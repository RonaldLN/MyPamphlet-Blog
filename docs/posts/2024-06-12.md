---
draft: false
date: 2024-06-12
authors:
  - ronald_luo
categories:
  - Configure & Debug
comments: true
---

# æ ‘è“æ´¾4Bç³»ç»Ÿçƒ§å½•ã€è®¾ç½®VNCViewerã€é…ç½®YOLOv8è¿‡ç¨‹è®°å½•

ç”±äºä¹‹å‰æ‹¿åˆ°çš„sdå¡ä¸Šçƒ§å½•çš„æ ‘è“æ´¾ç³»ç»Ÿæ˜¯32ä½çš„ï¼Œæ˜¯armv7læ¶æ„ï¼Œæ‰€ä»¥å¾ˆå¤špythonåŒ…éƒ½æ²¡æœ‰ç¼–è¯‘å¥½çš„whlæ–‡ä»¶ï¼Œäºæ˜¯é‡æ–°è·Ÿè€å¸ˆè¦äº†ä¸€å¼ æ–°çš„sdå¡ï¼Œæ‰“ç®—é‡æ–°çƒ§å½•64ä½çš„ç³»ç»Ÿ

<!-- more -->

## çƒ§å½•æ ‘è“æ´¾ç³»ç»Ÿ

æ ¹æ®å®˜ç½‘æ–‡æ¡£ä¸Šçš„æŒ‡ç¤ºæ“ä½œï¼Œ[ä½¿ç”¨ Imager å®‰è£…](https://www.raspberrypi.com/documentation/computers/getting-started.html#raspberry-pi-imager)

[` Install an operating system` - Getting started - Raspberry Pi Documentation](https://www.raspberrypi.com/documentation/computers/getting-started.html#installing-the-operating-system)

## è®¾ç½®VNCViewer

å¯ä»¥å‚è€ƒRealVNCçš„å®˜æ–¹æ–‡æ¡£è¿›è¡Œæ“ä½œ

[RealVNC Connect and Raspberry Pi â€“ RealVNC Help Center](https://help.realvnc.com/hc/en-us/articles/360002249917-RealVNC-Connect-and-Raspberry-Pi)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯èƒ½éœ€è¦åœ¨æ ‘è“æ´¾æ¥å£çš„è®¾ç½®ä¸­æŠŠVNCæ‰“å¼€(å¦‚æœä¹‹å‰æ²¡æœ‰æ‰“å¼€è¿‡çš„è¯)

>   select **Menu > Preferences > Raspberry Pi Configuration > Interfaces** and make sure **VNC** is set to **Enabled**.
>
>   Alternatively, run the command `sudo raspi-config`, navigate to **Interface Options > VNC** and select **Yes**.

ç„¶ååœ¨ç”µè„‘ä¸Šçš„vncviewerä¸­è¾“å…¥æ ‘è“æ´¾çš„IPå°±å¯ä»¥è¿æ¥æ ‘è“æ´¾äº†(ç”µè„‘å’Œæ ‘è“æ´¾éœ€è¦è¿æ¥åŒä¸€ä¸ªwifi)

## é…ç½®YOLOv8

ç”±äº[YOLOv8å®˜æ–¹æ–‡æ¡£](https://docs.ultralytics.com/guides/raspberry-pi/#start-with-docker)ä¸­æ¨èä½¿ç”¨Dockerè¿›è¡Œå®‰è£…ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ ‘è“æ´¾ä¸Šå…ˆå®‰è£…Docker

### å®‰è£…Docker

æ ¹æ®Dockerå®˜æ–¹æ–‡æ¡£

[Install Docker Engine on Raspberry Pi OS (32-bit) | Docker Docs](https://docs.docker.com/engine/install/raspberry-pi-os/)

!!! warning "Important"

    This installation instruction refers to the 32-bit (armhf) version of Raspberry Pi OS. If you're using the 64-bit (arm64) version, follow the instructions for [Debian](https://docs.docker.com/engine/install/debian/).

ç”±äº [**Install using the `apt` repository**](https://docs.docker.com/engine/install/debian/#install-using-the-repository) ä¸­çš„æ–¹æ³•åœ¨å°è¯•æ—¶å‘ç°è¿æ¥ä¸ä¸Šï¼Œäºæ˜¯ä½¿ç”¨ [**Install from a package**](https://docs.docker.com/engine/install/debian/#install-from-a-package) ä¸­çš„æ–¹æ³•

>   æŸ¥çœ‹Debianç³»ç»Ÿçš„ç‰ˆæœ¬å·
>
>   ```bash
>   lsb_release -a
>   ```
>
>   æŸ¥çœ‹ç³»ç»Ÿçš„æ¶æ„
>
>   ```bash
>   uname -a
>   ```
>
>   >   ```bash
>   >   ronald@raspberrypi:~ $ lsb_release -a
>   >   No LSB modules are available.
>   >   Distributor ID:	Debian
>   >   Description:	Debian GNU/Linux 12 (bookworm)
>   >   Release:	12
>   >   Codename:	bookworm
>   >   ronald@raspberrypi:~ $ uname -a
>   >   Linux raspberrypi 6.6.31+rpt-rpi-v8 #1 SMP PREEMPT Debian 1:6.6.31-1+rpt1 (2024-05-29) aarch64 GNU/Linux
>   >   ```
>   >
>   >   aarch64 å’Œ arm64 ä¼¼ä¹æ˜¯åŒä¸€ç§æ¶æ„

---

### é€šè¿‡sshè¿æ¥æ ‘è“æ´¾

>   ç”±äºéœ€è¦ä¼ è¾“æ–‡ä»¶

usernameå°±æ˜¯æ ‘è“æ´¾çš„ç”¨æˆ·åï¼Œipåœ°å€å°±æ˜¯æ ‘è“æ´¾çš„ipåœ°å€åœ¨vscodeæˆ–è€…mobaxtermä¸Šè®¾ç½®å¥½è¿æ¥ï¼Œç„¶åè¾“å…¥å¯†ç å³å¯

>   å¯ä»¥å‚è€ƒæ ‘è“æ´¾å®˜æ–¹æ–‡æ¡£
>
>   [Remote access - Raspberry Pi Documentation](https://www.raspberrypi.com/documentation/computers/remote-access.html#ssh)

---

```bash
dpkg: dependency problems prevent configuration of docker-ce:
 docker-ce depends on iptables; however:
  Package iptables is not installed.
```

äºæ˜¯å®‰è£…iptables

```bash
sudo apt-get install iptables
```

ç„¶åå°±å®‰è£…å¥½äº†docker-ce

### å®‰è£…Clash Vergeå¹¶è¿›è¡Œç›¸åº”é…ç½®

ç”±äºå®‰è£…å¥½dockerä¹‹åï¼Œå°è¯•è¿è¡Œ[YOLOv8å®˜æ–¹æ–‡æ¡£](https://docs.ultralytics.com/guides/raspberry-pi/#start-with-docker)ä¸­çš„å‘½ä»¤

```bash
t=ultralytics/ultralytics:latest-arm64 && sudo docker pull $t && sudo docker run -it --ipc=host $t
```

å‘ç°èƒ½è¿è¡Œï¼Œä½†æ˜¯ä¼¼ä¹è¿æ¥ä¸ä¸Šï¼Œ

è€Œæœç´¢äº†ä¸€ä¸‹dockeræ¢æºçš„æ–¹æ³•ä¼¼ä¹åˆæ²¡æœ‰æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•(åˆšå¥½å‰å‡ å¤©docker hubå¾ˆå¤šé•œåƒè¢«å…³åœäº†)ï¼Œäºæ˜¯æ‰“ç®—å®‰è£…clash vergeç›´æ¥è®©æ ‘è“æ´¾ç¿»å¢™ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ä»dockerå®‰è£…YOLOv8ã€‚

äºæ˜¯ä¸‹è½½clash-verge arm64çš„debå®‰è£…æ–‡ä»¶

>   [clash-verge-rev/clash-verge-rev: Continuation of Clash Verge - A Clash Meta GUI based on Tauri (Windows, MacOS, Linux) (github.com)](https://github.com/clash-verge-rev/clash-verge-rev)

å¹¶å®‰è£…ï¼Œå®‰è£…å¥½ä¹‹åè¿è¡Œ `clash-verge` å‘½ä»¤å¯åŠ¨ã€‚

æ­¤æ—¶å°è¯•è¿è¡Œä¸Šé¢å®‰è£…yolov8çš„å‘½ä»¤è¿˜æ˜¯è¿æ¥å¤±è´¥ï¼Œ

ç„¶åæ ¹æ®è¿™ä¸¤ä¸ªæ–‡ç« ï¼Œè®¾ç½®äº†ä¸€ä¸‹

>   -   [å¦‚ä½•åœ¨æ ‘è“æ´¾ä¸Šä½¿ç”¨ Clash | MR-Addict çš„ä¸ªäººä¸»é¡µ (mraddict.top)](https://mraddict.top/posts/clash-on-rpi/index.html#%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE%E7%BB%88%E7%AB%AF%E4%BB%A3%E7%90%86)
>   -   [å¦‚ä½•é…ç½®Dockerç½‘ç»œä»£ç† - ByteHandler - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/bytehandler/p/17105379.html)

1.   **ç»ˆç«¯**çš„ä»£ç†

     ```bash
     sudo vim /etc/environment
     ```

     æ·»åŠ å¦‚ä¸‹å†…å®¹

     ```bash
     export http_proxy="http://127.0.0.1:7897"
     export https_proxy="http://127.0.0.1:7897"
     export no_proxy="localhost, 127.0.0.1, *edu.cn"
     ```

2.   **Docker**çš„ä»£ç†

     **==æ›´æ–°docker.service==**

     æ›´æ–°`/lib/systemd/system/docker.service`é…ç½®æ–‡ä»¶

     ```yaml
     [Service]
     Environment="HTTP_PROXY=http://127.0.0.1:7897"
     Environment="HTTPS_PROXY=http://127.0.0.1:7897"
     ```

     **é‡å¯docker**

     ```bash
     sudo systemctl daemon-reload
     sudo systemctl restart docker
     ```

ç„¶åé‡æ–°è¿è¡Œå‘½ä»¤

```bash
t=ultralytics/ultralytics:latest-arm64 && sudo docker pull $t && sudo docker run -it --ipc=host $t
```

å°±å¯ä»¥ä»dockerå®‰è£…YOLOv8äº†(ç»ˆäºğŸ˜­)

### Dockerçš„ä¸€äº›æ“ä½œ

é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å®¹å™¨

```bash
sudo docker ps [-aq]
```

`-aq` åˆ™åŒ…å«å·²ç»åœæ­¢çš„æ‰€æœ‰å®¹å™¨ï¼Œ

```bash
ronald@raspberrypi:~ $ sudo docker ps
CONTAINER ID   IMAGE                                  COMMAND   CREATED          STATUS          PORTS     NAMES
1ccc998a556f   ultralytics/ultralytics:latest-arm64   "bash"    12 minutes ago   Up 12 minutes             eager_lumiere
```

å­˜æ¡£å®¹å™¨çš„çŠ¶æ€

```bash
sudo docker commit 1ccc998a556f myyolo:v1
```

å†æ¬¡ä»è¿™ä¸ªçŠ¶æ€å¯åŠ¨

```bash
sudo docker run -it --ipc=host myyolo:v1
```

å¦‚æœè¦å¯åŠ¨æŸä¸€ä¸ªå®¹å™¨å¹¶æ‰“å¼€å®ƒçš„ç»ˆç«¯(é€šè¿‡å®¹å™¨id)

```bash
sudo docker start 63ecca25cf60
sudo docker exec -it 63ecca25cf60 /bin/bash
```

---

### ä½¿ç”¨pipå®‰è£…YOLOv8

ç”±äºå°è¯•äº†å¾ˆä¹…ï¼Œä¸€ç›´æ— æ³•æˆåŠŸåœ¨dockerå®¹å™¨ä¸­æ‰“å¼€æ ‘è“æ´¾æ‘„åƒå¤´ï¼Œ

>   æœŸé—´å‚è€ƒäº†è¿™ä¸ªæ–‡ç« è¿›è¡Œå°è¯•
>
>   [How to Access the Raspberry Pi Camera in Docker (losant.com)](https://www.losant.com/blog/how-to-access-the-raspberry-pi-camera-in-docker)
>
>   `How to Let Non-Root Users Access the Raspberry Pi Camera` ä¸­ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„udevè§„åˆ™å
>
>   ```bash title="/etc/udev/rules.d/99-camera.rules"
>   SUBSYSTEM=="vchiq",MODE="0666"
>   ```
>
>   åœ¨å¯åŠ¨å®¹å™¨æ—¶å°±å¯ä»¥æ·»åŠ è®¾å¤‡äº†ï¼Œä½†æ˜¯è¦æ³¨æ„ `--device` å‚æ•°éœ€è¦æ”¾åœ¨å‰é¢
>
>   ```bash
>   sudo docker run -it --ipc=host --device /dev/vchiq myyolo:v2
>   ```

äºæ˜¯æ‰“ç®—ä¸é€‚ç”¨dockerå®‰è£…yolov8ã€‚

ç›´æ¥

```bash
pip install ultralytics
```

å‘ç°ï¼Œäº§ç”Ÿäº†æŠ¥é”™

```bash
ronald@raspberrypi:~ $ pip install ultralytics
error: externally-managed-environment

Ã— This environment is externally managed
â•°â”€> To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Debian-packaged Python package,
    create a virtual environment using python3 -m venv path/to/venv.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
    sure you have python3-full installed.
    
    For more information visit http://rptl.io/venv

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
hint: See PEP 668 for the detailed specification.
```

äºæ˜¯æŸ¥çœ‹ [http://rptl.io/venv](http://rptl.io/venv)

>   Starting in Raspberry Pi OS *Bookworm*, packages installed via `pip` *must be installed into a Python virtual environment* (`venv`). A virtual environment is a container where you can safely install third-party modules so they wonâ€™t interfere with your system Python.
>
>   ---
>
>   ä» Raspberry Pi OS *Bookworm* å¼€å§‹ï¼Œé€šè¿‡ `pip` å®‰è£…çš„è½¯ä»¶åŒ…*å¿…é¡»å®‰è£…åˆ° Python è™šæ‹Ÿç¯å¢ƒä¸­* ( `venv` )ã€‚è™šæ‹Ÿç¯å¢ƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å®‰å…¨åœ°å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šå¹²æ‰°æ‚¨çš„ç³»ç»Ÿ Pythonã€‚

äºæ˜¯æŒ‰ç…§ç½‘ç«™ä¸Šçš„æŒ‡ç¤ºï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»ç¯å¢ƒ

```bash
python -m venv yolo
source yolo/bin/activate
```

ç„¶åå†

```bash
pip install ultralytics
```

å°±å¯ä»¥å®‰è£…yolov8äº†

```bash
Successfully installed MarkupSafe-2.1.5 certifi-2024.6.2 charset-normalizer-3.3.2 contourpy-1.2.1 cycler-0.12.1 filelock-3.15.1 fonttools-4.53.0 fsspec-2024.6.0 idna-3.7 jinja2-3.1.4 kiwisolver-1.4.5 matplotlib-3.9.0 mpmath-1.3.0 networkx-3.3 numpy-1.26.4 opencv-python-4.10.0.82 packaging-24.1 pandas-2.2.2 pillow-10.3.0 psutil-5.9.8 py-cpuinfo-9.0.0 pyparsing-3.1.2 python-dateutil-2.9.0.post0 pytz-2024.1 pyyaml-6.0.1 requests-2.32.3 scipy-1.13.1 seaborn-0.13.2 six-1.16.0 sympy-1.12.1 torch-2.3.1 torchvision-0.18.1 tqdm-4.66.4 typing-extensions-4.12.2 tzdata-2024.1 ultralytics-8.2.31 ultralytics-thop-0.2.8 urllib3-2.2.1
```

[`Inference with Camera` - Raspberry Pi - Ultralytics YOLO Docs](https://docs.ultralytics.com/guides/raspberry-pi/#inference-with-camera) ä¸­ç»™å‡ºçš„ä½¿ç”¨æ ‘è“æ´¾æ‘„åƒå¤´çš„æ–¹æ³•æ˜¯ä½¿ç”¨picamera2è¿™ä¸ªåŒ…ï¼Œäºæ˜¯å®‰è£…

```bash
pip install picamera2
```

è¿‡ç¨‹ä¸­å‡ºç°è¿™ä¸ªæŠ¥é”™

```bash
Collecting python-prctl
  Using cached https://mirrors.bfsu.edu.cn/pypi/web/packages/c0/99/be5393cfe9c16376b4f515d90a68b11f1840143ac1890e9008bc176cf6a6/python-prctl-1.8.1.tar.gz (28 kB)
  Preparing metadata (setup.py) ... error
  error: subprocess-exited-with-error
  
  Ã— python setup.py egg_info did not run successfully.
  â”‚ exit code: 1
  â•°â”€> [1 lines of output]
      You need to install libcap development headers to build this module
      [end of output]
  
  note: This error originates from a subprocess, and is likely not a problem with pip.
error: metadata-generation-failed

Ã— Encountered error while generating package metadata.
â•°â”€> See above for output.

note: This is an issue with the package mentioned above, not pip.
hint: See above for details.
```

éœ€è¦å®‰è£…libcap-dev

```bash
sudo apt-get install libcap-dev
```

ä¹‹åå†å®‰è£…picamera2å°±å¯ä»¥å®‰è£…ä¸Šäº†

---

ä½†æ˜¯å‘ç°ï¼Œåœ¨åˆ›å»ºvenvè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œæ·»åŠ  `--system-site-packages` å°±å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„pythonåŒ…äº†

>   å‚è€ƒäº†è¿™é‡Œ
>
>   [How to install picamera2 - Raspberry Pi Forums](https://forums.raspberrypi.com/viewtopic.php?t=367558#p2204296)

ç„¶åpicamera2å°±å¯ä»¥ä¸ç”¨å†å®‰è£…äº†ã€‚

æœ€åè¿è¡Œ [`Inference with Camera`](https://docs.ultralytics.com/guides/raspberry-pi/#__tabbed_5_1) ä¸­çš„ç¬¬1ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œå¹¶å°†æƒé‡æ¢æˆä¹‹å‰å¯¼å‡ºçš„ncnnæ ¼å¼çš„æƒé‡ï¼Œ

```python hl_lines="15"
import cv2
from picamera2 import Picamera2

from ultralytics import YOLO

# Initialize the Picamera2
picam2 = Picamera2()
picam2.preview_configuration.main.size = (1280, 720)
picam2.preview_configuration.main.format = "RGB888"
picam2.preview_configuration.align()
picam2.configure("preview")
picam2.start()

# Load the YOLOv8 model
model = YOLO("yolov8n_ncnn_model")

while True:
    # Capture frame-by-frame
    frame = picam2.capture_array()

    # Run YOLOv8 inference on the frame
    results = model(frame)

    # Visualize the results on the frame
    annotated_frame = results[0].plot()

    # Display the resulting frame
    cv2.imshow("Camera", annotated_frame)

    # Break the loop if 'q' is pressed
    if cv2.waitKey(1) == ord("q"):
        break

# Release resources and close windows
cv2.destroyAllWindows()
```

å°±å¯ä»¥ç›´æ¥ä½¿ç”¨æ‘„åƒå¤´æ¥è¿›è¡Œè¯†åˆ«åŠŸèƒ½äº†ğŸ˜†

![raspberry_pi_yolov8](../images/raspberry_pi_yolov8.png){ loading=lazy }

![raspberry_pi_yolov8_detect_1](../images/raspberry_pi_yolov8_detect_1.png){ loading=lazy }

![raspberry_pi_yolov8_detect_2](../images/raspberry_pi_yolov8_detect_2.png){ loading=lazy }

