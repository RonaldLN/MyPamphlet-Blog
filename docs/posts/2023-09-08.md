---
draft: false
date: 2023-09-08
authors:
  - ronald_luo
categories:
  - Chronicle of Events
---

# 2023æ•°æ¨¡å›½èµ›è®°å½•

>   2023-09-07 --- 2023-09-10

æ•´ä¸ªä¸‰å¤©çš„ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œ[github copilot](https://ronaldln.github.io/MyPamphlet/git%E7%9B%B8%E5%85%B3/github%20copilot/)çš„ä½¿ç”¨ä½¿æ•ˆç‡å¾—åˆ°äº†æå¤§çš„æé«˜ï¼Œä»¥è‡³äº*å¤šæ¬¡å‘å‡ºæ„Ÿå¹â€œæ¸¸æˆç»“æŸå•¦ï¼â€*ğŸ˜ã€*å¤šæ¬¡æƒŠå‘¼â€œwocï¼Œå®ƒæ€ä¹ˆçŸ¥é“æˆ‘è¦å†™ä»€ä¹ˆï¼Ÿï¼â€*(ğŸ˜‚)ï¼Œcopilotçš„å¸®åŠ©åŒ…æ‹¬ä½†ä¸é™äº **è¾“å…¥éœ€æ±‚ç”Ÿæˆæ‰€éœ€å‡½æ•°** ã€ **è¾…åŠ©å¡«å†™ä»£ç ** ç­‰ï¼Œå¤§é‡èŠ‚çœçš„äº†æ—¶é—´å’Œç²¾åŠ›

<!-- more -->

## é—®é¢˜ä¸€

å‘ç°è¦å¤„ç†excelè¡¨æ ¼ä¸­çš„æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨ä¹‹å‰åœ¨[æ‰‹å†Œä¸Šè®°å½•çš„ä»£ç ](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/openpyxl%28%E7%94%A8%E4%BA%8Eexcel%29/#1)

å¾—åˆ°ä¸€ä¸ªäºŒç»´çš„åˆ—è¡¨ï¼Œ

ç„¶åç”±äºè¦å°†æ¯ä¸ªå•†å“æ¯ä¸ªå­£åº¦çš„é”€é‡æ±‚å’Œï¼Œå¹¶ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾ï¼Œæ‰“ç®—å°†æ•°æ®å­˜åœ¨ä¸€ä¸ªæ–°çš„å­—å…¸ä¸­ï¼Œ

è€Œæœ¬æ¥æ˜¯æ‰“ç®—é‡‡ç”¨å†å¼€ä¸€ä¸ªåˆ—è¡¨æ¥è®°å½•å·²ç»è®°å½•è¿‡ä¿¡æ¯çš„å•†å“(è®°å½•è¿‡å°±å¯ä»¥ç›´æ¥åŠ ä¸Šï¼Œæ²¡è®°å½•è¿‡è¿˜éœ€è¦åˆå§‹åŒ–ä¸€ä¸‹)ï¼Œç»“æœå‘ç°ï¼Œå¹¶ä¸éœ€è¦å¼€ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œ[å­—å…¸å¯ä»¥ç›´æ¥åˆ¤æ–­æ˜¯å¦å«æœ‰æŸä¸ªkey](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/#1)ï¼š

```python
# codes = []
xiaoliang = {}
for data in datas2:
    if data[2] not in xiaoliang:
        # codes.append(data[2])
        xiaoliang[data[2]] = {y * 100 + s: 0 for y in range(2020, 2024) for s in range(1, 5)}
    xiaoliang[data[2]][get_season(data[0])] += data[3]
```

å¹¶ä¸”ï¼Œ[ç›´æ¥ä»å­—å…¸ä¸­*è§£å‹*å‡ºæ¥çš„ä¹Ÿæ˜¯key](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/#1)ï¼Œå¦‚

```python
for xl in xiaoliang:
    new_xl = [round(xiaoliang[xl][x], 3) for x in xiaoliang[xl]]
    xiaoliang[xl] = new_xl
```

---

å¹¶ä¸”ï¼Œä»excelä¸­è¯»å‡ºæ¥çš„æ•°æ®çš„æ—¶é—´æ˜¯ `datetime` ç±»å‹çš„ï¼Œä¸çŸ¥é“è¦å¦‚ä½•è·å–å•ç‹¬çš„å¹´ä»½å’Œæœˆä»½ï¼Œ

æ‰€ä»¥å†™æ³¨é‡Šè®©copilotè‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªå‡½æ•°(ç¨åŠ ä¿®æ”¹ä»¥è·å–æƒ³è¦çš„æ ¼å¼)ï¼š

```python
# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¼ å…¥datetimeï¼Œåˆ¤æ–­åœ¨å“ªä¸€å¹´çš„å“ªä¸ªå­£åº¦ä¸­
def get_season(date):
    season = 0
    if date.month in [1, 2, 3]:
        season = 1
    elif date.month in [4, 5, 6]:
        season = 2
    elif date.month in [7, 8, 9]:
        season = 3
    elif date.month in [10, 11, 12]:
        season = 4
    return int(date.year * 100 + season)
```

æ‰çŸ¥é“datetimeè·å–æœˆä»½å¹´ä»½å¯ä»¥ç”¨ *`.å±æ€§`* çš„æ–¹æ³•è·å¾—å¹´ä»½å’Œæœˆä»½ç­‰ä¿¡æ¯([æ‰‹å†Œ](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/#7))

---

ä»¥åŠï¼Œç”±äºä¸çŸ¥ä»€ä¹ˆåŸå› ï¼Œä»excelè¯»å‡ºçš„æ•°æ®ä¸¢å¤±äº†ä¸€äº›ç²¾åº¦ï¼Œæ‰€ä»¥éœ€è¦å››èˆäº”å…¥ä¸€ä¸‹ï¼Œé€šè¿‡copilotçŸ¥é“[èˆå…¥å¯ä»¥å€ŸåŠ© `round()` å‡½æ•°](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/#6)

---

æœ€åç”±äºåœ¨ä½¿ç”¨å†™å…¥excelçš„å‡½æ•°æ—¶ï¼Œä¸çŸ¥ä¸ºä½•æŠ¥é”™ï¼Œæ‰€ä»¥è®©copilotç”Ÿæˆäº†ä¸€ä¸ª[æŠŠåˆ—è¡¨å†™å…¥csvæ–‡ä»¶çš„å‡½æ•°](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/#8)ï¼š

```python
# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†æ•°æ®å†™å…¥ csv æ–‡ä»¶ä¸­
def write_data(file_name, data_list):
    # æ‰“å¼€ csv æ–‡ä»¶
    with open(file_name, "w", encoding="utf-8") as f:
        # ä½¿ç”¨å¾ªç¯å°†æ•°æ®å†™å…¥ csv æ–‡ä»¶ä¸­
        for data in data_list:
            # å°†åˆ—è¡¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²
            data_str = ",".join([str(x) for x in data])
            # å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­
            f.write(data_str + "\n")
```

ç„¶åå‘ç°è¾“å‡ºçš„csvæ–‡ä»¶ç”¨excelæ‰“å¼€æ˜¾ç¤ºä¹±ç ï¼Œåˆ¤æ–­æ˜¯ç¼–ç çš„é—®é¢˜ï¼Œæµ‹è¯•åœ¨pycharmä¸­ç›´æ¥æ‰“å¼€æ˜¾ç¤ºæ­£å¸¸ï¼Œæ‰€ä»¥ä½¿ç”¨vscodeæ‰“å¼€å¹¶æ›´æ”¹ç¼–ç æ ¼å¼ä¸ºgbkï¼Œæœ€ååœ¨excelä¸­æ­£å¸¸æ‰“å¼€

å¹¶ä¸”ä¹‹åå‡ æ¬¡ä½¿ç”¨å†™å…¥csvæ–‡ä»¶çš„å‡½æ•°æˆ‘å°±ç›´æ¥è®¾ç½®ä¸º `encoding=gbk` å°±ä¸éœ€è¦å†å€’ä¸€æ‰‹

---

åœ¨å¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œæ‰“ç®—å°†å­—å…¸è½¬æ¢æˆåˆ—è¡¨ï¼Œäºæ˜¯åˆè®©copilotç”Ÿæˆäº†ä¸€ä¸ª[è½¬æ¢çš„å‡½æ•°](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/#2)ï¼Œç„¶åå‘ç°å­—å…¸çš„ `.items()` æ–¹æ³•å¯ä»¥è·å–keyå’Œvalueï¼Œ `.values()` æ–¹æ³•å¯ä»¥åªè·å–value

## é—®é¢˜äºŒ

ç”±äºé—®é¢˜äºŒè¦å¤„ç†çš„excelæ–‡ä»¶æ•°æ®å¾ˆå¤šï¼Œæ¯æ¬¡ä½¿ç”¨è¯»å–excelçš„å‡½æ•°è¯»å–è¯¥æ–‡ä»¶éƒ½éœ€è¦èŠ±å¤§æ¦‚ä¸€åˆ†é’Ÿå·¦å³çš„æ—¶é—´ï¼Œå†™å…¥çš„æ—¶é—´ä¹Ÿä¸æ…¢ã€‚ç„¶åçªç„¶æƒ³åˆ° `json` çš„æ–‡ä»¶æ ¼å¼(æ˜¯ä¸€ç§ï¼Œå­˜å‚¨çš„æ•°æ®æ ¼å¼è·Ÿpythonä¸­å­—å…¸å’Œåˆ—è¡¨å‡ ä¹ä¸€æ ·çš„æ ¼å¼ï¼Œæœ€å¤–å±‚å¿…éœ€æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„å…ƒç´ å¯ä»¥æ˜¯åˆ—è¡¨æˆ–è€…å­—å…¸)ï¼Œæ‰€ä»¥è®©copilotç”Ÿæˆäº†[è¯»å–å’Œå†™å…¥jsonæ–‡ä»¶çš„å‡½æ•°](https://ronaldln.github.io/MyPamphlet/python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/#5)

```python
import json


# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†dictå­˜åˆ°æŒ‡å®šçš„jsonæ–‡ä»¶ä¸­
def write_data(file_name, data):
    # æ‰“å¼€jsonæ–‡ä»¶
    with open(file_name, "w", encoding="utf-8") as f:
        # å°†æ•°æ®å†™å…¥jsonæ–‡ä»¶ä¸­
        json.dump(data, f, ensure_ascii=False, indent=4)


# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»jsonæ–‡ä»¶ä¸­è¯»å–æ•°æ®
def read_data(file_name):
    # æ‰“å¼€jsonæ–‡ä»¶
    with open(file_name, "r", encoding="utf-8") as f:
        # è¯»å–jsonæ–‡ä»¶ä¸­çš„æ•°æ®
        data = json.load(f)
        # è¿”å›æ•°æ®
        return data
```

ç»è¿‡æµ‹è¯•ï¼Œä»¥ä¸Šé¢æ‰€è¯´çš„excelçš„æ–‡ä»¶ä¸­æ•°æ®æ¥è¯»å–å’Œå†™å…¥jsonæ–‡ä»¶ï¼Œé€Ÿåº¦éƒ½éå¸¸çš„å¿«ï¼Œåªéœ€è¦å‡ ç§’åˆ°åå‡ ç§’çš„æ—¶é—´

---

åœ¨ä½¿ç”¨äº†jsonæ–‡ä»¶æ ¼å¼å­˜å‚¨æ•°æ®ä¹‹åï¼Œå³ä½¿éœ€è¦è¿™ä¸€é—®é¢˜ä¸­å¯¹æ•°æ®çš„å¤„ç†æ¯”è¾ƒéº»çƒ¦ï¼Œè¦åˆ†æˆå‡ æ­¥å»å¤„ç†ï¼Œä½†æœ€ç»ˆä¹ŸåªèŠ±äº†å¤§çº¦ä¸åˆ°3å°æ—¶å°±å¤„ç†å¥½äº†æœ€åçš„æ•°æ®

??? note "c_4.py"

    ```python
    # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†listæˆ–è€…dictå­˜åˆ°æŒ‡å®šçš„jsonæ–‡ä»¶ä¸­
    import json


    
    def write_data(file_name, data):
        # æ‰“å¼€jsonæ–‡ä»¶
        with open(file_name, "w", encoding="utf-8") as f:
            # å°†æ•°æ®å†™å…¥jsonæ–‡ä»¶ä¸­
            json.dump(data, f, ensure_ascii=False, indent=4)


    
    # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»jsonæ–‡ä»¶ä¸­è¯»å–æ•°æ®
    def read_data(file_name):
        # æ‰“å¼€jsonæ–‡ä»¶
        with open(file_name, "r", encoding="utf-8") as f:
            # è¯»å–jsonæ–‡ä»¶ä¸­çš„æ•°æ®
            data = json.load(f)
            # è¿”å›æ•°æ®
            return data


    
    datas3 = read_data("3.json")["data"]
    datas3_2 = {}
    for data in datas3:
        if data[-1] not in datas3_2:  # !!!
            datas3_2[data[-1]] = [data[:-1]]
        else:
            datas3_2[data[-1]] += [data[:-1]]
    
    datas3_3 = {key: {} for key in datas3_2}
    
    for data in datas3_2:
        for x in datas3_2[data]:
            if x[0] not in datas3_3[data]:
                datas3_3[data][x[0]] = [x[1:]]
            else:
                datas3_3[data][x[0]] += [x[1:]]
    
    datas3_4 = {key: {key_2: {key_3: [value] for _, value, key_3 in datas3_3[key][key_2]} for key_2 in datas3_3[key]} for key in datas3_3}
    
    # for data in datas3_3:
    #     for x in datas3_3[data]:
    #         for y in datas3_3[data][x]:
    #             if y[0] not in datas3_4[data][x]:
    #                 datas3_4[data][x][y[0]] = [y[1:]]
    #             else:
    #                 datas3_4[data][x][y[0]] += [y[1:]]


    
    #
    # for data in temp_res:
    #     for x in temp_res[data]:
    #         temp_res[data][x] = round(temp_res[data][x], 3)
    
    write_data("3_4.json", datas3_4)
    # datas3_res = temp_res
    
    # print(datas3_res)
    ```

??? note "c_5.py"

    ```python
    # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†listæˆ–è€…dictå­˜åˆ°æŒ‡å®šçš„jsonæ–‡ä»¶ä¸­
    import json


    
    def write_data(file_name, data):
        # æ‰“å¼€jsonæ–‡ä»¶
        with open(file_name, "w", encoding="utf-8") as f:
            # å°†æ•°æ®å†™å…¥jsonæ–‡ä»¶ä¸­
            json.dump(data, f, ensure_ascii=False, indent=4)


    
    # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»jsonæ–‡ä»¶ä¸­è¯»å–æ•°æ®
    def read_data(file_name):
        # æ‰“å¼€jsonæ–‡ä»¶
        with open(file_name, "r", encoding="utf-8") as f:
            # è¯»å–jsonæ–‡ä»¶ä¸­çš„æ•°æ®
            data = json.load(f)
            # è¿”å›æ•°æ®
            return data


    
    # datas2 = read_data("2.json")["data"]
    # datas2_2 = {}
    # for data in datas2:
    #     if data[-1] not in datas2_2:  # !!!
    #         datas2_2[data[-1]] = [data[:-1]]
    #     else:
    #         datas2_2[data[-1]] += [data[:-1]]
    
    # datas2_2 = read_data("2_2.json")
    # datas2_3 = {key: {} for key in datas2_2}
    #
    # for data in datas2_2:
    #     for x in datas2_2[data]:
    #         if x[0] not in datas2_3[data]:
    #             datas2_3[data][x[0]] = [x[1:]]
    #         else:
    #             datas2_3[data][x[0]] += [x[1:]]
    #
    # datas2_4 = {key: {key_2: {time: [sales, price, name] for time, _, sales, price, _, _, name in datas2_3[key][key_2]} for key_2 in datas2_3[key]} for key in datas2_3}
    
    datas2_4 = read_data("2_4.json")
    datas3_4 = read_data("3_4.json")
    datas2_5 = {key: {key_2: {"total sales": 0, "total price": 0, "total cost": 0} for key_2 in datas2_4[key]} for key in datas2_4}
    for data in datas2_4:
        for x in datas2_4[data]:
            for y in datas2_4[data][x]:
                sales, price, name = datas2_4[data][x][y]
                datas2_5[data][x]["total sales"] += sales
                datas2_5[data][x]["total price"] += price * sales
                datas2_5[data][x]["total cost"] += datas3_4[data][x][name][0] * sales
                # i = datas3_4[data][x][name][0]


    
    #
    # for data in temp_res:
    #     for x in temp_res[data]:
    #         temp_res[data][x] = round(temp_res[data][x], 3)
    
    write_data("2_5.json", datas2_5)
    # datas3_res = temp_res
    
    # print(datas3_res)
    ```

??? note "c_6.py"

    ```python
    # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†listæˆ–è€…dictå­˜åˆ°æŒ‡å®šçš„jsonæ–‡ä»¶ä¸­
    import json


    
    def write_data(file_name, data):
        # æ‰“å¼€jsonæ–‡ä»¶
        with open(file_name, "w", encoding="utf-8") as f:
            # å°†æ•°æ®å†™å…¥jsonæ–‡ä»¶ä¸­
            json.dump(data, f, ensure_ascii=False, indent=4)


    
    # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»jsonæ–‡ä»¶ä¸­è¯»å–æ•°æ®
    def read_data(file_name):
        # æ‰“å¼€jsonæ–‡ä»¶
        with open(file_name, "r", encoding="utf-8") as f:
            # è¯»å–jsonæ–‡ä»¶ä¸­çš„æ•°æ®
            data = json.load(f)
            # è¿”å›æ•°æ®
            return data


    
    datas2_5 = read_data("2_5.json")
    for data in datas2_5:
        for x in datas2_5[data]:
            datas2_5[data][x]["total profit"] = datas2_5[data][x]["total price"] - datas2_5[data][x]["total cost"]
            datas2_5[data][x]["profit rate"] = datas2_5[data][x]["total profit"] / datas2_5[data][x]["total price"]
            for y in datas2_5[data][x]:
                datas2_5[data][x][y] = round(datas2_5[data][x][y], 6)
    
    write_data("2_6.json", datas2_5)
    ```

## é—®é¢˜ä¸‰

ç”±äºéœ€è¦è·å–å­—å…¸çš„å…¨éƒ¨valueï¼Œå› æ­¤ä½¿ç”¨ `.values()` æ–¹æ³•æ¥è·å–å­—å…¸çš„å…¨éƒ¨valueï¼Œä½†å‘ç°è¿”å›çš„ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ˜¯ä¸€ä¸ª `dict_values` å¯¹è±¡ï¼Œå› æ­¤ä½¿ç”¨ `list()` æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºåˆ—è¡¨ã€‚

```python
datas2_6_1 = read_data("2_6_1.json")
datas2_6_1_list = []
for data in datas2_6_1:
    for x in datas2_6_1[data]:
        datas2_6_1_list.append([x] + list(datas2_6_1[data][x].values()))
    write_data_to_excel("2_6_1.xlsx", data, datas2_6_1_list)
```

---

æœ¬æ¥æ‰“ç®—ä½¿ç”¨ sympy æ¥æ±‚å–ä½¿åˆ©æ¶¦æœ€å¤§çš„åˆ©æ¶¦ç‡ï¼Œè€Œå‡½æ•°ä¸­æœ‰å¯¹æ•°å‡½æ•°ï¼Œæœ¬æ¥ä½¿ç”¨çš„æ˜¯mathé‡Œçš„ `log()` å‡½æ•°ï¼Œä½†å‡ºç°æŠ¥é”™ï¼Œæœ€åè¯¢é—®chatgptå‘ç°éœ€è¦ä½¿ç”¨ sympy åŒ…é‡Œé¢çš„ `log(x, y)` å‡½æ•°(xä¸ºçœŸæ•°ï¼Œyä¸ºåº•æ•°)

(å¦‚æœåœ¨å¯¼å…¥sympyåŒ…æ—¶ï¼Œä½¿ç”¨ `from sympy import *` åˆ™å¯èƒ½ä¼šä½¿å¾— python çš„ math é‡Œçš„æ±‚å¯¹æ•°çš„å‡½æ•°è¢«è¦†ç›–)

