---
draft: false
date: 2025-03-29
authors:
  - ronald_luo
categories:
  - Configure & Debug
comments: true
---

# é€šè¿‡å®ç°åœ¨Github Actionä¸­å°†æ–‡ä»¶æ¨é€åˆ°å¦ä¸€ä¸ªä»“åº“ä¸­ï¼Œå®ç°privateæ–‡æ¡£ä»“åº“æ„å»ºçš„é¡µé¢è‡ªåŠ¨éƒ¨ç½²åˆ°publicä»“åº“ä¸­

å› ä¸ºæƒ³è¦æ„å»ºçš„ç½‘é¡µåŒ…å«å¯†ç ï¼Œè€Œæˆ‘åˆæƒ³ä½¿ç”¨github actionæ¥åœ¨mainåˆ†æ”¯æ¨é€æ—¶è‡ªåŠ¨æ„å»ºé¡µé¢ï¼Œæ‰€ä»¥å­˜å‚¨æ–‡æ¡£çš„ä»“åº“ä¸­å°±éœ€è¦åŒ…å«è®¾ç½®å¯†ç çš„ `passwords.yml`ï¼Œå› æ­¤ä»“åº“çš„å±æ€§å°±éœ€è¦è®¾ç½®æˆprivate(è¦ä¸ç„¶ç›´æ¥ç¿»ä»“åº“å°±èƒ½çœ‹åˆ°å¯†ç äº†ğŸ˜…)ã€‚

è€Œå…è´¹çš„githubçš„ç»„ç»‡ä¸­ï¼Œprivateçš„ä»“åº“ä¸èƒ½å¼€å¯github pagesï¼Œæ‰€ä»¥ä¸€ç§åŠæ³•æ˜¯(æ–‡æ¡£å­˜å‚¨åœ¨privateä»“åº“ä¸­è€Œ)æŠŠæ„å»ºçš„é¡µé¢æ”¾ç½®åœ¨å¦ä¸€ä¸ªpublicçš„ä»“åº“ä¸­<del>(å¦ä¸€ç§åŠæ³•å°±æ˜¯ç›´æ¥æ°ªé‡‘)</del>ã€‚åˆå› ä¸ºæˆ‘æƒ³è¦åªæ¨é€ä¸€æ¬¡æ–‡æ¡£å°±å¯ä»¥è®©github actionè‡ªåŠ¨éƒ¨ç½²å¥½<del>(æ‡’æƒ°æ˜¯äººç±»è¿›æ­¥çš„é˜¶æ¢¯)</del>ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™æ¬¡çš„è®°å½•ã€‚

<!-- more -->

ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯ï¼Œåœ¨éƒ¨ç½²çš„ä»“åº“ä¸­ï¼Œæ£€æµ‹æ–‡æ¡£ä»“åº“çš„æ¨é€ï¼Œç„¶åå…‹éš†æ–‡æ¡£è¿›è¡Œæ„å»ºï¼Œ

[Google æœç´¢äº† `how to github action deploy a public repo and get a private repo`](https://www.google.com/search?q=how+to+github+action+deploy+a+public+repo+and+get+a+private+repo&sca_esv=ba1bbeed3c806847&sxsrf=AHTn8zqvZ6dxXUX3rjWcJuIqmsmriFDpvQ%3A1743176034668&ei=YsHmZ9G9KMeM4-EPt-GhyQY&ved=0ahUKEwjR9s7ijK2MAxVHxjgGHbdwKGkQ4dUDCBA&uact=5&oq=how+to+github+action+deploy+a+public+repo+and+get+a+private+repo&gs_lp=Egxnd3Mtd2l6LXNlcnAiQGhvdyB0byBnaXRodWIgYWN0aW9uIGRlcGxveSBhIHB1YmxpYyByZXBvIGFuZCBnZXQgYSBwcml2YXRlIHJlcG9IsMEBUABYoLwBcAp4AZABBZgB7gmgAcu7AaoBDzItMzUuMTguNS4zLjUuMbgBA8gBAPgBAZgCQ6AC5Z4BqAIKwgIHECMYJxjqAsICCxAAGIAEGLEDGIMBwgIFEAAYgATCAg4QLhiABBixAxjRAxjHAcICERAuGIAEGLEDGNEDGIMBGMcBwgIOEAAYgAQYsQMYgwEYigXCAgQQIxgnwgIIEAAYgAQYsQPCAgsQLhiABBjHARivAcICBRAuGIAEwgIIEC4YgAQY1ALCAggQABiABBjLAcICCxAuGIAEGNQCGMsBwgIKECMYgAQYJxiKBcICBBAAGB7CAgYQABgIGB7CAggQABiABBiiBMICBRAAGO8FwgIFECEYoAHCAgcQIRigARgKwgIEECEYCpgDL_EFcRd2hhgeAb6SBxAxMC4wLjI5LjE3LjYuNC4xoAeepQKyBw0yLTI5LjE3LjYuNC4xuAfrnQE&sclient=gws-wiz-serp)

å¾—åˆ°äº†stackoverflowä¸Šè¿™ä¸ªå¸–å­

-   [python - Cloning private github repository within organisation in actions - Stack Overflow](https://stackoverflow.com/questions/57612428/cloning-private-github-repository-within-organisation-in-actions)

å…¶ä¸­ [Nato Boramçš„æœ€é«˜èµå›ç­”](https://stackoverflow.com/a/70283191) æåˆ°äº†æ¯”è¾ƒ**å…³é”®**çš„ä¸€ä¸ªè®¾ç½®ï¼Œ

!!! quote "åŸæ–‡"

    Since access tokens are bound to an account and have write access to all its private repos, it's a very bad solution.
    
    Instead, use [deploy keys](https://docs.github.com/en/developers/overview/managing-deploy-keys#deploy-keys).
    
    Deploy keys are simply SSH keys that you can use to clone a repo.
    
    1.  Create a new SSH key pair on your computer
    2.  Put the *public key* in the private dependency repo's *Deploy keys*
    3.  Put the *private key* in the app repo's *Actions secrets*
    4.  Delete the keys from your computer
    
    ...

!!! tip "ç¿»è¯‘(æœºç¿»)"

    ç”±äºè®¿é—®ä»¤ç‰Œç»‘å®šåˆ°è´¦æˆ·ï¼Œå¹¶ä¸”å…·æœ‰å¯¹å…¶æ‰€æœ‰ç§æœ‰ä»“åº“çš„å†™è®¿é—®æƒé™ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è§£å†³æ–¹æ¡ˆã€‚
    
    è€Œåº”ä½¿ç”¨[éƒ¨ç½²å¯†é’¥](https://docs.github.com/en/developers/overview/managing-deploy-keys#deploy-keys)ã€‚
    
    éƒ¨ç½²å¯†é’¥æ˜¯ä½ å¯ä»¥ç”¨æ¥å…‹éš†ä»“åº“çš„ SSH å¯†é’¥ã€‚
    
    1.  åœ¨ä½ çš„ç”µè„‘ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ SSH å¯†é’¥å¯¹ã€‚
    2.  å°†*å…¬é’¥*æ”¾å…¥ç§æœ‰ä¾èµ–ä»“åº“çš„*éƒ¨ç½²å¯†é’¥*ä¸­ã€‚
    3.  å°†*ç§é’¥*æ”¾å…¥åº”ç”¨ä»“åº“çš„*Actions secrets*ä¸­ã€‚
    4.  ä»ä½ çš„ç”µè„‘ä¸Šåˆ é™¤å¯†é’¥
    
    ...

è¿™æ ·ä¸€ä¸ªä»“åº“å°±å¯¹å¦ä¸€ä¸ªä»“åº“æœ‰äº†è¯»/å†™çš„æƒé™ã€‚

---

è¿™æ—¶æˆ‘æƒ³åˆ°ï¼Œé‚£æˆ‘èƒ½ä¸èƒ½è®¾ç½®æ–‡æ¡£ä»“åº“å¯¹éƒ¨ç½²çš„ä»“åº“æœ‰å†™å…¥çš„æƒé™ï¼Œç„¶ååœ¨æ–‡æ¡£ä»“åº“ä¸­ç¼–å†™github workflowï¼Œæœ€åè‡ªåŠ¨æ„å»ºå¹¶æ¨é€åˆ°éƒ¨ç½²çš„ä»“åº“ä¸­ã€‚

äºæ˜¯è¯¢é—®äº†ä¸€ä¸‹deepseek

??? example "å¯¹è¯è®°å½•"

    **You**:
    
    åœ¨ä¸€ä¸ªgithubç»„ç»‡ä¸‹ï¼Œåœ¨ä¸€ä¸ªprivateä»“åº“mainåˆ†æ”¯æ¨é€æ—¶ä¼šè§¦å‘github actionï¼Œè¿™ä¸ªactionä¼šå¯¹mainåˆ†æ”¯è¿›è¡Œæ„å»ºå¹¶å‘å¸ƒåˆ°gh-pagesåˆ†æ”¯ä¸­ï¼Œæˆ‘æƒ³åœ¨è¿™ä¸ªgithub actionä¸­æ·»åŠ è®¾ç½®ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨æ„å»ºä¹‹åä¸€å¹¶æ¨é€åˆ°å¦ä¸€ä¸ªä»“åº“çš„gh-pagesåˆ†æ”¯ä¸­ï¼Œè¿™è¦å¦‚ä½•å®ç°å‘¢ï¼Ÿ
    
    &nbsp;
    
    **DeepSeek**:
    
    ??? quote "å·²æ·±åº¦æ€è€ƒï¼ˆç”¨æ—¶ 15 ç§’ï¼‰"
    
        >   å—¯ï¼Œç”¨æˆ·çš„é—®é¢˜æ˜¯æƒ³åœ¨ç°æœ‰çš„GitHub Actionå·¥ä½œæµä¸­æ·»åŠ ä¸€ä¸ªæ­¥éª¤ï¼Œå°†æ„å»ºåçš„å†…å®¹æ¨é€åˆ°å¦ä¸€ä¸ªä»“åº“çš„gh-pagesåˆ†æ”¯ã€‚æˆ‘éœ€è¦å…ˆç†è§£ç”¨æˆ·å½“å‰çš„å·¥ä½œæµç¨‹ï¼Œç„¶åæ‰¾åˆ°å¦‚ä½•æ‰©å±•å®ƒæ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚
        >
        >   é¦–å…ˆï¼Œç”¨æˆ·å½“å‰çš„Actionåº”è¯¥æ˜¯åœ¨mainåˆ†æ”¯æ¨é€æ—¶è§¦å‘ï¼Œæ„å»ºé¡¹ç›®å¹¶å‘å¸ƒåˆ°åŒä¸€ä»“åº“çš„gh-pagesåˆ†æ”¯ã€‚ç°åœ¨ä»–ä»¬éœ€è¦å°†åŒæ ·çš„å†…å®¹æ¨é€åˆ°å¦ä¸€ä¸ªä»“åº“çš„gh-pagesåˆ†æ”¯ã€‚
        >
        >   æ ¹æ®æˆ‘ä¹‹å‰çœ‹åˆ°çš„æœç´¢ç»“æœï¼Œæ¯”å¦‚ç½‘é¡µ78æåˆ°ä½¿ç”¨cpina/github-action-push-to-another-repositoryè¿™ä¸ªActionï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¥éª¤ä¸­æ·»åŠ ä¸€ä¸ªä½¿ç”¨è¯¥Actionçš„æ­¥éª¤ã€‚è¿™ä¸ªActionä¸“é—¨ç”¨äºå°†æ–‡ä»¶æ¨é€åˆ°å¦ä¸€ä¸ªä»“åº“ï¼Œéœ€è¦æä¾›ç›®æ ‡ä»“åº“çš„ä¿¡æ¯å’Œæƒé™ã€‚
        >
        >   ç„¶åéœ€è¦è€ƒè™‘æƒé™é—®é¢˜ã€‚æ¨é€å¦ä¸€ä¸ªä»“åº“éœ€è¦è®¿é—®ä»¤ç‰Œã€‚ç½‘é¡µ1æåˆ°ä½¿ç”¨GITHUB_TOKENï¼Œä½†è¿™æ˜¯å½“å‰ä»“åº“çš„æƒé™ï¼Œå¯èƒ½æ— æ³•è®¿é—®å…¶ä»–ä»“åº“ã€‚æ‰€ä»¥ç”¨æˆ·éœ€è¦åœ¨ç›®æ ‡ä»“åº“åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPATï¼‰ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å½“å‰ä»“åº“çš„Secretsä¸­ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ65å’Œ78ä¸­éƒ½æœ‰ç±»ä¼¼çš„ä¾‹å­ï¼Œä½¿ç”¨secrets.GITEE_TOKENæˆ–è€…API_TOKEN_GITHUBã€‚
        >
        >   æ¥ä¸‹æ¥æ˜¯é…ç½®æ­¥éª¤ã€‚ç”¨æˆ·éœ€è¦æŒ‡å®šæºç›®å½•ï¼ˆæ„å»ºåçš„ç›®å½•ï¼Œæ¯”å¦‚distï¼‰ã€ç›®æ ‡ä»“åº“çš„ç”¨æˆ·åã€ä»“åº“åã€ç›®æ ‡åˆ†æ”¯ï¼ˆgh-pagesï¼‰ä»¥åŠè®¿é—®ä»¤ç‰Œã€‚å¯èƒ½è¿˜éœ€è¦è®¾ç½®ç”¨æˆ·é‚®ç®±å’Œåç§°ï¼Œä»¥ä¾¿æäº¤è®°å½•æ­£ç¡®æ˜¾ç¤ºã€‚
        >
        >   å¦å¤–ï¼Œç½‘é¡µ68çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä»å¤šä¸ªåˆ†æ”¯æ£€å‡ºä»£ç å¹¶åˆå¹¶ï¼Œä½†ç”¨æˆ·çš„æƒ…å†µå¯èƒ½åªéœ€è¦æ¨é€æ„å»ºåçš„æ–‡ä»¶åˆ°å¦ä¸€ä¸ªä»“åº“ã€‚å› æ­¤ï¼Œå¯ä»¥è·³è¿‡å¤šåˆ†æ”¯æ£€å‡ºçš„æ­¥éª¤ï¼Œç›´æ¥ä½¿ç”¨æ¨é€Actionã€‚
        >
        >   éœ€è¦æ³¨æ„çš„æ½œåœ¨é—®é¢˜åŒ…æ‹¬è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œä»¤ç‰Œæƒé™æ˜¯å¦è¶³å¤Ÿï¼ˆéœ€è¦repoæƒé™ï¼‰ï¼Œä»¥åŠæ˜¯å¦éœ€è¦å¿½ç•¥.gitç›®å½•ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ68ä¸­åˆ é™¤äº†å­ç›®å½•çš„.gitæ–‡ä»¶å¤¹ï¼Œé¿å…åµŒå¥—ä»“åº“çš„é—®é¢˜ï¼Œè¿™å¯èƒ½ä¹Ÿéœ€è¦åœ¨ç”¨æˆ·çš„æ­¥éª¤ä¸­å¤„ç†ã€‚
        >
        >   æœ€åï¼Œæµ‹è¯•å·¥ä½œæµæ˜¯å¦æˆåŠŸè¿è¡Œï¼Œæ£€æŸ¥ç›®æ ‡ä»“åº“çš„gh-pagesåˆ†æ”¯æ˜¯å¦æœ‰æ›´æ–°ï¼Œå¹¶å¤„ç†å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œæ¯”å¦‚æƒé™ä¸è¶³æˆ–è·¯å¾„é”™è¯¯ã€‚
    
    åœ¨ç°æœ‰çš„GitHub Actionså·¥ä½œæµä¸­å®ç°è·¨ä»“åº“æ¨é€æ„å»ºç»“æœåˆ°å¦ä¸€ä¸ªä»“åº“çš„`gh-pages`åˆ†æ”¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š
    
    ---
    
    <h3>ä¸€ã€æ ¸å¿ƒå®ç°æ–¹æ¡ˆ</h3>
    
    1. **ä½¿ç”¨è·¨ä»“åº“æ¨é€çš„GitHub Action**  
       æ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹Action `cpina/github-action-push-to-another-repository`ï¼Œå®ƒä¸“ä¸ºè·¨ä»“åº“æ¨é€è®¾è®¡ï¼Œå¯è‡ªåŠ¨å¤„ç†æ–‡ä»¶å¤åˆ¶å’Œæäº¤ã€‚ä»¥ä¸‹æ˜¯å…³é”®é…ç½®ç¤ºä¾‹ï¼š
       ```yaml
       - name: Push to external repo
         uses: cpina/github-action-push-to-another-repository@v1
         env:
           SSH_PRIVATE_KEY: ${{ secrets.EXTERNAL_REPO_SSH_KEY }}
         with:
           source-directory: 'dist'  # æ„å»ºè¾“å‡ºç›®å½•
           destination-github-username: 'ç›®æ ‡ä»“åº“æ‰€å±ç»„ç»‡æˆ–ç”¨æˆ·'
           destination-repository-name: 'ç›®æ ‡ä»“åº“å'
           target-branch: gh-pages
           commit-message: "Update from source repo"
       ```
       *éœ€å°†`EXTERNAL_REPO_SSH_KEY`æ›¿æ¢ä¸ºç›®æ ‡ä»“åº“çš„SSHå¯†é’¥æˆ–è®¿é—®ä»¤ç‰Œ*
    
    2. **æ›¿ä»£æ–¹æ¡ˆï¼šæ‰‹åŠ¨Gitæ“ä½œ**  
       è‹¥éœ€æ›´å¤šæ§åˆ¶ï¼Œå¯é€šè¿‡è„šæœ¬ç›´æ¥æ“ä½œGitï¼š
       ```yaml
       - name: Configure Git for external repo
         run: |
           git config --global user.email "actions@github.com"
           git config --global user.name "GitHub Actions"
           cd dist
           git init
           git remote add external https://${{ secrets.EXTERNAL_TOKEN }}@github.com/ç›®æ ‡ç»„ç»‡/ç›®æ ‡ä»“åº“.git
           git add .
           git commit -m "Build: $(date)"
           git push external HEAD:gh-pages --force
       ```
       *æ­¤æ–¹å¼éœ€åœ¨Secretsä¸­é…ç½®ç›®æ ‡ä»“åº“çš„è®¿é—®ä»¤ç‰Œï¼ˆéœ€`repo`æƒé™ï¼‰*
    
    ---
    
    <h3>äºŒã€æƒé™é…ç½®è¦ç‚¹</h3>
    
    1. **è®¿é—®ä»¤ç‰Œç±»å‹**  
        - **æ¨è**ï¼šåœ¨ç›®æ ‡ä»“åº“ç”Ÿæˆ**Fine-grained PAT**ï¼Œä»…æˆäºˆ`Contents: Read and write`æƒé™ï¼Œé™åˆ¶ä½œç”¨èŒƒå›´ä¸ºç‰¹å®šä»“åº“   
        - æˆ–ä½¿ç”¨ä¼ ç»ŸPersonal Access Tokenï¼ˆéœ€`repo`æƒé™ï¼‰ï¼Œå­˜å‚¨åˆ°å½“å‰ä»“åº“çš„Secretsä¸­ï¼ˆå¦‚`EXTERNAL_TOKEN`ï¼‰
    
    2. **å¯†é’¥å®‰å…¨æ€§**  
        - é¿å…æ˜æ–‡å­˜å‚¨ä»¤ç‰Œï¼Œå¿…é¡»é€šè¿‡GitHub Secretsæ³¨å…¥ç¯å¢ƒå˜é‡
        - SSHå¯†é’¥éœ€å°†ç§é’¥å­˜å…¥Secretsï¼Œå…¬é’¥é…ç½®åˆ°ç›®æ ‡ä»“åº“çš„Deploy Keysä¸­ 
    
    ---
    
    <h3>ä¸‰ã€å®Œæ•´å·¥ä½œæµç¤ºä¾‹</h3>
    
    ```yaml
    name: Build and Cross-Deploy
    on:
      push:
        branches: [main]
    
    jobs:
      build:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
    
          - name: Install dependencies
            run: npm ci
    
          - name: Build project
            run: npm run build
    
          - name: Deploy to current repo
            uses: peaceiris/actions-gh-pages@v3
            with:
              github_token: ${{ secrets.GITHUB_TOKEN }}
              publish_dir: ./dist
    
          - name: Deploy to external repo
            uses: cpina/github-action-push-to-another-repository@v1
            env:
              API_TOKEN_GITHUB: ${{ secrets.EXTERNAL_TOKEN }}
            with:
              source-directory: 'dist'
              destination-github-username: 'ç›®æ ‡ç»„ç»‡'
              destination-repository-name: 'ç›®æ ‡ä»“åº“'
              target-branch: gh-pages
              user-email: "actions@github.com"
    ```
    
    ---
    
    <h3>å››ã€å¸¸è§é—®é¢˜å¤„ç†</h3>
    
    1. **è·¯å¾„å†²çª**  
        -   è‹¥ç›®æ ‡ä»“åº“å·²æœ‰å†…å®¹ï¼Œå»ºè®®æ·»åŠ `clean: true`å‚æ•°æ¸…ç©ºç›®æ ‡åˆ†æ”¯ 
        -   è‹¥éœ€ä¿ç•™å†å²ï¼Œå¯å…ˆå…‹éš†ç›®æ ‡ä»“åº“å†åˆå¹¶æ›´æ–°
    
    2. **åµŒå¥—.gitç›®å½•**  
       æ„å»ºç›®å½•è‹¥åŒ…å«.gitæ–‡ä»¶å¤¹ï¼Œéœ€åˆ é™¤é¿å…å†²çªï¼š
       ```yaml
       - run: rm -rf dist/.git  # åœ¨æ¨é€å‰æ‰§è¡Œ
       ```
    
    3. **è§¦å‘å¾ªç¯**  
       æ·»åŠ è·¯å¾„è¿‡æ»¤ï¼Œé¿å…å¤–éƒ¨ä»“åº“çš„æ¨é€å†æ¬¡è§¦å‘å½“å‰å·¥ä½œæµï¼š
       ```yaml
       on:
         push:
           paths-ignore:
             - 'dist/**'
       ```
    
    ---
    
    <h3>äº”ã€éªŒè¯ä¸è°ƒè¯•</h3>
    
    1. **æŸ¥çœ‹Actionsæ—¥å¿—**  
       æ£€æŸ¥æ­¥éª¤è¾“å‡ºæ˜¯å¦æ˜¾ç¤ºæˆåŠŸæäº¤åˆ°ç›®æ ‡ä»“åº“
    
    2. **ç›®æ ‡ä»“åº“éªŒè¯**  
       è®¿é—®`https://ç›®æ ‡ç»„ç»‡.github.io/ç›®æ ‡ä»“åº“/`æŸ¥çœ‹é¡µé¢æ˜¯å¦æ›´æ–°
    
    3. **åˆ†æ”¯ä¿æŠ¤è®¾ç½®**  
       è‹¥ç›®æ ‡ä»“åº“å¯ç”¨åˆ†æ”¯ä¿æŠ¤è§„åˆ™ï¼Œéœ€åœ¨Settingsä¸­å…è®¸Actionsæäº¤åˆ°`gh-pages`åˆ†æ”¯ 
    
    é€šè¿‡ä¸Šè¿°é…ç½®ï¼Œå¯å®ç°è‡ªåŠ¨åŒ–è·¨ä»“åº“éƒ¨ç½²ï¼Œé€‚ç”¨äºéœ€è¦åŒæ­¥å¤šä¸ªå±•ç¤ºç¯å¢ƒæˆ–åˆ†ç¦»æºç ä¸äº§ç‰©çš„åœºæ™¯ã€‚

deepseekçš„å›å¤ä¸­æåˆ°äº† [cpina/github-action-push-to-another-repository](https://github.com/cpina/github-action-push-to-another-repository) è¿™ä¸ªactionï¼Œäºæ˜¯æœç´¢äº†å®ƒå¯¹åº”çš„ä»“åº“å»æŸ¥çœ‹å®ƒçš„ç”¨æ³•ã€‚

>   See the extensive documentation in [https://cpina.github.io/push-to-another-repository-docs/](https://cpina.github.io/push-to-another-repository-docs/) (includes examples, FAQ, troubleshooting, etc.).
>
>   GitHub repository of the documentation: [https://github.com/cpina/push-to-another-repository-docs](https://github.com/cpina/push-to-another-repository-docs)

äºæ˜¯å»æŸ¥çœ‹[è¯´æ˜æ–‡æ¡£çš„ç½‘é¡µ](https://cpina.github.io/push-to-another-repository-docs/)ï¼Œçœ‹åˆ°æœ‰ [`Example setup`](https://cpina.github.io/push-to-another-repository-docs/generic-example.html)ï¼Œ

>   <h2>[Example setup<br>ç¤ºä¾‹è®¾ç½®](https://cpina.github.io/push-to-another-repository-docs/generic-example.html#example-setup)</h2>
>
>   This example shows both setup methods. This is part of a *GitHub workflow* Action, for example, in your repository: `.github/workflow/ci.yml`.<br>æœ¬ç¤ºä¾‹å±•ç¤ºäº†ä¸¤ç§è®¾ç½®æ–¹æ³•ã€‚è¿™æ˜¯ GitHub å·¥ä½œæµåŠ¨ä½œçš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œåœ¨ä½ çš„ä»“åº“ä¸­ï¼š `.github/workflow/ci.yml` ã€‚
>
>   Note that only one of the lines, `SSH_DEPLOY_KEY` or `API_TOKEN_GITHUB`, are needed [according to the chosen setup](https://cpina.github.io/push-to-another-repository-docs/setup.html#setup) that is being used.<br>æ³¨æ„ï¼Œ[æ ¹æ®æ‰€é€‰æ‹©çš„è®¾ç½®](https://cpina.github.io/push-to-another-repository-docs/setup.html#setup)ï¼Œåªéœ€è¦ä¸€è¡Œï¼Œå³ `SSH_DEPLOY_KEY` æˆ– `API_TOKEN_GITHUB` ä¹‹ä¸€ã€‚
>
>   ```yaml hl_lines="17-30"
>   name: CI
>   
>   on:
>     push:
>       branches: [ main ]
>     pull_request:
>       branches: [ main ]
>   
>   jobs:
>     build:
>       runs-on: ubuntu-latest
>       container: pandoc/latex    # "ubuntu" is a more generic container
>                                  # using "pandoc/latex" because of dependencies
>                                  # used in the specific "build.sh"
>       steps:
>         - uses: actions/checkout@v2
>         - name: creates output
>           run:  sh ./build.sh # some command from your repository that creates
>                               # output to "source-directory" ("output" in the example)
>         - name: Pushes to another repository
>           uses: cpina/github-action-push-to-another-repository@main
>           env:
>             SSH_DEPLOY_KEY: ${{ secrets.SSH_DEPLOY_KEY }}
>             API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
>           with:
>             source-directory: 'output'
>             destination-github-username: 'cpina'
>             destination-repository-name: 'pandoc-test-output'
>             user-email: carles3@pina.cat
>             target-branch: main
>   ```

ç„¶åæ„è¯†åˆ°åˆšæ‰é‚£ä¸ª[stackoverflowçš„å¸–å­çš„æœ€é«˜èµå›ç­”](https://stackoverflow.com/a/70283191)æåˆ°**åœ¨privateä»“åº“ä¸­**è®¾ç½®çš„ `PRIVATE_SSH_KEY` å°±å¯¹åº”è¿™é‡Œçš„ `SSH_DEPLOY_KEY`ï¼Œäºæ˜¯æˆ‘å¼€å§‹æŒ‰ç…§é‚£ä¸ªå›ç­”ä¸­çš„æ­¥éª¤è¿›è¡Œè®¾ç½®ã€‚

ç±»æ¯”ç”µè„‘æœ¬åœ°ä»“åº“(ssh)æ¨é€åˆ°githubè¿œç¨‹ä»“åº“ï¼Œéœ€è¦åœ¨githubè´¦æˆ·ä¸­æ·»åŠ *å…¬é’¥*ï¼Œè€Œ*ç§é’¥*ç•™åœ¨æœ¬åœ°ï¼Œæ‰€ä»¥æˆ‘æ–­å®šprivateçš„æ–‡æ¡£ä»“åº“çš„ `SSH_DEPLOY_KEY` è®¾ç½®çš„æ˜¯*ç§é’¥*ï¼Œè€Œpublicçš„éƒ¨ç½²ä»“åº“çš„*éƒ¨ç½²å¯†é’¥*ä¸­è®¾ç½®çš„æ˜¯*å…¬é’¥*ã€‚

ä½†è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘githubè´¦æˆ·å·²ç»è®¾ç½®äº†ssh keyï¼Œä½¿ç”¨çš„æ˜¯ `ed25519` çš„ç®—æ³•ç”Ÿæˆçš„ï¼Œåœ¨éƒ¨ç½²çš„ä»“åº“ä¸­å°è¯•ç»™*éƒ¨ç½²å¯†é’¥*æ·»åŠ è¿™ä¸ª(åŒä¸€ä¸ª)ssh keyæ—¶ï¼Œæ˜¾ç¤º

!!! failure

    Key is already in use

äºæ˜¯ä½¿ç”¨äº†[GitHub æ–‡æ¡£](https://docs.github.com/zh/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent)ä¸­æåˆ°çš„å¦ä¸€ä¸ªæ–¹æ³•(æ¢ç”¨rsaç®—æ³•)æ¥ç”Ÿæˆsshå¯†é’¥å¯¹

```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

è®¾ç½®å¥½ä¹‹åï¼Œç»“åˆ[github-action-push-to-another-repositoryçš„è¯´æ˜æ–‡æ¡£ä¸­çš„ç¤ºä¾‹](https://cpina.github.io/push-to-another-repository-docs/generic-example.html)å’Œæˆ‘ä¹‹å‰çš„ç¼–å†™çš„éƒ¨ç½²çš„yamlæ–‡ä»¶ï¼Œæœ€åå¾—åˆ°

```yaml title="gh-deploy.yaml" linenums="1"
name: Deploy MkDocs Site To Public Repo
on:
  push:
    branches: [ "main" ]  # ä»…åœ¨ main åˆ†æ”¯æ¨é€æ—¶è§¦å‘

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest  # ä½¿ç”¨ GitHub æä¾›çš„ Ubuntu ç¯å¢ƒ

    steps:
      - name: Checkout Main
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install Dependencies
        run: pip install -r requirements.txt

      - name: Build Site
        run: mkdocs build

      - name: Pushes to another repository
        uses: cpina/github-action-push-to-another-repository@main
        env:
          SSH_DEPLOY_KEY: ${{ secrets.SSH_DEPLOY_KEY }}
        with:
          source-directory: 'site'
          destination-github-username: 'NPU-Home'
          destination-repository-name: 'vision-docs-site'
          target-branch: gh-pages
```

ä¸è¿‡ç”±äºæˆ‘ä¸€å¼€å§‹åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªç©ºç™½çš„vision-docs-siteçš„ä»“åº“ï¼Œæ‰€ä»¥åœ¨github actionåœ¨æ¨é€æ—¶å‘ç”Ÿäº†é”™è¯¯

!!! failure

    ```yaml hl_lines="10-16"
    [+] Action start
    [+] Using SSH_DEPLOY_KEY
    [+] Git version
    git version 2.47.2
    [+] Enable git lfs
    Git LFS initialized.
    [+] Cloning destination git repository vision-docs-site
    Cloning into '/tmp/tmp.kGDePD'...
    fatal: Remote branch gh-pages not found in upstream origin
    Error: Could not clone the destination repository. Command:
    Error: git clone --single-branch --branch gh-pages 
      git@github.com:NPU-Home/vision-docs-site.git /tmp/tmp.kGDePD
    Error: (Note that if they exist USER_NAME and API_TOKEN is redacted by GitHub)
    Error: Please verify that the target repository exist AND that it contains 
      the destination branch name, and is accesible by the API_TOKEN_GITHUB OR 
      SSH_DEPLOY_KEY
    ```

æœ€ååœ¨vision-docs-siteä»“åº“ä¸­åˆ›å»ºäº†gh-pagesåˆ†æ”¯ä¹‹åï¼Œå† Re-run all jobs å°±èƒ½æˆåŠŸæ¨é€äº†ğŸ˜„
