
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../01/29/chatgptscheme-reduce/">
      
      
        <link rel="next" href="../../19/mkdocs-material/">
      
      
      <link rel="icon" href="../../../../icons/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>2024数模美赛参赛纪实(编程手视角) - My Pamphlet Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../css/timeago.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
      <link rel="stylesheet" href="https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css">
    
      <link rel="stylesheet" href="https://cdn.tonycrane.cc/lxgw/lxgwscreen.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap">
    
      <link rel="stylesheet" href="../../../../stylesheets/my_scheme.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/custom.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/card.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-H7SV12D750"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-H7SV12D750",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-H7SV12D750",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7a9cfe470ed52fa0c0940a58fede385c";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="sunset-glow" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2024" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="My Pamphlet Blog" class="md-header__button md-logo" aria-label="My Pamphlet Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Pamphlet Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2024数模美赛参赛纪实(编程手视角)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="sunset-glow" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="sunset-glow-dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/RonaldLN/MyPamphlet-Blog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RonaldLN/MyPamphlet-Blog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../.." class="md-tabs__link">
          
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  <!-- Add scripts that need to run before here -->
  
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="My Pamphlet Blog" class="md-nav__button md-logo" aria-label="My Pamphlet Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>

    </a>
    My Pamphlet Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/RonaldLN/MyPamphlet-Blog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RonaldLN/MyPamphlet-Blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    归档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    分类
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/configure-debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure & Debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/chronicle-of-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chronicle of Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/records-of-trivia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Records of Trivia
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#day-1" class="md-nav__link">
    Day 1
  </a>
  
    <nav class="md-nav" aria-label="Day 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    阅读题目 (早)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    了解网球规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    与老师讨论，确定选C题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    弄清楚字典中的各个术语
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    查找相关文献文章 (午)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    初步复习以及进一步了解机器学习/神经网络
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day-2" class="md-nav__link">
    Day 2
  </a>
  
    <nav class="md-nav" aria-label="Day 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rnnpython" class="md-nav__link">
    了解递归神经网络RNN的python实现 (早)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gru" class="md-nav__link">
    尝试实现GRU (午)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22cfgru" class="md-nav__link">
    理解22年C题F奖GRU相关代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    确定衡量势头的方法
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day-3" class="md-nav__link">
    Day 3
  </a>
  
    <nav class="md-nav" aria-label="Day 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#22cfgru_1" class="md-nav__link">
    继续理解22年C题F奖GRU相关代码 (早)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grupy" class="md-nav__link">
    尝试对 GRU模型.py 的代码进行修改以输入多维数据 (午)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tensorflowgru" class="md-nav__link">
    开始尝试使用TensorFlow来实现GRU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    debug并最终成功实现数据的训练和预测
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    用决赛数据进行训练和预测
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day-4-day-5" class="md-nav__link">
    Day 4 &amp; Day 5
  </a>
  
    <nav class="md-nav" aria-label="Day 4 & Day 5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    扩大决赛数据的预测部分 (5号早)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#h5" class="md-nav__link">
    尝试查看 .h5 权重文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    增添决赛的数据并再次训练 (5号午)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    着手处理全部的数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    用处理好的数据进行训练及预测 (5号晚)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    分析预测准确的数据 (6号凌晨)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    一点感受
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
  <!-- Add scripts that need to run afterwards here -->
  
    <script src="https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/javascripts/toc.js" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/fold_toc.css">
  

          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/assets/avatar.jpg" alt="Ronald Luo">
                    </span>
                    <span class="md-profile__description">
                      <strong>Ronald Luo</strong><br>
                      I'm A Student
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2024-02-12 00:00:00" class="md-ellipsis">2024年2月12日星期一</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../category/chronicle-of-events/">Chronicle of Events</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 47 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        

  
  


<h1 id="2024">2024数模美赛参赛纪实(编程手视角)<a class="headerlink" href="#2024" title="Permanent link">&para;</a></h1>
<div style="margin-top: -15px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> 约 14598 个字  • <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 1834 行代码 </p>
</div>
<blockquote>
<p>2024-02-02 --- 2024-02-06</p>
</blockquote>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>比赛时间为 2号早上6点公布题目，6号早上9点开始提交论文(北京时间)</p>
</div>
<h2 id="day-1">Day 1<a class="headerlink" href="#day-1" title="Permanent link">&para;</a></h2>
<h3 id="_1">阅读题目 (早)<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>早上8点起来，6点起来的队友已经将每个题目都大致看了一遍，然后开始边吃早餐边看题目边和队友讨论题目。</p>
<!-- more -->

<p>队友说，还是打算在MCM的三题(A B C题)里面选，所以我就着重看了这三题，D E F三题就只是简单扫了一眼了解了一下😅。</p>
<p>A题是关于 <em>七鳃鳗 lampreys</em> 的，大概是生态相关的问题。</p>
<p>B题是关于潜水艇，但看完后面的问题后，我感觉在建立相关的模型时，会需要地理相关的一些数据以及知识，感觉不是很好搞到这些数据。然后队友也说在读题目时有一个术语都不能准确理解具体是什么意思，所以我们优先排除了B题。</p>
<p>C题是关于网球，大概是需要根据提供的比赛时的数据，找到某种潜在的比赛球员赢球的 <strong><em>势头 momentum</em></strong>。</p>
<p>这时我和队友经过边看题边讨论，大概确定了选A题或C题，但还没最后确定选哪一题(队友说他打算第一天上午把题目确定好就行了)，然后我们就开始各自去查找资料(查找更多题目相关的资料来更深入了解题目，以便最终的选题确定)了。</p>
<h3 id="_2">了解网球规则<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>由于我理解的C题是需要寻找某种潜在的关系或者说规律，所以我觉得这很适合用<strong>机器学习</strong>来做，把C题所给的数据拿去跑。</p>
<p>于是我就开始去了解网球的规则(题目需要)，在b站上查看介绍网球比赛规则的相关视频，</p>
<ul>
<li><a href="https://b23.tv/oILc36E">网球规则解释（得分，术语等）_哔哩哔哩_bilibili</a></li>
<li><a href="https://b23.tv/WxzHiT1">网球记分规则｜Alex的知识分享，内附Alex亲自上场示范～_哔哩哔哩_bilibili</a></li>
</ul>
<p>看完这两个视频，明白了网球规则中的一些基础的概念，但还想再找更多的视频进行确认，而b站上感觉没有什么比较好且短的网球规则介绍视频了，于是我突然想到可以去油管上找，然后就找到一个帮助很大的视频(主要是英文的刚好能跟题目中的术语词汇对应上)，</p>
<ul>
<li><a href="https://youtu.be/1P_Das6OjAk">The Rules of Tennis - EXPLAINED! - YouTube</a></li>
</ul>
<h3 id="c">与老师讨论，确定选C题<a class="headerlink" href="#c" title="Permanent link">&para;</a></h3>
<p>到差不多11点左右，我们跟指导老师进行了讨论，老师当时主要看C题，并且也提到了可以运用机器学习去发掘潜在的关于<em>势头</em>的规律，(我的想法感觉跟老师不谋而合)于是我也跟老师说感觉这题适合用 神经网络 机器学习 来处理。</p>
<p>(我由于对模型和权重的概念还有些没厘清，于是向老师询问了一下)老师就进一步说到，这题大致的方案可以是先构建出模型，然后根据每个选手的数据训练出权重，最后应用权重在具体的数据上进行预测/估算。</p>
<p>因此我们最后决定了就选C题。</p>
<h3 id="_3">弄清楚字典中的各个术语<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>从11点半结束与老师的讨论，我们开始研究字典( <code>data_dictionary.csv</code> )中的那些变量名称，一直到12点左右各自去吃饭。其中几个比较关键的是</p>
<ul>
<li><code>serve_no</code> 发球次数，即(在当前分中)第1次还是第2次发球(第2次发球包含<em>双误 double fault</em>的情况)</li>
<li><code>ace</code> 发球得分，仅通过发球直接赢得这一分(在油管视频中有介绍)</li>
<li><code>xx_winner</code> 正面赢球，通过打出让对手接不到的球而得分(与之相对的是对手失误而得分)，因此可能存在 p1 p2 都为 0 的情况</li>
<li><code>xx_double_fault</code> 双误，发球方在当前分发球两次都失误(下网或发球出界)，则会使对方得分</li>
<li><code>xx_unf_err</code> <em>非受迫性失误 unforced error</em> ，类比羽毛球中的非受迫性失误，大概应该是主动失误丢分，像在<strong>不是拿点非常不好或者非常被动</strong>的情况下自己失误丢分</li>
<li><code>xx_net_pt</code> 网前回球，选手最后赢/输的那一球是在网前回的</li>
<li><code>xx_net_pt_won</code> 网前得分，与上面类似，只不过这球是赢了(感觉可能意味着拿点很好，因此会涨气势涨信心)</li>
<li><code>xx_break_pt</code> 在这一局中，作为接发方，并且如果赢下当前分则赢下这一局</li>
</ul>
<blockquote>
<p>因此最后我弄清楚的网球比分的规则和比赛得分的流程是这样的：</p>
</blockquote>
<details class="tip">
<summary>Tip</summary>
<p>网球比赛的记分从大到小有 <strong><em>盘 set</em></strong> <strong><em>局 game</em></strong> <strong><em>分 point</em></strong> ，通常是</p>
<ul>
<li>
<p><strong>5盘3胜</strong>(男单是这样，其他好像有些会不一样)，即赢下3盘赢得这场比赛</p>
</li>
<li>
<p>每盘中，赢下6局则赢得这盘比赛，但是<strong>需要领先两局</strong>，即如果出现 5:5 则需要赢下7局(类比羽毛球中 20:20 的加分)，而 6:6 则需要打 <strong><em>决胜局 tiebreaker</em></strong> ，赢下<em>决胜局</em>就赢得这盘(类比羽毛球中的29:29)</p>
</li>
<li>
<p>每局中，需要赢下4分，且也有类似于领先两分才能赢得这局的规定。</p>
<p>其中，还有 <strong><em>分数 score</em></strong> 的概念(来历可以看上面的第二个视频)，对应关系是</p>
<table>
<thead>
<tr>
<th style="text-align: center;">分 point</th>
<th style="text-align: center;">分数 score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0 (但读作 love)</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">15</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: center;">30</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: center;">40</td>
</tr>
</tbody>
</table>
<p>如果对手这一局没有拿到过3分，那么自己只需要赢下4分即可赢得这一局，如果对手拿到了3分，即分数中的40，则在之后的比分中会出现 <strong>AD (advantage)</strong> ，<strong>AD</strong>可以直接当作<strong>第4分</strong>，</p>
<p>而出现了分数40:40(即3:3)之后的记分规则是，在40:40(这个特殊局面也叫做 Deuce，但是在这一题的数据中没有出现相关的数据)时 赢下这分的进入AD，在下一分中，分数为AD的如果赢则赢得这一局，如果输则退回分数40(可以理解成分数会减少，即如果4:3输了就会变成3:3)</p>
<hr />
<p>在<em>决胜局 tiebreaker</em>中，则是需要赢下<strong>至少</strong>7分(如果<em>盘</em>比为2:2，则是需要赢下至少10分(所以也被叫做<strong>抢七</strong>或<strong>抢十</strong>))(<strong>至少</strong>也是因为需要比对手多至少两分，如果7:6则需要像羽毛球一样加分，并且无上限)</p>
</li>
</ul>
<hr />
<p>发球与接发，<strong>每一局中发球方是固定的</strong>，而下一局换成对方作为发球方，无论这局谁赢谁输(可以参考上面第二个视频后半部分的演示)</p>
<hr />
<p>在每一分中，发球方有两次发球的机会(即第一次发球如果失误，还能再次发球，即第一次发球失误不丢分)，如果两次发球均失误，即为<em>双误 double fault</em>，则失去这一分/对方得分，</p>
<p>而发球方发球成功/合法发球之后，则进入正常的对局，即如果哪一方没有成功回球或者回球出界/犯规等，另一方得分(就和羽毛球一样了)</p>
</details>
<h3 id="_4">查找相关文献文章 (午)<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>下午从2点半左右到4点半左右，我和队友在查找运用 机器学习 神经网络 来对比赛形势进行预测的相关文献文章，</p>
<p>我主要找到了这两篇文献，</p>
<blockquote>
<ul>
<li><a href="https://link.springer.com/article/10.1007/s42452-019-1821-5">A deep learning framework for football match prediction | Discover Applied Sciences (springer.com)</a></li>
<li><a href="https://www.mdpi.com/2073-431X/11/9/133">Computers | Free Full-Text | On Predicting Soccer Outcomes in the Greek League Using Machine Learning (mdpi.com)</a></li>
</ul>
</blockquote>
<p>本来我是像通过查找文献来看能不能找到一些对于编程方面有用的一些东西，但是发现不太行，</p>
<p>所以在跟队友讨论了一下这两篇之后，就让他去参考这两篇文章去弄写作的事情去了，</p>
<h3 id="_5">初步复习以及进一步了解机器学习/神经网络<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>然后我开始在b站上搜索 机器学习/神经网络 相关的学习视频，我这时的想法是，找到一个教怎么去实现使用机器学习/神经网络的视频，然后我先跟着视频去实现/复现简单的神经网络，然后再根据题目的要求去修改代码，<mark>最终能将题目提供的数据用来训练</mark></p>
<p>经过一番搜索，我发现了<strong>这个课程</strong>(一个非常好的课程，之前在23年4月在完成基地布置的考核任务时，任务中也有提到这个课程)，</p>
<p><a href="https://b23.tv/9N119Ny">合集·斯坦福2021秋季·实用机器学习【中文】【合集】-哔哩哔哩</a></p>
<p>浏览了一下每节课的标题，然后直接从<a href="https://b23.tv/Ovnm772">3.1节 8分钟机器学习介绍</a>开始看。</p>
<blockquote>
<p>看到了5点多，然后6点队友想跟我讨论另一篇文献，讨论了大约半小时之后去吃饭了，吃完饭又感觉有点困不小心睡着了😅，到9点左右醒过来了，于是继续开始看</p>
</blockquote>
<p>最后到这天晚上最后，大体看了这5节课</p>
<ul>
<li><a href="https://b23.tv/Ovnm772">3.1 8分钟机器学习介绍</a></li>
<li><a href="https://b23.tv/18zab4N">3.3 最简单也同样最常用的线性模型</a></li>
<li><a href="https://b23.tv/a8ERuyM">3.5 多层感知机</a></li>
<li><a href="https://b23.tv/fzoPdHl">3.6 卷积神经网络</a></li>
<li><a href="https://b23.tv/qS1V9QJ">3.7 循环神经网络</a></li>
</ul>
<p>重新熟悉了一遍神经网络的基本的一些相关概念和大致结构，然后还新了解了 <strong><em>卷积神经网络CNN</em></strong> <strong><em>递归神经网络RNN</em></strong> (之前只是知道这个名字，但不知道具体的与一般神经网络的区别以及各自的适用用途)。</p>
<p>根据我的看完之后的理解，大致是这样，CNN和RNN都是对于普通神经网络在特定用途下进行的改进的产物 或者说分支，</p>
<p>其中CNN是适用于处理图像的神经网络。由于一个图像包含的数据很大(300x300的像素就有9万个数据)，因此如果使用一般的神经网络，在迭代过程中会产生很多的参数。而图像又有一定的连续性(我的理解好像是这样的，但不知道是否准确)，因此使用<strong><em>卷积</em></strong>可以减小数据的量。</p>
<p><a class="glightbox" href="../../../../images/cnn_features.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="cnn_features" loading="lazy" src="../../../../images/cnn_features.png" /></a></p>
<p>所以CNN对于这题中的数据就用不上。</p>
<p>而RNN是适用于处理<strong>有时间序列信息的数据</strong>(我觉得可以直接理解成，数据是一串或多串连续的序列的情况)，如 正常语句的字符串 或者 用于价格预测的历史数据 之类的，就是说 <strong><mark>适用于 之前的数据有可能会影响到之后的数据 的情况</mark></strong></p>
<p><a class="glightbox" href="../../../../images/rnn_features.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="rnn_features" loading="lazy" src="../../../../images/rnn_features.png" /></a></p>
<p>所以觉得RNN适合用于这题的数据处理。</p>
<p>还了解到<strong>RNN有两个优化的产物 GRU 和 LSTM</strong> 。</p>
<p>但这个课程中的这几节课感觉讲的比较多的是一些概念性的东西，没有太多的实现，然后我就注意到这个大佬up主还有一门主要教授各种神经网络的实现(主要使用pytorch来实现)的课 <a href="https://b23.tv/yec4GOm">动手学深度学习v2</a>，然后通过<a href="https://space.bilibili.com/1567748478/search/video?keyword=rnn">在他主页上搜索 <code>rnn</code> </a>，发现了两节课是讲rnn的，我觉得其中应该会有实现的代码，</p>
<ul>
<li><a href="https://b23.tv/Fr7Ws3f">54 循环神经网络 RNN【动手学深度学习v2】_哔哩哔哩_bilibili</a></li>
<li><a href="https://b23.tv/w6dXNqj">55 循环神经网络 RNN 的实现【动手学深度学习v2】_哔哩哔哩_bilibili</a></li>
</ul>
<p>但由于这天已经比较累了，所以就打算明天看这两节课来学习怎么实现RNN</p>
<h2 id="day-2">Day 2<a class="headerlink" href="#day-2" title="Permanent link">&para;</a></h2>
<h3 id="rnnpython">了解递归神经网络RNN的python实现 (早)<a class="headerlink" href="#rnnpython" title="Permanent link">&para;</a></h3>
<p>早上起来，接着昨天的进度看。</p>
<p>在看 <a href="https://b23.tv/Fr7Ws3f">54 循环神经网络 RNN</a> 时，看到介绍RNN的应用的部分，就感觉C题的数据应该确实是可以用RNN来处理的，所以就差不多决定要使用RNN了</p>
<p><a class="glightbox" href="../../../../images/rnn_application.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="rnn_application" loadind="lazy" src="../../../../images/rnn_application.png" /></a></p>
<p>而在看 <a href="https://b23.tv/w6dXNqj">55 循环神经网络 RNN 的实现</a> 时，本来是想边看边把视频中的代码敲出来，然后理解代码的每个部分的作用，但是看到<a href="https://www.bilibili.com/video/BV1kq4y1H7sw/?t=2038"><strong><em>训练</em></strong></a>部分的时候，发现有点复杂，开始不是那么好理解了 有点难懂😅，于是就去看<a href="https://www.bilibili.com/video/BV1kq4y1H7sw?p=2">p2的简洁实现</a>了。</p>
<p>简洁实现 中的代码就没有那么多那么长了，于是我尝试运行，但发生了报错</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="ne">AttributeError</span><span class="p">:</span> <span class="n">module</span> <span class="s1">&#39;d2l.torch&#39;</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;load_data_time_machine&#39;</span>
</span></code></pre></div>
<p>显示 <code>d2l</code> 包中没有 <code>load_data_time_machine</code> 这个函数或类</p>
<blockquote>
<p><code>d2l</code> 包应该是这个课程对应的专门用于教学的包，因为课程的教材网站名就叫 d2l</p>
<blockquote>
<ul>
<li>中文版网站 <a href="https://zh-v2.d2l.ai/">《动手学深度学习》 — 动手学深度学习 2.0.0 documentation (d2l.ai)</a></li>
<li>英文版网站 <a href="https://d2l.ai/">Dive into Deep Learning — Dive into Deep Learning 1.0.3 documentation (d2l.ai)</a></li>
</ul>
</blockquote>
</blockquote>
<p>最后猜测可能是中文版教材中 <code>d2l</code> 包对应的版本比较老了，新版的包可能已经做了修改，于是去查看了<a href="https://d2l.ai/chapter_recurrent-neural-networks/rnn-concise.html">英文版教材中的代码</a>，复制出来然后尝试运行(我在两处 <code>predict</code> 的地方加了 <code>print</code> ，否则不会显示出结果)</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">F</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">from</span> <span class="nn">d2l</span> <span class="kn">import</span> <span class="n">torch</span> <span class="k">as</span> <span class="n">d2l</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="k">class</span> <span class="nc">RNN</span><span class="p">(</span><span class="n">d2l</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The RNN model implemented with high-level APIs.&quot;&quot;&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">):</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">)</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="k">class</span> <span class="nc">RNNLM</span><span class="p">(</span><span class="n">d2l</span><span class="o">.</span><span class="n">RNNLMScratch</span><span class="p">):</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The RNN-based language model implemented with high-level APIs.&quot;&quot;&quot;</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="k">def</span> <span class="nf">init_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LazyLinear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">)</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a>    <span class="k">def</span> <span class="nf">output_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hiddens</span><span class="p">):</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">hiddens</span><span class="p">)</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="n">data</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">TimeMachine</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="n">rnn</span> <span class="o">=</span> <span class="n">RNN</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">num_hiddens</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="n">model</span> <span class="o">=</span> <span class="n">RNNLM</span><span class="p">(</span><span class="n">rnn</span><span class="p">,</span> <span class="n">vocab_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">lr</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="c1"># model.predict(&#39;it has&#39;, 20, data.vocab)</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;it has&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">))</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="n">trainer</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">max_epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">gradient_clip_val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32"></a>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="c1"># model.predict(&#39;it has&#39;, 20, data.vocab, d2l.try_gpu()</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;it has&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="n">d2l</span><span class="o">.</span><span class="n">try_gpu</span><span class="p">()))</span>
</span></code></pre></div></td></tr></table></div>
<p>运行的结果</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>it<span class="w"> </span>hasiiidddyiididyiididyi
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>&lt;Figure<span class="w"> </span>size<span class="w"> </span>350x250<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>Axes&gt;
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>&lt;Figure<span class="w"> </span>size<span class="w"> </span>350x250<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>Axes&gt;
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>...
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>it<span class="w"> </span>has<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span>proment<span class="w"> </span>the
</span></code></pre></div>
<p>但课程中也有提到GRU和LSTM是一般RNN的改进，两者效果差不多，但GRU似乎比LSTM简单一些(LSTM好像要更复杂一些)，所以决定最后要使用GRU来处理题目所给的数据</p>
<h3 id="gru">尝试实现GRU (午)<a class="headerlink" href="#gru" title="Permanent link">&para;</a></h3>
<p>我直接打开了英文教材中的GRU部分 <a href="https://d2l.ai/chapter_recurrent-modern/gru.html">10.2. Gated Recurrent Units (GRU)</a> ，将代码复制出来</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">从零实现</label><label for="__tabbed_1_2">简洁实现</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span>
<span class="normal"><a href="#__codelineno-3-35">35</a></span>
<span class="normal"><a href="#__codelineno-3-36">36</a></span>
<span class="normal"><a href="#__codelineno-3-37">37</a></span>
<span class="normal"><a href="#__codelineno-3-38">38</a></span>
<span class="normal"><a href="#__codelineno-3-39">39</a></span>
<span class="normal"><a href="#__codelineno-3-40">40</a></span>
<span class="normal"><a href="#__codelineno-3-41">41</a></span>
<span class="normal"><a href="#__codelineno-3-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kn">from</span> <span class="nn">d2l</span> <span class="kn">import</span> <span class="n">torch</span> <span class="k">as</span> <span class="n">d2l</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="k">class</span> <span class="nc">GRUScratch</span><span class="p">(</span><span class="n">d2l</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a>        <span class="n">init_weight</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">shape</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a>        <span class="n">triple</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">init_weight</span><span class="p">(</span><span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">),</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a>                          <span class="n">init_weight</span><span class="p">(</span><span class="n">num_hiddens</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">),</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a>                          <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_hiddens</span><span class="p">)))</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_xz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_hz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_z</span> <span class="o">=</span> <span class="n">triple</span><span class="p">()</span>  <span class="c1"># Update gate</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_xr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_hr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_r</span> <span class="o">=</span> <span class="n">triple</span><span class="p">()</span>  <span class="c1"># Reset gate</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">W_xh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_hh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_h</span> <span class="o">=</span> <span class="n">triple</span><span class="p">()</span>  <span class="c1"># Candidate hidden state</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="nd">@d2l</span><span class="o">.</span><span class="n">add_to_class</span><span class="p">(</span><span class="n">GRUScratch</span><span class="p">)</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20"></a>    <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21"></a>        <span class="c1"># Initial state with shape: (batch_size, num_hiddens)</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22"></a>        <span class="n">H</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_hiddens</span><span class="p">),</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23"></a>                      <span class="n">device</span><span class="o">=</span><span class="n">inputs</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24"></a>    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25"></a>    <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26"></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_xz</span><span class="p">)</span> <span class="o">+</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27"></a>                        <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_hz</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_z</span><span class="p">)</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28"></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_xr</span><span class="p">)</span> <span class="o">+</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29"></a>                        <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_hr</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_r</span><span class="p">)</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30"></a>        <span class="n">H_tilde</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_xh</span><span class="p">)</span> <span class="o">+</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31"></a>                           <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_hh</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_h</span><span class="p">)</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32"></a>        <span class="n">H</span> <span class="o">=</span> <span class="n">Z</span> <span class="o">*</span> <span class="n">H</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="n">H_tilde</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33"></a>        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34"></a>    <span class="k">return</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">H</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35"></a>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="n">data</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">TimeMachine</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="n">gru</span> <span class="o">=</span> <span class="n">GRUScratch</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">num_hiddens</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="n">model</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">RNNLMScratch</span><span class="p">(</span><span class="n">gru</span><span class="p">,</span> <span class="n">vocab_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">lr</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="n">trainer</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">max_epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">gradient_clip_val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41"></a>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;it has&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="n">d2l</span><span class="o">.</span><span class="n">try_gpu</span><span class="p">()))</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kn">from</span> <span class="nn">d2l</span> <span class="kn">import</span> <span class="n">torch</span> <span class="k">as</span> <span class="n">d2l</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="k">class</span> <span class="nc">GRU</span><span class="p">(</span><span class="n">d2l</span><span class="o">.</span><span class="n">RNN</span><span class="p">):</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">):</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a>        <span class="n">d2l</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">)</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="n">data</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">TimeMachine</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="n">gru</span> <span class="o">=</span> <span class="n">GRU</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">num_hiddens</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="n">model</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">RNNLM</span><span class="p">(</span><span class="n">gru</span><span class="p">,</span> <span class="n">vocab_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">lr</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="n">trainer</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">max_epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">gradient_clip_val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;it has&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="n">d2l</span><span class="o">.</span><span class="n">try_gpu</span><span class="p">()))</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>尝试运行并运行成功。</p>
<p>由于课程是使用的GRU来进行文本的预测，所以数据的格式肯定和题目所给的表格类型不太一样，于是我想看看能不能修改数据的格式并且还用教材上的代码来进行预测，</p>
<p>于是尝试询问copilot</p>
<details class="example" open="open">
<summary>chatlog</summary>
<p><strong>RonaldLN</strong>: </p>
<p>如果我不想训练文本以及预测文本，我想通过RNN训练类似于矩阵或者向量的数据，来获得数学的模型，应该如何修改这个文件中的代码？</p>
<p>&nbsp;</p>
<p><strong>GitHub Copilot</strong>: </p>
<p>如果你想使用 RNN 来训练矩阵或向量数据，你需要做的主要是修改数据加载和预处理的部分。具体来说，你需要将 <code>d2l.TimeMachine</code> 替换为你自己的数据加载函数，这个函数需要返回一个可以迭代的数据集，每个元素都是一个形状为 <code>(batch_size, sequence_length, num_features)</code> 的张量，其中 <code>num_features</code> 是你的特征数量。</p>
<p>此外，你可能还需要修改模型的输入和输出大小以匹配你的数据。具体来说，<code>num_inputs</code> 应该等于你的特征数量，而 <code>vocab_size</code> 应该等于你的目标值的数量。</p>
<p>以下是一个修改后的代码示例：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">from</span> <span class="nn">d2l</span> <span class="kn">import</span> <span class="n">torch</span> <span class="k">as</span> <span class="n">d2l</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">class</span> <span class="nc">GRU</span><span class="p">(</span><span class="n">d2l</span><span class="o">.</span><span class="n">RNN</span><span class="p">):</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">):</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>        <span class="n">d2l</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="p">)</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="c1"># 加载你的数据</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="c1"># data 应该是一个可以迭代的数据集，每个元素都是一个形状为 (batch_size, sequence_length, num_features) 的张量</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="n">data</span> <span class="o">=</span> <span class="n">load_your_data</span><span class="p">()</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="n">num_features</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 特征数量</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="n">num_targets</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 目标值的数量，这里假设我们只有一个目标值</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="n">gru</span> <span class="o">=</span> <span class="n">GRU</span><span class="p">(</span><span class="n">num_inputs</span><span class="o">=</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_hiddens</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="n">model</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">RNNLM</span><span class="p">(</span><span class="n">gru</span><span class="p">,</span> <span class="n">vocab_size</span><span class="o">=</span><span class="n">num_targets</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="n">trainer</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="n">max_epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">gradient_clip_val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></code></pre></div>
<p>请注意，这只是一个基本的示例，你可能需要根据你的具体需求来进一步修改这个代码。例如，你可能需要修改模型的架构，或者使用不同的优化器和损失函数。</p>
</details>
<p>然后我就觉得，如果要对教材中的代码进行修改来适配这题的数据的使用的话，感觉不是那么方便，所以先放弃了这个想法</p>
<h3 id="22cfgru">理解22年C题F奖GRU相关代码<a class="headerlink" href="#22cfgru" title="Permanent link">&para;</a></h3>
<p>由于在美赛开始的一周前，队友给我分享了一个github仓库</p>
<p><a href="https://github.com/jishengpeng/2022MCM-C-problem">jishengpeng/2022MCM-C-problem: 2022美赛C题（MCM/ICM）F奖源码数据公开 (github.com)</a></p>
<p>是一支在22年美赛选择C题并最终获得F奖的队伍，仓库内有他们的论文以及处理数据的代码</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p><big><strong>关于美赛用到的模型</strong></big></p>
<p>主要用到的模型有小波降噪模型，GRU神经网络为基础的预测模型。然后利用贪心+规划的思想写了一个买卖比特币的策略。</p>
</div>
<p><strong>所以另一个思路就是修改他们的代码，使得能适用于我们的题目所给的数据</strong></p>
<h3 id="_6">确定衡量<em>势头</em>的方法<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>下午4点左右，因为在看着22年f奖的代码时，想到如果要将题目给的比赛时的各种状态的信息以及数据输入进行训练(或者说<em>监督学习 supervised learning</em>)，那么就还<strong>需要有确定的实际的<em>势头</em>结果</strong>用于训练时的检验，所以我突然有了一个想法，于是开始和队友讨论。</p>
<p>之前队友想的就是用下一分的输赢作为<em>势头</em>评判的标准(即把下一分赢的概率作为<em>势头</em>)，但我想到<strong><em><mark>势头</mark></em><mark>应该不止是对下一分有影响，应该还有可能影响到之后的几分</mark></strong>，于是就和队友进行了讨论。</p>
<p>我们大致假设势头只体现在之后3分上(或者说再往后的分相关性不是那么大了，所以就忽略掉)，设 $n_1$ $n_2$ $n_3$ 分别为之后第1 2 3分的输赢，赢为1 输为0，再假设势头与这3分结果的关系是这样的(最简单的线性关系，非线性感觉不好考虑)
$$
势头 = a \times n_1 + b \times n_2 + c \times n_3
$$
然后我们打算通过<strong>分析一些比较显然的情况</strong>来确定参数 $a$ $b$ $c$ 具体的大小(我认为直接凭感觉确定可能不一定是那么准确)，</p>
<ul>
<li>
<p>首先可以确定的是后三分都赢或者后三分都输的情况，即 $n_1=n_2=n_3=1$ 和 $n_1=n_2=n_3=0$ </p>
<ol>
<li>
<p>三分都赢时，我们想定势头为1，即 $n_1=n_2=n_3=1$ 时 $势头=1$ ，那么就能得到
     $$
     a+b+c=1
     $$</p>
</li>
<li>
<p>三分都输时，我们认为势头应该为0，这个其实上只能得到<em>势头</em>的常数项为0，而我们假设的关系式中其实已经包含了这个条件</p>
</li>
</ol>
</li>
<li>
<p>其次还可以确定的条件是，在后三分中只赢了1分的情况下，那么应该有 <strong>赢第1分的势头 &gt; 赢第2分的势头 &gt; 赢第3分的势头</strong> ，那么就可以得到
    $$
    a &gt; b &gt; c &gt; 0
    $$</p>
</li>
<li>
<p>然后我们再取了一些特定的情况来进行比较，以此来进一步确定3个参数的大小。</p>
<p>我们对<strong>只赢第1分</strong>和<strong>只输第1分(即赢了第2 3分)</strong>的情况进行分析比较，最后认为 只赢第1分的势头 应该<strong>略大于</strong> 只输第1分的势头，于是得到
$$
a &gt; b + c
$$</p>
</li>
</ul>
<p>于是最后我们将系数确定成 $a=0.55, b=0.25, c=0.2$ ，即
$$
势头 = 0.55 n_1 + 0.25 n_2 + 0.2 n_3
$$
然后我让队友随便挑一场比赛的数据，处理后按照公式算一算，然后队友选了决赛，下面是前100分冠军的势头</p>
<p><a class="glightbox" href="../../../../images/momentum_on_final.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="momentum_on_final" loading="lazy" src="../../../../images/momentum_on_final.svg" /></a></p>
<p>我感觉看起来还蛮ok的，这个波动感觉还算比较真实。</p>
<p>这时已经是晚上，累了一天就没有再做什么了</p>
<h2 id="day-3">Day 3<a class="headerlink" href="#day-3" title="Permanent link">&para;</a></h2>
<h3 id="22cfgru_1">继续理解22年C题F奖GRU相关代码 (早)<a class="headerlink" href="#22cfgru_1" title="Permanent link">&para;</a></h3>
<p>继续前一天的进度，</p>
<details class="info">
<summary><code>GRU模型.py</code> 完整代码</summary>
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">GRU模型.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">  1</a></span>
<span class="normal"><a href="#__codelineno-6-2">  2</a></span>
<span class="normal"><a href="#__codelineno-6-3">  3</a></span>
<span class="normal"><a href="#__codelineno-6-4">  4</a></span>
<span class="normal"><a href="#__codelineno-6-5">  5</a></span>
<span class="normal"><a href="#__codelineno-6-6">  6</a></span>
<span class="normal"><a href="#__codelineno-6-7">  7</a></span>
<span class="normal"><a href="#__codelineno-6-8">  8</a></span>
<span class="normal"><a href="#__codelineno-6-9">  9</a></span>
<span class="normal"><a href="#__codelineno-6-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-6-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-6-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-6-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-6-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-6-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-6-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-6-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-6-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-6-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-6-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-6-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-6-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-6-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-6-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-6-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-6-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-6-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-6-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-6-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-6-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-6-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-6-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-6-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-6-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-6-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-6-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-6-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-6-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-6-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-6-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-6-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-6-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-6-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-6-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-6-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-6-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-6-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-6-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-6-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-6-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-6-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-6-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-6-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-6-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-6-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-6-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-6-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-6-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-6-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-6-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-6-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-6-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-6-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-6-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-6-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-6-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-6-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-6-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-6-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-6-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-6-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-6-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-6-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-6-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-6-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-6-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-6-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-6-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-6-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-6-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-6-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-6-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-6-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-6-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-6-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-6-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-6-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-6-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-6-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-6-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-6-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-6-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-6-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-6-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-6-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-6-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-6-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-6-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-6-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-6-100">100</a></span>
<span class="normal"><a href="#__codelineno-6-101">101</a></span>
<span class="normal"><a href="#__codelineno-6-102">102</a></span>
<span class="normal"><a href="#__codelineno-6-103">103</a></span>
<span class="normal"><a href="#__codelineno-6-104">104</a></span>
<span class="normal"><a href="#__codelineno-6-105">105</a></span>
<span class="normal"><a href="#__codelineno-6-106">106</a></span>
<span class="normal"><a href="#__codelineno-6-107">107</a></span>
<span class="normal"><a href="#__codelineno-6-108">108</a></span>
<span class="normal"><a href="#__codelineno-6-109">109</a></span>
<span class="normal"><a href="#__codelineno-6-110">110</a></span>
<span class="normal"><a href="#__codelineno-6-111">111</a></span>
<span class="normal"><a href="#__codelineno-6-112">112</a></span>
<span class="normal"><a href="#__codelineno-6-113">113</a></span>
<span class="normal"><a href="#__codelineno-6-114">114</a></span>
<span class="normal"><a href="#__codelineno-6-115">115</a></span>
<span class="normal"><a href="#__codelineno-6-116">116</a></span>
<span class="normal"><a href="#__codelineno-6-117">117</a></span>
<span class="normal"><a href="#__codelineno-6-118">118</a></span>
<span class="normal"><a href="#__codelineno-6-119">119</a></span>
<span class="normal"><a href="#__codelineno-6-120">120</a></span>
<span class="normal"><a href="#__codelineno-6-121">121</a></span>
<span class="normal"><a href="#__codelineno-6-122">122</a></span>
<span class="normal"><a href="#__codelineno-6-123">123</a></span>
<span class="normal"><a href="#__codelineno-6-124">124</a></span>
<span class="normal"><a href="#__codelineno-6-125">125</a></span>
<span class="normal"><a href="#__codelineno-6-126">126</a></span>
<span class="normal"><a href="#__codelineno-6-127">127</a></span>
<span class="normal"><a href="#__codelineno-6-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="kn">from</span> <span class="nn">d2l</span> <span class="kn">import</span> <span class="n">torch</span> <span class="k">as</span> <span class="n">d2l</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="kn">import</span> <span class="nn">csv</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/home/jishengpeng/美赛的模拟练习&quot;</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="n">BCHAIN_MKPRU</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/BCHAIN-MKPRU.csv&quot;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="n">LBMA_GOLD</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/LBMA-GOLD.csv&quot;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="n">Data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/C题处理后的中间文件2.csv&quot;</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="k">def</span> <span class="nf">to_timestamp</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%y&quot;</span><span class="p">)))</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="c1">#将日期变为自然数</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="n">start_timestamp</span><span class="o">=</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21"></a>    <span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">start_timestamp</span><span class="p">)</span><span class="o">/</span><span class="mi">86400</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="nb">print</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23"></a>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># 应该只能为1</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="n">start_input</span><span class="o">=</span><span class="mi">30</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="n">input_size</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#训练：通过前input_size天预测input_size+1天，预测：通过2到input_size+1天预测第input_size+2天</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="n">hidden_size</span><span class="o">=</span><span class="mi">20</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="c1"># input_size=200</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="n">output_size</span><span class="o">=</span><span class="mi">1</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="n">layers_size</span><span class="o">=</span><span class="mi">3</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="n">lr</span><span class="o">=</span><span class="mi">10</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1000</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33"></a>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="k">class</span> <span class="nc">GRUModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">):</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39"></a>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44"></a>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46"></a>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="n">gru</span><span class="o">=</span><span class="n">GRUModel</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48"></a>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">L1Loss</span><span class="p">()</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">gru</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="p">)</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51"></a>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="n">ji</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="n">input_size</span><span class="o">=</span><span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54"></a>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="n">trainB_x</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="n">trainB_y</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57"></a>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59"></a>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">gru</span><span class="p">(</span><span class="n">trainB_x</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62"></a>    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">trainB_y</span><span class="p">)</span>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63"></a>    <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64"></a>
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66"></a>    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69"></a>
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="c1"># 预测，以比特币为例</span>
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71"></a><span class="c1"># pred_x_train=torch.from_numpy(np.array(Data.iloc[1:input_size+1,1]).reshape(-1,1,input_size)).to(torch.float32).to(device)</span>
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72"></a><span class="n">pred_x_train</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">29</span><span class="p">:</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73"></a><span class="n">pred_y_train</span><span class="o">=</span><span class="n">gru</span><span class="p">(</span><span class="n">pred_x_train</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prediction:&quot;</span><span class="p">,</span><span class="n">pred_y_train</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;actual:&quot;</span><span class="p">,</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76"></a>
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77"></a><span class="c1"># 预测代码</span>
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78"></a><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79"></a><span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80"></a><span class="n">actuals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_input</span><span class="p">,</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;进行到input_size=&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="__span-6-83"><a id="__codelineno-6-83" name="__codelineno-6-83"></a>    <span class="c1"># gru=GRUModel(i, hidden_size, output_size, layers_size).to(device)</span>
</span><span id="__span-6-84"><a id="__codelineno-6-84" name="__codelineno-6-84"></a>    <span class="n">gru</span> <span class="o">=</span> <span class="n">GRUModel</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-85"><a id="__codelineno-6-85" name="__codelineno-6-85"></a>    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">L1Loss</span><span class="p">()</span>
</span><span id="__span-6-86"><a id="__codelineno-6-86" name="__codelineno-6-86"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">gru</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="p">)</span>
</span><span id="__span-6-87"><a id="__codelineno-6-87" name="__codelineno-6-87"></a>
</span><span id="__span-6-88"><a id="__codelineno-6-88" name="__codelineno-6-88"></a>    <span class="c1"># 数据，以比特币为例</span>
</span><span id="__span-6-89"><a id="__codelineno-6-89" name="__codelineno-6-89"></a>    <span class="n">trainB_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">30</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-90"><a id="__codelineno-6-90" name="__codelineno-6-90"></a>    <span class="n">trainB_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-91"><a id="__codelineno-6-91" name="__codelineno-6-91"></a>
</span><span id="__span-6-92"><a id="__codelineno-6-92" name="__codelineno-6-92"></a>    <span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-93"><a id="__codelineno-6-93" name="__codelineno-6-93"></a>
</span><span id="__span-6-94"><a id="__codelineno-6-94" name="__codelineno-6-94"></a>    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
</span><span id="__span-6-95"><a id="__codelineno-6-95" name="__codelineno-6-95"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">gru</span><span class="p">(</span><span class="n">trainB_x</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-96"><a id="__codelineno-6-96" name="__codelineno-6-96"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">trainB_y</span><span class="p">)</span>
</span><span id="__span-6-97"><a id="__codelineno-6-97" name="__codelineno-6-97"></a>
</span><span id="__span-6-98"><a id="__codelineno-6-98" name="__codelineno-6-98"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-6-99"><a id="__codelineno-6-99" name="__codelineno-6-99"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-6-100"><a id="__codelineno-6-100" name="__codelineno-6-100"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-6-101"><a id="__codelineno-6-101" name="__codelineno-6-101"></a>        <span class="c1"># print(&quot;loss&quot;+str(epoch)+&quot;:&quot;, loss.item())</span>
</span><span id="__span-6-102"><a id="__codelineno-6-102" name="__codelineno-6-102"></a>    <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-6-103"><a id="__codelineno-6-103" name="__codelineno-6-103"></a>
</span><span id="__span-6-104"><a id="__codelineno-6-104" name="__codelineno-6-104"></a>    <span class="c1"># 预测，以比特币为例</span>
</span><span id="__span-6-105"><a id="__codelineno-6-105" name="__codelineno-6-105"></a>    <span class="n">pred_x_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">29</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-106"><a id="__codelineno-6-106" name="__codelineno-6-106"></a>    <span class="n">pred_y_train</span> <span class="o">=</span> <span class="n">gru</span><span class="p">(</span><span class="n">pred_x_train</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-6-107"><a id="__codelineno-6-107" name="__codelineno-6-107"></a>    <span class="c1"># print(&quot;prediction:&quot;,pred_y_train.item())</span>
</span><span id="__span-6-108"><a id="__codelineno-6-108" name="__codelineno-6-108"></a>    <span class="c1"># print(&quot;actual:&quot;,Data.iloc[i+1,1])</span>
</span><span id="__span-6-109"><a id="__codelineno-6-109" name="__codelineno-6-109"></a>    <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_y_train</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-6-110"><a id="__codelineno-6-110" name="__codelineno-6-110"></a>    <span class="n">actuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="__span-6-111"><a id="__codelineno-6-111" name="__codelineno-6-111"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
</span><span id="__span-6-112"><a id="__codelineno-6-112" name="__codelineno-6-112"></a>
</span><span id="__span-6-113"><a id="__codelineno-6-113" name="__codelineno-6-113"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</span><span id="__span-6-114"><a id="__codelineno-6-114" name="__codelineno-6-114"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span>
</span><span id="__span-6-115"><a id="__codelineno-6-115" name="__codelineno-6-115"></a>
</span><span id="__span-6-116"><a id="__codelineno-6-116" name="__codelineno-6-116"></a><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-6-117"><a id="__codelineno-6-117" name="__codelineno-6-117"></a><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-6-118"><a id="__codelineno-6-118" name="__codelineno-6-118"></a><span class="nb">print</span><span class="p">(</span><span class="n">input_size</span><span class="o">-</span><span class="mi">29</span><span class="p">)</span>
</span><span id="__span-6-119"><a id="__codelineno-6-119" name="__codelineno-6-119"></a>
</span><span id="__span-6-120"><a id="__codelineno-6-120" name="__codelineno-6-120"></a><span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/周期lstm黄金预测1000版本.csv&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-6-121"><a id="__codelineno-6-121" name="__codelineno-6-121"></a><span class="n">csv_writer</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-6-122"><a id="__codelineno-6-122" name="__codelineno-6-122"></a><span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;实际价格&quot;</span><span class="p">,</span><span class="s2">&quot;预测价格&quot;</span><span class="p">])</span>
</span><span id="__span-6-123"><a id="__codelineno-6-123" name="__codelineno-6-123"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">input_size</span><span class="o">-</span><span class="mi">29</span><span class="p">):</span>
</span><span id="__span-6-124"><a id="__codelineno-6-124" name="__codelineno-6-124"></a>    <span class="n">tmp</span><span class="o">=</span><span class="p">[]</span>
</span><span id="__span-6-125"><a id="__codelineno-6-125" name="__codelineno-6-125"></a>    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actuals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-6-126"><a id="__codelineno-6-126" name="__codelineno-6-126"></a>    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-6-127"><a id="__codelineno-6-127" name="__codelineno-6-127"></a>    <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</span><span id="__span-6-128"><a id="__codelineno-6-128" name="__codelineno-6-128"></a><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>经过一段时间的查阅及分析，大致理解了代码各个部分的作用，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/home/jishengpeng/美赛的模拟练习&quot;</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="n">BCHAIN_MKPRU</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/BCHAIN-MKPRU.csv&quot;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="n">LBMA_GOLD</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/LBMA-GOLD.csv&quot;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="n">Data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/C题处理后的中间文件2.csv&quot;</span><span class="p">)</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="k">def</span> <span class="nf">to_timestamp</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%y&quot;</span><span class="p">)))</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="c1">#将日期变为自然数</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="n">start_timestamp</span><span class="o">=</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a>    <span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">start_timestamp</span><span class="p">)</span><span class="o">/</span><span class="mi">86400</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="nb">print</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>这部分代码是在对数据进行加载和预处理，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># 应该只能为1</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="n">start_input</span><span class="o">=</span><span class="mi">30</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="n">input_size</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#训练：通过前input_size天预测input_size+1天，预测：通过2到input_size+1天预测第input_size+2天</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="n">hidden_size</span><span class="o">=</span><span class="mi">20</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="c1"># input_size=200</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="n">output_size</span><span class="o">=</span><span class="mi">1</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="n">layers_size</span><span class="o">=</span><span class="mi">3</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="n">lr</span><span class="o">=</span><span class="mi">10</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1000</span>
</span></code></pre></div></td></tr></table></div>
<p>这里是在设置模型的一些参数，其中我认为最后需要改动的只有 <code>input_size</code> 输入数据的维数 和 <code>num_epochs</code> 训练批次。</p>
<p>由于之前在测试运行原本的代码时，训练时间比较久，所以为了方便测试我就将 <code>num_epochs</code> 改成了 <code>1</code> 。</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span>
<span class="normal"><a href="#__codelineno-9-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="k">class</span> <span class="nc">GRUModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">):</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39"></a>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44"></a>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45"></a><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46"></a>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="n">gru</span><span class="o">=</span><span class="n">GRUModel</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48"></a>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49"></a><span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">L1Loss</span><span class="p">()</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">gru</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>这一块代码是在设置GRU模型的函数，但似乎用的只是线性的函数( <code>nn.Linear</code> 这一行)，并没有添加非线性的激活函数。</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-52">52</a></span>
<span class="normal"><a href="#__codelineno-10-53">53</a></span>
<span class="normal"><a href="#__codelineno-10-54">54</a></span>
<span class="normal"><a href="#__codelineno-10-55">55</a></span>
<span class="normal"><a href="#__codelineno-10-56">56</a></span>
<span class="normal"><a href="#__codelineno-10-57">57</a></span>
<span class="normal"><a href="#__codelineno-10-58">58</a></span>
<span class="normal"><a href="#__codelineno-10-59">59</a></span>
<span class="normal"><a href="#__codelineno-10-60">60</a></span>
<span class="normal"><a href="#__codelineno-10-61">61</a></span>
<span class="normal"><a href="#__codelineno-10-62">62</a></span>
<span class="normal"><a href="#__codelineno-10-63">63</a></span>
<span class="normal"><a href="#__codelineno-10-64">64</a></span>
<span class="normal"><a href="#__codelineno-10-65">65</a></span>
<span class="normal"><a href="#__codelineno-10-66">66</a></span>
<span class="normal"><a href="#__codelineno-10-67">67</a></span>
<span class="normal"><a href="#__codelineno-10-68">68</a></span>
<span class="normal"><a href="#__codelineno-10-69">69</a></span>
<span class="normal"><a href="#__codelineno-10-70">70</a></span>
<span class="normal"><a href="#__codelineno-10-71">71</a></span>
<span class="normal"><a href="#__codelineno-10-72">72</a></span>
<span class="normal"><a href="#__codelineno-10-73">73</a></span>
<span class="normal"><a href="#__codelineno-10-74">74</a></span>
<span class="normal"><a href="#__codelineno-10-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52"></a><span class="n">ji</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53"></a><span class="n">input_size</span><span class="o">=</span><span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54"></a>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55"></a><span class="n">trainB_x</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56"></a><span class="n">trainB_y</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57"></a>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59"></a>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60"></a><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">gru</span><span class="p">(</span><span class="n">trainB_x</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62"></a>    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">trainB_y</span><span class="p">)</span>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63"></a>    <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64"></a>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66"></a>    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69"></a>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70"></a><span class="c1"># 预测，以比特币为例</span>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71"></a><span class="c1"># pred_x_train=torch.from_numpy(np.array(Data.iloc[1:input_size+1,1]).reshape(-1,1,input_size)).to(torch.float32).to(device)</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72"></a><span class="n">pred_x_train</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">29</span><span class="p">:</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73"></a><span class="n">pred_y_train</span><span class="o">=</span><span class="n">gru</span><span class="p">(</span><span class="n">pred_x_train</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prediction:&quot;</span><span class="p">,</span><span class="n">pred_y_train</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;actual:&quot;</span><span class="p">,</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
<p>这一段代码似乎是进行的一次训练和预测的测试(因为在之后的代码中，与这段代码结构非常相似的代码被放在了 <code>for</code> 循环中)。</p>
<p>由于一开始没有看懂代码😅，所以把头5行代码拿来询问copilot</p>
<details class="example" open="open">
<summary>chatlog</summary>
<p><strong>RonaldLN</strong>:</p>
<p><code>@workspace</code> <code>/explain</code> Write an explanation for the active selection as paragraphs of text.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">ji</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">input_size</span><span class="o">=</span><span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">trainB_x</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">trainB_y</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>&nbsp;</p>
<p><strong>GitHub Copilot</strong>: </p>
<p>The selected code is part of a larger Python script that uses the PyTorch library to train a Gated Recurrent Unit (GRU) model for time series prediction. The GRU model is a type of recurrent neural network (RNN) that is often used for sequence prediction problems.</p>
<p>The first line of the selected code creates a numpy array <code>ji</code> from the third column of the DataFrame <code>Data</code>, starting from the first row up to <code>input_size</code> rows. The <code>dropna()</code> function is used to remove any missing values from the data.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">ji</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</span></code></pre></div>
<p>The <code>input_size</code> is then updated to be two less than the number of elements in <code>ji</code>. This is likely done to account for the fact that the GRU model will be trained using a sliding window of 30 days, and the last two days of data will be used for prediction rather than training.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">input_size</span><span class="o">=</span><span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span>
</span></code></pre></div>
<p>The next two lines of code create PyTorch tensors <code>trainB_x</code> and <code>trainB_y</code> from the numpy array <code>ji</code>. <code>trainB_x</code> is a 3D tensor that contains 30-day windows of data from <code>ji</code>, and <code>trainB_y</code> is a 1D tensor that contains the corresponding target values for each 30-day window. The <code>-1</code> in the <code>reshape()</code> function allows numpy to automatically calculate the size of that dimension based on the size of the input data and the other dimensions.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">trainB_x</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">trainB_y</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>The <code>to(torch.float32)</code> function is used to convert the data to 32-bit floating point numbers, which are the standard data type for neural network weights and biases in PyTorch. The <code>to(device)</code> function is used to move the tensors to the GPU if one is available. This allows the model to be trained much faster than if it were trained on the CPU.</p>
<details class="quote">
<summary>Using 1 Reference</summary>
<ul>
<li>GRU模型.py</li>
</ul>
</details>
<hr />
<p>ChatGPT的翻译：</p>
<p>所选代码是一个较大的Python脚本的一部分，使用PyTorch库训练门控循环单元（GRU）模型进行时间序列预测。GRU模型是一种经常用于序列预测问题的循环神经网络（RNN）类型。</p>
<p>所选代码的第一行从DataFrame <code>Data</code> 的第三列创建一个numpy数组 <code>ji</code> ，从第一行开始到 <code>input_size</code> 行。 <code>dropna()</code> 函数用于从数据中删除任何缺失值。</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">ji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</span></code></pre></div>
<p>然后，将 <code>input_size</code> 更新为 <code>ji</code> 元素数量减2。这可能是为了考虑到GRU模型将使用一个30天的滑动窗口进行训练，而最后两天的数据将用于预测而不是训练。</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">input_size</span> <span class="o">=</span> <span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span></code></pre></div>
<p>接下来的两行代码从numpy数组 <code>ji</code> 创建PyTorch张量 <code>trainB_x</code> 和 <code>trainB_y</code> 。 <code>trainB_x</code> 是一个3D张量，包含来自 <code>ji</code> 的30天窗口的数据，而 <code>trainB_y</code> 是一个包含每个30天窗口对应目标值的1D张量。 <code>reshape()</code> 函数中的 <code>-1</code> 允许numpy根据输入数据和其他维度的大小自动计算该维度的大小。</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">trainB_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">trainB_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p><code>to(torch.float32)</code> 函数用于将数据转换为32位浮点数，这是PyTorch中神经网络权重和偏差的标准数据类型。 <code>to(device)</code> 函数用于将张量移动到GPU（如果可用）。这使得模型的训练速度比在CPU上训练要快得多。</p>
</details>
<p>于是大概理解了代码的含义，先是从csv文件中取出 <code>黄金价值</code> 这一列的数据，</p>
<blockquote>
<div class="language-css highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C题处理后的中间文件2.csv</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nt">日期</span><span class="o">(</span><span class="nt">月</span><span class="o">/</span><span class="nt">日</span><span class="o">/</span><span class="nt">年</span><span class="o">),</span><span class="nt">比特币价值</span><span class="o">,</span><span class="nt">是否可以买卖黄金</span><span class="o">,</span><span class="nt">黄金价值</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nt">9</span><span class="o">/</span><span class="nt">11</span><span class="o">/</span><span class="nt">16</span><span class="o">,</span><span class="nt">621</span><span class="p">.</span><span class="nc">65</span><span class="o">,</span><span class="nt">1</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="nt">9</span><span class="o">/</span><span class="nt">12</span><span class="o">/</span><span class="nt">16</span><span class="o">,</span><span class="nt">609</span><span class="p">.</span><span class="nc">67</span><span class="o">,</span><span class="nt">0</span><span class="o">,</span><span class="nt">1324</span><span class="p">.</span><span class="nc">6</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="nt">9</span><span class="o">/</span><span class="nt">13</span><span class="o">/</span><span class="nt">16</span><span class="o">,</span><span class="nt">610</span><span class="p">.</span><span class="nc">92</span><span class="o">,</span><span class="nt">0</span><span class="o">,</span><span class="nt">1323</span><span class="p">.</span><span class="nc">65</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="o">...</span>
</span></code></pre></div></td></tr></table></div>
</blockquote>
<p>然后取<strong>倒数第32到倒数第3的30个数据</strong>和<strong>倒数第2个数据</strong>作为训练的输入和输出，</p>
<blockquote>
<p>他们好像是需要<strong><mark>使用前30天的价格来预测下一天的价格</mark></strong>，因此如果要预测哪一天，就需要取那一天往前数30天的数据作为输入</p>
</blockquote>
<p>最后再取<strong>倒数第31到倒数第2的30个数据</strong>输入模型来对最后一天的价格进行预测，最后再和实际的价格一起显示进行比较。</p>
<p>而从 <code># 预测代码</code> 开始的剩下的代码，就是依次从第31天到最后1天，每天取其前30天作为输入序列进行预测。</p>
<h3 id="grupy">尝试对 <code>GRU模型.py</code> 的代码进行修改以输入多维数据 (午)<a class="headerlink" href="#grupy" title="Permanent link">&para;</a></h3>
<p>理解了 <code>GRU模型.py</code> 中的代码之后，我开始尝试在chatgpt的帮助下，修改他们的代码来实现多维数据的输入，</p>
<p>但大概尝试了一下感觉不是很好改，于是最后还是放弃了。</p>
<details class="example">
<summary>chatlog</summary>
<p><strong>User</strong>:</p>
<details class="note">
<summary><code>my_test.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span>
<span class="normal"><a href="#__codelineno-19-35">35</a></span>
<span class="normal"><a href="#__codelineno-19-36">36</a></span>
<span class="normal"><a href="#__codelineno-19-37">37</a></span>
<span class="normal"><a href="#__codelineno-19-38">38</a></span>
<span class="normal"><a href="#__codelineno-19-39">39</a></span>
<span class="normal"><a href="#__codelineno-19-40">40</a></span>
<span class="normal"><a href="#__codelineno-19-41">41</a></span>
<span class="normal"><a href="#__codelineno-19-42">42</a></span>
<span class="normal"><a href="#__codelineno-19-43">43</a></span>
<span class="normal"><a href="#__codelineno-19-44">44</a></span>
<span class="normal"><a href="#__codelineno-19-45">45</a></span>
<span class="normal"><a href="#__codelineno-19-46">46</a></span>
<span class="normal"><a href="#__codelineno-19-47">47</a></span>
<span class="normal"><a href="#__codelineno-19-48">48</a></span>
<span class="normal"><a href="#__codelineno-19-49">49</a></span>
<span class="normal"><a href="#__codelineno-19-50">50</a></span>
<span class="normal"><a href="#__codelineno-19-51">51</a></span>
<span class="normal"><a href="#__codelineno-19-52">52</a></span>
<span class="normal"><a href="#__codelineno-19-53">53</a></span>
<span class="normal"><a href="#__codelineno-19-54">54</a></span>
<span class="normal"><a href="#__codelineno-19-55">55</a></span>
<span class="normal"><a href="#__codelineno-19-56">56</a></span>
<span class="normal"><a href="#__codelineno-19-57">57</a></span>
<span class="normal"><a href="#__codelineno-19-58">58</a></span>
<span class="normal"><a href="#__codelineno-19-59">59</a></span>
<span class="normal"><a href="#__codelineno-19-60">60</a></span>
<span class="normal"><a href="#__codelineno-19-61">61</a></span>
<span class="normal"><a href="#__codelineno-19-62">62</a></span>
<span class="normal"><a href="#__codelineno-19-63">63</a></span>
<span class="normal"><a href="#__codelineno-19-64">64</a></span>
<span class="normal"><a href="#__codelineno-19-65">65</a></span>
<span class="normal"><a href="#__codelineno-19-66">66</a></span>
<span class="normal"><a href="#__codelineno-19-67">67</a></span>
<span class="normal"><a href="#__codelineno-19-68">68</a></span>
<span class="normal"><a href="#__codelineno-19-69">69</a></span>
<span class="normal"><a href="#__codelineno-19-70">70</a></span>
<span class="normal"><a href="#__codelineno-19-71">71</a></span>
<span class="normal"><a href="#__codelineno-19-72">72</a></span>
<span class="normal"><a href="#__codelineno-19-73">73</a></span>
<span class="normal"><a href="#__codelineno-19-74">74</a></span>
<span class="normal"><a href="#__codelineno-19-75">75</a></span>
<span class="normal"><a href="#__codelineno-19-76">76</a></span>
<span class="normal"><a href="#__codelineno-19-77">77</a></span>
<span class="normal"><a href="#__codelineno-19-78">78</a></span>
<span class="normal"><a href="#__codelineno-19-79">79</a></span>
<span class="normal"><a href="#__codelineno-19-80">80</a></span>
<span class="normal"><a href="#__codelineno-19-81">81</a></span>
<span class="normal"><a href="#__codelineno-19-82">82</a></span>
<span class="normal"><a href="#__codelineno-19-83">83</a></span>
<span class="normal"><a href="#__codelineno-19-84">84</a></span>
<span class="normal"><a href="#__codelineno-19-85">85</a></span>
<span class="normal"><a href="#__codelineno-19-86">86</a></span>
<span class="normal"><a href="#__codelineno-19-87">87</a></span>
<span class="normal"><a href="#__codelineno-19-88">88</a></span>
<span class="normal"><a href="#__codelineno-19-89">89</a></span>
<span class="normal"><a href="#__codelineno-19-90">90</a></span>
<span class="normal"><a href="#__codelineno-19-91">91</a></span>
<span class="normal"><a href="#__codelineno-19-92">92</a></span>
<span class="normal"><a href="#__codelineno-19-93">93</a></span>
<span class="normal"><a href="#__codelineno-19-94">94</a></span>
<span class="normal"><a href="#__codelineno-19-95">95</a></span>
<span class="normal"><a href="#__codelineno-19-96">96</a></span>
<span class="normal"><a href="#__codelineno-19-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="kn">from</span> <span class="nn">d2l</span> <span class="kn">import</span> <span class="n">torch</span> <span class="k">as</span> <span class="n">d2l</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="kn">import</span> <span class="nn">csv</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="n">BCHAIN_MKPRU</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/BCHAIN-MKPRU.csv&quot;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="n">LBMA_GOLD</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/LBMA-GOLD.csv&quot;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Date&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="n">Data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/C题处理后的中间文件2.csv&quot;</span><span class="p">)</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14"></a>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="k">def</span> <span class="nf">to_timestamp</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%y&quot;</span><span class="p">)))</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17"></a>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="c1">#将日期变为自然数</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="n">start_timestamp</span><span class="o">=</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21"></a>    <span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">start_timestamp</span><span class="p">)</span><span class="o">/</span><span class="mi">86400</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="nb">print</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23"></a>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># 应该只能为1</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="n">start_input</span><span class="o">=</span><span class="mi">30</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="n">input_size</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#训练：通过前input_size天预测input_size+1天，预测：通过2到input_size+1天预测第input_size+2天</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="n">hidden_size</span><span class="o">=</span><span class="mi">20</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="c1"># input_size=200</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="n">output_size</span><span class="o">=</span><span class="mi">1</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="n">layers_size</span><span class="o">=</span><span class="mi">3</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="n">lr</span><span class="o">=</span><span class="mi">10</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33"></a>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="c1"># exit(0)</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35"></a>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="k">class</span> <span class="nc">GRUModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">):</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39"></a><span class="sd">        Initializes a GRUModel instance.</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40"></a>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41"></a><span class="sd">        Args:</span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42"></a><span class="sd">            input_size (int): The number of expected features in the input x</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43"></a><span class="sd">            hidden_size (int): The number of features in the hidden state h</span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44"></a><span class="sd">            output_size (int): The number of output features</span>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45"></a><span class="sd">            layers_size (int): Number of recurrent layers</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46"></a>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51"></a>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54"></a><span class="sd">        Forward pass of the GRUModel.</span>
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55"></a>
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56"></a><span class="sd">        Args:</span>
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57"></a><span class="sd">            x (Tensor): Input tensor of shape (seq_len, batch, input_size)</span>
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58"></a>
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59"></a><span class="sd">        Returns:</span>
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60"></a><span class="sd">            Tensor: Output tensor of shape (seq_len, batch, output_size)</span>
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61"></a>
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-19-64"><a id="__codelineno-19-64" name="__codelineno-19-64"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-19-65"><a id="__codelineno-19-65" name="__codelineno-19-65"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-19-66"><a id="__codelineno-19-66" name="__codelineno-19-66"></a>
</span><span id="__span-19-67"><a id="__codelineno-19-67" name="__codelineno-19-67"></a><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
</span><span id="__span-19-68"><a id="__codelineno-19-68" name="__codelineno-19-68"></a>
</span><span id="__span-19-69"><a id="__codelineno-19-69" name="__codelineno-19-69"></a><span class="n">gru</span><span class="o">=</span><span class="n">GRUModel</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-19-70"><a id="__codelineno-19-70" name="__codelineno-19-70"></a>
</span><span id="__span-19-71"><a id="__codelineno-19-71" name="__codelineno-19-71"></a><span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">L1Loss</span><span class="p">()</span>
</span><span id="__span-19-72"><a id="__codelineno-19-72" name="__codelineno-19-72"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">gru</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="p">)</span>
</span><span id="__span-19-73"><a id="__codelineno-19-73" name="__codelineno-19-73"></a>
</span><span id="__span-19-74"><a id="__codelineno-19-74" name="__codelineno-19-74"></a><span class="n">ji</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</span><span id="__span-19-75"><a id="__codelineno-19-75" name="__codelineno-19-75"></a><span class="n">input_size</span><span class="o">=</span><span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span>
</span><span id="__span-19-76"><a id="__codelineno-19-76" name="__codelineno-19-76"></a>
</span><span id="__span-19-77"><a id="__codelineno-19-77" name="__codelineno-19-77"></a><span class="n">trainB_x</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-19-78"><a id="__codelineno-19-78" name="__codelineno-19-78"></a><span class="n">trainB_y</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-19-79"><a id="__codelineno-19-79" name="__codelineno-19-79"></a>
</span><span id="__span-19-80"><a id="__codelineno-19-80" name="__codelineno-19-80"></a><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-19-81"><a id="__codelineno-19-81" name="__codelineno-19-81"></a>
</span><span id="__span-19-82"><a id="__codelineno-19-82" name="__codelineno-19-82"></a><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
</span><span id="__span-19-83"><a id="__codelineno-19-83" name="__codelineno-19-83"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">gru</span><span class="p">(</span><span class="n">trainB_x</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-19-84"><a id="__codelineno-19-84" name="__codelineno-19-84"></a>    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">trainB_y</span><span class="p">)</span>
</span><span id="__span-19-85"><a id="__codelineno-19-85" name="__codelineno-19-85"></a>    <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
</span><span id="__span-19-86"><a id="__codelineno-19-86" name="__codelineno-19-86"></a>
</span><span id="__span-19-87"><a id="__codelineno-19-87" name="__codelineno-19-87"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-19-88"><a id="__codelineno-19-88" name="__codelineno-19-88"></a>    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-19-89"><a id="__codelineno-19-89" name="__codelineno-19-89"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-19-90"><a id="__codelineno-19-90" name="__codelineno-19-90"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-19-91"><a id="__codelineno-19-91" name="__codelineno-19-91"></a>
</span><span id="__span-19-92"><a id="__codelineno-19-92" name="__codelineno-19-92"></a><span class="c1"># 预测，以比特币为例</span>
</span><span id="__span-19-93"><a id="__codelineno-19-93" name="__codelineno-19-93"></a><span class="c1"># pred_x_train=torch.from_numpy(np.array(Data.iloc[1:input_size+1,1]).reshape(-1,1,input_size)).to(torch.float32).to(device)</span>
</span><span id="__span-19-94"><a id="__codelineno-19-94" name="__codelineno-19-94"></a><span class="n">pred_x_train</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">29</span><span class="p">:</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-19-95"><a id="__codelineno-19-95" name="__codelineno-19-95"></a><span class="n">pred_y_train</span><span class="o">=</span><span class="n">gru</span><span class="p">(</span><span class="n">pred_x_train</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-19-96"><a id="__codelineno-19-96" name="__codelineno-19-96"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prediction:&quot;</span><span class="p">,</span><span class="n">pred_y_train</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-19-97"><a id="__codelineno-19-97" name="__codelineno-19-97"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;actual:&quot;</span><span class="p">,</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>这个python脚本中，读取的要输入的数据似乎都是单独的数字，如果我想给GRU输入的是一个n维的向量，我应该如何去修改代码？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>若要修改代码以处理n维向量而不是单个数字，需要对输入数据的处理进行相应的调整。以下是一些可能的修改：</p>
<ol>
<li>
<p><strong>修改数据预处理：</strong></p>
<ul>
<li>确保<code>Data</code>中的每个输入样本是一个n维向量，而不仅仅是一个单独的数字。你可能需要调整<code>Data</code>的结构，以包含一个n维向量的列，而不是单独的数字。</li>
</ul>
</li>
<li>
<p><strong>修改GRU模型的输入和初始化：</strong></p>
<ul>
<li>修改<code>GRUModel</code>类的<code>__init__</code>方法，使其能够处理n维向量而不仅仅是单个数字。这涉及到修改<code>input_size</code>和<code>nn.GRU</code>的初始化参数。</li>
<li>如果输入是n维向量，将<code>input_size</code>修改为n。例如，如果向量长度是10，那么将<code>GRUModel</code>的初始化修改为：<code>gru = GRUModel(10, hidden_size, output_size, layers_size).to(device)</code></li>
</ul>
</li>
<li>
<p><strong>修改数据加载和处理的部分：</strong></p>
<ul>
<li>确保<code>trainB_x</code>和<code>trainB_y</code>包含n维向量的信息。这可能涉及到对<code>ji</code>的处理方式的修改。</li>
</ul>
</li>
</ol>
<p>以下是可能的修改代码片段：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># 假设每个输入样本是一个长度为n的向量</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># 请根据你的实际需求设置向量的维度</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1"># ...</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">class</span> <span class="nc">GRUModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">):</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="c1"># ...</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="c1"># 数据处理部分</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="n">ji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>  <span class="c1"># 修改为包含n维向量的处理方式</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="n">input_size</span> <span class="o">=</span> <span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="n">trainB_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="n">trainB_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="c1"># ...</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="c1"># 预测部分</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="n">pred_x_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">29</span><span class="p">:</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>这里的关键点是确保<code>ji</code>和<code>Data</code>中包含n维向量的信息，并且相应地调整模型的输入大小和初始化。</p>
<p>&nbsp;</p>
<p>......</p>
<p><strong>User</strong>:</p>
<p>我假设了这样一个公式，</p>
<p>$$
M(x, y, z) = ...
$$</p>
<p>并且有一个关于 x, y, z 的三维向量的一个序列，我想通过 GRU 模型来预测 M 的值，我应该如何写代码？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>若想通过GRU模型来预测$M$的值，你需要进行如下修改：</p>
<ol>
<li>
<p><strong>修改数据预处理：</strong></p>
<ul>
<li>确保<code>Data</code>中的每个输入样本是一个关于$x, y, z$的三维向量序列，而不仅仅是单个数字。你可能需要调整<code>Data</code>的结构，以包含一个序列的列，其中每个元素是一个三维向量。</li>
</ul>
</li>
<li>
<p><strong>修改GRU模型的输入和初始化：</strong></p>
<ul>
<li>修改<code>GRUModel</code>类的<code>__init__</code>方法，使其能够处理整个序列而不仅仅是单个数字。这涉及到修改<code>input_size</code>和<code>nn.GRU</code>的初始化参数。</li>
<li>如果每个元素是一个三维向量，将<code>input_size</code>修改为向量的维度。例如，如果向量维度是3，那么将<code>GRUModel</code>的初始化修改为：<code>gru = GRUModel(3, hidden_size, output_size, layers_size).to(device)</code></li>
</ul>
</li>
<li>
<p><strong>修改数据加载和处理的部分：</strong></p>
<ul>
<li>确保<code>trainB_x</code>和<code>trainB_y</code>包含整个序列的信息。这可能涉及到对<code>ji</code>的处理方式的修改。</li>
</ul>
</li>
</ol>
<p>以下是可能的修改代码片段：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># 假设每个元素是一个长度为3的三维向量</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 请根据你的实际需求设置向量的维度</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1"># ...</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="k">class</span> <span class="nc">GRUModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">):</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">layers_size</span><span class="p">)</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GRU_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="c1"># ...</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="c1"># 数据处理部分</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="n">ji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>  <span class="c1"># 修改为包含n维向量的处理方式</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="n">input_size</span> <span class="o">=</span> <span class="n">ji</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="c1"># 构造训练数据</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="n">trainB_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="n">trainB_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="c1"># ...</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="c1"># 预测部分</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="n">pred_x_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">29</span><span class="p">:</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>在这里，确保<code>ji</code>和<code>Data</code>中包含整个序列的信息，并且相应地调整模型的输入大小和初始化。然后，你可以使用GRU模型来训练和预测$M$的值。</p>
<p>&nbsp;</p>
<p><strong>User</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>    <span class="n">trainB_x</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="ne">TypeError</span><span class="p">:</span> <span class="n">can</span><span class="s1">&#39;t convert np.ndarray of type numpy.object_. The only supported types are: float64, float32, float16, complex64, complex128, int64, int32, int16, int8, uint8, and bool.</span>
</span></code></pre></div>
<hr />
<p>这是为什么，我应该怎么修改？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>该错误通常表示在转换<code>np.ndarray</code>为PyTorch tensor时，<code>np.ndarray</code>中包含了不支持的数据类型。在这种情况下，可能是由于<code>ji</code>数组中的某些元素具有不同的数据类型。</p>
<p>确保<code>ji</code> 中所有元素都具有相同的数据类型，最好使用 <code>astype</code> 将其转换为一致的类型。在你的情况下，尝试将 <code>ji</code> 转换为 <code>float32</code> 数据类型，以确保它包含支持的类型之一。</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">ji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></code></pre></div>
<p>然后，你可以使用这个更新后的 <code>ji</code> 构造 <code>trainB_x</code>：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">trainB_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>这样应该能够解决上述错误。确保数据类型一致性，以便成功转换为 PyTorch tensor。</p>
<p>&nbsp;</p>
<p><strong>User</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">ji</span><span class="p">:</span> <span class="p">[</span><span class="mf">1324.6</span>  <span class="mf">1323.65</span> <span class="mf">1321.75</span> <span class="o">...</span> <span class="mf">1786.</span>   <span class="mf">1788.25</span> <span class="mf">1794.6</span> <span class="p">]</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">ji</span><span class="p">:</span> <span class="p">[[</span><span class="mf">1.000000e+00</span> <span class="mf">6.096700e+02</span> <span class="mf">0.000000e+00</span> <span class="mf">1.324600e+03</span><span class="p">]</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a> <span class="p">[</span><span class="mf">2.000000e+00</span> <span class="mf">6.109200e+02</span> <span class="mf">0.000000e+00</span> <span class="mf">1.323650e+03</span><span class="p">]</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a> <span class="p">[</span><span class="mf">3.000000e+00</span> <span class="mf">6.088200e+02</span> <span class="mf">0.000000e+00</span> <span class="mf">1.321750e+03</span><span class="p">]</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a> <span class="o">...</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a> <span class="p">[</span><span class="mf">1.249000e+03</span> <span class="mf">1.027538e+04</span> <span class="mf">0.000000e+00</span> <span class="mf">1.563700e+03</span><span class="p">]</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a> <span class="p">[</span><span class="mf">1.250000e+03</span> <span class="mf">1.035430e+04</span> <span class="mf">0.000000e+00</span> <span class="mf">1.575050e+03</span><span class="p">]</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a> <span class="p">[</span><span class="mf">1.251000e+03</span> <span class="mf">1.024243e+04</span> <span class="mf">0.000000e+00</span> <span class="mf">1.581400e+03</span><span class="p">]]</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>  <span class="o">...</span><span class="s2">&quot;E:\Programs\Anaconda3\envs\genrec\lib\site-packages</span><span class="se">\t</span><span class="s2">orch</span><span class="se">\n</span><span class="s2">n\modules</span><span class="se">\r</span><span class="s2">nn.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">206</span><span class="p">,</span> <span class="ow">in</span> <span class="n">check_input</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="ne">RuntimeError</span><span class="p">:</span> <span class="nb">input</span> <span class="n">must</span> <span class="n">have</span> <span class="mi">3</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">got</span> <span class="mi">5</span>
</span></code></pre></div>
<hr />
<p>为什么会出现5维？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>问题出在对 <code>GRU</code> 模型的输入数据格式上。在这里，<code>trainB_x</code> 的形状被设置为 <code>(batch_size, sequence_length, input_size) = (1, 30, 4)</code>，然后通过 <code>torch.from_numpy(ji[input_size-30:input_size].reshape(-1, batch_size, 30, n))</code> 这行代码，维度被转换为 <code>(batch_size, 1, sequence_length, input_size, n) = (1, 1, 30, 4, 3)</code>。</p>
<p>这可能是由于在数据处理中的某一步造成的，因此需要修改数据处理的方式，确保数据形状传递给模型是正确的。</p>
<p>在处理时，你只需要确保<code>trainB_x</code>的形状是 <code>(sequence_length, batch_size, input_size)</code> 就可以了。如果<code>ji</code> 中的每个元素都是一个长度为 <code>n</code> 的向量，而你想要使用 <code>30</code> 个这样的向量作为输入，你可以这样处理：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># 构造训练数据</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">trainB_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">input_size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">trainB_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">ji</span><span class="p">[</span><span class="n">input_size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>这应该能够解决维度问题。请确保输入的形状是 <code>(sequence_length, batch_size, input_size)</code>。</p>
<p>......</p>
</details>
<h3 id="tensorflowgru">开始尝试使用TensorFlow来实现GRU<a class="headerlink" href="#tensorflowgru" title="Permanent link">&para;</a></h3>
<p>新建了一个与chatgpt的对话，询问如果输入是个多维向量的序列，应该如何编写代码，而这时chatgpt让我使用TensorFlow来实现，然后看了一下它给的代码，感觉比用pytorch实现GRU要简单许多，于是产生了尝试使用tensorflow实现的想法。</p>
<details class="example" open="open">
<summary>chatlog</summary>
<p><strong>User</strong>:</p>
<p>我假设了这样一个公式，</p>
<p>$$
M(x, y, z) = ...
$$</p>
<p>并且有一个关于 x, y, z 的三维向量的一个序列，我想通过 GRU 来对这个序列进行监督学习，来获得pt权重文件，我应该如何编写代码？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>你的问题涉及到使用 GRU（Gated Recurrent Unit）进行监督学习，以获得权重文件，但在你的问题中，缺少一些细节，比如目标是什么，损失函数是什么等。我将提供一个简单的示例代码，假设你要解决的是一个回归问题，即给定输入序列，预测一个连续值。</p>
<p>在这个示例中，我将使用 Python 和深度学习框架 TensorFlow 来实现。首先，确保你已经安装了 TensorFlow：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>pip<span class="w"> </span>install<span class="w"> </span>tensorflow
</span></code></pre></div>
<p>然后，你可以使用以下代码作为起点：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="c1"># 生成虚拟数据</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="k">def</span> <span class="nf">generate_data</span><span class="p">():</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>    <span class="c1"># 生成输入序列和对应的目标值</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>    <span class="n">seq_length</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">seq_length</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3维向量的输入序列</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 目标值是输入序列各元素之和</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="c1"># 构建模型</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="c1"># 编译模型</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="c1"># 生成数据</span>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">()</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="c1"># 训练模型</span>
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;gru_weights.h5&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>在这个例子中，<code>generate_data</code> 函数生成了一个包含 1000 个样本的数据集，每个样本包含一个长度为 10 的序列，其中每个元素是一个 3 维向量。模型使用了一个包含 50 个单元的 GRU 层，最后输出一个单一值。我们使用均方误差作为损失函数，并用 Adam 优化器进行训练。</p>
<p>最后，通过 <code>model.save_weights</code> 方法保存模型的权重到名为 <code>gru_weights.h5</code> 的文件中。你可以根据你的问题和数据集来修改模型结构、损失函数等。</p>
</details>
<p>然后尝试运行了一下chatgpt给我的代码，发现能运行，于是打算在这个代码的基础上进行修改尝试</p>
<h3 id="debug">debug并最终成功实现数据的训练和预测<a class="headerlink" href="#debug" title="Permanent link">&para;</a></h3>
<blockquote>
<p>此时大约下午4:30</p>
</blockquote>
<p>一开始是想看看能不能使用gpu来进行训练，于是询问继续chatgpt</p>
<details class="example" open="open">
<summary>chatlog</summary>
<p>(对话连着前面)</p>
<p>&nbsp;</p>
<p><strong>User</strong>:</p>
<p>我想使用 cuda 和 cudnn 加速， 我应该如何修改代码？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>如果你想使用CUDA和cuDNN来加速你的深度学习模型，你需要确保你的TensorFlow版本已经配置好支持GPU，并且你的机器上已经安装了NVIDIA的CUDA和cuDNN库。</p>
<p>首先，确保你的TensorFlow版本支持GPU。你可以通过以下命令来安装TensorFlow GPU版本：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>pip<span class="w"> </span>install<span class="w"> </span>tensorflow-gpu
</span></code></pre></div>
<p>然后，确保你的机器上已经正确安装了CUDA和cuDNN。可以参考NVIDIA的官方文档进行安装配置。</p>
<p>修改代码以使用GPU加速时，只需确保TensorFlow能够自动选择GPU设备。这通常是默认行为，但你可以添加以下代码来确保：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># 导入 TensorFlow 并检查 GPU 是否可用</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Num GPUs Available: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">)))</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="c1"># 其余的代码保持不变</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="c1"># ...</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="c1"># 编译模型，确保 Tensorflow 使用 GPU 加速</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="c1"># 训练模型，TensorFlow 会自动使用 GPU</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;gru_weights.h5&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>以上代码会输出可用的GPU数量。如果TensorFlow能够正确识别GPU并使用它，你的模型将在GPU上运行。</p>
<p>确保你的TensorFlow和CUDA/cuDNN版本是兼容的。你可以查看TensorFlow的文档以获取关于兼容性的详细信息。</p>
<p>注意：在使用GPU时，确保你的模型和数据都适合GPU的内存。有时候需要调整批处理大小等超参数，以便适应GPU内存。</p>
</details>
<p>于是我尝试运行命令</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>pip<span class="w"> </span>install<span class="w"> </span>tensorflow-gpu
</span></code></pre></div>
<p>但是发生了报错</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>...
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">        </span>File<span class="w"> </span><span class="s2">&quot;E:\Programs\Anaconda3\envs\genrec\lib\site-packages\setuptools\_vendor\packaging\requirements.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">37</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__init__
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">          </span>raise<span class="w"> </span>InvalidRequirement<span class="o">(</span>str<span class="o">(</span>e<span class="o">))</span><span class="w"> </span>from<span class="w"> </span>e
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">      </span>setuptools.extern.packaging.requirements.InvalidRequirement:<span class="w"> </span>Expected<span class="w"> </span>end<span class="w"> </span>or<span class="w"> </span>semicolon<span class="w"> </span><span class="o">(</span>after<span class="w"> </span>name<span class="w"> </span>and<span class="w"> </span>no<span class="w"> </span>valid<span class="w"> </span>version<span class="w"> </span>specifier<span class="o">)</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">          </span>python_version&gt;<span class="s2">&quot;3.7&quot;</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">                        </span>^
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">      </span><span class="o">[</span>end<span class="w"> </span>of<span class="w"> </span>output<span class="o">]</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">  </span>note:<span class="w"> </span>This<span class="w"> </span>error<span class="w"> </span>originates<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>subprocess,<span class="w"> </span>and<span class="w"> </span>is<span class="w"> </span>likely<span class="w"> </span>not<span class="w"> </span>a<span class="w"> </span>problem<span class="w"> </span>with<span class="w"> </span>pip.
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>error:<span class="w"> </span>metadata-generation-failed
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>×<span class="w"> </span>Encountered<span class="w"> </span>error<span class="w"> </span><span class="k">while</span><span class="w"> </span>generating<span class="w"> </span>package<span class="w"> </span>metadata.
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>╰─&gt;<span class="w"> </span>See<span class="w"> </span>above<span class="w"> </span><span class="k">for</span><span class="w"> </span>output.
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>note:<span class="w"> </span>This<span class="w"> </span>is<span class="w"> </span>an<span class="w"> </span>issue<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>mentioned<span class="w"> </span>above,<span class="w"> </span>not<span class="w"> </span>pip.
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>hint:<span class="w"> </span>See<span class="w"> </span>above<span class="w"> </span><span class="k">for</span><span class="w"> </span>details.
</span></code></pre></div>
<p>然后搜索相关信息，找到这个issue</p>
<p><a href="https://github.com/tensorflow/tensorflow/issues/60074"><code>pip install tensorflow-gpu</code> gives <code>setuptools.extern.packaging.requirements.InvalidRequirement</code> · Issue #60074 · tensorflow/tensorflow (github.com)</a></p>
<p>根据 <a href="https://github.com/tensorflow/tensorflow/issues/60074#issuecomment-1480717509">tilakrayal的回答</a>，在新的版本中，tensorflow已经不区分gpu和非gpu版本了，合并成一个版本</p>
<blockquote>
<p>From tensorflow v2.12, removed redundant packages <strong>tensorflow-gpu and tf-nightly-gpu</strong>. These packages were removed and replaced with packages that direct users to switch to <strong>tensorflow or tf-nightly respectively</strong>.</p>
</blockquote>
<p>于是我就尝试chatgpt回答中的这个代码</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Num GPUs Available: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">)))</span>
</span></code></pre></div>
<p>但是显示了 0。</p>
<p>最后我感觉要弄好这个gpu可能比较费时间，并且cpu也足够用，于是就不打算再追究这个。</p>
<hr />
<p>将原本chatgpt给我的代码稍加修改了一下(为了查看输入数据/矩阵的形状，以及进行预测)(由于生成的数据太多，为了方便查看所以将 <code>num_samples</code> 设置成了 <code>10</code> )，</p>
<details class="note" open="open">
<summary><code>my_test2.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span>
<span class="normal"><a href="#__codelineno-34-21">21</a></span>
<span class="normal"><a href="#__codelineno-34-22">22</a></span>
<span class="normal"><a href="#__codelineno-34-23">23</a></span>
<span class="normal"><a href="#__codelineno-34-24">24</a></span>
<span class="normal"><a href="#__codelineno-34-25">25</a></span>
<span class="normal"><a href="#__codelineno-34-26">26</a></span>
<span class="normal"><a href="#__codelineno-34-27">27</a></span>
<span class="normal"><a href="#__codelineno-34-28">28</a></span>
<span class="normal"><a href="#__codelineno-34-29">29</a></span>
<span class="normal"><a href="#__codelineno-34-30">30</a></span>
<span class="normal"><a href="#__codelineno-34-31">31</a></span>
<span class="normal"><a href="#__codelineno-34-32">32</a></span>
<span class="normal"><a href="#__codelineno-34-33">33</a></span>
<span class="normal"><a href="#__codelineno-34-34">34</a></span>
<span class="normal"><a href="#__codelineno-34-35">35</a></span>
<span class="normal"><a href="#__codelineno-34-36">36</a></span>
<span class="normal"><a href="#__codelineno-34-37">37</a></span>
<span class="normal"><a href="#__codelineno-34-38">38</a></span>
<span class="normal"><a href="#__codelineno-34-39">39</a></span>
<span class="normal"><a href="#__codelineno-34-40">40</a></span>
<span class="normal"><a href="#__codelineno-34-41">41</a></span>
<span class="normal"><a href="#__codelineno-34-42">42</a></span>
<span class="normal"><a href="#__codelineno-34-43">43</a></span>
<span class="normal"><a href="#__codelineno-34-44">44</a></span>
<span class="normal"><a href="#__codelineno-34-45">45</a></span>
<span class="normal"><a href="#__codelineno-34-46">46</a></span>
<span class="normal"><a href="#__codelineno-34-47">47</a></span>
<span class="normal"><a href="#__codelineno-34-48">48</a></span>
<span class="normal"><a href="#__codelineno-34-49">49</a></span>
<span class="normal"><a href="#__codelineno-34-50">50</a></span>
<span class="normal"><a href="#__codelineno-34-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="c1"># 生成虚拟数据</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="k">def</span> <span class="nf">generate_data</span><span class="p">():</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8"></a>    <span class="c1"># 生成输入序列和对应的目标值</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9"></a>    <span class="n">seq_length</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10"></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">seq_length</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3维向量的输入序列</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 目标值是输入序列各元素之和</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13"></a>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15"></a>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="c1"># 构建模型</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21"></a>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23"></a>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24"></a><span class="c1"># 编译模型</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27"></a>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28"></a><span class="c1"># 生成数据</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29"></a><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">()</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30"></a>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31"></a><span class="nb">print</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32"></a><span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33"></a>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34"></a><span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sum </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36"></a>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37"></a><span class="c1"># exit(0)</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38"></a>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39"></a><span class="c1"># 训练模型</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41"></a>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;gru_weights.h5&#39;</span><span class="p">)</span>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44"></a>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45"></a><span class="c1"># 预测并计算每个序列输出的和</span>
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46"></a><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47"></a><span class="n">sum_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-34-48"><a id="__codelineno-34-48" name="__codelineno-34-48"></a>
</span><span id="__span-34-49"><a id="__codelineno-34-49" name="__codelineno-34-49"></a><span class="c1"># 打印结果</span>
</span><span id="__span-34-50"><a id="__codelineno-34-50" name="__codelineno-34-50"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predictions:&quot;</span><span class="p">)</span>
</span><span id="__span-34-51"><a id="__codelineno-34-51" name="__codelineno-34-51"></a><span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>终端输出出来的 <code>x_train</code> <code>y_train</code> (31和32行的两个 <code>print</code> )是这样的</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1"><code>x_train</code></label><label for="__tabbed_2_2"><code>y_train</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="p">[[[</span><span class="mf">0.7944328</span>  <span class="mf">0.19991478</span> <span class="mf">0.1717165</span> <span class="p">]</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>  <span class="p">[</span><span class="mf">0.52863161</span> <span class="mf">0.18222096</span> <span class="mf">0.70395594</span><span class="p">]</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>  <span class="p">[</span><span class="mf">0.57382239</span> <span class="mf">0.64215397</span> <span class="mf">0.63834019</span><span class="p">]</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>  <span class="p">[</span><span class="mf">0.1210313</span>  <span class="mf">0.22205257</span> <span class="mf">0.51856381</span><span class="p">]</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>  <span class="p">[</span><span class="mf">0.64116937</span> <span class="mf">0.40346543</span> <span class="mf">0.73267251</span><span class="p">]</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>  <span class="p">[</span><span class="mf">0.68666603</span> <span class="mf">0.96090184</span> <span class="mf">0.69283727</span><span class="p">]</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>  <span class="p">[</span><span class="mf">0.72992198</span> <span class="mf">0.02034594</span> <span class="mf">0.84201691</span><span class="p">]</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>  <span class="p">[</span><span class="mf">0.81079883</span> <span class="mf">0.20875773</span> <span class="mf">0.03558987</span><span class="p">]</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>  <span class="p">[</span><span class="mf">0.81432445</span> <span class="mf">0.47643867</span> <span class="mf">0.87499175</span><span class="p">]</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>  <span class="p">[</span><span class="mf">0.28032208</span> <span class="mf">0.5911067</span>  <span class="mf">0.99797703</span><span class="p">]]</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a> <span class="o">...</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a> <span class="p">[[</span><span class="mf">0.41748414</span> <span class="mf">0.33052038</span> <span class="mf">0.83109248</span><span class="p">]</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>  <span class="p">[</span><span class="mf">0.70159718</span> <span class="mf">0.8524119</span>  <span class="mf">0.02944102</span><span class="p">]</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>  <span class="p">[</span><span class="mf">0.22653771</span> <span class="mf">0.11587124</span> <span class="mf">0.50194598</span><span class="p">]</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>  <span class="p">[</span><span class="mf">0.75814563</span> <span class="mf">0.03297447</span> <span class="mf">0.14874201</span><span class="p">]</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>  <span class="p">[</span><span class="mf">0.30183465</span> <span class="mf">0.36516737</span> <span class="mf">0.5084972</span> <span class="p">]</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>  <span class="p">[</span><span class="mf">0.46178636</span> <span class="mf">0.34466552</span> <span class="mf">0.93100872</span><span class="p">]</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>  <span class="p">[</span><span class="mf">0.85690693</span> <span class="mf">0.26805801</span> <span class="mf">0.61805625</span><span class="p">]</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>  <span class="p">[</span><span class="mf">0.08040773</span> <span class="mf">0.75785972</span> <span class="mf">0.98884817</span><span class="p">]</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>  <span class="p">[</span><span class="mf">0.11996411</span> <span class="mf">0.0269658</span>  <span class="mf">0.932087</span>  <span class="p">]</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>  <span class="p">[</span><span class="mf">0.72871391</span> <span class="mf">0.80410475</span> <span class="mf">0.30108709</span><span class="p">]]]</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="p">[[</span><span class="mf">1.16606407</span> <span class="mf">1.4148085</span>  <span class="mf">1.85431655</span> <span class="mf">0.86164768</span> <span class="mf">1.77730731</span> <span class="mf">2.34040514</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>  <span class="mf">1.59228483</span> <span class="mf">1.05514643</span> <span class="mf">2.16575486</span> <span class="mf">1.86940581</span><span class="p">]</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a> <span class="p">[</span><span class="mf">1.579097</span>   <span class="mf">1.5834501</span>  <span class="mf">0.84435492</span> <span class="mf">0.93986211</span> <span class="mf">1.17549922</span> <span class="mf">1.73746061</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>  <span class="mf">1.74302119</span> <span class="mf">1.82711561</span> <span class="mf">1.0790169</span>  <span class="mf">1.83390576</span><span class="p">]</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a> <span class="p">[</span><span class="mf">1.05626799</span> <span class="mf">1.40353675</span> <span class="mf">1.45449643</span> <span class="mf">1.47791795</span> <span class="mf">1.33798364</span> <span class="mf">1.23835848</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>  <span class="mf">1.22593666</span> <span class="mf">0.61404874</span> <span class="mf">1.56806409</span> <span class="mf">2.00279187</span><span class="p">]</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a> <span class="p">[</span><span class="mf">1.52692854</span> <span class="mf">1.02003715</span> <span class="mf">1.43574853</span> <span class="mf">2.16162096</span> <span class="mf">1.87126819</span> <span class="mf">2.39616241</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>  <span class="mf">1.58802291</span> <span class="mf">0.59642459</span> <span class="mf">1.03014043</span> <span class="mf">2.33408625</span><span class="p">]</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a> <span class="p">[</span><span class="mf">0.6888727</span>  <span class="mf">1.89631828</span> <span class="mf">2.22542497</span> <span class="mf">2.02600974</span> <span class="mf">1.80885565</span> <span class="mf">2.04338134</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>  <span class="mf">1.39698629</span> <span class="mf">1.74913134</span> <span class="mf">2.41820951</span> <span class="mf">2.1095142</span> <span class="p">]</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a> <span class="p">[</span><span class="mf">1.45975555</span> <span class="mf">1.66387383</span> <span class="mf">1.31121027</span> <span class="mf">2.17661788</span> <span class="mf">1.53556581</span> <span class="mf">1.65127684</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>  <span class="mf">1.4565594</span>  <span class="mf">0.7422163</span>  <span class="mf">1.27289512</span> <span class="mf">1.5068791</span> <span class="p">]</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a> <span class="p">[</span><span class="mf">0.54572599</span> <span class="mf">0.89128647</span> <span class="mf">1.99626636</span> <span class="mf">1.02370802</span> <span class="mf">2.11791123</span> <span class="mf">0.68699581</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>  <span class="mf">1.49900562</span> <span class="mf">1.77851229</span> <span class="mf">2.19032219</span> <span class="mf">0.97705314</span><span class="p">]</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a> <span class="p">[</span><span class="mf">1.59726203</span> <span class="mf">1.81477729</span> <span class="mf">1.27713759</span> <span class="mf">1.28049124</span> <span class="mf">0.39606842</span> <span class="mf">2.15493916</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>  <span class="mf">1.24729366</span> <span class="mf">0.96491842</span> <span class="mf">1.44108162</span> <span class="mf">1.70740263</span><span class="p">]</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a> <span class="p">[</span><span class="mf">2.08867844</span> <span class="mf">0.4113912</span>  <span class="mf">1.61522844</span> <span class="mf">1.86740305</span> <span class="mf">2.00394564</span> <span class="mf">2.32879784</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>  <span class="mf">1.17513393</span> <span class="mf">1.68913914</span> <span class="mf">2.71357174</span> <span class="mf">0.92150995</span><span class="p">]</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a> <span class="p">[</span><span class="mf">1.46399312</span> <span class="mf">2.29460573</span> <span class="mf">1.33109995</span> <span class="mf">1.54187649</span> <span class="mf">1.93523676</span> <span class="mf">1.60621029</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>  <span class="mf">2.06562629</span> <span class="mf">0.79873924</span> <span class="mf">1.14552017</span> <span class="mf">1.76911693</span><span class="p">]]</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>但是发现输出的 <code>predictions</code> 结果格式好像有些不一样，或者说不正确</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">Predictions</span><span class="p">:</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="p">[[</span><span class="mf">0.7516717</span> <span class="p">]</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a> <span class="p">[</span><span class="mf">0.6875819</span> <span class="p">]</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a> <span class="p">[</span><span class="mf">0.6742991</span> <span class="p">]</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a> <span class="p">[</span><span class="mf">0.68913144</span><span class="p">]</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a> <span class="p">[</span><span class="mf">0.8163525</span> <span class="p">]</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a> <span class="p">[</span><span class="mf">0.6028297</span> <span class="p">]</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a> <span class="p">[</span><span class="mf">0.625753</span>  <span class="p">]</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a> <span class="p">[</span><span class="mf">0.6262842</span> <span class="p">]</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a> <span class="p">[</span><span class="mf">0.70508885</span><span class="p">]</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a> <span class="p">[</span><span class="mf">0.65028405</span><span class="p">]]</span>
</span></code></pre></div>
<p><strong>本来应该是输入的每个数据都是一个3维的向量，并对应一个数值的输出，如 <code>[0.7944328  0.19991478 0.1717165 ]</code> 对应 <code>1.16606407</code> ，所以最后的预测应该是一个 10*10 的矩阵，而 <code>predictions</code> 只是一个 10*1 的矩阵</strong>，</p>
<p>于是继续询问chatgpt</p>
<details class="example" open="open">
<summary>chatlog</summary>
<p>(对话连着前面)</p>
<p>&nbsp;</p>
<p><strong>User</strong>:</p>
<details class="note">
<summary><code>my_test2.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span>
<span class="normal"><a href="#__codelineno-38-21">21</a></span>
<span class="normal"><a href="#__codelineno-38-22">22</a></span>
<span class="normal"><a href="#__codelineno-38-23">23</a></span>
<span class="normal"><a href="#__codelineno-38-24">24</a></span>
<span class="normal"><a href="#__codelineno-38-25">25</a></span>
<span class="normal"><a href="#__codelineno-38-26">26</a></span>
<span class="normal"><a href="#__codelineno-38-27">27</a></span>
<span class="normal"><a href="#__codelineno-38-28">28</a></span>
<span class="normal"><a href="#__codelineno-38-29">29</a></span>
<span class="normal"><a href="#__codelineno-38-30">30</a></span>
<span class="normal"><a href="#__codelineno-38-31">31</a></span>
<span class="normal"><a href="#__codelineno-38-32">32</a></span>
<span class="normal"><a href="#__codelineno-38-33">33</a></span>
<span class="normal"><a href="#__codelineno-38-34">34</a></span>
<span class="normal"><a href="#__codelineno-38-35">35</a></span>
<span class="normal"><a href="#__codelineno-38-36">36</a></span>
<span class="normal"><a href="#__codelineno-38-37">37</a></span>
<span class="normal"><a href="#__codelineno-38-38">38</a></span>
<span class="normal"><a href="#__codelineno-38-39">39</a></span>
<span class="normal"><a href="#__codelineno-38-40">40</a></span>
<span class="normal"><a href="#__codelineno-38-41">41</a></span>
<span class="normal"><a href="#__codelineno-38-42">42</a></span>
<span class="normal"><a href="#__codelineno-38-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5"></a>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="c1"># 生成虚拟数据</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="k">def</span> <span class="nf">generate_data</span><span class="p">():</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8"></a>    <span class="c1"># 生成输入序列和对应的目标值</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9"></a>    <span class="n">seq_length</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10"></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">seq_length</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3维向量的输入序列</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 目标值是输入序列各元素之和</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13"></a>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15"></a>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="c1"># 构建模型</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21"></a>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23"></a>
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24"></a><span class="c1"># 编译模型</span>
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27"></a>
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28"></a><span class="c1"># 生成数据</span>
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29"></a><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">()</span>
</span><span id="__span-38-30"><a id="__codelineno-38-30" name="__codelineno-38-30"></a>
</span><span id="__span-38-31"><a id="__codelineno-38-31" name="__codelineno-38-31"></a><span class="nb">print</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span><span id="__span-38-32"><a id="__codelineno-38-32" name="__codelineno-38-32"></a><span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
</span><span id="__span-38-33"><a id="__codelineno-38-33" name="__codelineno-38-33"></a>
</span><span id="__span-38-34"><a id="__codelineno-38-34" name="__codelineno-38-34"></a><span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-38-35"><a id="__codelineno-38-35" name="__codelineno-38-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sum </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-38-36"><a id="__codelineno-38-36" name="__codelineno-38-36"></a>
</span><span id="__span-38-37"><a id="__codelineno-38-37" name="__codelineno-38-37"></a><span class="c1"># exit(0)</span>
</span><span id="__span-38-38"><a id="__codelineno-38-38" name="__codelineno-38-38"></a>
</span><span id="__span-38-39"><a id="__codelineno-38-39" name="__codelineno-38-39"></a><span class="c1"># 训练模型</span>
</span><span id="__span-38-40"><a id="__codelineno-38-40" name="__codelineno-38-40"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-38-41"><a id="__codelineno-38-41" name="__codelineno-38-41"></a>
</span><span id="__span-38-42"><a id="__codelineno-38-42" name="__codelineno-38-42"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-38-43"><a id="__codelineno-38-43" name="__codelineno-38-43"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;gru_weights.h5&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>为什么 <code>model.predict(x_train)</code> 的结果是</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="p">[[</span><span class="mf">1.644006</span> <span class="p">]</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="p">[</span><span class="mf">1.5395831</span><span class="p">]</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="p">[</span><span class="mf">1.5784358</span><span class="p">]</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="p">[</span><span class="mf">1.3815761</span><span class="p">]</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="p">[</span><span class="mf">1.4156687</span><span class="p">]</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="p">[</span><span class="mf">1.3671852</span><span class="p">]</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="p">[</span><span class="mf">1.5763392</span><span class="p">]</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="p">[</span><span class="mf">1.4610821</span><span class="p">]</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="p">[</span><span class="mf">1.5581633</span><span class="p">]</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="o">...</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="p">]</span>
</span></code></pre></div>
<p>和 <code>y_train</code> 不一样？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>在你的代码中，你生成了输入数据 <code>x_train</code> 和对应的目标数据 <code>y_train</code>。在 <code>generate_data</code> 函数中，你计算了每个序列的元素之和作为目标值。但在你的 <code>for</code> 循环中，你使用了 <code>zip(x_train[0], y_train[0])</code>，这会输出第一个样本的输入序列和目标值的对应关系。然而，这并不是一个合适的对应关系。</p>
<p>GRU 模型的输入形状是 <code>(batch_size, time_steps, input_dim)</code>，在你的情况下是 <code>(None, 10, 3)</code>，而输出形状是 <code>(batch_size, units)</code>，在你的情况下是 <code>(None, 50)</code>。因此，使用 <code>model.predict(x_train)</code> 会返回每个输入序列对应的输出值，但这并不是输入序列的元素之和。</p>
<p>如果你想要得到模型预测的和，你可以计算每个序列输出的和。下面是一个修改后的代码示例：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># 预测并计算每个序列输出的和</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">sum_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="c1"># 打印结果</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predictions:&quot;</span><span class="p">)</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sum of predictions:&quot;</span><span class="p">)</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="nb">print</span><span class="p">(</span><span class="n">sum_predictions</span><span class="p">)</span>
</span></code></pre></div>
<p>这样做会打印模型预测的每个序列的输出值，以及每个序列输出值的和。这个和应该接近于输入序列元素之和的值。</p>
</details>
<p>从chatgpt的回答中得知了一个 <mark>重要信息</mark>， <strong>GRU 模型的输入形状是 <code>(batch_size, time_steps, input_dim)</code> (即输入矩阵的形状)</strong>，在之前4号学习课程时有了解到 <code>batch_size</code> 是每一次训练时 丢进去的数据的个数，再结合 <code>time_steps</code> (根据名字的意思猜测)应该指的是<strong>(单个)序列的长度</strong>，(最后的 <code>input_dim</code> 是代表输入的单个数据的维度)所以理解了这个之后，再结合题目的数据，我认为应该是 <mark>一场比赛的数据作为一个单独的序列，而这场比赛中总共打的</mark><em><mark>分</mark></em><mark>就是序列的长度</mark>。</p>
<p>但是chatgpt的回答并没有给我解决输出不正确的方法，于是我去查看 <code>.fit()</code> 方法的说明</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nd">@keras_export</span><span class="p">(</span><span class="s2">&quot;keras.Model&quot;</span><span class="p">,</span> <span class="s2">&quot;keras.models.Model&quot;</span><span class="p">)</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">base_layer</span><span class="o">.</span><span class="n">Layer</span><span class="p">,</span> <span class="n">version_utils</span><span class="o">.</span><span class="n">ModelVersionSelector</span><span class="p">):</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>    <span class="o">...</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    <span class="nd">@traceback_utils</span><span class="o">.</span><span class="n">filter_traceback</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>        <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>        <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>        <span class="o">...</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>    <span class="p">):</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trains the model for a fixed number of epochs (dataset iterations).</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="sd">        Args:</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="sd">            x: Input data. It could be:</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="sd">              - A Numpy array (or array-like), or a list of arrays</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="sd">                (in case the model has multiple inputs).</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="sd">              - A TensorFlow tensor, or a list of tensors</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="sd">                (in case the model has multiple inputs).</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="sd">              - A dict mapping input names to the corresponding array/tensors,</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="sd">                if the model has named inputs.</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="sd">              - A `tf.data` dataset. Should return a tuple</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="sd">                of either `(inputs, targets)` or</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="sd">                `(inputs, targets, sample_weights)`.</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="sd">              - A generator or `keras.utils.Sequence` returning `(inputs,</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="sd">                targets)` or `(inputs, targets, sample_weights)`.</span>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="sd">              - A `tf.keras.utils.experimental.DatasetCreator`, which wraps a</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="sd">                callable that takes a single argument of type</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="sd">                `tf.distribute.InputContext`, and returns a `tf.data.Dataset`.</span>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="sd">                `DatasetCreator` should be used when users prefer to specify the</span>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="sd">                per-replica batching and sharding logic for the `Dataset`.</span>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="sd">                See `tf.keras.utils.experimental.DatasetCreator` doc for more</span>
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="sd">                information.</span>
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="sd">              A more detailed description of unpacking behavior for iterator</span>
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="sd">              types (Dataset, generator, Sequence) is given below. If these</span>
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="sd">              include `sample_weights` as a third component, note that sample</span>
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="sd">              weighting applies to the `weighted_metrics` argument but not the</span>
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="sd">              `metrics` argument in `compile()`. If using</span>
</span><span id="__span-41-40"><a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="sd">              `tf.distribute.experimental.ParameterServerStrategy`, only</span>
</span><span id="__span-41-41"><a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="sd">              `DatasetCreator` type is supported for `x`.</span>
</span><span id="__span-41-42"><a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="sd">            y: Target data. Like the input data `x`,</span>
</span><span id="__span-41-43"><a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a><span class="sd">              it could be either Numpy array(s) or TensorFlow tensor(s).</span>
</span><span id="__span-41-44"><a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a><span class="sd">              It should be consistent with `x` (you cannot have Numpy inputs and</span>
</span><span id="__span-41-45"><a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a><span class="sd">              tensor targets, or inversely). If `x` is a dataset, generator,</span>
</span><span id="__span-41-46"><a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a><span class="sd">              or `keras.utils.Sequence` instance, `y` should</span>
</span><span id="__span-41-47"><a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a><span class="sd">              not be specified (since targets will be obtained from `x`).</span>
</span><span id="__span-41-48"><a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a><span class="sd">        ...</span>
</span><span id="__span-41-49"><a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a><span class="sd">        &quot;&quot;&quot;</span>
</span></code></pre></div>
<p>用chatgpt翻译了一些(我认为)关键/有用的部分</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>            x: 输入数据。可能是：
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">               </span><span class="k">-</span><span class="w"> </span>一个 Numpy 数组（或类似数组），或者数组列表
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>                 （如果模型有多个输入）。
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">               </span><span class="k">-</span><span class="w"> </span>一个 TensorFlow 张量，或者张量列表
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>                 （如果模型有多个输入）。
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">               </span><span class="k">-</span><span class="w"> </span>如果模型有命名输入，还可以是将输入名称映射到相应数组/张量的字典。
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>               ...
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>            y: 目标数据。与输入数据 <span class="sb">`x`</span> 类似，
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>               它可以是 Numpy 数组或 TensorFlow 张量。
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>               它应与 <span class="sb">`x`</span> 保持一致（不能有 Numpy 输入和
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>               张量目标，反之亦然）。如果 <span class="sb">`x`</span> 是数据集、生成器，
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>               或 <span class="sb">`keras.utils.Sequence`</span> 实例，则不应指定 <span class="sb">`y`</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>               （因为目标将从 <span class="sb">`x`</span> 中获取）。
</span></code></pre></div>
</div>
<p>由于在函数说明中提到 目标数据 <code>y</code> 需要和输入数据 <code>x</code> 的形状保持一致，而在之前的代码中没有保持一致( <code>x_train</code> 是3维矩阵而 <code>y_train</code> 是2维矩阵)，不知道是不是这个地方使得预测时输出的数据形状不正确，</p>
<p>于是我将函数 <code>generate_data</code> 稍微修改了一下</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">def</span> <span class="nf">generate_data</span><span class="p">():</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>    <span class="c1"># 生成输入序列和对应的目标值</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>    <span class="n">seq_length</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">seq_length</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3维向量的输入序列</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 目标值是输入序列各元素之和</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>    <span class="c1"># 将y的每个元素转换为自身的列表</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>    <span class="n">y_as_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="n">element</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_as_list</span>
</span></code></pre></div>
<p>这样 <code>y_train</code> 就变成了</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="p">[[[</span><span class="mf">1.55256756</span><span class="p">]</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>  <span class="p">[</span><span class="mf">1.54053964</span><span class="p">]</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>  <span class="p">[</span><span class="mf">1.03681008</span><span class="p">]</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>  <span class="p">[</span><span class="mf">1.85271063</span><span class="p">]</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>  <span class="p">[</span><span class="mf">1.42733873</span><span class="p">]</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>  <span class="p">[</span><span class="mf">1.31950369</span><span class="p">]</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>  <span class="p">[</span><span class="mf">2.30268749</span><span class="p">]</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>  <span class="p">[</span><span class="mf">1.30466184</span><span class="p">]</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>  <span class="p">[</span><span class="mf">0.82556753</span><span class="p">]</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>  <span class="p">[</span><span class="mf">0.85749012</span><span class="p">]]</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a> <span class="o">...</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="p">]</span>
</span></code></pre></div>
<p>这就与输入的 <code>x_train</code> 对应上了(就变成了一个3维向量对应一个1维向量)。</p>
<p>但是运行进行测试，预测输出的矩阵还是和原来一样😫😵(debug了弄了半天结果还是原样，这时候感觉精神非常萎靡，感觉脑子快成一团浆糊了)，</p>
<blockquote>
<p>此时大约刚过晚上8点</p>
</blockquote>
<hr />
<p>此时已经有些没有动力去debug，因此就想着搜索一些现成的使用tensorflow的代码，</p>
<p><a class="glightbox" href="../../../../images/gru_browser_history.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="gru_browser_history" loading="lazy" src="../../../../images/gru_browser_history.png" /></a></p>
<p>但搜索了一段时间感觉也不太能找到比较合适的。</p>
<blockquote>
<p>搜索过程中找到了一个tensorflow官网上的指导</p>
<p><a href="https://tensorflow.google.cn/tutorials/load_data/csv?hl=zh-cn#内存数据"><code>内存数据</code> = 用 tf.data 加载 CSV 数据  | TensorFlow Core (google.cn)</a></p>
<p>这里有介绍用pandas来读取csv文件中的数据并输入模型中进行训练的一些示例代码(感觉还算比较有用)</p>
</blockquote>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>之前还有尝试过把输入数据改成2维的矩阵，因为 <code>.fit()</code> 函数说明中提到 <code>x</code> 可以是numpy数组的列表( <code>a list of arrays</code> )，</p>
<p>但是这样改动后发生了这样的报错</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="o">...</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">Epoch</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>  <span class="n">File</span> <span class="s2">&quot;E:\Github\Repo-for-2024MCM</span><span class="se">\202</span><span class="s2">2MCM-C-problem\代码和中间数据结果\my_test2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">42</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>  <span class="o">...</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>    <span class="n">File</span> <span class="s2">&quot;E:\Programs\Anaconda3\envs\genrec\lib\site-packages\keras\src\engine\input_spec.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">235</span><span class="p">,</span> <span class="ow">in</span> <span class="n">assert_input_compatibility</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>    <span class="ne">ValueError</span><span class="p">:</span> <span class="ne">Exception</span> <span class="n">encountered</span> <span class="n">when</span> <span class="n">calling</span> <span class="n">layer</span> <span class="s1">&#39;sequential&#39;</span> <span class="p">(</span><span class="nb">type</span> <span class="n">Sequential</span><span class="p">)</span><span class="o">.</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>    <span class="n">Input</span> <span class="mi">0</span> <span class="n">of</span> <span class="n">layer</span> <span class="s2">&quot;gru&quot;</span> <span class="ow">is</span> <span class="n">incompatible</span> <span class="k">with</span> <span class="n">the</span> <span class="n">layer</span><span class="p">:</span> <span class="n">expected</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">found</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">2.</span> <span class="n">Full</span> <span class="n">shape</span> <span class="n">received</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>    <span class="n">Call</span> <span class="n">arguments</span> <span class="n">received</span> <span class="n">by</span> <span class="n">layer</span> <span class="s1">&#39;sequential&#39;</span> <span class="p">(</span><span class="nb">type</span> <span class="n">Sequential</span><span class="p">):</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>      <span class="err">•</span> <span class="n">inputs</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a>      <span class="err">•</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a>      <span class="err">•</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="n">进程已结束</span><span class="err">，</span><span class="n">退出代码为</span> <span class="mi">1</span>
</span></code></pre></div>
<p>于是在google上搜索这样的报错，</p>
<p><a href="https://www.google.com/search?q=ValueError%3A+Exception+encountered+when+calling+layer+%27sequential%27+%28type+Sequential%29.++%0D%0AInput+0+of+layer+%22gru%22+is+incompatible+with+the+layer%3A+expected+ndim%3D3%2C+found+ndim%3D2.+Full+shape+received%3A+%28None%2C+3%29%0D%0A%0D%0ACall+arguments+received+by+layer+%27sequential%27+%28type+Sequential%29%3A%0D%0A++%E2%80%A2+inputs%3Dtf.Tensor%28shape%3D%28None%2C+3%29%2C+dtype%3Dint32%29%0D%0A++%E2%80%A2+training%3DFalse%0D%0A++%E2%80%A2+mask%3DNone&amp;newwindow=1&amp;sca_esv=37f724872de16756&amp;sxsrf=ACQVn0-LuFmna4ijpPFbjNeaYA25l8Od3g%3A1707050979991&amp;source=hp&amp;ei=44e_Zeq8OuihkPIP3tawgA8&amp;iflsig=ANes7DEAAAAAZb-V8wWi2TcRtFaesvqSe8m0GdSVVhzX&amp;ved=0ahUKEwiqupi63JGEAxXoEEQIHV4rDPAQ4dUDCA0&amp;uact=5&amp;oq=ValueError%3A+Exception+encountered+when+calling+layer+%27sequential%27+%28type+Sequential%29.++%0D%0AInput+0+of+layer+%22gru%22+is+incompatible+with+the+layer%3A+expected+ndim%3D3%2C+found+ndim%3D2.+Full+shape+received%3A+%28None%2C+3%29%0D%0A%0D%0ACall+arguments+received+by+layer+%27sequential%27+%28type+Sequential%29%3A%0D%0A++%E2%80%A2+inputs%3Dtf.Tensor%28shape%3D%28None%2C+3%29%2C+dtype%3Dint32%29%0D%0A++%E2%80%A2+training%3DFalse%0D%0A++%E2%80%A2+mask%3DNone&amp;gs_lp=Egdnd3Mtd2l6IucCVmFsdWVFcnJvcjogRXhjZXB0aW9uIGVuY291bnRlcmVkIHdoZW4gY2FsbGluZyBsYXllciAnc2VxdWVudGlhbCcgKHR5cGUgU2VxdWVudGlhbCkuICAKSW5wdXQgMCBvZiBsYXllciAiZ3J1IiBpcyBpbmNvbXBhdGlibGUgd2l0aCB0aGUgbGF5ZXI6IGV4cGVjdGVkIG5kaW09MywgZm91bmQgbmRpbT0yLiBGdWxsIHNoYXBlIHJlY2VpdmVkOiAoTm9uZSwgMykKCkNhbGwgYXJndW1lbnRzIHJlY2VpdmVkIGJ5IGxheWVyICdzZXF1ZW50aWFsJyAodHlwZSBTZXF1ZW50aWFsKToKICDigKIgaW5wdXRzPXRmLlRlbnNvcihzaGFwZT0oTm9uZSwgMyksIGR0eXBlPWludDMyKQogIOKAoiB0cmFpbmluZz1GYWxzZQogIOKAoiBtYXNrPU5vbmVIAFAAWABwAHgAkAEAmAEAoAEAqgEAuAEDyAEA-AEC-AEB&amp;sclient=gws-wiz">ValueError: Exception encountered when calling layer 'sequential' (type Sequential). Input 0 of layer "gru" is incompatible with the layer: expected ndim=3, found ndim=2. Full shape received: (None, 3) Call arguments received by layer 'sequential' (type Sequential): • inputs=tf.Tensor(shape=(None, 3), dtype=int32) • training=False • mask=None - Google 搜索</a></p>
<p><a class="glightbox" href="../../../../images/google_search_dimensions_error.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="google_search_dimensions_error" loading="lazy" src="../../../../images/google_search_dimensions_error.png" /></a></p>
</div>
<p>在google上搜索时，发现了在这两个问题的回答中</p>
<ul>
<li><a href="https://stackoverflow.com/questions/44583254/valueerror-input-0-is-incompatible-with-layer-lstm-13-expected-ndim-3-found-n">python - ValueError: Input 0 is incompatible with layer lstm_13: expected ndim=3, found ndim=4 - Stack Overflow</a></li>
<li><a href="https://github.com/keras-team/keras/issues/7403">Input 0 is incompatible with layer lstm_1: expected ndim=3, found ndim=4 · Issue #7403 · keras-team/keras (github.com)</a></li>
</ul>
<p><strong>都有人提到了将 <code>.fit()</code> 的 <code>return_sequences</code> 这个参数设置成 <code>True</code></strong></p>
<blockquote>
<ul>
<li><a href="https://stackoverflow.com/a/55086664">stackoverflow上的回答</a></li>
<li><a href="https://github.com/keras-team/keras/issues/7403#issuecomment-317199855">github上的回答</a></li>
</ul>
</blockquote>
<p>虽然不明白含义，但是由于脑子比较累了，于是就不报希望地尝试了一下，</p>
<p><mark>结果发现居然成功实现了</mark> 😲😲😲</p>
<details class="note">
<summary><code>my_test2.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span>
<span class="normal"><a href="#__codelineno-46-17">17</a></span>
<span class="normal"><a href="#__codelineno-46-18">18</a></span>
<span class="normal"><a href="#__codelineno-46-19">19</a></span>
<span class="normal"><a href="#__codelineno-46-20">20</a></span>
<span class="normal"><a href="#__codelineno-46-21">21</a></span>
<span class="normal"><a href="#__codelineno-46-22">22</a></span>
<span class="normal"><a href="#__codelineno-46-23">23</a></span>
<span class="normal"><a href="#__codelineno-46-24">24</a></span>
<span class="normal"><a href="#__codelineno-46-25">25</a></span>
<span class="normal"><a href="#__codelineno-46-26">26</a></span>
<span class="normal"><a href="#__codelineno-46-27">27</a></span>
<span class="normal"><a href="#__codelineno-46-28">28</a></span>
<span class="normal"><a href="#__codelineno-46-29">29</a></span>
<span class="normal"><a href="#__codelineno-46-30">30</a></span>
<span class="normal"><a href="#__codelineno-46-31">31</a></span>
<span class="normal"><a href="#__codelineno-46-32">32</a></span>
<span class="normal"><a href="#__codelineno-46-33">33</a></span>
<span class="normal"><a href="#__codelineno-46-34">34</a></span>
<span class="normal"><a href="#__codelineno-46-35">35</a></span>
<span class="normal"><a href="#__codelineno-46-36">36</a></span>
<span class="normal"><a href="#__codelineno-46-37">37</a></span>
<span class="normal"><a href="#__codelineno-46-38">38</a></span>
<span class="normal"><a href="#__codelineno-46-39">39</a></span>
<span class="normal"><a href="#__codelineno-46-40">40</a></span>
<span class="normal"><a href="#__codelineno-46-41">41</a></span>
<span class="normal"><a href="#__codelineno-46-42">42</a></span>
<span class="normal"><a href="#__codelineno-46-43">43</a></span>
<span class="normal"><a href="#__codelineno-46-44">44</a></span>
<span class="normal"><a href="#__codelineno-46-45">45</a></span>
<span class="normal"><a href="#__codelineno-46-46">46</a></span>
<span class="normal"><a href="#__codelineno-46-47">47</a></span>
<span class="normal"><a href="#__codelineno-46-48">48</a></span>
<span class="normal"><a href="#__codelineno-46-49">49</a></span>
<span class="normal"><a href="#__codelineno-46-50">50</a></span>
<span class="normal"><a href="#__codelineno-46-51">51</a></span>
<span class="normal"><a href="#__codelineno-46-52">52</a></span>
<span class="normal"><a href="#__codelineno-46-53">53</a></span>
<span class="normal"><a href="#__codelineno-46-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="c1"># 生成虚拟数据</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="k">def</span> <span class="nf">generate_data</span><span class="p">():</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8"></a>    <span class="c1"># 生成输入序列和对应的目标值</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9"></a>    <span class="n">seq_length</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10"></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">seq_length</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3维向量的输入序列</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 目标值是输入序列各元素之和</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13"></a>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14"></a>    <span class="c1"># 将y的每个元素转换为自身的列表</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15"></a>    <span class="n">y_as_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="n">element</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16"></a>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_as_list</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18"></a>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19"></a><span class="c1"># 构建模型</span>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22"></a><span class="hll">    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># 使用50个GRU单元</span>
</span></span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24"></a>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26"></a>
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27"></a><span class="c1"># 编译模型</span>
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30"></a>
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31"></a><span class="c1"># 生成数据</span>
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32"></a><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">()</span>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33"></a>
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34"></a><span class="nb">print</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span><span id="__span-46-35"><a id="__codelineno-46-35" name="__codelineno-46-35"></a><span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
</span><span id="__span-46-36"><a id="__codelineno-46-36" name="__codelineno-46-36"></a>
</span><span id="__span-46-37"><a id="__codelineno-46-37" name="__codelineno-46-37"></a><span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-46-38"><a id="__codelineno-46-38" name="__codelineno-46-38"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sum </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-46-39"><a id="__codelineno-46-39" name="__codelineno-46-39"></a>
</span><span id="__span-46-40"><a id="__codelineno-46-40" name="__codelineno-46-40"></a><span class="c1"># exit(0)</span>
</span><span id="__span-46-41"><a id="__codelineno-46-41" name="__codelineno-46-41"></a>
</span><span id="__span-46-42"><a id="__codelineno-46-42" name="__codelineno-46-42"></a><span class="c1"># 训练模型</span>
</span><span id="__span-46-43"><a id="__codelineno-46-43" name="__codelineno-46-43"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-46-44"><a id="__codelineno-46-44" name="__codelineno-46-44"></a>
</span><span id="__span-46-45"><a id="__codelineno-46-45" name="__codelineno-46-45"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-46-46"><a id="__codelineno-46-46" name="__codelineno-46-46"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;gru_weights.h5&#39;</span><span class="p">)</span>
</span><span id="__span-46-47"><a id="__codelineno-46-47" name="__codelineno-46-47"></a>
</span><span id="__span-46-48"><a id="__codelineno-46-48" name="__codelineno-46-48"></a><span class="c1"># 预测并计算每个序列输出的和</span>
</span><span id="__span-46-49"><a id="__codelineno-46-49" name="__codelineno-46-49"></a><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span><span id="__span-46-50"><a id="__codelineno-46-50" name="__codelineno-46-50"></a><span class="n">sum_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-46-51"><a id="__codelineno-46-51" name="__codelineno-46-51"></a>
</span><span id="__span-46-52"><a id="__codelineno-46-52" name="__codelineno-46-52"></a><span class="c1"># 打印结果</span>
</span><span id="__span-46-53"><a id="__codelineno-46-53" name="__codelineno-46-53"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predictions:&quot;</span><span class="p">)</span>
</span><span id="__span-46-54"><a id="__codelineno-46-54" name="__codelineno-46-54"></a><span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>终端中显示的预测的输出变成了</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">Predictions</span><span class="p">:</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="p">[[[</span><span class="mf">0.3234646</span> <span class="p">]</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>  <span class="p">[</span><span class="mf">0.5083787</span> <span class="p">]</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>  <span class="p">[</span><span class="mf">0.5576476</span> <span class="p">]</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>  <span class="p">[</span><span class="mf">0.54944414</span><span class="p">]</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>  <span class="p">[</span><span class="mf">0.47944394</span><span class="p">]</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>  <span class="p">[</span><span class="mf">0.5049154</span> <span class="p">]</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>  <span class="p">[</span><span class="mf">0.50329256</span><span class="p">]</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>  <span class="p">[</span><span class="mf">0.5258315</span> <span class="p">]</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>  <span class="p">[</span><span class="mf">0.69459194</span><span class="p">]</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>  <span class="p">[</span><span class="mf">0.7504357</span> <span class="p">]]</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a> <span class="o">...</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="p">]</span>
</span></code></pre></div>
<p>然后我在末尾添加了这样几行代码来<strong>比较预测结果和目标结果</strong>，并将 <code>epochs</code> 设置成了 <code>1000</code></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-56">56</a></span>
<span class="normal"><a href="#__codelineno-48-57">57</a></span>
<span class="normal"><a href="#__codelineno-48-58">58</a></span>
<span class="normal"><a href="#__codelineno-48-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-48-56"><a id="__codelineno-48-56" name="__codelineno-48-56"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-48-57"><a id="__codelineno-48-57" name="__codelineno-48-57"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot; -------&quot;</span><span class="p">)</span>
</span><span id="__span-48-58"><a id="__codelineno-48-58" name="__codelineno-48-58"></a>    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="__span-48-59"><a id="__codelineno-48-59" name="__codelineno-48-59"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;act_sum </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">, pre: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>下面是训练后进行预测的(部分)结果</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="o">...</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="mi">9</span>  <span class="o">-------</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">act_sum</span> <span class="p">[</span><span class="mf">0.17794148</span> <span class="mf">0.2804384</span>  <span class="mf">0.91154308</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.36992296</span><span class="p">],</span> <span class="n">pre</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.3727927</span><span class="p">]</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="n">act_sum</span> <span class="p">[</span><span class="mf">0.9505687</span>  <span class="mf">0.57981087</span> <span class="mf">0.11528877</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.64566833</span><span class="p">],</span> <span class="n">pre</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.6547668</span><span class="p">]</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="n">act_sum</span> <span class="p">[</span><span class="mf">0.10600898</span> <span class="mf">0.16341549</span> <span class="mf">0.22128649</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.49071096</span><span class="p">],</span> <span class="n">pre</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.49099457</span><span class="p">]</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="n">act_sum</span> <span class="p">[</span><span class="mf">0.32428769</span> <span class="mf">0.09856033</span> <span class="mf">0.46073104</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.88357906</span><span class="p">],</span> <span class="n">pre</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8894826</span><span class="p">]</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="o">...</span>
</span></code></pre></div>
<blockquote>
<p>😲没想到被卡了这么久的地方就这样被解决了😅😭</p>
</blockquote>
<hr />
<p>在之后思考了一下 <code>return_sequences</code> 分别为 <code>True</code> 和 <code>False</code> 的区别，</p>
<p>我的理解中，如果为 <code>True</code> 应该就是像这题里我们想要处理的数据一样，<strong><mark>每一个输入的数据都对应一个输出</mark></strong>，</p>
<p>而如果为 <code>False</code> 应该就是像22年C题一样 <strong>比如需要用之前一段序列的数据来获得单个的数据(用前30天的价格来预测下一天的价格)</strong></p>
<h3 id="_7">用决赛数据进行训练和预测<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>队友之前已经将冠军决赛的数据处理好发给我了，于是我就重新写了一个python文件，</p>
<details class="note" open="open">
<summary><code>my_test5.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span>
<span class="normal"><a href="#__codelineno-50-16">16</a></span>
<span class="normal"><a href="#__codelineno-50-17">17</a></span>
<span class="normal"><a href="#__codelineno-50-18">18</a></span>
<span class="normal"><a href="#__codelineno-50-19">19</a></span>
<span class="normal"><a href="#__codelineno-50-20">20</a></span>
<span class="normal"><a href="#__codelineno-50-21">21</a></span>
<span class="normal"><a href="#__codelineno-50-22">22</a></span>
<span class="normal"><a href="#__codelineno-50-23">23</a></span>
<span class="normal"><a href="#__codelineno-50-24">24</a></span>
<span class="normal"><a href="#__codelineno-50-25">25</a></span>
<span class="normal"><a href="#__codelineno-50-26">26</a></span>
<span class="normal"><a href="#__codelineno-50-27">27</a></span>
<span class="normal"><a href="#__codelineno-50-28">28</a></span>
<span class="normal"><a href="#__codelineno-50-29">29</a></span>
<span class="normal"><a href="#__codelineno-50-30">30</a></span>
<span class="normal"><a href="#__codelineno-50-31">31</a></span>
<span class="normal"><a href="#__codelineno-50-32">32</a></span>
<span class="normal"><a href="#__codelineno-50-33">33</a></span>
<span class="normal"><a href="#__codelineno-50-34">34</a></span>
<span class="normal"><a href="#__codelineno-50-35">35</a></span>
<span class="normal"><a href="#__codelineno-50-36">36</a></span>
<span class="normal"><a href="#__codelineno-50-37">37</a></span>
<span class="normal"><a href="#__codelineno-50-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3"></a>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7"></a>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;CA(test)_2.csv&quot;</span><span class="p">)</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11"></a>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15"></a><span class="n">Shi</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17"></a><span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18"></a>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23"></a>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25"></a>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26"></a><span class="c1"># 编译模型</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">)</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29"></a>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30"></a><span class="c1"># 训练模型</span>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32"></a>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;Shi.h5&#39;</span><span class="p">)</span>
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35"></a>
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36"></a><span class="n">pre</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Shi</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pre: &quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;act: &quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
</details>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-8">8</a></span>
<span class="normal"><a href="#__codelineno-51-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;CA(test)_2.csv&quot;</span><span class="p">)</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
<p>首先，用pandas读取csv中的数据，需要注意的是(如果参数都使用默认设置) <code>read_csv</code> 函数读取数据时会将第一行认为是标题而不与其他数据一起存储。</p>
<p>然后，将读取出来的数据 <code>data</code> 转换成numpy数组，这里由于csv表格读取出来是类似一个2维的矩阵，又因为只有一个序列，所以在 <code>data</code> 外再套一层列表再转换成numpy数组即可。</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>再将头两列 选手名 和 <em>分</em>数 去除，并将数据全部转换成numpy的 <code>float32</code> 类型(如果数据格式不同意，在训练时会报错)。</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15"></a><span class="n">Shi</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
</span></code></pre></div></td></tr></table></div>
<p>将(去除后的)第一列作为目标数据，其余列作为输入数据，并都除去最后15个数据用于之后的预测比较，</p>
<p>复制一份完整数据用于预测。</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-19">19</a></span>
<span class="normal"><a href="#__codelineno-54-20">20</a></span>
<span class="normal"><a href="#__codelineno-54-21">21</a></span>
<span class="normal"><a href="#__codelineno-54-22">22</a></span>
<span class="normal"><a href="#__codelineno-54-23">23</a></span>
<span class="normal"><a href="#__codelineno-54-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23"></a>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24"></a>    <span class="k">return</span> <span class="n">model</span>
</span></code></pre></div></td></tr></table></div>
<p>因为输入数据有14的指标，所以设为14维，而<strong>激活函数 <code>activation</code> 已经有默认的设置</strong>所以就不用添加了。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nd">@keras_export</span><span class="p">(</span><span class="s2">&quot;keras.layers.GRU&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="p">[])</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="k">class</span> <span class="nc">GRU</span><span class="p">(</span><span class="n">DropoutRNNCellMixin</span><span class="p">,</span> <span class="n">RNN</span><span class="p">,</span> <span class="n">base_layer</span><span class="o">.</span><span class="n">BaseRandomLayer</span><span class="p">):</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>    <span class="o">...</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>        <span class="n">units</span><span class="p">,</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>        <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;tanh&quot;</span><span class="p">,</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>        <span class="n">recurrent_activation</span><span class="o">=</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">,</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>        <span class="o">...</span>
</span></code></pre></div>
</div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-56-31"><a id="__codelineno-56-31" name="__codelineno-56-31"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>由于只有一个序列的数据，所以 <code>batch_size</code> 设置为 <code>1</code> 。</p>
<p>最后输出的结果(展示了20个)</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="o">...</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.47406548</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.55</span><span class="p">]</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="o">-</span><span class="mf">0.01765729</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.18175407</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.2</span><span class="p">]</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.49228787</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.45</span><span class="p">]</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.97142494</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.</span><span class="p">]</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.8183602</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.</span><span class="p">]</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.731129</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.8</span><span class="p">]</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.7134777</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.55</span><span class="p">]</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.4599433</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.8594324</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.2</span><span class="p">]</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.2307503</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.25</span><span class="p">]</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.5505791</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.55</span><span class="p">]</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.2079588</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.2</span><span class="p">]</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.3865234</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.45</span><span class="p">]</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.6969306</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.8</span><span class="p">]</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.2981229</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.75</span><span class="p">]</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.9129096</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.45</span><span class="p">]</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.3361117</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">1.0873715</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="n">pre</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.786334</span><span class="p">]</span> <span class="n">act</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
</span></code></pre></div>
<blockquote>
<p>数据保存成了 <code>Shi.csv</code></p>
</blockquote>
<p>将用公式计算的<em>势头</em>和预测的<em>势头</em>用excel画出折线图比较</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">version 1</label><label for="__tabbed_3_2">version 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../../../../images/mcm_first_predict.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_first_predict" loading="lazy" src="../../../../images/mcm_first_predict.svg" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../../../../images/mcm_first_predict_2.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_first_predict_2" loading="lazy" src="../../../../images/mcm_first_predict_2.svg" /></a></p>
</div>
</div>
</div>
<p>没想到在完全预测部分的结果中，变换的趋势都是能对应上的😲，所以感觉还不错😄。</p>
<p>由于累了一天，并且下一天可能还需要熬夜通宵，所以把数据传给队友就结束今天的任务了。</p>
<h2 id="day-4-day-5">Day 4 &amp; Day 5<a class="headerlink" href="#day-4-day-5" title="Permanent link">&para;</a></h2>
<h3 id="5">扩大决赛数据的预测部分 (5号早)<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<blockquote>
<p>大约早上8点半至9点</p>
</blockquote>
<p>打算减少用于训练的数据占比，将完全进行预测的数据增大到1/3，看看预测的效果</p>
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test5.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="n">nums</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="n">nums</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="n">nums</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>数据保存成了 <code>Shi_2.csv</code></p>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">version 1</label><label for="__tabbed_4_2">version 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../../../../images/mcm_second_predict.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_second_predict" loading="lazy" src="../../../../images/mcm_second_predict.svg" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../../../../images/mcm_second_predict_2.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_second_predict_2" loading="lazy" src="../../../../images/mcm_second_predict_2.svg" /></a></p>
</div>
</div>
</div>
<h3 id="h5">尝试查看 <code>.h5</code> 权重文件<a class="headerlink" href="#h5" title="Permanent link">&para;</a></h3>
<p>这时想通过查看权重文件中的参数来分析每个指标/维度与<em>势头</em>的相关性，</p>
<p>于是搜索，然后发现这两篇文章</p>
<ul>
<li><a href="https://blog.csdn.net/qq_42508076/article/details/116600303">可视化工具打开hdf5文件_hdf5文件用什么打开-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/weixin_45674669/article/details/130029509">查看h5文件方法——vitables-CSDN博客</a></li>
</ul>
<p>都提到使用vitables来查看 <code>.h5</code> 文件，于是按照文章所说， <code>pip install vitables</code> 之后，</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>vitables<span class="w"> </span>Shi_2.h5
</span></code></pre></div>
<p><a class="glightbox" href="../../../../images/vitables.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="vitables" loading="lazy" src="../../../../images/vitables.png" /></a></p>
<p>但弄了一番之后感觉似乎并不是太有用，于是就不打算再研究 <code>.h5</code> 文件了</p>
<blockquote>
<p>期间还有尝试生成不同的单位向量(每个维度对应一个)，然后输入进行预测，进而查看结果，然后通过结果来分析不同维度对<em>势头</em>的相关性，</p>
<p>但是后来想了想，觉得有些不合理，并且关系都是非线性的，可能预测的结果体现不出相关性，最后就放弃了这样的思路</p>
</blockquote>
<h3 id="5_1">增添决赛的数据并再次训练 (5号午)<a class="headerlink" href="#5_1" title="Permanent link">&para;</a></h3>
<p>快中午时，查看决赛的数据的时候，感觉 <strong>每一局中还剩几分能获胜</strong> 应该是一个对势头影响比较大的因素，而队友却没有放在csv文件中，于是让队友重新处理添加了数据，</p>
<p>然后到了下午我重新进行了训练和预测。</p>
<blockquote>
<p>数据保存成了 <code>Shi_3.csv</code></p>
</blockquote>
<hr />
<p>这个时候还顺带发现了，原来tensorflow可以直接保存模型文件😅(而不是权重文件)</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>之前chatgpt提供的代码(最开始提供的tensorflow GRU模型的代码)中包含了保存权重文件的部分，</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;gru_weights.h5&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>于是在那之后不久又去询问了如何加载权重文件，</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>    <span class="o">...</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="n">model</span><span class="o">.</span><span class="n">load_weights</span><span class="p">(</span><span class="s1">&#39;gru_weights.h5&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>并且需要注意，<strong><mark>构建的模型需要与之前的模型结构一样</mark></strong>，否则可能会报错。</p>
</details>
<p>已经训练好的模型通过 <code>save</code> 方法即可保存，如</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;my_gru_model.keras&#39;</span><span class="p">)</span>
</span></code></pre></div>
<blockquote>
<p>keras文件应该就是tensorflow自己的模型文件格式，因为keras好像就是tensorflow下的一个包</p>
</blockquote>
<p>然后就可以(<mark>非常迅速地</mark>😎)<strong>直接从文件中加载模型</strong>(与之相对的就是，先搭建好模型再用模型加载权重文件)</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;my_gru_model.keras&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>然后就可以直接进行预测等操作。</p>
<h3 id="_8">着手处理全部的数据<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>队友之前已经将这列我们认为没有太大作用的数据去除了，</p>
<div class="language-css highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="nt">winner_shot_type</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="nt">p1_distance_run</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="nt">p2_distance_run</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="nt">rally_count</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="nt">speed_mph</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="nt">serve_widt</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="nt">serve_depth</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="nt">return_depth</span>
</span></code></pre></div>
<p>然后我又让他再看看还有什么在处理决赛数据时能用上的操作，发现只能替换分数，</p>
<blockquote>
<p>在 <code>p1_score</code> 和 <code>p2_score</code> 那两列，</p>
<ul>
<li>把 <code>15</code> 替换成 <code>1</code></li>
<li>把 <code>30</code> 替换成 <code>2</code></li>
<li>把 <code>40</code> 替换成 <code>3</code></li>
<li>把 <code>AD</code> 替换成 <code>4</code></li>
</ul>
</blockquote>
<p>于是他替换好分数之后把总的csv发给了我，然后我就开始写处理全部数据的python代码。</p>
<blockquote>
<p>此时大约下午4点</p>
</blockquote>
<hr />
<p>这时我有两种思路，</p>
<ol>
<li>选出第一轮32个选手的数据，然后用32个数据序列来进行训练</li>
<li>选出冠军5场比赛的所有数据进行训练</li>
</ol>
<p>我先处理第一种思路，</p>
<details class="note" open="open">
<summary><code>my_test7.py</code> <code>my_test8.py</code> <code>my_test9.py</code></summary>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><input id="__tabbed_5_3" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1"><code>my_test7.py</code></label><label for="__tabbed_5_2"><code>my_test8.py</code></label><label for="__tabbed_5_3"><code>my_test9.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test7.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span>
<span class="normal"><a href="#__codelineno-65-18">18</a></span>
<span class="normal"><a href="#__codelineno-65-19">19</a></span>
<span class="normal"><a href="#__codelineno-65-20">20</a></span>
<span class="normal"><a href="#__codelineno-65-21">21</a></span>
<span class="normal"><a href="#__codelineno-65-22">22</a></span>
<span class="normal"><a href="#__codelineno-65-23">23</a></span>
<span class="normal"><a href="#__codelineno-65-24">24</a></span>
<span class="normal"><a href="#__codelineno-65-25">25</a></span>
<span class="normal"><a href="#__codelineno-65-26">26</a></span>
<span class="normal"><a href="#__codelineno-65-27">27</a></span>
<span class="normal"><a href="#__codelineno-65-28">28</a></span>
<span class="normal"><a href="#__codelineno-65-29">29</a></span>
<span class="normal"><a href="#__codelineno-65-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3"></a>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;Wimbledon_featured_matches.csv&quot;</span><span class="p">)</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5"></a>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8"></a>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10"></a>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12"></a>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13"></a><span class="c1"># exit(0)</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14"></a>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15"></a><span class="c1"># 将 match_id 结尾为 13xx 的数据筛选出来，并且将每一个 id 的数据存在单独的 csv 文件中</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16"></a><span class="n">data_of_13</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">13</span><span class="p">,</span> <span class="n">all_data</span><span class="p">)))</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17"></a>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">data_of_13</span><span class="p">)</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19"></a>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20"></a><span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21"></a><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_of_13</span><span class="p">:</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23"></a>        <span class="n">result</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24"></a>    <span class="n">result</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)),</span> <span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27"></a>    <span class="c1"># name like: 00 01 02 ...</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29"></a>    <span class="c1"># copy the file to another name</span>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test8.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-66-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-66-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-66-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-66-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-66-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-66-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-66-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-66-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-66-10">10</a></span>
<span class="normal"><a href="#__codelineno-66-11">11</a></span>
<span class="normal"><a href="#__codelineno-66-12">12</a></span>
<span class="normal"><a href="#__codelineno-66-13">13</a></span>
<span class="normal"><a href="#__codelineno-66-14">14</a></span>
<span class="normal"><a href="#__codelineno-66-15">15</a></span>
<span class="normal"><a href="#__codelineno-66-16">16</a></span>
<span class="normal"><a href="#__codelineno-66-17">17</a></span>
<span class="normal"><a href="#__codelineno-66-18">18</a></span>
<span class="normal"><a href="#__codelineno-66-19">19</a></span>
<span class="normal"><a href="#__codelineno-66-20">20</a></span>
<span class="normal"><a href="#__codelineno-66-21">21</a></span>
<span class="normal"><a href="#__codelineno-66-22">22</a></span>
<span class="normal"><a href="#__codelineno-66-23">23</a></span>
<span class="normal"><a href="#__codelineno-66-24">24</a></span>
<span class="normal"><a href="#__codelineno-66-25">25</a></span>
<span class="normal"><a href="#__codelineno-66-26">26</a></span>
<span class="normal"><a href="#__codelineno-66-27">27</a></span>
<span class="normal"><a href="#__codelineno-66-28">28</a></span>
<span class="normal"><a href="#__codelineno-66-29">29</a></span>
<span class="normal"><a href="#__codelineno-66-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3"></a>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;Wimbledon_featured_matches.csv&quot;</span><span class="p">)</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5"></a>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8"></a>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9"></a><span class="n">col_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10"></a><span class="n">thing_to_find</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;match_id&quot;</span><span class="p">,</span> <span class="s2">&quot;elapsed_time&quot;</span><span class="p">,</span> <span class="s2">&quot;set_no&quot;</span><span class="p">,</span> <span class="s2">&quot;game_no&quot;</span><span class="p">,</span> <span class="s2">&quot;point_no&quot;</span><span class="p">,</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11"></a>                 <span class="s2">&quot;game_victor&quot;</span><span class="p">,</span> <span class="s2">&quot;set_victor&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_net_pt&quot;</span><span class="p">,</span> <span class="s2">&quot;p2_net_pt&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_net_pt_won&quot;</span><span class="p">,</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12"></a>                 <span class="s2">&quot;p2_net_pt_won&quot;</span><span class="p">,</span> <span class="s1">&#39;p1_points_won&#39;</span><span class="p">,</span> <span class="s1">&#39;p2_points_won&#39;</span><span class="p">)</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13"></a><span class="c1"># get the index of the column</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14"></a><span class="n">index_to_find</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_list</span><span class="p">)):</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16"></a>    <span class="k">if</span> <span class="n">col_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">thing_to_find</span><span class="p">:</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17"></a>        <span class="n">index_to_find</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18"></a>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19"></a><span class="c1"># exit(0)</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20"></a>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">):</span>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24"></a>    <span class="c1"># delete the column whose index is in index_to_find</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index_to_find</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26"></a>    <span class="c1"># print(data)</span>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27"></a>
</span><span id="__span-66-28"><a id="__codelineno-66-28" name="__codelineno-66-28"></a>    <span class="c1"># save the data to the file</span>
</span><span id="__span-66-29"><a id="__codelineno-66-29" name="__codelineno-66-29"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-66-30"><a id="__codelineno-66-30" name="__codelineno-66-30"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test9.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-67-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-67-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-67-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-67-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-67-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-67-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-67-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-67-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-67-10">10</a></span>
<span class="normal"><a href="#__codelineno-67-11">11</a></span>
<span class="normal"><a href="#__codelineno-67-12">12</a></span>
<span class="normal"><a href="#__codelineno-67-13">13</a></span>
<span class="normal"><a href="#__codelineno-67-14">14</a></span>
<span class="normal"><a href="#__codelineno-67-15">15</a></span>
<span class="normal"><a href="#__codelineno-67-16">16</a></span>
<span class="normal"><a href="#__codelineno-67-17">17</a></span>
<span class="normal"><a href="#__codelineno-67-18">18</a></span>
<span class="normal"><a href="#__codelineno-67-19">19</a></span>
<span class="normal"><a href="#__codelineno-67-20">20</a></span>
<span class="normal"><a href="#__codelineno-67-21">21</a></span>
<span class="normal"><a href="#__codelineno-67-22">22</a></span>
<span class="normal"><a href="#__codelineno-67-23">23</a></span>
<span class="normal"><a href="#__codelineno-67-24">24</a></span>
<span class="normal"><a href="#__codelineno-67-25">25</a></span>
<span class="normal"><a href="#__codelineno-67-26">26</a></span>
<span class="normal"><a href="#__codelineno-67-27">27</a></span>
<span class="normal"><a href="#__codelineno-67-28">28</a></span>
<span class="normal"><a href="#__codelineno-67-29">29</a></span>
<span class="normal"><a href="#__codelineno-67-30">30</a></span>
<span class="normal"><a href="#__codelineno-67-31">31</a></span>
<span class="normal"><a href="#__codelineno-67-32">32</a></span>
<span class="normal"><a href="#__codelineno-67-33">33</a></span>
<span class="normal"><a href="#__codelineno-67-34">34</a></span>
<span class="normal"><a href="#__codelineno-67-35">35</a></span>
<span class="normal"><a href="#__codelineno-67-36">36</a></span>
<span class="normal"><a href="#__codelineno-67-37">37</a></span>
<span class="normal"><a href="#__codelineno-67-38">38</a></span>
<span class="normal"><a href="#__codelineno-67-39">39</a></span>
<span class="normal"><a href="#__codelineno-67-40">40</a></span>
<span class="normal"><a href="#__codelineno-67-41">41</a></span>
<span class="normal"><a href="#__codelineno-67-42">42</a></span>
<span class="normal"><a href="#__codelineno-67-43">43</a></span>
<span class="normal"><a href="#__codelineno-67-44">44</a></span>
<span class="normal"><a href="#__codelineno-67-45">45</a></span>
<span class="normal"><a href="#__codelineno-67-46">46</a></span>
<span class="normal"><a href="#__codelineno-67-47">47</a></span>
<span class="normal"><a href="#__codelineno-67-48">48</a></span>
<span class="normal"><a href="#__codelineno-67-49">49</a></span>
<span class="normal"><a href="#__codelineno-67-50">50</a></span>
<span class="normal"><a href="#__codelineno-67-51">51</a></span>
<span class="normal"><a href="#__codelineno-67-52">52</a></span>
<span class="normal"><a href="#__codelineno-67-53">53</a></span>
<span class="normal"><a href="#__codelineno-67-54">54</a></span>
<span class="normal"><a href="#__codelineno-67-55">55</a></span>
<span class="normal"><a href="#__codelineno-67-56">56</a></span>
<span class="normal"><a href="#__codelineno-67-57">57</a></span>
<span class="normal"><a href="#__codelineno-67-58">58</a></span>
<span class="normal"><a href="#__codelineno-67-59">59</a></span>
<span class="normal"><a href="#__codelineno-67-60">60</a></span>
<span class="normal"><a href="#__codelineno-67-61">61</a></span>
<span class="normal"><a href="#__codelineno-67-62">62</a></span>
<span class="normal"><a href="#__codelineno-67-63">63</a></span>
<span class="normal"><a href="#__codelineno-67-64">64</a></span>
<span class="normal"><a href="#__codelineno-67-65">65</a></span>
<span class="normal"><a href="#__codelineno-67-66">66</a></span>
<span class="normal"><a href="#__codelineno-67-67">67</a></span>
<span class="normal"><a href="#__codelineno-67-68">68</a></span>
<span class="normal"><a href="#__codelineno-67-69">69</a></span>
<span class="normal"><a href="#__codelineno-67-70">70</a></span>
<span class="normal"><a href="#__codelineno-67-71">71</a></span>
<span class="normal"><a href="#__codelineno-67-72">72</a></span>
<span class="normal"><a href="#__codelineno-67-73">73</a></span>
<span class="normal"><a href="#__codelineno-67-74">74</a></span>
<span class="normal"><a href="#__codelineno-67-75">75</a></span>
<span class="normal"><a href="#__codelineno-67-76">76</a></span>
<span class="normal"><a href="#__codelineno-67-77">77</a></span>
<span class="normal"><a href="#__codelineno-67-78">78</a></span>
<span class="normal"><a href="#__codelineno-67-79">79</a></span>
<span class="normal"><a href="#__codelineno-67-80">80</a></span>
<span class="normal"><a href="#__codelineno-67-81">81</a></span>
<span class="normal"><a href="#__codelineno-67-82">82</a></span>
<span class="normal"><a href="#__codelineno-67-83">83</a></span>
<span class="normal"><a href="#__codelineno-67-84">84</a></span>
<span class="normal"><a href="#__codelineno-67-85">85</a></span>
<span class="normal"><a href="#__codelineno-67-86">86</a></span>
<span class="normal"><a href="#__codelineno-67-87">87</a></span>
<span class="normal"><a href="#__codelineno-67-88">88</a></span>
<span class="normal"><a href="#__codelineno-67-89">89</a></span>
<span class="normal"><a href="#__codelineno-67-90">90</a></span>
<span class="normal"><a href="#__codelineno-67-91">91</a></span>
<span class="normal"><a href="#__codelineno-67-92">92</a></span>
<span class="normal"><a href="#__codelineno-67-93">93</a></span>
<span class="normal"><a href="#__codelineno-67-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3"></a>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="sd">[&#39;player1&#39;, &#39;player2&#39;,</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6"></a><span class="sd">       &#39;p1_sets&#39;, &#39;p2_sets&#39;, </span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="sd">       &#39;p1_games&#39;, &#39;p2_games&#39;, </span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="sd">       &#39;p1_score&#39;, &#39;p2_score&#39;, </span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="sd">       &#39;server&#39;, &#39;serve_no&#39;, </span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10"></a><span class="sd">       &#39;point_victor&#39;,</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11"></a><span class="sd">       &#39;p1_ace&#39;, &#39;p2_ace&#39;,</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12"></a><span class="sd">       &#39;p1_winner&#39;, &#39;p2_winner&#39;, </span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13"></a><span class="sd">       &#39;p1_double_fault&#39;, &#39;p2_double_fault&#39;,</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14"></a><span class="sd">       &#39;p1_unf_err&#39;, &#39;p2_unf_err&#39;,</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15"></a><span class="sd">       &#39;p1_break_pt&#39;, &#39;p2_break_pt&#39;, </span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16"></a><span class="sd">       &#39;p1_break_pt_won&#39;, &#39;p2_break_pt_won&#39;, </span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17"></a><span class="sd">       &#39;p1_break_pt_missed&#39;, &#39;p2_break_pt_missed&#39;]</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19"></a>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">):</span>
</span><span id="__span-67-21"><a id="__codelineno-67-21" name="__codelineno-67-21"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="__span-67-22"><a id="__codelineno-67-22" name="__codelineno-67-22"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-67-23"><a id="__codelineno-67-23" name="__codelineno-67-23"></a>
</span><span id="__span-67-24"><a id="__codelineno-67-24" name="__codelineno-67-24"></a>    <span class="c1"># 算 领先盘数 领先局数 领先球数 是不是一局最后三球 几球赢这局 势头</span>
</span><span id="__span-67-25"><a id="__codelineno-67-25" name="__codelineno-67-25"></a>    <span class="c1"># add a new column to the end of data</span>
</span><span id="__span-67-26"><a id="__codelineno-67-26" name="__codelineno-67-26"></a>    <span class="n">new_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="__span-67-27"><a id="__codelineno-67-27" name="__codelineno-67-27"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">new_column</span><span class="p">))</span>
</span><span id="__span-67-28"><a id="__codelineno-67-28" name="__codelineno-67-28"></a>
</span><span id="__span-67-29"><a id="__codelineno-67-29" name="__codelineno-67-29"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span><span id="__span-67-30"><a id="__codelineno-67-30" name="__codelineno-67-30"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-67-31"><a id="__codelineno-67-31" name="__codelineno-67-31"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-67-32"><a id="__codelineno-67-32" name="__codelineno-67-32"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
</span><span id="__span-67-33"><a id="__codelineno-67-33" name="__codelineno-67-33"></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-67-34"><a id="__codelineno-67-34" name="__codelineno-67-34"></a>            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-67-35"><a id="__codelineno-67-35" name="__codelineno-67-35"></a>            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-67-36"><a id="__codelineno-67-36" name="__codelineno-67-36"></a>            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-67-37"><a id="__codelineno-67-37" name="__codelineno-67-37"></a>
</span><span id="__span-67-38"><a id="__codelineno-67-38" name="__codelineno-67-38"></a>        <span class="c1"># 是否影响下一局</span>
</span><span id="__span-67-39"><a id="__codelineno-67-39" name="__codelineno-67-39"></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-67-40"><a id="__codelineno-67-40" name="__codelineno-67-40"></a>            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="__span-67-41"><a id="__codelineno-67-41" name="__codelineno-67-41"></a>
</span><span id="__span-67-42"><a id="__codelineno-67-42" name="__codelineno-67-42"></a>        <span class="c1"># 判断还剩几球赢这局</span>
</span><span id="__span-67-43"><a id="__codelineno-67-43" name="__codelineno-67-43"></a>        <span class="n">me</span><span class="p">,</span> <span class="n">they</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="__span-67-44"><a id="__codelineno-67-44" name="__codelineno-67-44"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># 判断是否抢七</span>
</span><span id="__span-67-45"><a id="__codelineno-67-45" name="__codelineno-67-45"></a>            <span class="n">target</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">7</span>
</span><span id="__span-67-46"><a id="__codelineno-67-46" name="__codelineno-67-46"></a>            <span class="c1"># 对手超过6就加分</span>
</span><span id="__span-67-47"><a id="__codelineno-67-47" name="__codelineno-67-47"></a>            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">target</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">target</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-67-48"><a id="__codelineno-67-48" name="__codelineno-67-48"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-67-49"><a id="__codelineno-67-49" name="__codelineno-67-49"></a>            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-67-50"><a id="__codelineno-67-50" name="__codelineno-67-50"></a>                <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-67-51"><a id="__codelineno-67-51" name="__codelineno-67-51"></a>            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-67-52"><a id="__codelineno-67-52" name="__codelineno-67-52"></a>                <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-67-53"><a id="__codelineno-67-53" name="__codelineno-67-53"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-67-54"><a id="__codelineno-67-54" name="__codelineno-67-54"></a>                <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-67-55"><a id="__codelineno-67-55" name="__codelineno-67-55"></a>
</span><span id="__span-67-56"><a id="__codelineno-67-56" name="__codelineno-67-56"></a>    <span class="n">index_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="o">+</span><span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-67-57"><a id="__codelineno-67-57" name="__codelineno-67-57"></a>
</span><span id="__span-67-58"><a id="__codelineno-67-58" name="__codelineno-67-58"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index_to_delete</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-67-59"><a id="__codelineno-67-59" name="__codelineno-67-59"></a>
</span><span id="__span-67-60"><a id="__codelineno-67-60" name="__codelineno-67-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-67-61"><a id="__codelineno-67-61" name="__codelineno-67-61"></a><span class="sd">    [&#39;player1&#39;,</span>
</span><span id="__span-67-62"><a id="__codelineno-67-62" name="__codelineno-67-62"></a><span class="sd">           &#39;p1_sets&#39;,</span>
</span><span id="__span-67-63"><a id="__codelineno-67-63" name="__codelineno-67-63"></a><span class="sd">           &#39;p1_games&#39;,</span>
</span><span id="__span-67-64"><a id="__codelineno-67-64" name="__codelineno-67-64"></a><span class="sd">           &#39;p1_score&#39;,</span>
</span><span id="__span-67-65"><a id="__codelineno-67-65" name="__codelineno-67-65"></a><span class="sd">           &#39;server&#39;, &#39;serve_no&#39;, </span>
</span><span id="__span-67-66"><a id="__codelineno-67-66" name="__codelineno-67-66"></a><span class="sd">           &#39;point_victor&#39;,</span>
</span><span id="__span-67-67"><a id="__codelineno-67-67" name="__codelineno-67-67"></a><span class="sd">           &#39;p1_ace&#39;,</span>
</span><span id="__span-67-68"><a id="__codelineno-67-68" name="__codelineno-67-68"></a><span class="sd">           &#39;p1_winner&#39;, </span>
</span><span id="__span-67-69"><a id="__codelineno-67-69" name="__codelineno-67-69"></a><span class="sd">           &#39;p1_double_fault&#39;,</span>
</span><span id="__span-67-70"><a id="__codelineno-67-70" name="__codelineno-67-70"></a><span class="sd">           &#39;p1_unf_err&#39;,</span>
</span><span id="__span-67-71"><a id="__codelineno-67-71" name="__codelineno-67-71"></a><span class="sd">           &#39;p1_break_pt&#39;, </span>
</span><span id="__span-67-72"><a id="__codelineno-67-72" name="__codelineno-67-72"></a><span class="sd">           &#39;p1_break_pt_won&#39;, </span>
</span><span id="__span-67-73"><a id="__codelineno-67-73" name="__codelineno-67-73"></a><span class="sd">           &#39;p1_break_pt_missed&#39;]</span>
</span><span id="__span-67-74"><a id="__codelineno-67-74" name="__codelineno-67-74"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-67-75"><a id="__codelineno-67-75" name="__codelineno-67-75"></a>
</span><span id="__span-67-76"><a id="__codelineno-67-76" name="__codelineno-67-76"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-67-77"><a id="__codelineno-67-77" name="__codelineno-67-77"></a>        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-67-78"><a id="__codelineno-67-78" name="__codelineno-67-78"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-67-79"><a id="__codelineno-67-79" name="__codelineno-67-79"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-67-80"><a id="__codelineno-67-80" name="__codelineno-67-80"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-67-81"><a id="__codelineno-67-81" name="__codelineno-67-81"></a>
</span><span id="__span-67-82"><a id="__codelineno-67-82" name="__codelineno-67-82"></a>        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-67-83"><a id="__codelineno-67-83" name="__codelineno-67-83"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-67-84"><a id="__codelineno-67-84" name="__codelineno-67-84"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-67-85"><a id="__codelineno-67-85" name="__codelineno-67-85"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-67-86"><a id="__codelineno-67-86" name="__codelineno-67-86"></a>
</span><span id="__span-67-87"><a id="__codelineno-67-87" name="__codelineno-67-87"></a>    <span class="c1"># 计算势头</span>
</span><span id="__span-67-88"><a id="__codelineno-67-88" name="__codelineno-67-88"></a>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.2</span>
</span><span id="__span-67-89"><a id="__codelineno-67-89" name="__codelineno-67-89"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="__span-67-90"><a id="__codelineno-67-90" name="__codelineno-67-90"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
</span><span id="__span-67-91"><a id="__codelineno-67-91" name="__codelineno-67-91"></a>
</span><span id="__span-67-92"><a id="__codelineno-67-92" name="__codelineno-67-92"></a>    <span class="c1"># save the data to the file</span>
</span><span id="__span-67-93"><a id="__codelineno-67-93" name="__codelineno-67-93"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-67-94"><a id="__codelineno-67-94" name="__codelineno-67-94"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h4><big>第一步，在 my_test7.py 中</big></h4>

<p>先读取了csv中的数据并转换成numpy数组，</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;Wimbledon_featured_matches.csv&quot;</span><span class="p">)</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="o">...</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span></code></pre></div>
<p>再将 <code>match_id</code> 结尾为 <code>13xx</code> 的数据筛选出来，</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>在 <code>Wimbledon_featured_matches.csv</code> 中，一共进行了5轮比赛，</p>
<ul>
<li>第1轮，<code>match_id</code> 以 <code>13xx</code> 结尾，对应<strong>32进16</strong></li>
<li>第2轮，<code>match_id</code> 以 <code>14xx</code> 结尾，对应<strong>16进8</strong></li>
<li>第3轮，<code>match_id</code> 以 <code>15xx</code> 结尾，对应<strong>8进4</strong></li>
<li>第4轮，<code>match_id</code> 以 <code>16xx</code> 结尾，对应<strong>4进2</strong></li>
<li>第5轮，<code>match_id</code> 以 <code>17xx</code> 结尾，对应<strong>决赛</strong></li>
</ul>
</div>
<p>并且将每一个 id 的数据存在单独的csv文件中，</p>
<p>且由于每场比赛有两个选手的数据，所以每场比赛都各复制了一份，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-15">15</a></span>
<span class="normal"><a href="#__codelineno-69-16">16</a></span>
<span class="normal"><a href="#__codelineno-69-17">17</a></span>
<span class="normal"><a href="#__codelineno-69-18">18</a></span>
<span class="normal"><a href="#__codelineno-69-19">19</a></span>
<span class="normal"><a href="#__codelineno-69-20">20</a></span>
<span class="normal"><a href="#__codelineno-69-21">21</a></span>
<span class="normal"><a href="#__codelineno-69-22">22</a></span>
<span class="normal"><a href="#__codelineno-69-23">23</a></span>
<span class="normal"><a href="#__codelineno-69-24">24</a></span>
<span class="normal"><a href="#__codelineno-69-25">25</a></span>
<span class="normal"><a href="#__codelineno-69-26">26</a></span>
<span class="normal"><a href="#__codelineno-69-27">27</a></span>
<span class="normal"><a href="#__codelineno-69-28">28</a></span>
<span class="normal"><a href="#__codelineno-69-29">29</a></span>
<span class="normal"><a href="#__codelineno-69-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15"></a><span class="c1"># 将 match_id 结尾为 13xx 的数据筛选出来，并且将每一个 id 的数据存在单独的 csv 文件中</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16"></a><span class="n">data_of_13</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">13</span><span class="p">,</span> <span class="n">all_data</span><span class="p">)))</span>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17"></a>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">data_of_13</span><span class="p">)</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19"></a>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20"></a><span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21"></a><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_of_13</span><span class="p">:</span>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23"></a>        <span class="n">result</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24"></a>    <span class="n">result</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)),</span> <span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="__span-69-26"><a id="__codelineno-69-26" name="__codelineno-69-26"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-69-27"><a id="__codelineno-69-27" name="__codelineno-69-27"></a>    <span class="c1"># name like: 00 01 02 ...</span>
</span><span id="__span-69-28"><a id="__codelineno-69-28" name="__codelineno-69-28"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-69-29"><a id="__codelineno-69-29" name="__codelineno-69-29"></a>    <span class="c1"># copy the file to another name</span>
</span><span id="__span-69-30"><a id="__codelineno-69-30" name="__codelineno-69-30"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>这里在调用 <code>to_csv</code> 时，设置 <code>header=True</code> 是因为pandas在 <code>read_csv</code> 时会默认把第一行当作列标题(之前也有提到过)，所以在村文件的时候要给新的csv添加列标题。</p>
<h4><big>第二步，在 my_test8.py 中</big></h4>

<p>由于需要删除几列没有用的数据，所以采取了这样的方法，</p>
<p>因为原来的 <code>Wimbledon_featured_matches.csv</code> 列名是数据名，而要使用numpy中的 <code>detele</code> 函数需要传入要删除列的下标序号，</p>
<p>所以我先在 <code>Wimbledon_featured_matches.csv</code> 中获取了列名的列表，</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;Wimbledon_featured_matches.csv&quot;</span><span class="p">)</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="o">...</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="n">col_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></code></pre></div>
<p>再获取要删去的列的下标序号，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-10">10</a></span>
<span class="normal"><a href="#__codelineno-71-11">11</a></span>
<span class="normal"><a href="#__codelineno-71-12">12</a></span>
<span class="normal"><a href="#__codelineno-71-13">13</a></span>
<span class="normal"><a href="#__codelineno-71-14">14</a></span>
<span class="normal"><a href="#__codelineno-71-15">15</a></span>
<span class="normal"><a href="#__codelineno-71-16">16</a></span>
<span class="normal"><a href="#__codelineno-71-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10"></a><span class="n">thing_to_find</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;match_id&quot;</span><span class="p">,</span> <span class="s2">&quot;elapsed_time&quot;</span><span class="p">,</span> <span class="s2">&quot;set_no&quot;</span><span class="p">,</span> <span class="s2">&quot;game_no&quot;</span><span class="p">,</span> <span class="s2">&quot;point_no&quot;</span><span class="p">,</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11"></a>                 <span class="s2">&quot;game_victor&quot;</span><span class="p">,</span> <span class="s2">&quot;set_victor&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_net_pt&quot;</span><span class="p">,</span> <span class="s2">&quot;p2_net_pt&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_net_pt_won&quot;</span><span class="p">,</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12"></a>                 <span class="s2">&quot;p2_net_pt_won&quot;</span><span class="p">,</span> <span class="s1">&#39;p1_points_won&#39;</span><span class="p">,</span> <span class="s1">&#39;p2_points_won&#39;</span><span class="p">)</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13"></a><span class="c1"># get the index of the column</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14"></a><span class="n">index_to_find</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_list</span><span class="p">)):</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16"></a>    <span class="k">if</span> <span class="n">col_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">thing_to_find</span><span class="p">:</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17"></a>        <span class="n">index_to_find</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>最后在第一步得到的csv中删去对应的列，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-21">21</a></span>
<span class="normal"><a href="#__codelineno-72-22">22</a></span>
<span class="normal"><a href="#__codelineno-72-23">23</a></span>
<span class="normal"><a href="#__codelineno-72-24">24</a></span>
<span class="normal"><a href="#__codelineno-72-25">25</a></span>
<span class="normal"><a href="#__codelineno-72-26">26</a></span>
<span class="normal"><a href="#__codelineno-72-27">27</a></span>
<span class="normal"><a href="#__codelineno-72-28">28</a></span>
<span class="normal"><a href="#__codelineno-72-29">29</a></span>
<span class="normal"><a href="#__codelineno-72-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">):</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24"></a>    <span class="c1"># delete the column whose index is in index_to_find</span>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index_to_find</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26"></a>    <span class="c1"># print(data)</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27"></a>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28"></a>    <span class="c1"># save the data to the file</span>
</span><span id="__span-72-29"><a id="__codelineno-72-29" name="__codelineno-72-29"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-72-30"><a id="__codelineno-72-30" name="__codelineno-72-30"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4><big>第三步，在 my_test9.py 中</big></h4>

<p>需要将每个选手的数据保留而删去对手的数据，并添加/计算一些所需的数据。</p>
<p>由于有6个数据需要新添，所以在矩阵末尾添加6个新列，并初始化为0，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-24">24</a></span>
<span class="normal"><a href="#__codelineno-73-25">25</a></span>
<span class="normal"><a href="#__codelineno-73-26">26</a></span>
<span class="normal"><a href="#__codelineno-73-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-73-24"><a id="__codelineno-73-24" name="__codelineno-73-24"></a><span class="c1"># 算 领先盘数 领先局数 领先球数 是不是一局最后三球 几球赢这局 势头</span>
</span><span id="__span-73-25"><a id="__codelineno-73-25" name="__codelineno-73-25"></a><span class="c1"># add a new column to the end of data</span>
</span><span id="__span-73-26"><a id="__codelineno-73-26" name="__codelineno-73-26"></a><span class="n">new_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="__span-73-27"><a id="__codelineno-73-27" name="__codelineno-73-27"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">new_column</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<details class="tip" open="open">
<summary>Tip</summary>
<p><code>np.hstack</code> 的用法似乎是在numpy矩阵的<strong>最后一个层(或者说数组的维度)</strong>添加数据。</p>
<p>而numpy还有一个 <code>np.stack</code> 函数，与 <code>np.hstack</code> 用法类似，但还需要传入一个参数 <code>axis=</code> 来指定<strong>在哪一层插入新的元素</strong></p>
<details class="example" open="open">
<summary>chatlog</summary>
<p><strong>User</strong>:</p>
<p>如何将多个 二维 numpy array 合并成 一个三维 numpy array?</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>要将多个二维NumPy数组合并成一个三维NumPy数组，可以使用 <code>np.stack</code> 函数或 <code>np.concatenate</code> 函数。这两个函数允许你在指定的轴上合并数组。</p>
<p>以下是使用 <code>np.stack</code> 的示例：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="c1"># 假设有两个二维数组 arr1 和 arr2</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="n">arr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="c1"># 使用 np.stack 沿着新的轴（第三维度）合并数组</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="c1"># 打印结果</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></code></pre></div>
<p>或者，使用 <code>np.concatenate</code> ：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="c1"># 使用 np.concatenate 沿着新的轴（第三维度）合并数组</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">arr1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">arr2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="c1"># 打印结果</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></code></pre></div>
<p>这两种方法都将 <code>arr1</code> 和 <code>arr2</code> 合并到一个新的三维数组中，其中第三维度是合并的维度。确保调整轴和数组的形状以适应你的实际需求。</p>
</details>
</details>
<ul>
<li>
<p>计算领先的盘数，如果是p2(player2)，则乘个 <code>-1</code></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-30">30</a></span>
<span class="normal"><a href="#__codelineno-76-31">31</a></span>
<span class="normal"><a href="#__codelineno-76-32">32</a></span>
<span class="normal"><a href="#__codelineno-76-33">33</a></span>
<span class="normal"><a href="#__codelineno-76-34">34</a></span>
<span class="normal"><a href="#__codelineno-76-35">35</a></span>
<span class="normal"><a href="#__codelineno-76-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-76-30"><a id="__codelineno-76-30" name="__codelineno-76-30"></a><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-76-31"><a id="__codelineno-76-31" name="__codelineno-76-31"></a><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-76-32"><a id="__codelineno-76-32" name="__codelineno-76-32"></a><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
</span><span id="__span-76-33"><a id="__codelineno-76-33" name="__codelineno-76-33"></a><span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-76-34"><a id="__codelineno-76-34" name="__codelineno-76-34"></a>    <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-76-35"><a id="__codelineno-76-35" name="__codelineno-76-35"></a>    <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-76-36"><a id="__codelineno-76-36" name="__codelineno-76-36"></a>    <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>判断是否是一局的最后其中三分(计算的势头包含下一局的分)</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-38">38</a></span>
<span class="normal"><a href="#__codelineno-77-39">39</a></span>
<span class="normal"><a href="#__codelineno-77-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-77-38"><a id="__codelineno-77-38" name="__codelineno-77-38"></a><span class="c1"># 是否影响下一局</span>
</span><span id="__span-77-39"><a id="__codelineno-77-39" name="__codelineno-77-39"></a><span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-77-40"><a id="__codelineno-77-40" name="__codelineno-77-40"></a>    <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>计算还剩几分可以赢得这一局(<strong><mark>需要判断是否是</mark><em><mark>抢七</mark></em><mark>或者</mark><em><mark>抢十</mark></em><mark>的情况</mark></strong>)</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-42">42</a></span>
<span class="normal"><a href="#__codelineno-78-43">43</a></span>
<span class="normal"><a href="#__codelineno-78-44">44</a></span>
<span class="normal"><a href="#__codelineno-78-45">45</a></span>
<span class="normal"><a href="#__codelineno-78-46">46</a></span>
<span class="normal"><a href="#__codelineno-78-47">47</a></span>
<span class="normal"><a href="#__codelineno-78-48">48</a></span>
<span class="normal"><a href="#__codelineno-78-49">49</a></span>
<span class="normal"><a href="#__codelineno-78-50">50</a></span>
<span class="normal"><a href="#__codelineno-78-51">51</a></span>
<span class="normal"><a href="#__codelineno-78-52">52</a></span>
<span class="normal"><a href="#__codelineno-78-53">53</a></span>
<span class="normal"><a href="#__codelineno-78-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-78-42"><a id="__codelineno-78-42" name="__codelineno-78-42"></a><span class="c1"># 判断还剩几球赢这局</span>
</span><span id="__span-78-43"><a id="__codelineno-78-43" name="__codelineno-78-43"></a><span class="n">me</span><span class="p">,</span> <span class="n">they</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="__span-78-44"><a id="__codelineno-78-44" name="__codelineno-78-44"></a><span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># 判断是否抢七</span>
</span><span id="__span-78-45"><a id="__codelineno-78-45" name="__codelineno-78-45"></a>    <span class="n">target</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">7</span>
</span><span id="__span-78-46"><a id="__codelineno-78-46" name="__codelineno-78-46"></a>    <span class="c1"># 对手超过6就加分</span>
</span><span id="__span-78-47"><a id="__codelineno-78-47" name="__codelineno-78-47"></a>    <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">target</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">target</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-78-48"><a id="__codelineno-78-48" name="__codelineno-78-48"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-78-49"><a id="__codelineno-78-49" name="__codelineno-78-49"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-78-50"><a id="__codelineno-78-50" name="__codelineno-78-50"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-78-51"><a id="__codelineno-78-51" name="__codelineno-78-51"></a>    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-78-52"><a id="__codelineno-78-52" name="__codelineno-78-52"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-78-53"><a id="__codelineno-78-53" name="__codelineno-78-53"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-78-54"><a id="__codelineno-78-54" name="__codelineno-78-54"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<p>删除对手的数据，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-56">56</a></span>
<span class="normal"><a href="#__codelineno-79-57">57</a></span>
<span class="normal"><a href="#__codelineno-79-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-79-56"><a id="__codelineno-79-56" name="__codelineno-79-56"></a><span class="n">index_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="o">+</span><span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-79-57"><a id="__codelineno-79-57" name="__codelineno-79-57"></a>
</span><span id="__span-79-58"><a id="__codelineno-79-58" name="__codelineno-79-58"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index_to_delete</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>处理选手当前分是否赢的数据(原本为 <code>point_victor</code> ， <code>p1</code> 赢则为 <code>1</code> ， <code>p2</code> 赢则为 <code>2</code> )，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-76">76</a></span>
<span class="normal"><a href="#__codelineno-80-77">77</a></span>
<span class="normal"><a href="#__codelineno-80-78">78</a></span>
<span class="normal"><a href="#__codelineno-80-79">79</a></span>
<span class="normal"><a href="#__codelineno-80-80">80</a></span>
<span class="normal"><a href="#__codelineno-80-81">81</a></span>
<span class="normal"><a href="#__codelineno-80-82">82</a></span>
<span class="normal"><a href="#__codelineno-80-83">83</a></span>
<span class="normal"><a href="#__codelineno-80-84">84</a></span>
<span class="normal"><a href="#__codelineno-80-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-80-76"><a id="__codelineno-80-76" name="__codelineno-80-76"></a><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-80-77"><a id="__codelineno-80-77" name="__codelineno-80-77"></a>    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-80-78"><a id="__codelineno-80-78" name="__codelineno-80-78"></a>        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-80-79"><a id="__codelineno-80-79" name="__codelineno-80-79"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-80-80"><a id="__codelineno-80-80" name="__codelineno-80-80"></a>        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-80-81"><a id="__codelineno-80-81" name="__codelineno-80-81"></a>
</span><span id="__span-80-82"><a id="__codelineno-80-82" name="__codelineno-80-82"></a>    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-80-83"><a id="__codelineno-80-83" name="__codelineno-80-83"></a>        <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-80-84"><a id="__codelineno-80-84" name="__codelineno-80-84"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-80-85"><a id="__codelineno-80-85" name="__codelineno-80-85"></a>        <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></div></td></tr></table></div>
<p>计算<em>势头</em>，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-87">87</a></span>
<span class="normal"><a href="#__codelineno-81-88">88</a></span>
<span class="normal"><a href="#__codelineno-81-89">89</a></span>
<span class="normal"><a href="#__codelineno-81-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-81-87"><a id="__codelineno-81-87" name="__codelineno-81-87"></a><span class="c1"># 计算势头</span>
</span><span id="__span-81-88"><a id="__codelineno-81-88" name="__codelineno-81-88"></a><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.2</span>
</span><span id="__span-81-89"><a id="__codelineno-81-89" name="__codelineno-81-89"></a><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="__span-81-90"><a id="__codelineno-81-90" name="__codelineno-81-90"></a>    <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<p>最后保存数据，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-92">92</a></span>
<span class="normal"><a href="#__codelineno-82-93">93</a></span>
<span class="normal"><a href="#__codelineno-82-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-82-92"><a id="__codelineno-82-92" name="__codelineno-82-92"></a><span class="c1"># save the data to the file</span>
</span><span id="__span-82-93"><a id="__codelineno-82-93" name="__codelineno-82-93"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-82-94"><a id="__codelineno-82-94" name="__codelineno-82-94"></a><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<p>继续处理第二种思路，</p>
<details class="note">
<summary><code>my_test7_1.py</code> <code>my_test8_1.py</code> <code>my_test9_1.py</code></summary>
<div class="tabbed-set tabbed-alternate" data-tabs="6:3"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1"><code>my_test7_1.py</code></label><label for="__tabbed_6_2"><code>my_test8_1.py</code></label><label for="__tabbed_6_3"><code>my_test9_1.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test7_1.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-83-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-83-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-83-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-83-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-83-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-83-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-83-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-83-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-83-10">10</a></span>
<span class="normal"><a href="#__codelineno-83-11">11</a></span>
<span class="normal"><a href="#__codelineno-83-12">12</a></span>
<span class="normal"><a href="#__codelineno-83-13">13</a></span>
<span class="normal"><a href="#__codelineno-83-14">14</a></span>
<span class="normal"><a href="#__codelineno-83-15">15</a></span>
<span class="normal"><a href="#__codelineno-83-16">16</a></span>
<span class="normal"><a href="#__codelineno-83-17">17</a></span>
<span class="normal"><a href="#__codelineno-83-18">18</a></span>
<span class="normal"><a href="#__codelineno-83-19">19</a></span>
<span class="normal"><a href="#__codelineno-83-20">20</a></span>
<span class="normal"><a href="#__codelineno-83-21">21</a></span>
<span class="normal"><a href="#__codelineno-83-22">22</a></span>
<span class="normal"><a href="#__codelineno-83-23">23</a></span>
<span class="normal"><a href="#__codelineno-83-24">24</a></span>
<span class="normal"><a href="#__codelineno-83-25">25</a></span>
<span class="normal"><a href="#__codelineno-83-26">26</a></span>
<span class="normal"><a href="#__codelineno-83-27">27</a></span>
<span class="normal"><a href="#__codelineno-83-28">28</a></span>
<span class="normal"><a href="#__codelineno-83-29">29</a></span>
<span class="normal"><a href="#__codelineno-83-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3"></a>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;Wimbledon_featured_matches.csv&quot;</span><span class="p">)</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5"></a>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8"></a>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10"></a>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12"></a>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13"></a><span class="c1"># exit(0)</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14"></a>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15"></a><span class="c1"># 将 match_id 结尾为 13xx 的数据筛选出来，并且将每一个 id 的数据存在单独的 csv 文件中</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16"></a><span class="n">data_of_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Carlos Alcaraz&quot;</span><span class="p">,</span> <span class="n">all_data</span><span class="p">)))</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17"></a>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">data_of_one</span><span class="p">)</span>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19"></a>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20"></a><span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21"></a><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_of_one</span><span class="p">:</span>
</span><span id="__span-83-22"><a id="__codelineno-83-22" name="__codelineno-83-22"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-83-23"><a id="__codelineno-83-23" name="__codelineno-83-23"></a>        <span class="n">result</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-83-24"><a id="__codelineno-83-24" name="__codelineno-83-24"></a>    <span class="n">result</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-83-25"><a id="__codelineno-83-25" name="__codelineno-83-25"></a>
</span><span id="__span-83-26"><a id="__codelineno-83-26" name="__codelineno-83-26"></a><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="__span-83-27"><a id="__codelineno-83-27" name="__codelineno-83-27"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-83-28"><a id="__codelineno-83-28" name="__codelineno-83-28"></a>
</span><span id="__span-83-29"><a id="__codelineno-83-29" name="__codelineno-83-29"></a>    <span class="c1"># name like: 00 01 02 ...</span>
</span><span id="__span-83-30"><a id="__codelineno-83-30" name="__codelineno-83-30"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone/</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test8_1.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-84-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-84-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-84-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-84-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-84-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-84-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-84-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-84-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-84-10">10</a></span>
<span class="normal"><a href="#__codelineno-84-11">11</a></span>
<span class="normal"><a href="#__codelineno-84-12">12</a></span>
<span class="normal"><a href="#__codelineno-84-13">13</a></span>
<span class="normal"><a href="#__codelineno-84-14">14</a></span>
<span class="normal"><a href="#__codelineno-84-15">15</a></span>
<span class="normal"><a href="#__codelineno-84-16">16</a></span>
<span class="normal"><a href="#__codelineno-84-17">17</a></span>
<span class="normal"><a href="#__codelineno-84-18">18</a></span>
<span class="normal"><a href="#__codelineno-84-19">19</a></span>
<span class="normal"><a href="#__codelineno-84-20">20</a></span>
<span class="normal"><a href="#__codelineno-84-21">21</a></span>
<span class="normal"><a href="#__codelineno-84-22">22</a></span>
<span class="normal"><a href="#__codelineno-84-23">23</a></span>
<span class="normal"><a href="#__codelineno-84-24">24</a></span>
<span class="normal"><a href="#__codelineno-84-25">25</a></span>
<span class="normal"><a href="#__codelineno-84-26">26</a></span>
<span class="normal"><a href="#__codelineno-84-27">27</a></span>
<span class="normal"><a href="#__codelineno-84-28">28</a></span>
<span class="normal"><a href="#__codelineno-84-29">29</a></span>
<span class="normal"><a href="#__codelineno-84-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3"></a>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4"></a><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;Wimbledon_featured_matches.csv&quot;</span><span class="p">)</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5"></a>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7"></a><span class="nb">print</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8"></a>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9"></a><span class="n">col_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10"></a><span class="n">thing_to_find</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;match_id&quot;</span><span class="p">,</span> <span class="s2">&quot;elapsed_time&quot;</span><span class="p">,</span> <span class="s2">&quot;set_no&quot;</span><span class="p">,</span> <span class="s2">&quot;game_no&quot;</span><span class="p">,</span> <span class="s2">&quot;point_no&quot;</span><span class="p">,</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11"></a>                <span class="s2">&quot;game_victor&quot;</span><span class="p">,</span> <span class="s2">&quot;set_victor&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_net_pt&quot;</span><span class="p">,</span> <span class="s2">&quot;p2_net_pt&quot;</span><span class="p">,</span> <span class="s2">&quot;p1_net_pt_won&quot;</span><span class="p">,</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12"></a>                <span class="s2">&quot;p2_net_pt_won&quot;</span><span class="p">,</span> <span class="s1">&#39;p1_points_won&#39;</span><span class="p">,</span> <span class="s1">&#39;p2_points_won&#39;</span><span class="p">)</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13"></a><span class="c1"># get the index of the column</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14"></a><span class="n">index_to_find</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_list</span><span class="p">)):</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16"></a>    <span class="k">if</span> <span class="n">col_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">thing_to_find</span><span class="p">:</span>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17"></a>        <span class="n">index_to_find</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18"></a>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19"></a><span class="c1"># exit(0)</span>
</span><span id="__span-84-20"><a id="__codelineno-84-20" name="__codelineno-84-20"></a>
</span><span id="__span-84-21"><a id="__codelineno-84-21" name="__codelineno-84-21"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span>
</span><span id="__span-84-22"><a id="__codelineno-84-22" name="__codelineno-84-22"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">01.csv&quot;</span><span class="p">)</span>
</span><span id="__span-84-23"><a id="__codelineno-84-23" name="__codelineno-84-23"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-84-24"><a id="__codelineno-84-24" name="__codelineno-84-24"></a>    <span class="c1"># delete the column whose index is in index_to_find</span>
</span><span id="__span-84-25"><a id="__codelineno-84-25" name="__codelineno-84-25"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index_to_find</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-84-26"><a id="__codelineno-84-26" name="__codelineno-84-26"></a>    <span class="c1"># print(data)</span>
</span><span id="__span-84-27"><a id="__codelineno-84-27" name="__codelineno-84-27"></a>
</span><span id="__span-84-28"><a id="__codelineno-84-28" name="__codelineno-84-28"></a>    <span class="c1"># save the data to the file</span>
</span><span id="__span-84-29"><a id="__codelineno-84-29" name="__codelineno-84-29"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-84-30"><a id="__codelineno-84-30" name="__codelineno-84-30"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">01.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test9_1.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-85-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-85-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-85-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-85-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-85-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-85-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-85-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-85-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-85-10">10</a></span>
<span class="normal"><a href="#__codelineno-85-11">11</a></span>
<span class="normal"><a href="#__codelineno-85-12">12</a></span>
<span class="normal"><a href="#__codelineno-85-13">13</a></span>
<span class="normal"><a href="#__codelineno-85-14">14</a></span>
<span class="normal"><a href="#__codelineno-85-15">15</a></span>
<span class="normal"><a href="#__codelineno-85-16">16</a></span>
<span class="normal"><a href="#__codelineno-85-17">17</a></span>
<span class="normal"><a href="#__codelineno-85-18">18</a></span>
<span class="normal"><a href="#__codelineno-85-19">19</a></span>
<span class="normal"><a href="#__codelineno-85-20">20</a></span>
<span class="normal"><a href="#__codelineno-85-21">21</a></span>
<span class="normal"><a href="#__codelineno-85-22">22</a></span>
<span class="normal"><a href="#__codelineno-85-23">23</a></span>
<span class="normal"><a href="#__codelineno-85-24">24</a></span>
<span class="normal"><a href="#__codelineno-85-25">25</a></span>
<span class="normal"><a href="#__codelineno-85-26">26</a></span>
<span class="normal"><a href="#__codelineno-85-27">27</a></span>
<span class="normal"><a href="#__codelineno-85-28">28</a></span>
<span class="normal"><a href="#__codelineno-85-29">29</a></span>
<span class="normal"><a href="#__codelineno-85-30">30</a></span>
<span class="normal"><a href="#__codelineno-85-31">31</a></span>
<span class="normal"><a href="#__codelineno-85-32">32</a></span>
<span class="normal"><a href="#__codelineno-85-33">33</a></span>
<span class="normal"><a href="#__codelineno-85-34">34</a></span>
<span class="normal"><a href="#__codelineno-85-35">35</a></span>
<span class="normal"><a href="#__codelineno-85-36">36</a></span>
<span class="normal"><a href="#__codelineno-85-37">37</a></span>
<span class="normal"><a href="#__codelineno-85-38">38</a></span>
<span class="normal"><a href="#__codelineno-85-39">39</a></span>
<span class="normal"><a href="#__codelineno-85-40">40</a></span>
<span class="normal"><a href="#__codelineno-85-41">41</a></span>
<span class="normal"><a href="#__codelineno-85-42">42</a></span>
<span class="normal"><a href="#__codelineno-85-43">43</a></span>
<span class="normal"><a href="#__codelineno-85-44">44</a></span>
<span class="normal"><a href="#__codelineno-85-45">45</a></span>
<span class="normal"><a href="#__codelineno-85-46">46</a></span>
<span class="normal"><a href="#__codelineno-85-47">47</a></span>
<span class="normal"><a href="#__codelineno-85-48">48</a></span>
<span class="normal"><a href="#__codelineno-85-49">49</a></span>
<span class="normal"><a href="#__codelineno-85-50">50</a></span>
<span class="normal"><a href="#__codelineno-85-51">51</a></span>
<span class="normal"><a href="#__codelineno-85-52">52</a></span>
<span class="normal"><a href="#__codelineno-85-53">53</a></span>
<span class="normal"><a href="#__codelineno-85-54">54</a></span>
<span class="normal"><a href="#__codelineno-85-55">55</a></span>
<span class="normal"><a href="#__codelineno-85-56">56</a></span>
<span class="normal"><a href="#__codelineno-85-57">57</a></span>
<span class="normal"><a href="#__codelineno-85-58">58</a></span>
<span class="normal"><a href="#__codelineno-85-59">59</a></span>
<span class="normal"><a href="#__codelineno-85-60">60</a></span>
<span class="normal"><a href="#__codelineno-85-61">61</a></span>
<span class="normal"><a href="#__codelineno-85-62">62</a></span>
<span class="normal"><a href="#__codelineno-85-63">63</a></span>
<span class="normal"><a href="#__codelineno-85-64">64</a></span>
<span class="normal"><a href="#__codelineno-85-65">65</a></span>
<span class="normal"><a href="#__codelineno-85-66">66</a></span>
<span class="normal"><a href="#__codelineno-85-67">67</a></span>
<span class="normal"><a href="#__codelineno-85-68">68</a></span>
<span class="normal"><a href="#__codelineno-85-69">69</a></span>
<span class="normal"><a href="#__codelineno-85-70">70</a></span>
<span class="normal"><a href="#__codelineno-85-71">71</a></span>
<span class="normal"><a href="#__codelineno-85-72">72</a></span>
<span class="normal"><a href="#__codelineno-85-73">73</a></span>
<span class="normal"><a href="#__codelineno-85-74">74</a></span>
<span class="normal"><a href="#__codelineno-85-75">75</a></span>
<span class="normal"><a href="#__codelineno-85-76">76</a></span>
<span class="normal"><a href="#__codelineno-85-77">77</a></span>
<span class="normal"><a href="#__codelineno-85-78">78</a></span>
<span class="normal"><a href="#__codelineno-85-79">79</a></span>
<span class="normal"><a href="#__codelineno-85-80">80</a></span>
<span class="normal"><a href="#__codelineno-85-81">81</a></span>
<span class="normal"><a href="#__codelineno-85-82">82</a></span>
<span class="normal"><a href="#__codelineno-85-83">83</a></span>
<span class="normal"><a href="#__codelineno-85-84">84</a></span>
<span class="normal"><a href="#__codelineno-85-85">85</a></span>
<span class="normal"><a href="#__codelineno-85-86">86</a></span>
<span class="normal"><a href="#__codelineno-85-87">87</a></span>
<span class="normal"><a href="#__codelineno-85-88">88</a></span>
<span class="normal"><a href="#__codelineno-85-89">89</a></span>
<span class="normal"><a href="#__codelineno-85-90">90</a></span>
<span class="normal"><a href="#__codelineno-85-91">91</a></span>
<span class="normal"><a href="#__codelineno-85-92">92</a></span>
<span class="normal"><a href="#__codelineno-85-93">93</a></span>
<span class="normal"><a href="#__codelineno-85-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3"></a>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5"></a><span class="sd">[&#39;player1&#39;, &#39;player2&#39;,</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6"></a><span class="sd">    &#39;p1_sets&#39;, &#39;p2_sets&#39;, </span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7"></a><span class="sd">    &#39;p1_games&#39;, &#39;p2_games&#39;, </span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8"></a><span class="sd">    &#39;p1_score&#39;, &#39;p2_score&#39;, </span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9"></a><span class="sd">    &#39;server&#39;, &#39;serve_no&#39;, </span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10"></a><span class="sd">    &#39;point_victor&#39;,</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11"></a><span class="sd">    &#39;p1_ace&#39;, &#39;p2_ace&#39;,</span>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12"></a><span class="sd">    &#39;p1_winner&#39;, &#39;p2_winner&#39;, </span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13"></a><span class="sd">    &#39;p1_double_fault&#39;, &#39;p2_double_fault&#39;,</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14"></a><span class="sd">    &#39;p1_unf_err&#39;, &#39;p2_unf_err&#39;,</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15"></a><span class="sd">    &#39;p1_break_pt&#39;, &#39;p2_break_pt&#39;, </span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16"></a><span class="sd">    &#39;p1_break_pt_won&#39;, &#39;p2_break_pt_won&#39;, </span>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17"></a><span class="sd">    &#39;p1_break_pt_missed&#39;, &#39;p2_break_pt_missed&#39;]</span>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19"></a>
</span><span id="__span-85-20"><a id="__codelineno-85-20" name="__codelineno-85-20"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span>
</span><span id="__span-85-21"><a id="__codelineno-85-21" name="__codelineno-85-21"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">01.csv&quot;</span><span class="p">)</span>
</span><span id="__span-85-22"><a id="__codelineno-85-22" name="__codelineno-85-22"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-85-23"><a id="__codelineno-85-23" name="__codelineno-85-23"></a>
</span><span id="__span-85-24"><a id="__codelineno-85-24" name="__codelineno-85-24"></a>    <span class="c1"># 算 领先盘数 领先局数 领先球数 是不是一局最后三球 几球赢这局 势头</span>
</span><span id="__span-85-25"><a id="__codelineno-85-25" name="__codelineno-85-25"></a>    <span class="c1"># add a new column to the end of data</span>
</span><span id="__span-85-26"><a id="__codelineno-85-26" name="__codelineno-85-26"></a>    <span class="n">new_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="__span-85-27"><a id="__codelineno-85-27" name="__codelineno-85-27"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">new_column</span><span class="p">))</span>
</span><span id="__span-85-28"><a id="__codelineno-85-28" name="__codelineno-85-28"></a>
</span><span id="__span-85-29"><a id="__codelineno-85-29" name="__codelineno-85-29"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span><span id="__span-85-30"><a id="__codelineno-85-30" name="__codelineno-85-30"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-85-31"><a id="__codelineno-85-31" name="__codelineno-85-31"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-85-32"><a id="__codelineno-85-32" name="__codelineno-85-32"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
</span><span id="__span-85-33"><a id="__codelineno-85-33" name="__codelineno-85-33"></a>        <span class="c1"># if i % 2 == 0:</span>
</span><span id="__span-85-34"><a id="__codelineno-85-34" name="__codelineno-85-34"></a>        <span class="c1">#     data[j][-6] *= -1</span>
</span><span id="__span-85-35"><a id="__codelineno-85-35" name="__codelineno-85-35"></a>        <span class="c1">#     data[j][-5] *= -1</span>
</span><span id="__span-85-36"><a id="__codelineno-85-36" name="__codelineno-85-36"></a>        <span class="c1">#     data[j][-4] *= -1</span>
</span><span id="__span-85-37"><a id="__codelineno-85-37" name="__codelineno-85-37"></a>
</span><span id="__span-85-38"><a id="__codelineno-85-38" name="__codelineno-85-38"></a>        <span class="c1"># 是否影响下一局</span>
</span><span id="__span-85-39"><a id="__codelineno-85-39" name="__codelineno-85-39"></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-85-40"><a id="__codelineno-85-40" name="__codelineno-85-40"></a>            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="__span-85-41"><a id="__codelineno-85-41" name="__codelineno-85-41"></a>
</span><span id="__span-85-42"><a id="__codelineno-85-42" name="__codelineno-85-42"></a>        <span class="c1"># 判断还剩几球赢这局</span>
</span><span id="__span-85-43"><a id="__codelineno-85-43" name="__codelineno-85-43"></a>        <span class="n">me</span><span class="p">,</span> <span class="n">they</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># if i % 2 == 1 else (7, 6)</span>
</span><span id="__span-85-44"><a id="__codelineno-85-44" name="__codelineno-85-44"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># 判断是否抢七</span>
</span><span id="__span-85-45"><a id="__codelineno-85-45" name="__codelineno-85-45"></a>            <span class="n">target</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">7</span>
</span><span id="__span-85-46"><a id="__codelineno-85-46" name="__codelineno-85-46"></a>            <span class="c1"># 对手超过6就加分</span>
</span><span id="__span-85-47"><a id="__codelineno-85-47" name="__codelineno-85-47"></a>            <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">target</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">target</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-85-48"><a id="__codelineno-85-48" name="__codelineno-85-48"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-85-49"><a id="__codelineno-85-49" name="__codelineno-85-49"></a>            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-85-50"><a id="__codelineno-85-50" name="__codelineno-85-50"></a>                <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-85-51"><a id="__codelineno-85-51" name="__codelineno-85-51"></a>            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">they</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-85-52"><a id="__codelineno-85-52" name="__codelineno-85-52"></a>                <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">me</span><span class="p">]</span>
</span><span id="__span-85-53"><a id="__codelineno-85-53" name="__codelineno-85-53"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-85-54"><a id="__codelineno-85-54" name="__codelineno-85-54"></a>                <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-85-55"><a id="__codelineno-85-55" name="__codelineno-85-55"></a>
</span><span id="__span-85-56"><a id="__codelineno-85-56" name="__codelineno-85-56"></a>    <span class="n">index_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-85-57"><a id="__codelineno-85-57" name="__codelineno-85-57"></a>
</span><span id="__span-85-58"><a id="__codelineno-85-58" name="__codelineno-85-58"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index_to_delete</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-85-59"><a id="__codelineno-85-59" name="__codelineno-85-59"></a>
</span><span id="__span-85-60"><a id="__codelineno-85-60" name="__codelineno-85-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-85-61"><a id="__codelineno-85-61" name="__codelineno-85-61"></a><span class="sd">    [&#39;player1&#39;,</span>
</span><span id="__span-85-62"><a id="__codelineno-85-62" name="__codelineno-85-62"></a><span class="sd">        &#39;p1_sets&#39;,</span>
</span><span id="__span-85-63"><a id="__codelineno-85-63" name="__codelineno-85-63"></a><span class="sd">        &#39;p1_games&#39;,</span>
</span><span id="__span-85-64"><a id="__codelineno-85-64" name="__codelineno-85-64"></a><span class="sd">        &#39;p1_score&#39;,</span>
</span><span id="__span-85-65"><a id="__codelineno-85-65" name="__codelineno-85-65"></a><span class="sd">        &#39;server&#39;, &#39;serve_no&#39;, </span>
</span><span id="__span-85-66"><a id="__codelineno-85-66" name="__codelineno-85-66"></a><span class="sd">        &#39;point_victor&#39;,</span>
</span><span id="__span-85-67"><a id="__codelineno-85-67" name="__codelineno-85-67"></a><span class="sd">        &#39;p1_ace&#39;,</span>
</span><span id="__span-85-68"><a id="__codelineno-85-68" name="__codelineno-85-68"></a><span class="sd">        &#39;p1_winner&#39;, </span>
</span><span id="__span-85-69"><a id="__codelineno-85-69" name="__codelineno-85-69"></a><span class="sd">        &#39;p1_double_fault&#39;,</span>
</span><span id="__span-85-70"><a id="__codelineno-85-70" name="__codelineno-85-70"></a><span class="sd">        &#39;p1_unf_err&#39;,</span>
</span><span id="__span-85-71"><a id="__codelineno-85-71" name="__codelineno-85-71"></a><span class="sd">        &#39;p1_break_pt&#39;, </span>
</span><span id="__span-85-72"><a id="__codelineno-85-72" name="__codelineno-85-72"></a><span class="sd">        &#39;p1_break_pt_won&#39;, </span>
</span><span id="__span-85-73"><a id="__codelineno-85-73" name="__codelineno-85-73"></a><span class="sd">        &#39;p1_break_pt_missed&#39;]</span>
</span><span id="__span-85-74"><a id="__codelineno-85-74" name="__codelineno-85-74"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-85-75"><a id="__codelineno-85-75" name="__codelineno-85-75"></a>
</span><span id="__span-85-76"><a id="__codelineno-85-76" name="__codelineno-85-76"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-85-77"><a id="__codelineno-85-77" name="__codelineno-85-77"></a>        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-85-78"><a id="__codelineno-85-78" name="__codelineno-85-78"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-85-79"><a id="__codelineno-85-79" name="__codelineno-85-79"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-85-80"><a id="__codelineno-85-80" name="__codelineno-85-80"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-85-81"><a id="__codelineno-85-81" name="__codelineno-85-81"></a>
</span><span id="__span-85-82"><a id="__codelineno-85-82" name="__codelineno-85-82"></a>        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-85-83"><a id="__codelineno-85-83" name="__codelineno-85-83"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-85-84"><a id="__codelineno-85-84" name="__codelineno-85-84"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-85-85"><a id="__codelineno-85-85" name="__codelineno-85-85"></a>            <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-85-86"><a id="__codelineno-85-86" name="__codelineno-85-86"></a>
</span><span id="__span-85-87"><a id="__codelineno-85-87" name="__codelineno-85-87"></a>    <span class="c1"># 计算势头</span>
</span><span id="__span-85-88"><a id="__codelineno-85-88" name="__codelineno-85-88"></a>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.2</span>
</span><span id="__span-85-89"><a id="__codelineno-85-89" name="__codelineno-85-89"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="__span-85-90"><a id="__codelineno-85-90" name="__codelineno-85-90"></a>        <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
</span><span id="__span-85-91"><a id="__codelineno-85-91" name="__codelineno-85-91"></a>
</span><span id="__span-85-92"><a id="__codelineno-85-92" name="__codelineno-85-92"></a>    <span class="c1"># save the data to the file</span>
</span><span id="__span-85-93"><a id="__codelineno-85-93" name="__codelineno-85-93"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-85-94"><a id="__codelineno-85-94" name="__codelineno-85-94"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">01.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<p>这次我基本上是基于处理第一种思路时的代码进行修改的，所以大体上差不多。</p>
<h3 id="5_2">用处理好的数据进行训练及预测 (5号晚)<a class="headerlink" href="#5_2" title="Permanent link">&para;</a></h3>
<details class="note">
<summary>两种思路分别对应的模型训练python代码</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1"><code>my_test10.py</code></label><label for="__tabbed_7_2"><code>my_test10_1.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test10.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-86-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-86-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-86-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-86-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-86-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-86-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-86-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-86-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-86-10">10</a></span>
<span class="normal"><a href="#__codelineno-86-11">11</a></span>
<span class="normal"><a href="#__codelineno-86-12">12</a></span>
<span class="normal"><a href="#__codelineno-86-13">13</a></span>
<span class="normal"><a href="#__codelineno-86-14">14</a></span>
<span class="normal"><a href="#__codelineno-86-15">15</a></span>
<span class="normal"><a href="#__codelineno-86-16">16</a></span>
<span class="normal"><a href="#__codelineno-86-17">17</a></span>
<span class="normal"><a href="#__codelineno-86-18">18</a></span>
<span class="normal"><a href="#__codelineno-86-19">19</a></span>
<span class="normal"><a href="#__codelineno-86-20">20</a></span>
<span class="normal"><a href="#__codelineno-86-21">21</a></span>
<span class="normal"><a href="#__codelineno-86-22">22</a></span>
<span class="normal"><a href="#__codelineno-86-23">23</a></span>
<span class="normal"><a href="#__codelineno-86-24">24</a></span>
<span class="normal"><a href="#__codelineno-86-25">25</a></span>
<span class="normal"><a href="#__codelineno-86-26">26</a></span>
<span class="normal"><a href="#__codelineno-86-27">27</a></span>
<span class="normal"><a href="#__codelineno-86-28">28</a></span>
<span class="normal"><a href="#__codelineno-86-29">29</a></span>
<span class="normal"><a href="#__codelineno-86-30">30</a></span>
<span class="normal"><a href="#__codelineno-86-31">31</a></span>
<span class="normal"><a href="#__codelineno-86-32">32</a></span>
<span class="normal"><a href="#__codelineno-86-33">33</a></span>
<span class="normal"><a href="#__codelineno-86-34">34</a></span>
<span class="normal"><a href="#__codelineno-86-35">35</a></span>
<span class="normal"><a href="#__codelineno-86-36">36</a></span>
<span class="normal"><a href="#__codelineno-86-37">37</a></span>
<span class="normal"><a href="#__codelineno-86-38">38</a></span>
<span class="normal"><a href="#__codelineno-86-39">39</a></span>
<span class="normal"><a href="#__codelineno-86-40">40</a></span>
<span class="normal"><a href="#__codelineno-86-41">41</a></span>
<span class="normal"><a href="#__codelineno-86-42">42</a></span>
<span class="normal"><a href="#__codelineno-86-43">43</a></span>
<span class="normal"><a href="#__codelineno-86-44">44</a></span>
<span class="normal"><a href="#__codelineno-86-45">45</a></span>
<span class="normal"><a href="#__codelineno-86-46">46</a></span>
<span class="normal"><a href="#__codelineno-86-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3"></a>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7"></a>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8"></a><span class="n">all_datas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">):</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10"></a>    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12"></a>        <span class="n">all_datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">164</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13"></a><span class="c1"># data = pd.read_csv(&quot;CA(test)_2.csv&quot;)</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">all_datas</span><span class="p">))</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16"></a>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17"></a><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># delete name</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19"></a>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20"></a><span class="c1"># input()</span>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21"></a>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22"></a><span class="n">nums</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23"></a><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="n">nums</span><span class="o">//</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24"></a><span class="c1"># Shi, val = val[:, :, :1], val[:, :, 1:]</span>
</span><span id="__span-86-25"><a id="__codelineno-86-25" name="__codelineno-86-25"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-86-26"><a id="__codelineno-86-26" name="__codelineno-86-26"></a><span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="__span-86-27"><a id="__codelineno-86-27" name="__codelineno-86-27"></a>
</span><span id="__span-86-28"><a id="__codelineno-86-28" name="__codelineno-86-28"></a><span class="c1"># input()</span>
</span><span id="__span-86-29"><a id="__codelineno-86-29" name="__codelineno-86-29"></a>
</span><span id="__span-86-30"><a id="__codelineno-86-30" name="__codelineno-86-30"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-86-31"><a id="__codelineno-86-31" name="__codelineno-86-31"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-86-32"><a id="__codelineno-86-32" name="__codelineno-86-32"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-86-33"><a id="__codelineno-86-33" name="__codelineno-86-33"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-86-34"><a id="__codelineno-86-34" name="__codelineno-86-34"></a>
</span><span id="__span-86-35"><a id="__codelineno-86-35" name="__codelineno-86-35"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-86-36"><a id="__codelineno-86-36" name="__codelineno-86-36"></a>
</span><span id="__span-86-37"><a id="__codelineno-86-37" name="__codelineno-86-37"></a><span class="c1"># 编译模型</span>
</span><span id="__span-86-38"><a id="__codelineno-86-38" name="__codelineno-86-38"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-86-39"><a id="__codelineno-86-39" name="__codelineno-86-39"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">)</span>
</span><span id="__span-86-40"><a id="__codelineno-86-40" name="__codelineno-86-40"></a>
</span><span id="__span-86-41"><a id="__codelineno-86-41" name="__codelineno-86-41"></a><span class="c1"># 训练模型</span>
</span><span id="__span-86-42"><a id="__codelineno-86-42" name="__codelineno-86-42"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span id="__span-86-43"><a id="__codelineno-86-43" name="__codelineno-86-43"></a>
</span><span id="__span-86-44"><a id="__codelineno-86-44" name="__codelineno-86-44"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-86-45"><a id="__codelineno-86-45" name="__codelineno-86-45"></a><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Shi_everyone&quot;</span>
</span><span id="__span-86-46"><a id="__codelineno-86-46" name="__codelineno-86-46"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span><span class="p">)</span>
</span><span id="__span-86-47"><a id="__codelineno-86-47" name="__codelineno-86-47"></a><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.keras&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test10_1.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-87-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-87-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-87-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-87-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-87-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-87-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-87-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-87-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-87-10">10</a></span>
<span class="normal"><a href="#__codelineno-87-11">11</a></span>
<span class="normal"><a href="#__codelineno-87-12">12</a></span>
<span class="normal"><a href="#__codelineno-87-13">13</a></span>
<span class="normal"><a href="#__codelineno-87-14">14</a></span>
<span class="normal"><a href="#__codelineno-87-15">15</a></span>
<span class="normal"><a href="#__codelineno-87-16">16</a></span>
<span class="normal"><a href="#__codelineno-87-17">17</a></span>
<span class="normal"><a href="#__codelineno-87-18">18</a></span>
<span class="normal"><a href="#__codelineno-87-19">19</a></span>
<span class="normal"><a href="#__codelineno-87-20">20</a></span>
<span class="normal"><a href="#__codelineno-87-21">21</a></span>
<span class="normal"><a href="#__codelineno-87-22">22</a></span>
<span class="normal"><a href="#__codelineno-87-23">23</a></span>
<span class="normal"><a href="#__codelineno-87-24">24</a></span>
<span class="normal"><a href="#__codelineno-87-25">25</a></span>
<span class="normal"><a href="#__codelineno-87-26">26</a></span>
<span class="normal"><a href="#__codelineno-87-27">27</a></span>
<span class="normal"><a href="#__codelineno-87-28">28</a></span>
<span class="normal"><a href="#__codelineno-87-29">29</a></span>
<span class="normal"><a href="#__codelineno-87-30">30</a></span>
<span class="normal"><a href="#__codelineno-87-31">31</a></span>
<span class="normal"><a href="#__codelineno-87-32">32</a></span>
<span class="normal"><a href="#__codelineno-87-33">33</a></span>
<span class="normal"><a href="#__codelineno-87-34">34</a></span>
<span class="normal"><a href="#__codelineno-87-35">35</a></span>
<span class="normal"><a href="#__codelineno-87-36">36</a></span>
<span class="normal"><a href="#__codelineno-87-37">37</a></span>
<span class="normal"><a href="#__codelineno-87-38">38</a></span>
<span class="normal"><a href="#__codelineno-87-39">39</a></span>
<span class="normal"><a href="#__codelineno-87-40">40</a></span>
<span class="normal"><a href="#__codelineno-87-41">41</a></span>
<span class="normal"><a href="#__codelineno-87-42">42</a></span>
<span class="normal"><a href="#__codelineno-87-43">43</a></span>
<span class="normal"><a href="#__codelineno-87-44">44</a></span>
<span class="normal"><a href="#__codelineno-87-45">45</a></span>
<span class="normal"><a href="#__codelineno-87-46">46</a></span>
<span class="normal"><a href="#__codelineno-87-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3"></a>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7"></a>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8"></a><span class="n">all_datas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10"></a>    <span class="c1"># if i != 5 and i != 6:</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">01.csv&quot;</span><span class="p">)</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12"></a>    <span class="n">all_datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">159</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13"></a><span class="c1"># data = pd.read_csv(&quot;CA(test)_2.csv&quot;)</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">all_datas</span><span class="p">))</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16"></a>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17"></a><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># delete name</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19"></a>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20"></a><span class="c1"># input()</span>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21"></a>
</span><span id="__span-87-22"><a id="__codelineno-87-22" name="__codelineno-87-22"></a><span class="n">nums</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-87-23"><a id="__codelineno-87-23" name="__codelineno-87-23"></a><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="n">nums</span><span class="o">//</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-87-24"><a id="__codelineno-87-24" name="__codelineno-87-24"></a><span class="c1"># Shi, val = val[:, :, :1], val[:, :, 1:]</span>
</span><span id="__span-87-25"><a id="__codelineno-87-25" name="__codelineno-87-25"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-87-26"><a id="__codelineno-87-26" name="__codelineno-87-26"></a><span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="__span-87-27"><a id="__codelineno-87-27" name="__codelineno-87-27"></a>
</span><span id="__span-87-28"><a id="__codelineno-87-28" name="__codelineno-87-28"></a><span class="c1"># input()</span>
</span><span id="__span-87-29"><a id="__codelineno-87-29" name="__codelineno-87-29"></a>
</span><span id="__span-87-30"><a id="__codelineno-87-30" name="__codelineno-87-30"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-87-31"><a id="__codelineno-87-31" name="__codelineno-87-31"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-87-32"><a id="__codelineno-87-32" name="__codelineno-87-32"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-87-33"><a id="__codelineno-87-33" name="__codelineno-87-33"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-87-34"><a id="__codelineno-87-34" name="__codelineno-87-34"></a>
</span><span id="__span-87-35"><a id="__codelineno-87-35" name="__codelineno-87-35"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-87-36"><a id="__codelineno-87-36" name="__codelineno-87-36"></a>
</span><span id="__span-87-37"><a id="__codelineno-87-37" name="__codelineno-87-37"></a><span class="c1"># 编译模型</span>
</span><span id="__span-87-38"><a id="__codelineno-87-38" name="__codelineno-87-38"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-87-39"><a id="__codelineno-87-39" name="__codelineno-87-39"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">)</span>
</span><span id="__span-87-40"><a id="__codelineno-87-40" name="__codelineno-87-40"></a>
</span><span id="__span-87-41"><a id="__codelineno-87-41" name="__codelineno-87-41"></a><span class="c1"># 训练模型</span>
</span><span id="__span-87-42"><a id="__codelineno-87-42" name="__codelineno-87-42"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-87-43"><a id="__codelineno-87-43" name="__codelineno-87-43"></a>
</span><span id="__span-87-44"><a id="__codelineno-87-44" name="__codelineno-87-44"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-87-45"><a id="__codelineno-87-45" name="__codelineno-87-45"></a><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Shi_onlyone&quot;</span>
</span><span id="__span-87-46"><a id="__codelineno-87-46" name="__codelineno-87-46"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span><span class="p">)</span>
</span><span id="__span-87-47"><a id="__codelineno-87-47" name="__codelineno-87-47"></a><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.keras&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<p>这里需要注意的是，32个选手即对应32个数据序列，所以 <code>batch_size</code> 设为 <code>32</code> ，</p>
<p>但输入数据是一个矩阵，即 <strong><mark>每个序列的长度必须一样</mark></strong>。</p>
<p>于是获取到了16场比赛各自进行了多少<em>分</em>,</p>
<div class="language-css highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="nt">1</span><span class="w">   </span><span class="nt">300</span><span class="o">,</span><span class="w"> </span><span class="nt">201</span><span class="o">,</span><span class="w"> </span><span class="nt">134</span><span class="o">,</span><span class="w"> </span><span class="nt">337</span><span class="o">,</span><span class="w"> </span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="nt">5</span><span class="w">   </span><span class="nt">246</span><span class="o">,</span><span class="w"> </span><span class="nt">332</span><span class="o">,</span><span class="w"> </span><span class="nt">232</span><span class="o">,</span><span class="w"> </span><span class="nt">190</span><span class="o">,</span><span class="w"> </span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="nt">9</span><span class="w">   </span><span class="nt">213</span><span class="o">,</span><span class="w"> </span><span class="nt">318</span><span class="o">,</span><span class="w"> </span><span class="nt">170</span><span class="o">,</span><span class="w"> </span><span class="nt">275</span><span class="o">,</span><span class="w"> </span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="nt">13</span><span class="w">  </span><span class="nt">290</span><span class="o">,</span><span class="w"> </span><span class="nt">185</span><span class="o">,</span><span class="w"> </span><span class="nt">198</span><span class="o">,</span><span class="w"> </span><span class="nt">167</span><span class="o">,</span>
</span></code></pre></div>
<p>再通过代码计算出能使用最多数据进行训练的方案，</p>
<details class="note">
<summary><code>my_test11.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-89-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-89-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-89-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-89-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-89-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-89-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-89-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-89-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-89-10">10</a></span>
<span class="normal"><a href="#__codelineno-89-11">11</a></span>
<span class="normal"><a href="#__codelineno-89-12">12</a></span>
<span class="normal"><a href="#__codelineno-89-13">13</a></span>
<span class="normal"><a href="#__codelineno-89-14">14</a></span>
<span class="normal"><a href="#__codelineno-89-15">15</a></span>
<span class="normal"><a href="#__codelineno-89-16">16</a></span>
<span class="normal"><a href="#__codelineno-89-17">17</a></span>
<span class="normal"><a href="#__codelineno-89-18">18</a></span>
<span class="normal"><a href="#__codelineno-89-19">19</a></span>
<span class="normal"><a href="#__codelineno-89-20">20</a></span>
<span class="normal"><a href="#__codelineno-89-21">21</a></span>
<span class="normal"><a href="#__codelineno-89-22">22</a></span>
<span class="normal"><a href="#__codelineno-89-23">23</a></span>
<span class="normal"><a href="#__codelineno-89-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3"></a>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7"></a>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8"></a><span class="c1"># res = []</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9"></a><span class="c1"># for i in range(1, 33):</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10"></a><span class="c1">#     data = pd.read_csv(f&quot;everyone/{i:02d}.csv&quot;)</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11"></a><span class="c1">#     res.append(len(np.array(data)))</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12"></a><span class="c1">#</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13"></a><span class="c1"># print(res)</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14"></a>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15"></a><span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">332</span><span class="p">,</span> <span class="mi">332</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">318</span><span class="p">,</span> <span class="mi">318</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">167</span><span class="p">]</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16"></a>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17"></a><span class="nb">print</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">167</span><span class="p">,</span> <span class="n">res</span><span class="p">))))</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19"></a>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20"></a><span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21"></a>
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22"></a><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23"></a>    <span class="n">sublist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
</span><span id="__span-89-24"><a id="__codelineno-89-24" name="__codelineno-89-24"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>最后得到的方案是，只除去比分最少(134)的一场，其余的序列长度都保留至164(167-3，最后三分势头无法进行预测)，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test10.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-90-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-90-10">10</a></span>
<span class="normal"><a href="#__codelineno-90-11">11</a></span>
<span class="normal"><a href="#__codelineno-90-12">12</a></span>
<span class="normal"><a href="#__codelineno-90-13">13</a></span>
<span class="normal"><a href="#__codelineno-90-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8"></a><span class="n">all_datas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">):</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10"></a>    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;everyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12"></a>        <span class="n">all_datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">164</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13"></a><span class="c1"># data = pd.read_csv(&quot;CA(test)_2.csv&quot;)</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">all_datas</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>训练结果命名为 <code>Shi_everyone.xxx</code></p>
</blockquote>
<hr />
<p>第二种思路也有相似的处理步骤，</p>
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">my_test10_1.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-91-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-91-10">10</a></span>
<span class="normal"><a href="#__codelineno-91-11">11</a></span>
<span class="normal"><a href="#__codelineno-91-12">12</a></span>
<span class="normal"><a href="#__codelineno-91-13">13</a></span>
<span class="normal"><a href="#__codelineno-91-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8"></a><span class="n">all_datas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10"></a>    <span class="c1"># if i != 5 and i != 6:</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone/</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">01.csv&quot;</span><span class="p">)</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12"></a>    <span class="n">all_datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">159</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13"></a><span class="c1"># data = pd.read_csv(&quot;CA(test)_2.csv&quot;)</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">all_datas</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>5个序列长度分别是 <code>300, 225, 189, 159, 334</code></p>
</div>
<blockquote>
<p>训练结果命名为 <code>Shi_onlyone.xxx</code></p>
</blockquote>
<hr />
<p>然后用第一种思路训练出来的模型对冠军第3轮1501的比赛的数据进行了预测，结果如下图</p>
<p><a class="glightbox" href="../../../../images/mcm_predict_everyone_on_1501_p1.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_predict_everyone_on_1501_p1" loading="lazy" src="../../../../images/mcm_predict_everyone_on_1501_p1.svg" /></a></p>
<blockquote>
<p>数据保存为 <code>Shi_everyone.csv</code></p>
</blockquote>
<p>感觉很ok😊</p>
<hr />
<p>为了比较两种模型的预测效果，需要有一场在两边都没有使用过的比赛数据进行预测，于是又编写了 <code>my_test7_1_2.py</code> <code>my_test8_1_2.py</code> <code>my_test9_1_2.py</code> 来处理5场亚军的数据，</p>
<blockquote>
<p>保存在了 <code>onlyone2/</code> 下</p>
</blockquote>
<p>然后用亚军第4轮半决赛1502的比赛数据，一起输入两个模型进行预测，结果如下图</p>
<p><a class="glightbox" href="../../../../images/mcm_predict_everyone_onlyone_on_1602_p2.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_predict_everyone_onlyone_on_1602_p2" loading="lazy" src="../../../../images/mcm_predict_everyone_onlyone_on_1602_p2.svg" /></a></p>
<p>于是发现，居然 <strong><mark>拿冠军个人的数据训练出来的模型的预测效果要比拿32名选手的数据训练出来的模型要好</mark></strong> 😲，这是我没想到的情况，</p>
<p>于是鉴于这样的情况，我决定再用亚军的数据训练一个模型，再用三个模型一起预测同一场比赛。</p>
<blockquote>
<p>此时大约6号0点40分</p>
</blockquote>
<hr />
<p>改出 <code>my_test10_2.py</code> 来训练亚军的数据，</p>
<details class="note">
<summary><code>my_test10_2.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-92-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-92-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-92-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-92-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-92-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-92-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-92-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-92-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-92-10">10</a></span>
<span class="normal"><a href="#__codelineno-92-11">11</a></span>
<span class="normal"><a href="#__codelineno-92-12">12</a></span>
<span class="normal"><a href="#__codelineno-92-13">13</a></span>
<span class="normal"><a href="#__codelineno-92-14">14</a></span>
<span class="normal"><a href="#__codelineno-92-15">15</a></span>
<span class="normal"><a href="#__codelineno-92-16">16</a></span>
<span class="normal"><a href="#__codelineno-92-17">17</a></span>
<span class="normal"><a href="#__codelineno-92-18">18</a></span>
<span class="normal"><a href="#__codelineno-92-19">19</a></span>
<span class="normal"><a href="#__codelineno-92-20">20</a></span>
<span class="normal"><a href="#__codelineno-92-21">21</a></span>
<span class="normal"><a href="#__codelineno-92-22">22</a></span>
<span class="normal"><a href="#__codelineno-92-23">23</a></span>
<span class="normal"><a href="#__codelineno-92-24">24</a></span>
<span class="normal"><a href="#__codelineno-92-25">25</a></span>
<span class="normal"><a href="#__codelineno-92-26">26</a></span>
<span class="normal"><a href="#__codelineno-92-27">27</a></span>
<span class="normal"><a href="#__codelineno-92-28">28</a></span>
<span class="normal"><a href="#__codelineno-92-29">29</a></span>
<span class="normal"><a href="#__codelineno-92-30">30</a></span>
<span class="normal"><a href="#__codelineno-92-31">31</a></span>
<span class="normal"><a href="#__codelineno-92-32">32</a></span>
<span class="normal"><a href="#__codelineno-92-33">33</a></span>
<span class="normal"><a href="#__codelineno-92-34">34</a></span>
<span class="normal"><a href="#__codelineno-92-35">35</a></span>
<span class="normal"><a href="#__codelineno-92-36">36</a></span>
<span class="normal"><a href="#__codelineno-92-37">37</a></span>
<span class="normal"><a href="#__codelineno-92-38">38</a></span>
<span class="normal"><a href="#__codelineno-92-39">39</a></span>
<span class="normal"><a href="#__codelineno-92-40">40</a></span>
<span class="normal"><a href="#__codelineno-92-41">41</a></span>
<span class="normal"><a href="#__codelineno-92-42">42</a></span>
<span class="normal"><a href="#__codelineno-92-43">43</a></span>
<span class="normal"><a href="#__codelineno-92-44">44</a></span>
<span class="normal"><a href="#__codelineno-92-45">45</a></span>
<span class="normal"><a href="#__codelineno-92-46">46</a></span>
<span class="normal"><a href="#__codelineno-92-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3"></a>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7"></a>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8"></a><span class="n">all_datas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1316&quot;</span><span class="p">,</span> <span class="s2">&quot;1408&quot;</span><span class="p">,</span> <span class="s2">&quot;1504&quot;</span><span class="p">,</span> <span class="s2">&quot;1602&quot;</span><span class="p">,</span> <span class="s2">&quot;1701&quot;</span><span class="p">):</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10"></a>    <span class="c1"># if i != 5 and i != 6:</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;onlyone_2/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12"></a>    <span class="n">all_datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">167</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13"></a><span class="c1"># data = pd.read_csv(&quot;CA(test)_2.csv&quot;)</span>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">all_datas</span><span class="p">))</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16"></a>
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17"></a><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># delete name</span>
</span><span id="__span-92-18"><a id="__codelineno-92-18" name="__codelineno-92-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-92-19"><a id="__codelineno-92-19" name="__codelineno-92-19"></a>
</span><span id="__span-92-20"><a id="__codelineno-92-20" name="__codelineno-92-20"></a><span class="c1"># input()</span>
</span><span id="__span-92-21"><a id="__codelineno-92-21" name="__codelineno-92-21"></a>
</span><span id="__span-92-22"><a id="__codelineno-92-22" name="__codelineno-92-22"></a><span class="n">nums</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-92-23"><a id="__codelineno-92-23" name="__codelineno-92-23"></a><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="n">nums</span><span class="o">//</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-92-24"><a id="__codelineno-92-24" name="__codelineno-92-24"></a><span class="c1"># Shi, val = val[:, :, :1], val[:, :, 1:]</span>
</span><span id="__span-92-25"><a id="__codelineno-92-25" name="__codelineno-92-25"></a><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-92-26"><a id="__codelineno-92-26" name="__codelineno-92-26"></a><span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="__span-92-27"><a id="__codelineno-92-27" name="__codelineno-92-27"></a>
</span><span id="__span-92-28"><a id="__codelineno-92-28" name="__codelineno-92-28"></a><span class="c1"># input()</span>
</span><span id="__span-92-29"><a id="__codelineno-92-29" name="__codelineno-92-29"></a>
</span><span id="__span-92-30"><a id="__codelineno-92-30" name="__codelineno-92-30"></a><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
</span><span id="__span-92-31"><a id="__codelineno-92-31" name="__codelineno-92-31"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span><span id="__span-92-32"><a id="__codelineno-92-32" name="__codelineno-92-32"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># 使用50个GRU单元</span>
</span><span id="__span-92-33"><a id="__codelineno-92-33" name="__codelineno-92-33"></a>    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 输出层，用于回归问题</span>
</span><span id="__span-92-34"><a id="__codelineno-92-34" name="__codelineno-92-34"></a>
</span><span id="__span-92-35"><a id="__codelineno-92-35" name="__codelineno-92-35"></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-92-36"><a id="__codelineno-92-36" name="__codelineno-92-36"></a>
</span><span id="__span-92-37"><a id="__codelineno-92-37" name="__codelineno-92-37"></a><span class="c1"># 编译模型</span>
</span><span id="__span-92-38"><a id="__codelineno-92-38" name="__codelineno-92-38"></a><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
</span><span id="__span-92-39"><a id="__codelineno-92-39" name="__codelineno-92-39"></a><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">)</span>
</span><span id="__span-92-40"><a id="__codelineno-92-40" name="__codelineno-92-40"></a>
</span><span id="__span-92-41"><a id="__codelineno-92-41" name="__codelineno-92-41"></a><span class="c1"># 训练模型</span>
</span><span id="__span-92-42"><a id="__codelineno-92-42" name="__codelineno-92-42"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-92-43"><a id="__codelineno-92-43" name="__codelineno-92-43"></a>
</span><span id="__span-92-44"><a id="__codelineno-92-44" name="__codelineno-92-44"></a><span class="c1"># 保存权重文件</span>
</span><span id="__span-92-45"><a id="__codelineno-92-45" name="__codelineno-92-45"></a><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Shi_onlyone_2&quot;</span>
</span><span id="__span-92-46"><a id="__codelineno-92-46" name="__codelineno-92-46"></a><span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span><span class="p">)</span>
</span><span id="__span-92-47"><a id="__codelineno-92-47" name="__codelineno-92-47"></a><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.keras&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</details>
<blockquote>
<p>训练结果命名为 <code>Shi_onlyone_2.xxx</code></p>
</blockquote>
<p>然后处理出 <strong>输给亚军的四强</strong> 的4场比赛数据( <code>my_test7_1_3.py</code> <code>my_test8_1_3.py</code> <code>my_test9_1_3.py</code> )，然后用三个不同的模型对<strong>他</strong>第3轮1503的比赛数据进行预测(<mark>用这一场因为三个模型都与这一场比赛无关</mark>)，结果如下图</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">3个模型一起预测</label><label for="__tabbed_8_2">大众模型和亚军模型</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../../../../images/mcm_predict_three_models_on_1503_p1.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_predict_three_models_on_1503_p1" loading="lazy" src="../../../../images/mcm_predict_three_models_on_1503_p1.svg" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../../../../images/mcm_predict_everyone_onlyone_2_on_1503_p1.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="mcm_predict_everyone_onlyone_2_on_1503_p1" loading="lazy" src="../../../../images/mcm_predict_everyone_onlyone_2_on_1503_p1.svg" /></a></p>
</div>
</div>
</div>
<p>看起来似乎确实用单人数据训练出来的模型要比大众训练出来的模型预测效果要好🤔，或许可能是因为同一个选手的比赛数据相关性更高，所以训练出的模型效果更好。</p>
<blockquote>
<p>此时大约凌晨1点半</p>
</blockquote>
<hr />
<p>由于已经比较晚，所以也不知道还能怎样取数据进行预测和训练，就没有再去处理新的数据了。</p>
<h3 id="6">分析预测准确的数据 (6号凌晨)<a class="headerlink" href="#6" title="Permanent link">&para;</a></h3>
<p>(由于已经没什么事了，于是)我在pycharm的copilot上询问它训练出来模型后，如何提取输入的特征</p>
<blockquote>
<p>第二个问题是copilot提示/猜测我要询问它的问题，我觉得是个好问题于是继续按照它的提示询问它</p>
</blockquote>
<details class="example" open="open">
<summary>chatlog</summary>
<p><strong>RonaldLN</strong>:</p>
<p>I have learned some data through TensorFlow's GRU to obtain a model that can predict given inputs. I would like to know how to extract the characteristics of the input when the predicted value matches the true value?</p>
<p>&nbsp;</p>
<p><strong>Github Copilot</strong>:</p>
<p>You can extract the characteristics of the input when the predicted value matches the true value by comparing the predicted outputs with the true outputs. If they match within a certain tolerance, you can store the corresponding input. Here's how you can do it:</p>
<ol>
<li>Load your model.</li>
<li>Use the model to predict outputs based on your inputs.</li>
<li>Initialize an empty list to store inputs where predicted output matches true output.</li>
<li>Iterate over each predicted output:<ul>
<li>If the predicted output matches the true output within a certain tolerance, append the corresponding input to your list.</li>
</ul>
</li>
</ol>
<p>Here's the Python code that implements this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="c1"># Assuming you have your inputs and true outputs in variables `inputs` and `true_outputs`</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="c1"># And your model in variable `model`</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="n">predicted_outputs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="c1"># Initialize an empty list to store inputs where predicted output matches true output</span>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">)):</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>    <span class="c1"># If the predicted output matches the true output</span>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">true_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a>        <span class="c1"># Store the corresponding input</span>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a>        <span class="n">matching_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="c1"># Now, `matching_inputs` contains the inputs where the predicted output matches the true output</span>
</span></code></pre></div>
<p>In this code, <code>np.allclose</code> is used to check if the predicted output matches the true output within a tolerance of 0.1. You can adjust this tolerance as needed. The <code>matching_inputs</code> list will contain the inputs for which the predicted and true outputs match.</p>
<details class="quote">
<summary>Using 3 Reference</summary>
<ul>
<li>my_test10_predict.py</li>
<li>my_test10_2.py</li>
<li>my_test3.py</li>
</ul>
</details>
<p>&nbsp;</p>
<p><strong>RonaldLN</strong>:</p>
<p>How can I visualize the characteristics of the input data that matches the true value?</p>
<p>&nbsp;</p>
<p><strong>Github Copilot</strong>:</p>
<p>You can visualize the characteristics of the input data that matches the true value by plotting histograms for each dimension of the input data. Here's how you can do it:</p>
<ol>
<li>Convert your list of matching inputs to a numpy array for easier manipulation.</li>
<li>For each dimension in the input data, create a new figure and plot a histogram of the data in the current dimension.</li>
<li>Set the title of the plot to the current dimension and show the plot.</li>
</ol>
<p>Here's the Python code that implements this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="c1"># Convert matching_inputs to a numpy array for easier manipulation</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="n">matching_inputs_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matching_inputs</span><span class="p">)</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="c1"># For each dimension in the input data</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matching_inputs_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>    <span class="c1"># Create a new figure</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>    <span class="c1"># Plot a histogram of the data in the current dimension</span>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">matching_inputs_np</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>    <span class="c1"># Set the title of the plot</span>
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input Dimension </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a>
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>    <span class="c1"># Show the plot</span>
</span><span id="__span-94-18"><a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p>In this code, <code>plt.hist</code> is used to plot a histogram of the data in the current dimension. The <code>bins</code> parameter is set to 20, but you can adjust this as needed. The title of the plot is set to the current dimension using <code>plt.title</code>. Finally, the plot is displayed using <code>plt.show</code>.</p>
<details class="quote">
<summary>Using 3 Reference</summary>
<ul>
<li>my_test10_predict.py</li>
<li>my_test10_2.py</li>
<li>my_test3.py</li>
</ul>
</details>
<hr />
<details class="quote">
<summary>ChatGPT翻译</summary>
<p><strong>RonaldLN</strong>：</p>
<p>我通过TensorFlow的GRU学到了一些数据，得到了一个能够根据给定输入进行预测的模型。我想知道在预测值与真实值匹配时如何提取输入的特征？</p>
<p>&nbsp;</p>
<p><strong>Github Copilot</strong>：</p>
<p>当预测值与真实值匹配时，你可以通过比较预测输出和真实输出来提取输入的特征。如果它们在某个容差范围内匹配，你可以存储相应的输入。以下是具体步骤：</p>
<ol>
<li>加载你的模型。</li>
<li>使用模型根据输入预测输出。</li>
<li>初始化一个空列表，用于存储预测输出与真实输出匹配的输入。</li>
<li>遍历每个预测输出：<ul>
<li>如果预测输出在某个容差范围内与真实输出匹配，则将相应的输入添加到列表中。</li>
</ul>
</li>
</ol>
<p>以下是实现这一过程的Python代码：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="c1"># 假设你的输入和真实输出分别存储在变量`inputs`和`true_outputs`中</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="c1"># 你的模型存储在变量`model`中</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="n">predicted_outputs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="c1"># 初始化一个空列表，用于存储预测输出与真实输出匹配的输入</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">)):</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a>    <span class="c1"># 如果预测输出与真实输出匹配</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">true_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a>        <span class="c1"># 存储相应的输入</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a>        <span class="n">matching_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a>
</span><span id="__span-95-17"><a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a><span class="c1"># 现在，`matching_inputs`包含预测输出与真实输出匹配的输入</span>
</span></code></pre></div>
<p>在这段代码中，<code>np.allclose</code>用于检查预测输出是否在容差为0.1的范围内与真实输出匹配。你可以根据需要调整这个容差。<code>matching_inputs</code>列表将包含预测和真实输出匹配的输入。</p>
<p>&nbsp;</p>
<p><strong>RonaldLN</strong>：</p>
<p>我如何可视化与真实值匹配的输入数据的特征？</p>
<p>&nbsp;</p>
<p><strong>Github Copilot</strong>：</p>
<p>你可以通过绘制每个输入数据维度的直方图来可视化与真实值匹配的输入数据的特征。以下是具体步骤：</p>
<ol>
<li>将匹配输入的列表转换为numpy数组，以便更容易处理。</li>
<li>对于输入数据的每个维度，创建一个新的图形，并绘制当前维度数据的直方图。</li>
<li>将图形的标题设置为当前维度，并显示图形。</li>
</ol>
<p>以下是实现这一过程的Python代码：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="c1"># 将匹配输入转换为numpy数组，以便更容易处理</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="n">matching_inputs_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matching_inputs</span><span class="p">)</span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="c1"># 对于输入数据的每个维度</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matching_inputs_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a>    <span class="c1"># 创建一个新的图形</span>
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a>
</span><span id="__span-96-11"><a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a>    <span class="c1"># 绘制当前维度数据的直方图</span>
</span><span id="__span-96-12"><a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">matching_inputs_np</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-96-13"><a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a>
</span><span id="__span-96-14"><a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a>    <span class="c1"># 设置图形的标题</span>
</span><span id="__span-96-15"><a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;输入维度 </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-96-16"><a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a>
</span><span id="__span-96-17"><a id="__codelineno-96-17" name="__codelineno-96-17" href="#__codelineno-96-17"></a>    <span class="c1"># 显示图形</span>
</span><span id="__span-96-18"><a id="__codelineno-96-18" name="__codelineno-96-18" href="#__codelineno-96-18"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p>在这段代码中，<code>plt.hist</code>用于绘制当前维度数据的直方图。<code>bins</code>参数设置为20，但你可以根据需要调整。使用<code>plt.title</code>设置图形的标题为当前维度。最后，使用<code>plt.show</code>显示图形。</p>
</details>
</details>
<p>于是我按照copilot提供的代码，编写了 <code>my_test12.py</code> (为了适配我的输出的数据做了部分修改)，使用冠军模型来预测决赛亚军的数据，并对预测结果进行分析，</p>
<details class="note">
<summary><code>my_test12.py</code></summary>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-97-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-97-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-97-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-97-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-97-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-97-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-97-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-97-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-97-10">10</a></span>
<span class="normal"><a href="#__codelineno-97-11">11</a></span>
<span class="normal"><a href="#__codelineno-97-12">12</a></span>
<span class="normal"><a href="#__codelineno-97-13">13</a></span>
<span class="normal"><a href="#__codelineno-97-14">14</a></span>
<span class="normal"><a href="#__codelineno-97-15">15</a></span>
<span class="normal"><a href="#__codelineno-97-16">16</a></span>
<span class="normal"><a href="#__codelineno-97-17">17</a></span>
<span class="normal"><a href="#__codelineno-97-18">18</a></span>
<span class="normal"><a href="#__codelineno-97-19">19</a></span>
<span class="normal"><a href="#__codelineno-97-20">20</a></span>
<span class="normal"><a href="#__codelineno-97-21">21</a></span>
<span class="normal"><a href="#__codelineno-97-22">22</a></span>
<span class="normal"><a href="#__codelineno-97-23">23</a></span>
<span class="normal"><a href="#__codelineno-97-24">24</a></span>
<span class="normal"><a href="#__codelineno-97-25">25</a></span>
<span class="normal"><a href="#__codelineno-97-26">26</a></span>
<span class="normal"><a href="#__codelineno-97-27">27</a></span>
<span class="normal"><a href="#__codelineno-97-28">28</a></span>
<span class="normal"><a href="#__codelineno-97-29">29</a></span>
<span class="normal"><a href="#__codelineno-97-30">30</a></span>
<span class="normal"><a href="#__codelineno-97-31">31</a></span>
<span class="normal"><a href="#__codelineno-97-32">32</a></span>
<span class="normal"><a href="#__codelineno-97-33">33</a></span>
<span class="normal"><a href="#__codelineno-97-34">34</a></span>
<span class="normal"><a href="#__codelineno-97-35">35</a></span>
<span class="normal"><a href="#__codelineno-97-36">36</a></span>
<span class="normal"><a href="#__codelineno-97-37">37</a></span>
<span class="normal"><a href="#__codelineno-97-38">38</a></span>
<span class="normal"><a href="#__codelineno-97-39">39</a></span>
<span class="normal"><a href="#__codelineno-97-40">40</a></span>
<span class="normal"><a href="#__codelineno-97-41">41</a></span>
<span class="normal"><a href="#__codelineno-97-42">42</a></span>
<span class="normal"><a href="#__codelineno-97-43">43</a></span>
<span class="normal"><a href="#__codelineno-97-44">44</a></span>
<span class="normal"><a href="#__codelineno-97-45">45</a></span>
<span class="normal"><a href="#__codelineno-97-46">46</a></span>
<span class="normal"><a href="#__codelineno-97-47">47</a></span>
<span class="normal"><a href="#__codelineno-97-48">48</a></span>
<span class="normal"><a href="#__codelineno-97-49">49</a></span>
<span class="normal"><a href="#__codelineno-97-50">50</a></span>
<span class="normal"><a href="#__codelineno-97-51">51</a></span>
<span class="normal"><a href="#__codelineno-97-52">52</a></span>
<span class="normal"><a href="#__codelineno-97-53">53</a></span>
<span class="normal"><a href="#__codelineno-97-54">54</a></span>
<span class="normal"><a href="#__codelineno-97-55">55</a></span>
<span class="normal"><a href="#__codelineno-97-56">56</a></span>
<span class="normal"><a href="#__codelineno-97-57">57</a></span>
<span class="normal"><a href="#__codelineno-97-58">58</a></span>
<span class="normal"><a href="#__codelineno-97-59">59</a></span>
<span class="normal"><a href="#__codelineno-97-60">60</a></span>
<span class="normal"><a href="#__codelineno-97-61">61</a></span>
<span class="normal"><a href="#__codelineno-97-62">62</a></span>
<span class="normal"><a href="#__codelineno-97-63">63</a></span>
<span class="normal"><a href="#__codelineno-97-64">64</a></span>
<span class="normal"><a href="#__codelineno-97-65">65</a></span>
<span class="normal"><a href="#__codelineno-97-66">66</a></span>
<span class="normal"><a href="#__codelineno-97-67">67</a></span>
<span class="normal"><a href="#__codelineno-97-68">68</a></span>
<span class="normal"><a href="#__codelineno-97-69">69</a></span>
<span class="normal"><a href="#__codelineno-97-70">70</a></span>
<span class="normal"><a href="#__codelineno-97-71">71</a></span>
<span class="normal"><a href="#__codelineno-97-72">72</a></span>
<span class="normal"><a href="#__codelineno-97-73">73</a></span>
<span class="normal"><a href="#__codelineno-97-74">74</a></span>
<span class="normal"><a href="#__codelineno-97-75">75</a></span>
<span class="normal"><a href="#__codelineno-97-76">76</a></span>
<span class="normal"><a href="#__codelineno-97-77">77</a></span>
<span class="normal"><a href="#__codelineno-97-78">78</a></span>
<span class="normal"><a href="#__codelineno-97-79">79</a></span>
<span class="normal"><a href="#__codelineno-97-80">80</a></span>
<span class="normal"><a href="#__codelineno-97-81">81</a></span>
<span class="normal"><a href="#__codelineno-97-82">82</a></span>
<span class="normal"><a href="#__codelineno-97-83">83</a></span>
<span class="normal"><a href="#__codelineno-97-84">84</a></span>
<span class="normal"><a href="#__codelineno-97-85">85</a></span>
<span class="normal"><a href="#__codelineno-97-86">86</a></span>
<span class="normal"><a href="#__codelineno-97-87">87</a></span>
<span class="normal"><a href="#__codelineno-97-88">88</a></span>
<span class="normal"><a href="#__codelineno-97-89">89</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4"></a>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5"></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6"></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GRU</span><span class="p">,</span> <span class="n">Dense</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8"></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">load_model</span><span class="p">,</span> <span class="n">Model</span>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9"></a>
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;onlyone_2/1602.csv&quot;</span><span class="p">)</span>
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
</span><span id="__span-97-12"><a id="__codelineno-97-12" name="__codelineno-97-12"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-97-13"><a id="__codelineno-97-13" name="__codelineno-97-13"></a><span class="n">true_outputs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-97-14"><a id="__codelineno-97-14" name="__codelineno-97-14"></a>
</span><span id="__span-97-15"><a id="__codelineno-97-15" name="__codelineno-97-15"></a><span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;Shi_onlyone.keras&quot;</span><span class="p">)</span>
</span><span id="__span-97-16"><a id="__codelineno-97-16" name="__codelineno-97-16"></a>
</span><span id="__span-97-17"><a id="__codelineno-97-17" name="__codelineno-97-17"></a><span class="c1"># Assuming you have your inputs and true outputs in variables `inputs` and `true_outputs`</span>
</span><span id="__span-97-18"><a id="__codelineno-97-18" name="__codelineno-97-18"></a><span class="c1"># And your model in variable `model`</span>
</span><span id="__span-97-19"><a id="__codelineno-97-19" name="__codelineno-97-19"></a>
</span><span id="__span-97-20"><a id="__codelineno-97-20" name="__codelineno-97-20"></a><span class="n">predicted_outputs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="__span-97-21"><a id="__codelineno-97-21" name="__codelineno-97-21"></a>
</span><span id="__span-97-22"><a id="__codelineno-97-22" name="__codelineno-97-22"></a><span class="nb">print</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">)</span>
</span><span id="__span-97-23"><a id="__codelineno-97-23" name="__codelineno-97-23"></a>
</span><span id="__span-97-24"><a id="__codelineno-97-24" name="__codelineno-97-24"></a><span class="c1"># Initialize an empty list to store inputs where predicted output matches true output</span>
</span><span id="__span-97-25"><a id="__codelineno-97-25" name="__codelineno-97-25"></a><span class="n">matching_inputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-97-26"><a id="__codelineno-97-26" name="__codelineno-97-26"></a>
</span><span id="__span-97-27"><a id="__codelineno-97-27" name="__codelineno-97-27"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
</span><span id="__span-97-28"><a id="__codelineno-97-28" name="__codelineno-97-28"></a>    <span class="c1"># If the predicted output matches the true output</span>
</span><span id="__span-97-29"><a id="__codelineno-97-29" name="__codelineno-97-29"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">true_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="__span-97-30"><a id="__codelineno-97-30" name="__codelineno-97-30"></a>        <span class="c1"># Store the corresponding input</span>
</span><span id="__span-97-31"><a id="__codelineno-97-31" name="__codelineno-97-31"></a>        <span class="n">matching_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-97-32"><a id="__codelineno-97-32" name="__codelineno-97-32"></a>
</span><span id="__span-97-33"><a id="__codelineno-97-33" name="__codelineno-97-33"></a><span class="c1"># Now, `matching_inputs` contains the inputs where the predicted output matches the true output</span>
</span><span id="__span-97-34"><a id="__codelineno-97-34" name="__codelineno-97-34"></a><span class="nb">print</span><span class="p">(</span><span class="n">matching_inputs</span><span class="p">)</span>
</span><span id="__span-97-35"><a id="__codelineno-97-35" name="__codelineno-97-35"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">matching_inputs</span><span class="p">))</span>
</span><span id="__span-97-36"><a id="__codelineno-97-36" name="__codelineno-97-36"></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-97-37"><a id="__codelineno-97-37" name="__codelineno-97-37"></a>
</span><span id="__span-97-38"><a id="__codelineno-97-38" name="__codelineno-97-38"></a><span class="c1"># Convert matching_inputs to a numpy array for easier manipulation</span>
</span><span id="__span-97-39"><a id="__codelineno-97-39" name="__codelineno-97-39"></a><span class="n">matching_inputs_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matching_inputs</span><span class="p">)</span>
</span><span id="__span-97-40"><a id="__codelineno-97-40" name="__codelineno-97-40"></a>
</span><span id="__span-97-41"><a id="__codelineno-97-41" name="__codelineno-97-41"></a><span class="c1"># For each dimension in the input data</span>
</span><span id="__span-97-42"><a id="__codelineno-97-42" name="__codelineno-97-42"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matching_inputs_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-97-43"><a id="__codelineno-97-43" name="__codelineno-97-43"></a>    <span class="c1"># Create a new figure</span>
</span><span id="__span-97-44"><a id="__codelineno-97-44" name="__codelineno-97-44"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-97-45"><a id="__codelineno-97-45" name="__codelineno-97-45"></a>
</span><span id="__span-97-46"><a id="__codelineno-97-46" name="__codelineno-97-46"></a>    <span class="c1"># Plot a histogram of the data in the current dimension</span>
</span><span id="__span-97-47"><a id="__codelineno-97-47" name="__codelineno-97-47"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">matching_inputs_np</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-97-48"><a id="__codelineno-97-48" name="__codelineno-97-48"></a>
</span><span id="__span-97-49"><a id="__codelineno-97-49" name="__codelineno-97-49"></a>    <span class="c1"># Set the title of the plot</span>
</span><span id="__span-97-50"><a id="__codelineno-97-50" name="__codelineno-97-50"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input Dimension </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-97-51"><a id="__codelineno-97-51" name="__codelineno-97-51"></a>
</span><span id="__span-97-52"><a id="__codelineno-97-52" name="__codelineno-97-52"></a>    <span class="c1"># Show the plot</span>
</span><span id="__span-97-53"><a id="__codelineno-97-53" name="__codelineno-97-53"></a>    <span class="c1"># plt.show()</span>
</span><span id="__span-97-54"><a id="__codelineno-97-54" name="__codelineno-97-54"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pic/matching Input Dimension </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
</span><span id="__span-97-55"><a id="__codelineno-97-55" name="__codelineno-97-55"></a>
</span><span id="__span-97-56"><a id="__codelineno-97-56" name="__codelineno-97-56"></a>    <span class="c1"># close the plot</span>
</span><span id="__span-97-57"><a id="__codelineno-97-57" name="__codelineno-97-57"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-97-58"><a id="__codelineno-97-58" name="__codelineno-97-58"></a>
</span><span id="__span-97-59"><a id="__codelineno-97-59" name="__codelineno-97-59"></a><span class="c1"># Initialize an empty list to store inputs where predicted output does not match true output</span>
</span><span id="__span-97-60"><a id="__codelineno-97-60" name="__codelineno-97-60"></a><span class="n">non_matching_inputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-97-61"><a id="__codelineno-97-61" name="__codelineno-97-61"></a>
</span><span id="__span-97-62"><a id="__codelineno-97-62" name="__codelineno-97-62"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
</span><span id="__span-97-63"><a id="__codelineno-97-63" name="__codelineno-97-63"></a>    <span class="c1"># If the predicted output does not match the true output</span>
</span><span id="__span-97-64"><a id="__codelineno-97-64" name="__codelineno-97-64"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">predicted_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">true_outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="__span-97-65"><a id="__codelineno-97-65" name="__codelineno-97-65"></a>        <span class="c1"># Store the corresponding input</span>
</span><span id="__span-97-66"><a id="__codelineno-97-66" name="__codelineno-97-66"></a>        <span class="n">non_matching_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-97-67"><a id="__codelineno-97-67" name="__codelineno-97-67"></a>
</span><span id="__span-97-68"><a id="__codelineno-97-68" name="__codelineno-97-68"></a><span class="c1"># Now, `non_matching_inputs` contains the inputs where the predicted output does not match the true output</span>
</span><span id="__span-97-69"><a id="__codelineno-97-69" name="__codelineno-97-69"></a>
</span><span id="__span-97-70"><a id="__codelineno-97-70" name="__codelineno-97-70"></a><span class="c1"># Convert non_matching_inputs to a numpy array for easier manipulation</span>
</span><span id="__span-97-71"><a id="__codelineno-97-71" name="__codelineno-97-71"></a><span class="n">non_matching_inputs_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">non_matching_inputs</span><span class="p">)</span>
</span><span id="__span-97-72"><a id="__codelineno-97-72" name="__codelineno-97-72"></a>
</span><span id="__span-97-73"><a id="__codelineno-97-73" name="__codelineno-97-73"></a><span class="c1"># For each dimension in the input data</span>
</span><span id="__span-97-74"><a id="__codelineno-97-74" name="__codelineno-97-74"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">non_matching_inputs_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-97-75"><a id="__codelineno-97-75" name="__codelineno-97-75"></a>    <span class="c1"># Create a new figure</span>
</span><span id="__span-97-76"><a id="__codelineno-97-76" name="__codelineno-97-76"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-97-77"><a id="__codelineno-97-77" name="__codelineno-97-77"></a>
</span><span id="__span-97-78"><a id="__codelineno-97-78" name="__codelineno-97-78"></a>    <span class="c1"># Plot a histogram of the data in the current dimension</span>
</span><span id="__span-97-79"><a id="__codelineno-97-79" name="__codelineno-97-79"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">non_matching_inputs_np</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-97-80"><a id="__codelineno-97-80" name="__codelineno-97-80"></a>
</span><span id="__span-97-81"><a id="__codelineno-97-81" name="__codelineno-97-81"></a>    <span class="c1"># Set the title of the plot</span>
</span><span id="__span-97-82"><a id="__codelineno-97-82" name="__codelineno-97-82"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input Dimension </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-97-83"><a id="__codelineno-97-83" name="__codelineno-97-83"></a>
</span><span id="__span-97-84"><a id="__codelineno-97-84" name="__codelineno-97-84"></a>    <span class="c1"># Show the plot</span>
</span><span id="__span-97-85"><a id="__codelineno-97-85" name="__codelineno-97-85"></a>    <span class="c1"># plt.show()</span>
</span><span id="__span-97-86"><a id="__codelineno-97-86" name="__codelineno-97-86"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pic/non_matching Input Dimension </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
</span><span id="__span-97-87"><a id="__codelineno-97-87" name="__codelineno-97-87"></a>
</span><span id="__span-97-88"><a id="__codelineno-97-88" name="__codelineno-97-88"></a>    <span class="c1"># close the plot</span>
</span><span id="__span-97-89"><a id="__codelineno-97-89" name="__codelineno-97-89"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p><strong>需要注意的是</strong>，在使用 <code>np.allclose</code> 函数时，除了传入预测值和真实值，还<strong>设置 <code>rtol</code> 和 <code>atol</code> 参数</strong>，大概是允许误差的范围/误差容忍( <code>tol</code> 对应 tolerance)，</p>
<p>一开始我没有设置(就采用的是它默认的值，默认的值很小)，所以运行出来显示预测结果中没有与真实数据相近的😅。</p>
<p><code>np.allclose</code> 的函数说明如下</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="nd">@array_function_dispatch</span><span class="p">(</span><span class="n">_allclose_dispatcher</span><span class="p">)</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="k">def</span> <span class="nf">allclose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.e-8</span><span class="p">,</span> <span class="n">equal_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="sd">    Returns True if two arrays are element-wise equal within a tolerance.</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="sd">    The tolerance values are positive, typically very small numbers.  The</span>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="sd">    relative difference (`rtol` * abs(`b`)) and the absolute difference</span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="sd">    `atol` are added together to compare against the absolute difference</span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="sd">    between `a` and `b`.</span>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="sd">    ...</span>
</span><span id="__span-98-12"><a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a>
</span><span id="__span-98-13"><a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="sd">    Parameters</span>
</span><span id="__span-98-14"><a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a><span class="sd">    ----------</span>
</span><span id="__span-98-15"><a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a><span class="sd">    a, b : array_like</span>
</span><span id="__span-98-16"><a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a><span class="sd">        Input arrays to compare.</span>
</span><span id="__span-98-17"><a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a><span class="sd">    rtol : float</span>
</span><span id="__span-98-18"><a id="__codelineno-98-18" name="__codelineno-98-18" href="#__codelineno-98-18"></a><span class="sd">        The relative tolerance parameter (see Notes).</span>
</span><span id="__span-98-19"><a id="__codelineno-98-19" name="__codelineno-98-19" href="#__codelineno-98-19"></a><span class="sd">    atol : float</span>
</span><span id="__span-98-20"><a id="__codelineno-98-20" name="__codelineno-98-20" href="#__codelineno-98-20"></a><span class="sd">        The absolute tolerance parameter (see Notes).</span>
</span><span id="__span-98-21"><a id="__codelineno-98-21" name="__codelineno-98-21" href="#__codelineno-98-21"></a><span class="sd">    ...</span>
</span><span id="__span-98-22"><a id="__codelineno-98-22" name="__codelineno-98-22" href="#__codelineno-98-22"></a>
</span><span id="__span-98-23"><a id="__codelineno-98-23" name="__codelineno-98-23" href="#__codelineno-98-23"></a><span class="sd">    Notes</span>
</span><span id="__span-98-24"><a id="__codelineno-98-24" name="__codelineno-98-24" href="#__codelineno-98-24"></a><span class="sd">    -----</span>
</span><span id="__span-98-25"><a id="__codelineno-98-25" name="__codelineno-98-25" href="#__codelineno-98-25"></a><span class="sd">    If the following equation is element-wise True, then allclose returns</span>
</span><span id="__span-98-26"><a id="__codelineno-98-26" name="__codelineno-98-26" href="#__codelineno-98-26"></a><span class="sd">    True.</span>
</span><span id="__span-98-27"><a id="__codelineno-98-27" name="__codelineno-98-27" href="#__codelineno-98-27"></a>
</span><span id="__span-98-28"><a id="__codelineno-98-28" name="__codelineno-98-28" href="#__codelineno-98-28"></a><span class="sd">     absolute(`a` - `b`) &lt;= (`atol` + `rtol` * absolute(`b`))</span>
</span><span id="__span-98-29"><a id="__codelineno-98-29" name="__codelineno-98-29" href="#__codelineno-98-29"></a>
</span><span id="__span-98-30"><a id="__codelineno-98-30" name="__codelineno-98-30" href="#__codelineno-98-30"></a><span class="sd">    The above equation is not symmetric in `a` and `b`, so that</span>
</span><span id="__span-98-31"><a id="__codelineno-98-31" name="__codelineno-98-31" href="#__codelineno-98-31"></a><span class="sd">    ``allclose(a, b)`` might be different from ``allclose(b, a)`` in</span>
</span><span id="__span-98-32"><a id="__codelineno-98-32" name="__codelineno-98-32" href="#__codelineno-98-32"></a><span class="sd">    some rare cases.</span>
</span><span id="__span-98-33"><a id="__codelineno-98-33" name="__codelineno-98-33" href="#__codelineno-98-33"></a>
</span><span id="__span-98-34"><a id="__codelineno-98-34" name="__codelineno-98-34" href="#__codelineno-98-34"></a><span class="sd">    ...</span>
</span><span id="__span-98-35"><a id="__codelineno-98-35" name="__codelineno-98-35" href="#__codelineno-98-35"></a><span class="sd">    &quot;&quot;&quot;</span>
</span></code></pre></div>
<p>然后又问了一下chatgpt</p>
<details class="example" open="open">
<summary>chatlog</summary>
<p><strong>User</strong>:</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>    Notes
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>    -----
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a>    If the following equation is element-wise True, then allclose returns
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>    True.
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>     absolute(`a` - <span class="sb">`b`</span>) &lt;= (<span class="sb">`atol`</span> + <span class="sb">`rtol`</span> * absolute(`b`))
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>
</span><span id="__span-99-8"><a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a>    The above equation is not symmetric in <span class="sb">`a`</span> and <span class="sb">`b`</span>, so that
</span><span id="__span-99-9"><a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a>    ``allclose(a, b)`` might be different from ``allclose(b, a)`` in
</span><span id="__span-99-10"><a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a>    some rare cases.
</span></code></pre></div>
<p>translate to chinese</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>    注释
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>    -----
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>    如果以下方程在元素级别上为True，则allclose返回True。
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>     绝对值（`a` - <span class="sb">`b`</span>）&lt;=（`atol` + <span class="sb">`rtol`</span> * 绝对值（`b`））
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a>    上述方程在`a`和`b`中不对称，因此在一些罕见情况下，``allclose(a, b)``可能与``allclose(b, a)``不同。
</span></code></pre></div>
<p>&nbsp;</p>
<p><strong>User</strong>:</p>
<p><code>atol</code> 和 <code>rtol</code> 分别是什么？</p>
<p>&nbsp;</p>
<p><strong>ChatGPT</strong>:</p>
<p>在上述文档中，<code>atol</code> 和 <code>rtol</code> 是用于控制<code>allclose</code>函数的两个参数。</p>
<ul>
<li><code>atol</code> 是"absolute tolerance"（绝对容差）的缩写。它是一个绝对值，表示两个数值在进行比较时的绝对容忍度。如果两个数值之间的差异小于或等于<code>atol</code>，则被认为是相等的。在上述的等式中，<code>atol</code> 控制了两个数值之间的差异是否被认为足够小，以使它们被视为相等。</li>
<li><code>rtol</code> 是"relative tolerance"（相对容差）的缩写。它是一个比例值，表示两个数值在进行比较时的相对容忍度。具体来说，如果两个数值之间的相对差异小于或等于 <code>rtol</code> 乘以第二个数值的绝对值，那么它们被认为是相等的。在上述的等式中，<code>rtol</code> 控制了相对容忍度的程度。</li>
</ul>
<p>这两个参数一起确定了在使用<code>allclose</code>函数进行数值比较时的容忍度范围。</p>
</details>
<p>于是弄明白参数 <code>rtol</code> 和 <code>atol</code> 的含义之后，我打算只设置 <code>atol</code> 的值就行了。</p>
<p>经过几次尝试，最后我将 <code>atol</code> 设置成了 <code>0.1</code> ，因为此时被认为是预测准确的数据有34个，比例差不多占15%这样。</p>
<hr />
<p>最后将预测较准确的数据和不准确数据的个数分别绘制成柱形图，部分结果如下</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:8"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><input id="__tabbed_9_3" name="__tabbed_9" type="radio" /><input id="__tabbed_9_4" name="__tabbed_9" type="radio" /><input id="__tabbed_9_5" name="__tabbed_9" type="radio" /><input id="__tabbed_9_6" name="__tabbed_9" type="radio" /><input id="__tabbed_9_7" name="__tabbed_9" type="radio" /><input id="__tabbed_9_8" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">维度2: 当前盘所赢局数</label><label for="__tabbed_9_2">维度3: 当前局所赢分数</label><label for="__tabbed_9_3">维度7: 是否ace</label><label for="__tabbed_9_4">维度14: 领先盘数</label><label for="__tabbed_9_5">维度15: 领先局数</label><label for="__tabbed_9_6">维度16: 领先分数</label><label for="__tabbed_9_7">维度14: 是否一局最后3球</label><label for="__tabbed_9_8">维度18: 当前局获胜所需分数</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_2" loading="lazy" src="../../../../images/matching_input_dimension_2.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_2" loading="lazy" src="../../../../images/non_matching_input_dimension_2.png" /></a></p>
</div>
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_3" loading="lazy" src="../../../../images/matching_input_dimension_3.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_3" loading="lazy" src="../../../../images/non_matching_input_dimension_3.png" /></a></p>
</div>
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_7" loading="lazy" src="../../../../images/matching_input_dimension_7.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_7" loading="lazy" src="../../../../images/non_matching_input_dimension_7.png" /></a></p>
</div>
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_14.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_14" loading="lazy" src="../../../../images/matching_input_dimension_14.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_14.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_14" loading="lazy" src="../../../../images/non_matching_input_dimension_14.png" /></a></p>
</div>
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_15.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_15" loading="lazy" src="../../../../images/matching_input_dimension_15.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_15.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_15" loading="lazy" src="../../../../images/non_matching_input_dimension_15.png" /></a></p>
</div>
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_16.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_16" loading="lazy" src="../../../../images/matching_input_dimension_16.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_16.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_16" loading="lazy" src="../../../../images/non_matching_input_dimension_16.png" /></a></p>
</div>
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_17.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_17" loading="lazy" src="../../../../images/matching_input_dimension_17.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_17.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_17" loading="lazy" src="../../../../images/non_matching_input_dimension_17.png" /></a></p>
</div>
<div class="tabbed-block">
<p>预测较准数据：</p>
<p><a class="glightbox" href="../../../../images/matching_input_dimension_18.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="matching_input_dimension_18" loading="lazy" src="../../../../images/matching_input_dimension_18.png" /></a></p>
<p>其余数据：</p>
<p><a class="glightbox" href="../../../../images/non_matching_input_dimension_18.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="non_matching_input_dimension_18" loading="lazy" src="../../../../images/non_matching_input_dimension_18.png" /></a></p>
</div>
</div>
</div>
<p>我分析感觉，<strong>那些准确和不准确中比例都差不多的维度/指标，说明就和势头相关性不是那么大，而 <mark>比例有明显不同</mark> 的维度/指标，就意味着对准确度是关键因素</strong>。</p>
<p>于是把图片传给队友，不知道他是否用上。</p>
<p>然后发现其实还可以更改 <strong>准确</strong> 的判断依据，比如检查 <strong><em>势头</em>上升下降或转折的趋势</strong> 是否和真实数据一致，但是由于距离比赛结束时间不是很多了，最后就没有尝试这样的思路。</p>
<blockquote>
<p>此时约凌晨3点40</p>
</blockquote>
<hr />
<p>最后就是队友在编写论文，我就没有什么任务了。</p>
<p>到了(6号)早上8点队友提交了论文。</p>
<h2 id="_9">一点感受<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<p>这几天下来是真的累😇，感觉每天都在头脑风暴，最后一天甚至需要通宵，</p>
<p>但是确实又学到了很多东西，个人觉得还是很有意义的🧐(只希望最后不要给我一个S奖，那我是真的会谢😅)。</p>
<h2>代码仓库</h2>

<ul>
<li><a href="https://github.com/RonaldLN/Code_for_2024_MCM_C">RonaldLN/Code_for_2024_MCM_C (github.com)</a></li>
<li><a href="https://gitee.com/ronald-luo/Code_for_2024_MCM_C">Ronald_Luo/Code_for_2024_MCM_C (gitee.com)</a></li>
</ul>
<p>本文对应代码版本位于original分支中</p>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-02-20T05:20:30+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-02-20</span>
      
        <br>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-02-19T14:27:29+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-02-19</span>
      
    
  </small>
</div>


  


  



  <h2 id="__comments">评论</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
        data-repo="RonaldLN/MyPamphlet-Blog"
        data-repo-id="R_kgDOKTCz0g"
        data-category="Announcements"
        data-category-id="DIC_kwDOKTCz0s4CZ2M5"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="top"
        data-theme="https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow.css"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
  </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "sunset-glow-dark"
        ? "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow_dark.css"
        : "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow.css"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "sunset-glow-dark"
            ? "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow_dark.css"
            : "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow.css"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

      
    </article>
  </div>

          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../01/29/chatgptscheme-reduce/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 向ChatGPT咨询Scheme语言中 reduce 被用于重复应用指定函数的函数名的原因">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                向ChatGPT咨询Scheme语言中 reduce 被用于重复应用指定函数的函数名的原因
              </div>
            </div>
          </a>
        
        
          
          <a href="../../19/mkdocs-material/" class="md-footer__link md-footer__link--next" aria-label="下一页: 修改 mkdocs-material 代码块行号字体大小">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                修改 mkdocs-material 代码块行号字体大小
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2023 Ronald Luo
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.expand", "toc.follow", "navigation.top", "search.suggest", "navigation.footer", "navigation.tabs", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "content.code.copy", "search.suggest", "search.highlight", "search.share"], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../../../js/timeago.min.js"></script>
      
        <script src="../../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>