<!doctype html><html class=no-js lang=zh><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=../../22/deepseek/ rel=prev><link href=../../26/faster-whisper/ rel=next><link href=../../../../icons/favicon.png rel=icon><meta content="mkdocs-1.5.3, mkdocs-material-9.4.6" name=generator><title>借助DeepSeek将Python程序转换为Flask网页并实现服务器部署的记录 - My Pamphlet Blog</title><link href=../../../../assets/stylesheets/main.35e1ed30.min.css rel=stylesheet><link href=../../../../assets/stylesheets/palette.356b1318.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../../css/timeago.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web/style.css rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel=stylesheet><link href=../../../../stylesheets/my_scheme.css rel=stylesheet><link href=../../../../stylesheets/custom.css rel=stylesheet><link href=../../../../stylesheets/card.css rel=stylesheet><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-H7SV12D750"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-H7SV12D750",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-H7SV12D750",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><script>var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7a9cfe470ed52fa0c0940a58fede385c";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();</script><link href=../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>html.glightbox-open{overflow:initial;height:100%}.gslide-title{user-select:text;margin-top:0}.gslide-desc{color:#666;user-select:text}.gslide-image img{background:#fff}.gscrollbar-fixer{padding-right:15px}.gdesc-inner{font-size:.75rem}body[data-md-color-scheme=slate] .gdesc-inner{background:var(--md-default-bg-color)}body[data-md-color-scheme=slate] .gslide-title,body[data-md-color-scheme=slate] .gslide-desc{color:var(--md-default-fg-color)}</style><script src=../../../../assets/javascripts/glightbox.min.js></script><body data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=sunset-glow dir=ltr><script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#deepseekpythonflask> 跳转至 </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=页眉><a aria-label="My Pamphlet Blog" class="md-header__button md-logo" title="My Pamphlet Blog" data-md-component=logo href=../../../..> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> My Pamphlet Blog </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> 借助DeepSeek将Python程序转换为Flask网页并实现服务器部署的记录 </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" data-md-color-media="(prefers-color-scheme: light)" class=md-option data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=sunset-glow id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg></label><input aria-label="Switch to light mode" data-md-color-media="(prefers-color-scheme: dark)" class=md-option data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=sunset-glow-dark id=__palette_2 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg></label></form><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=搜索 autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=搜索 required spellcheck=false type=text><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg></label><nav aria-label=查找 class=md-search__options><a class="md-search__icon md-icon" aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=分享> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a><button class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1 title=清空当前内容 type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>正在初始化搜索引擎</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a class=md-source data-md-component=source href=https://github.com/RonaldLN/MyPamphlet-Blog title=前往仓库> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg></div> <div class=md-source__repository>RonaldLN/MyPamphlet-Blog</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=标签 class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../../../..> Blog </a></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0><label class=md-nav__title for=__drawer><a aria-label="My Pamphlet Blog" class="md-nav__button md-logo" title="My Pamphlet Blog" data-md-component=logo href=../../../..> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg> </a> My Pamphlet Blog</label><div class=md-nav__source><a class=md-source data-md-component=source href=https://github.com/RonaldLN/MyPamphlet-Blog title=前往仓库> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg></div> <div class=md-source__repository>RonaldLN/MyPamphlet-Blog</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_1 type=checkbox> <label class=md-nav__link for=__nav_1 id=__nav_1_label><span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_1_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_1><span class="md-nav__icon md-icon"></span> Blog</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active"><a class=md-nav__link href=../../../..> <span class=md-ellipsis> Blog </span> </a><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_1_2 type=checkbox> <label class=md-nav__link for=__nav_1_2 id=__nav_1_2_label tabindex=0><span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_1_2_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_1_2><span class="md-nav__icon md-icon"></span> 归档</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../../../archive/2025/> <span class=md-ellipsis> 2025 </span> </a><li class=md-nav__item><a class=md-nav__link href=../../../../archive/2024/> <span class=md-ellipsis> 2024 </span> </a><li class=md-nav__item><a class=md-nav__link href=../../../../archive/2023/> <span class=md-ellipsis> 2023 </span> </a></ul></nav><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle md-toggle--indeterminate" id=__nav_1_3 type=checkbox> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex=0><span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_1_3_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_1_3><span class="md-nav__icon md-icon"></span> 分类</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../../../category/records-of-trivia/> <span class=md-ellipsis> Records of Trivia </span> </a><li class=md-nav__item><a class=md-nav__link href=../../../../category/configure-debug/> <span class=md-ellipsis> Configure & Debug </span> </a><li class=md-nav__item><a class=md-nav__link href=../../../../category/chronicle-of-events/> <span class=md-ellipsis> Chronicle of Events </span> </a></ul></nav></ul></nav></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--secondary" aria-label=目录><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> 目录</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#python> 用Python实现单词记忆测试功能 </a><li class=md-nav__item><a class=md-nav__link href=#python_1> 将Python程序转换成网页 </a></ul></nav></div></div></div><script defer src=https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/javascripts/toc.js></script><link href=https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/fold_toc.css rel=stylesheet><div class="md-content md-content--post" data-md-component=content><div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class="md-sidebar__inner md-post"><nav class="md-nav md-nav--primary"><div class=md-post__back><div class="md-nav__title md-nav__container"><a class=md-nav__link href=../../../..> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> <span class=md-ellipsis> 回到主页 </span> </a></div></div><div class="md-post__authors md-typeset"><div class="md-profile md-post__profile"><span class="md-author md-author--long"> <img alt="Ronald Luo" src="https://avatars.githubusercontent.com/u/120019179?v=4"> </span><span class=md-profile__description> <strong>Ronald Luo</strong><br> I'm A Student </span></div></div><ul class="md-post__meta md-nav__list"><li class="md-nav__item md-nav__item--section"><div class=md-post__title><span class=md-ellipsis> 元数据 </span></div> <nav class=md-nav><ul class=md-nav__list><li class=md-nav__item><div class=md-nav__link><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg><time datetime="2025-03-23 00:00:00" class=md-ellipsis>2025年3月23日星期日</time></div><li class=md-nav__item><div class=md-nav__link><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg><span class=md-ellipsis> 分类于 <a href=../../../../category/records-of-trivia/>Records of Trivia</a></span></div><li class=md-nav__item><div class=md-nav__link><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg><span class=md-ellipsis> 需要 15 分钟阅读时间 </span></div></ul></nav></ul></nav></div></div></div><article class="md-content__inner md-typeset"><h1 id=deepseekpythonflask>借助DeepSeek将Python程序转换为Flask网页并实现服务器部署的记录<a title="Permanent link" class=headerlink href=#deepseekpythonflask>¶</a></h1><div style=opacity:.7;margin-top:-15px;font-size:.75em><p><span class=twemoji><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> 约 10946 个字 • <span class=twemoji><svg viewbox="0 0 640 512" xmlns=http://www.w3.org/2000/svg><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 664 行代码</div><p>背单词的过程中，由于自测也是按照背的顺序，因此比较容易想到对应的词义，但是突然见到其中一个单词时，发现会想不起来。于是就想让deepseek写一个可以随机显示单词，并且根据“记不清”的次数调整出现概率的python程序<h2 id=python>用Python实现单词记忆测试功能<a title="Permanent link" class=headerlink href=#python>¶</a></h2><details class=example open><summary>对话记录</summary> <p><strong>You</strong>:</p> <p>我想要把这个pdf中的表格中的所有的单词(以表格单元格为单位)提取到程序中，以便我随机输出来测试，我应该如何进行提取？</p> <p> </p> <p><strong>DeepSeek</strong>:</p> <p>...</p> <p> </p> <p><strong>You</strong>:</p> <p>我现在提取出这些单词了，我想要编写一个程序，能够随机从这个词库中挑选单词显示在终端中，我看终端中的单词，如果我记得单词的含义，就按y，不记得就按n，然后程序会记录我的历史数据，并且在显示下一个单词时，要与当前的单词不同并且根据历史数据来加权(不记得次数多的单词赋予更大的权重/出现概率)。如果我不想继续测试单词记忆了，就按q退出这个程序，并且程序会将这一次的数据添加/更新到过往所有的历史数据中(历史数据我想使用yaml文件的形式来存储)。</p> <p> </p> <p><strong>DeepSeek</strong>:</p> <details class=quote><summary>已深度思考（用时 35 秒）</summary> <blockquote><p>嗯，用户的问题是想编写一个程序，实现一个根据记忆情况动态调整单词出现概率的测试工具。用户已经提取了单词，现在需要程序随机显示，记录用户记忆情况，用yaml存储历史数据，并且下次运行时能根据历史数据调整权重。我得一步步想怎么实现这个功能。<p>首先，程序的结构应该包括读取现有的yaml历史数据，如果没有就初始化。然后每次测试时，根据每个单词的权重（不记得次数越多权重越高）来随机选择单词。用户输入y或n后，更新该单词的记录，并调整权重。退出时保存到yaml。<p>关于加权随机选择，用户提到不记得次数多的单词出现概率更高。这需要用到带权重的随机选择方法。根据之前的搜索结果，比如网页1和网页2提到的，Python的random.choices函数支持weights参数，可以直接用。权重可以设计为每个单词的“忘记次数+1”（避免零权重）。<p>然后是数据结构的设计。每个单词需要存储总测试次数和忘记次数，这样每次选择时可以计算权重。历史数据用yaml存储，结构可能是字典，键是单词，值是两个数字的列表，比如{'apple': [5, 3]}，表示测试5次，忘记3次。<p>程序流程大概是这样的：<ol><li><p>启动时加载yaml文件，读取历史数据。</p><li><p>如果用户有新增的单词（当前词库），合并到历史数据中，新增的单词初始化为[0,0]。</p><li><p>进入循环，每次根据权重选择单词。</p><li><p>显示单词，等待用户输入。</p><li><p>更新该单词的测试次数和忘记次数（如果输入n）。</p><li><p>直到用户输入q，保存数据到yaml。</p></ol><p>需要注意的问题：<ul><li><p>如何处理新单词，确保它们被加入历史数据。</p><li><p>每次选择时要排除当前显示的单词，避免重复。可能需要维护一个已显示列表，或者从列表中临时移除当前单词。</p><li><p>yaml的读写需要使用PyYAML库，dump时注意格式。</p></ul><p>根据网页25、27、35等，yaml的读写可以通过PyYAML库实现。使用safe_load和safe_dump来处理数据。此外，合并当前词库和历史数据时，需要检查每个单词是否存在，不存在则初始化。<p>对于加权随机，每次生成权重列表时，根据每个单词的忘记次数+1作为权重，这样即使新单词从未测试过，权重为1，也有机会被选中。而忘记次数多的权重更高。<p>另外，用户希望每次显示下一个单词时与当前的不同，所以在选择下一个单词时，需要排除当前显示的单词。可以通过在random.choices时传入一个排除当前单词的列表，或者在选择后暂时从候选列表中移除，但这样可能影响权重计算。可能需要重新生成候选列表，排除当前单词，并重新计算权重。<p>例如，在选择下一个单词时，先复制当前词库，移除当前单词，然后根据剩余单词的权重进行选择。但这样可能会影响整体的权重分布，但用户的需求是确保下一个单词不同，所以必须这样做。<p>综合这些考虑，代码的大致步骤是：<ol><li><p>加载历史数据。</p><li><p>合并当前词库，确保所有单词都有历史记录。</p><li><p>进入循环：</p> <ol><li><p>根据权重生成候选列表（排除当前单词）。</p><li><p>使用random.choices选择单词。</p><li><p>显示单词，获取输入。</p><li><p>更新历史数据。</p><li><p>保存当前单词，以便下次排除。</p></ol><li><p>退出时保存到yaml。</p></ol><p>代码结构可能如下：<ul><li><p>使用PyYAML读取和写入yaml文件。</p><li><p>使用random.choices的weights参数实现加权随机。</p><li><p>维护一个last_word变量，记录当前显示的单词，下次选择时排除。</p></ul><p>现在，需要处理排除当前单词的情况。例如，在候选列表中排除last_word，然后计算对应的权重列表。如果候选列表为空（比如只有一个单词），则允许重复。<p>此外，处理用户输入时，需要循环直到输入有效（y/n/q），忽略其他输入。<p>测试时，需要确保每次更新历史数据正确，并且yaml文件正确保存。<p>最后，示例代码应该包括这些部分，并给出注释说明关键步骤。</blockquote></details> <p>根据你的需求，我将为你设计一个基于Python的单词记忆测试系统。以下是分步骤的实现方案及代码实现：</p> <hr> <p><h3>一、技术方案设计</h3> <ol><li><strong>权重计算</strong>：使用<code>random.choices</code>的<code>weights</code>参数实现加权随机，权重=忘记次数+1（避免0权重）<li><strong>数据存储</strong>：YAML文件存储历史记录，格式为<code>{单词: [总测试次数, 忘记次数]}</code><li><strong>流程控制</strong>：循环显示单词，记录用户反馈，退出时更新YAML文件</ol> <hr> <p><h3>二、代码实现</h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=kn>import</span><span class=w> </span><span class=nn>random</span>
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=kn>import</span><span class=w> </span><span class=nn>yaml</span>
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
</span><span id=__span-0-4><a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a>
</span><span id=__span-0-5><a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=k>class</span><span class=w> </span><span class=nc>WordMemoryTest</span><span class=p>:</span>
</span><span id=__span-0-6><a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>word_list</span><span class=p>,</span> <span class=n>history_file</span><span class=o>=</span><span class=s1>'history.yaml'</span><span class=p>):</span>
</span><span id=__span-0-7><a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=o>=</span> <span class=n>word_list</span>
</span><span id=__span-0-8><a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>history_file</span><span class=p>)</span>
</span><span id=__span-0-9><a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_load_history</span><span class=p>()</span>
</span><span id=__span-0-10><a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a>        <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-11><a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a>
</span><span id=__span-0-12><a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a>    <span class=k>def</span><span class=w> </span><span class=nf>_load_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-13><a href=#__codelineno-0-13 id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>        </span><span class=sd>"""加载历史记录"""</span>
</span><span id=__span-0-14><a href=#__codelineno-0-14 id=__codelineno-0-14 name=__codelineno-0-14></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-15><a href=#__codelineno-0-15 id=__codelineno-0-15 name=__codelineno-0-15></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>,</span> <span class=s1>'r'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-16><a href=#__codelineno-0-16 id=__codelineno-0-16 name=__codelineno-0-16></a>                <span class=k>return</span> <span class=n>yaml</span><span class=o>.</span><span class=n>safe_load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span> <span class=ow>or</span> <span class=p>{}</span>
</span><span id=__span-0-17><a href=#__codelineno-0-17 id=__codelineno-0-17 name=__codelineno-0-17></a>        <span class=k>return</span> <span class=p>{}</span>
</span><span id=__span-0-18><a href=#__codelineno-0-18 id=__codelineno-0-18 name=__codelineno-0-18></a>
</span><span id=__span-0-19><a href=#__codelineno-0-19 id=__codelineno-0-19 name=__codelineno-0-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>_save_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-20><a href=#__codelineno-0-20 id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>        </span><span class=sd>"""保存历史记录"""</span>
</span><span id=__span-0-21><a href=#__codelineno-0-21 id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>,</span> <span class=s1>'w'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-22><a href=#__codelineno-0-22 id=__codelineno-0-22 name=__codelineno-0-22></a>            <span class=n>yaml</span><span class=o>.</span><span class=n>safe_dump</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-23><a href=#__codelineno-0-23 id=__codelineno-0-23 name=__codelineno-0-23></a>
</span><span id=__span-0-24><a href=#__codelineno-0-24 id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=k>def</span><span class=w> </span><span class=nf>_update_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>word</span><span class=p>,</span> <span class=n>remembered</span><span class=p>):</span>
</span><span id=__span-0-25><a href=#__codelineno-0-25 id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>        </span><span class=sd>"""更新单词记忆数据"""</span>
</span><span id=__span-0-26><a href=#__codelineno-0-26 id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=k>if</span> <span class=n>word</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>:</span>
</span><span id=__span-0-27><a href=#__codelineno-0-27 id=__codelineno-0-27 name=__codelineno-0-27></a>            <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-28><a href=#__codelineno-0-28 id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># 总次数</span>
</span><span id=__span-0-29><a href=#__codelineno-0-29 id=__codelineno-0-29 name=__codelineno-0-29></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>remembered</span><span class=p>:</span>
</span><span id=__span-0-30><a href=#__codelineno-0-30 id=__codelineno-0-30 name=__codelineno-0-30></a>            <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># 忘记次数</span>
</span><span id=__span-0-31><a href=#__codelineno-0-31 id=__codelineno-0-31 name=__codelineno-0-31></a>
</span><span id=__span-0-32><a href=#__codelineno-0-32 id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=k>def</span><span class=w> </span><span class=nf>_get_weights</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-33><a href=#__codelineno-0-33 id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>        </span><span class=sd>"""生成权重列表（排除当前单词）"""</span>
</span><span id=__span-0-34><a href=#__codelineno-0-34 id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span><span class=n>w</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=k>if</span> <span class=n>w</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span><span class=p>]</span>
</span><span id=__span-0-35><a href=#__codelineno-0-35 id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>])[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>candidates</span><span class=p>]</span>
</span><span id=__span-0-36><a href=#__codelineno-0-36 id=__codelineno-0-36 name=__codelineno-0-36></a>
</span><span id=__span-0-37><a href=#__codelineno-0-37 id=__codelineno-0-37 name=__codelineno-0-37></a>    <span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-38><a href=#__codelineno-0-38 id=__codelineno-0-38 name=__codelineno-0-38></a><span class=w>        </span><span class=sd>"""运行测试"""</span>
</span><span id=__span-0-39><a href=#__codelineno-0-39 id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=c1># 合并新单词到历史记录</span>
</span><span id=__span-0-40><a href=#__codelineno-0-40 id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span><span class=p>:</span>
</span><span id=__span-0-41><a href=#__codelineno-0-41 id=__codelineno-0-41 name=__codelineno-0-41></a>            <span class=k>if</span> <span class=n>word</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>:</span>
</span><span id=__span-0-42><a href=#__codelineno-0-42 id=__codelineno-0-42 name=__codelineno-0-42></a>                <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-43><a href=#__codelineno-0-43 id=__codelineno-0-43 name=__codelineno-0-43></a>
</span><span id=__span-0-44><a href=#__codelineno-0-44 id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-45><a href=#__codelineno-0-45 id=__codelineno-0-45 name=__codelineno-0-45></a>            <span class=c1># 生成候选列表和权重</span>
</span><span id=__span-0-46><a href=#__codelineno-0-46 id=__codelineno-0-46 name=__codelineno-0-46></a>            <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span><span class=n>w</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=k>if</span> <span class=n>w</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span><span class=p>]</span>
</span><span id=__span-0-47><a href=#__codelineno-0-47 id=__codelineno-0-47 name=__codelineno-0-47></a>            <span class=n>weights</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_weights</span><span class=p>()</span>
</span><span id=__span-0-48><a href=#__codelineno-0-48 id=__codelineno-0-48 name=__codelineno-0-48></a>
</span><span id=__span-0-49><a href=#__codelineno-0-49 id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>candidates</span><span class=p>:</span>  <span class=c1># 处理只剩一个单词的情况</span>
</span><span id=__span-0-50><a href=#__codelineno-0-50 id=__codelineno-0-50 name=__codelineno-0-50></a>                <span class=n>candidates</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span>
</span><span id=__span-0-51><a href=#__codelineno-0-51 id=__codelineno-0-51 name=__codelineno-0-51></a>                <span class=n>weights</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>w</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>candidates</span><span class=p>]</span>
</span><span id=__span-0-52><a href=#__codelineno-0-52 id=__codelineno-0-52 name=__codelineno-0-52></a>
</span><span id=__span-0-53><a href=#__codelineno-0-53 id=__codelineno-0-53 name=__codelineno-0-53></a>            <span class=c1># 加权随机选择</span>
</span><span id=__span-0-54><a href=#__codelineno-0-54 id=__codelineno-0-54 name=__codelineno-0-54></a>            <span class=n>chosen</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choices</span><span class=p>(</span><span class=n>candidates</span><span class=p>,</span> <span class=n>weights</span><span class=o>=</span><span class=n>weights</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-55><a href=#__codelineno-0-55 id=__codelineno-0-55 name=__codelineno-0-55></a>            <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>chosen</span>
</span><span id=__span-0-56><a href=#__codelineno-0-56 id=__codelineno-0-56 name=__codelineno-0-56></a>
</span><span id=__span-0-57><a href=#__codelineno-0-57 id=__codelineno-0-57 name=__codelineno-0-57></a>            <span class=c1># 用户交互</span>
</span><span id=__span-0-58><a href=#__codelineno-0-58 id=__codelineno-0-58 name=__codelineno-0-58></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"</span><span class=se>\n</span><span class=s2>当前单词：</span><span class=si>{</span><span class=n>chosen</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-0-59><a href=#__codelineno-0-59 id=__codelineno-0-59 name=__codelineno-0-59></a>            <span class=n>action</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>"记得按y，忘记按n，退出按q："</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-0-60><a href=#__codelineno-0-60 id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a href=#__codelineno-0-61 id=__codelineno-0-61 name=__codelineno-0-61></a>            <span class=k>if</span> <span class=n>action</span> <span class=o>==</span> <span class=s1>'q'</span><span class=p>:</span>
</span><span id=__span-0-62><a href=#__codelineno-0-62 id=__codelineno-0-62 name=__codelineno-0-62></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_save_history</span><span class=p>()</span>
</span><span id=__span-0-63><a href=#__codelineno-0-63 id=__codelineno-0-63 name=__codelineno-0-63></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>"已保存学习记录"</span><span class=p>)</span>
</span><span id=__span-0-64><a href=#__codelineno-0-64 id=__codelineno-0-64 name=__codelineno-0-64></a>                <span class=k>break</span>
</span><span id=__span-0-65><a href=#__codelineno-0-65 id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=k>elif</span> <span class=n>action</span> <span class=ow>in</span> <span class=p>(</span><span class=s1>'y'</span><span class=p>,</span> <span class=s1>'n'</span><span class=p>):</span>
</span><span id=__span-0-66><a href=#__codelineno-0-66 id=__codelineno-0-66 name=__codelineno-0-66></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_update_history</span><span class=p>(</span><span class=n>chosen</span><span class=p>,</span> <span class=n>action</span> <span class=o>==</span> <span class=s1>'y'</span><span class=p>)</span>
</span><span id=__span-0-67><a href=#__codelineno-0-67 id=__codelineno-0-67 name=__codelineno-0-67></a>
</span><span id=__span-0-68><a href=#__codelineno-0-68 id=__codelineno-0-68 name=__codelineno-0-68></a><span class=c1># 使用示例</span>
</span><span id=__span-0-69><a href=#__codelineno-0-69 id=__codelineno-0-69 name=__codelineno-0-69></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>"__main__"</span><span class=p>:</span>
</span><span id=__span-0-70><a href=#__codelineno-0-70 id=__codelineno-0-70 name=__codelineno-0-70></a>    <span class=c1># 你的单词列表（示例）</span>
</span><span id=__span-0-71><a href=#__codelineno-0-71 id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=n>words</span> <span class=o>=</span> <span class=p>[</span><span class=s2>"apple"</span><span class=p>,</span> <span class=s2>"banana"</span><span class=p>,</span> <span class=s2>"cognitive"</span><span class=p>,</span> <span class=s2>"paradigm"</span><span class=p>,</span> <span class=s2>"algorithm"</span><span class=p>]</span>
</span><span id=__span-0-72><a href=#__codelineno-0-72 id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a href=#__codelineno-0-73 id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>words</span><span class=p>)</span>
</span><span id=__span-0-74><a href=#__codelineno-0-74 id=__codelineno-0-74 name=__codelineno-0-74></a>    <span class=n>test</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></code></pre></div> <hr> <p><h3>三、核心功能说明</h3> <ol><li><p><strong>YAML数据存储</strong>：</p> <ul><li><p>自动创建<code>history.yaml</code>文件</p><li><p>格式示例：</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=nt>apple</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>3</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>1</span><span class="p p-Indicator">]</span>
</span><span id=__span-1-2><a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=nt>banana</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>5</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>2</span><span class="p p-Indicator">]</span>
</span><span id=__span-1-3><a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=nt>cognitive</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>2</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>2</span><span class="p p-Indicator">]</span>
</span></code></pre></div></ul><li><p><strong>动态权重计算</strong>：</p> <ul><li><p>新单词初始权重为1</p><li><p>每次忘记会使权重+1</p><li><p>自动排除当前显示的单词</p></ul><li><p><strong>历史数据合并</strong>：</p> <ul><li><p>自动检测新增单词</p><li><p>保留原有学习记录</p></ul></ol> <hr> <p><h3>四、扩展建议</h3> <ol><li><p><strong>记忆曲线优化</strong>：参考艾宾浩斯遗忘曲线，添加间隔重复算法</p><li><p><strong>可视化报告</strong>：使用<code>matplotlib</code>生成学习进度图表</p><li><p><strong>多维度权重</strong>：结合测试时间、词频等因素计算综合权重</p><li><p><strong>云端同步</strong>：增加Google Drive/Dropbox API实现多设备同步</p></ol> <hr> <p><h3>五、运行说明</h3> <ol><li><p>安装依赖：</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>pip<span class=w> </span>install<span class=w> </span>pyyaml
</span></code></pre></div><li><p>将你的单词列表替换<code>words</code>变量</p><li><p>每次运行会自动创建/更新<code>history.yaml</code>文件</p></ol> <p>这个系统可以帮助你高效记忆单词，随着使用时间的增加，程序会智能强化你不熟悉的词汇训练。如果需要进一步的功能扩展，可以参考注释中的扩展建议进行开发。</p></details><p>然后我把deepseek编写的代码测试修改整理了一下，换成了使用 <code>json</code> 的格式来存储数据(因为yaml在存储的时候，字典中的key中的空格会被去除，而我想保留下来)。<h2 id=python_1>将Python程序转换成网页<a title="Permanent link" class=headerlink href=#python_1>¶</a></h2><p>然后我想到，这个程序只能在我有电脑的时候才能运行和使用，那我能不能部署到服务器上，这样我在路上通过手机也能使用。<p>于是打开deepseek<details class=example open><summary>对话记录</summary> <p><strong>You</strong>:</p> <details class=note><summary>Python代码</summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1> 1</a></span>
<span class=normal><a href=#__codelineno-3-2> 2</a></span>
<span class=normal><a href=#__codelineno-3-3> 3</a></span>
<span class=normal><a href=#__codelineno-3-4> 4</a></span>
<span class=normal><a href=#__codelineno-3-5> 5</a></span>
<span class=normal><a href=#__codelineno-3-6> 6</a></span>
<span class=normal><a href=#__codelineno-3-7> 7</a></span>
<span class=normal><a href=#__codelineno-3-8> 8</a></span>
<span class=normal><a href=#__codelineno-3-9> 9</a></span>
<span class=normal><a href=#__codelineno-3-10>10</a></span>
<span class=normal><a href=#__codelineno-3-11>11</a></span>
<span class=normal><a href=#__codelineno-3-12>12</a></span>
<span class=normal><a href=#__codelineno-3-13>13</a></span>
<span class=normal><a href=#__codelineno-3-14>14</a></span>
<span class=normal><a href=#__codelineno-3-15>15</a></span>
<span class=normal><a href=#__codelineno-3-16>16</a></span>
<span class=normal><a href=#__codelineno-3-17>17</a></span>
<span class=normal><a href=#__codelineno-3-18>18</a></span>
<span class=normal><a href=#__codelineno-3-19>19</a></span>
<span class=normal><a href=#__codelineno-3-20>20</a></span>
<span class=normal><a href=#__codelineno-3-21>21</a></span>
<span class=normal><a href=#__codelineno-3-22>22</a></span>
<span class=normal><a href=#__codelineno-3-23>23</a></span>
<span class=normal><a href=#__codelineno-3-24>24</a></span>
<span class=normal><a href=#__codelineno-3-25>25</a></span>
<span class=normal><a href=#__codelineno-3-26>26</a></span>
<span class=normal><a href=#__codelineno-3-27>27</a></span>
<span class=normal><a href=#__codelineno-3-28>28</a></span>
<span class=normal><a href=#__codelineno-3-29>29</a></span>
<span class=normal><a href=#__codelineno-3-30>30</a></span>
<span class=normal><a href=#__codelineno-3-31>31</a></span>
<span class=normal><a href=#__codelineno-3-32>32</a></span>
<span class=normal><a href=#__codelineno-3-33>33</a></span>
<span class=normal><a href=#__codelineno-3-34>34</a></span>
<span class=normal><a href=#__codelineno-3-35>35</a></span>
<span class=normal><a href=#__codelineno-3-36>36</a></span>
<span class=normal><a href=#__codelineno-3-37>37</a></span>
<span class=normal><a href=#__codelineno-3-38>38</a></span>
<span class=normal><a href=#__codelineno-3-39>39</a></span>
<span class=normal><a href=#__codelineno-3-40>40</a></span>
<span class=normal><a href=#__codelineno-3-41>41</a></span>
<span class=normal><a href=#__codelineno-3-42>42</a></span>
<span class=normal><a href=#__codelineno-3-43>43</a></span>
<span class=normal><a href=#__codelineno-3-44>44</a></span>
<span class=normal><a href=#__codelineno-3-45>45</a></span>
<span class=normal><a href=#__codelineno-3-46>46</a></span>
<span class=normal><a href=#__codelineno-3-47>47</a></span>
<span class=normal><a href=#__codelineno-3-48>48</a></span>
<span class=normal><a href=#__codelineno-3-49>49</a></span>
<span class=normal><a href=#__codelineno-3-50>50</a></span>
<span class=normal><a href=#__codelineno-3-51>51</a></span>
<span class=normal><a href=#__codelineno-3-52>52</a></span>
<span class=normal><a href=#__codelineno-3-53>53</a></span>
<span class=normal><a href=#__codelineno-3-54>54</a></span>
<span class=normal><a href=#__codelineno-3-55>55</a></span>
<span class=normal><a href=#__codelineno-3-56>56</a></span>
<span class=normal><a href=#__codelineno-3-57>57</a></span>
<span class=normal><a href=#__codelineno-3-58>58</a></span>
<span class=normal><a href=#__codelineno-3-59>59</a></span>
<span class=normal><a href=#__codelineno-3-60>60</a></span>
<span class=normal><a href=#__codelineno-3-61>61</a></span>
<span class=normal><a href=#__codelineno-3-62>62</a></span>
<span class=normal><a href=#__codelineno-3-63>63</a></span>
<span class=normal><a href=#__codelineno-3-64>64</a></span>
<span class=normal><a href=#__codelineno-3-65>65</a></span>
<span class=normal><a href=#__codelineno-3-66>66</a></span>
<span class=normal><a href=#__codelineno-3-67>67</a></span>
<span class=normal><a href=#__codelineno-3-68>68</a></span>
<span class=normal><a href=#__codelineno-3-69>69</a></span>
<span class=normal><a href=#__codelineno-3-70>70</a></span>
<span class=normal><a href=#__codelineno-3-71>71</a></span>
<span class=normal><a href=#__codelineno-3-72>72</a></span>
<span class=normal><a href=#__codelineno-3-73>73</a></span>
<span class=normal><a href=#__codelineno-3-74>74</a></span>
<span class=normal><a href=#__codelineno-3-75>75</a></span>
<span class=normal><a href=#__codelineno-3-76>76</a></span>
<span class=normal><a href=#__codelineno-3-77>77</a></span>
<span class=normal><a href=#__codelineno-3-78>78</a></span>
<span class=normal><a href=#__codelineno-3-79>79</a></span></pre></div><td class=code><div><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=kn>import</span><span class=w> </span><span class=nn>random</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=c1># import yaml</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><span class=k>class</span><span class=w> </span><span class=nc>WordMemoryTest</span><span class=p>:</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>word_list</span><span class=p>,</span> <span class=n>history_file</span><span class=o>=</span><span class=s1>'history.json'</span><span class=p>):</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=o>=</span> <span class=n>word_list</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>history_file</span><span class=p>)</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_load_history</span><span class=p>()</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a>        <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a>    <span class=k>def</span><span class=w> </span><span class=nf>_load_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><span class=w>        </span><span class=sd>"""加载历史记录"""</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>,</span> <span class=s1>'r'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17></a>                <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span> <span class=ow>or</span> <span class=p>{}</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18></a>        <span class=k>return</span> <span class=p>{}</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19></a>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>_save_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21></a><span class=w>        </span><span class=sd>"""保存历史记录"""</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>,</span> <span class=s1>'w'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24></a>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25></a>    <span class=k>def</span><span class=w> </span><span class=nf>_update_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>word</span><span class=p>,</span> <span class=n>remembered</span><span class=p>):</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26></a><span class=w>        </span><span class=sd>"""更新单词记忆数据"""</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27></a>        <span class=k>if</span> <span class=n>word</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>:</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28></a>            <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># 总次数</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>remembered</span><span class=p>:</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31></a>            <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># 忘记次数</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32></a>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33></a>    <span class=k>def</span><span class=w> </span><span class=nf>_get_weights</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34></a><span class=w>        </span><span class=sd>"""生成权重列表（排除当前单词）"""</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35></a>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span><span class=n>w</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=k>if</span> <span class=n>w</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span><span class=p>]</span>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36></a>        <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>])[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>candidates</span><span class=p>]</span>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37></a>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38></a>    <span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39></a><span class=w>        </span><span class=sd>"""运行测试"""</span>
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40></a>        <span class=c1># 合并新单词到历史记录</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41></a>        <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span><span class=p>:</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42></a>            <span class=k>if</span> <span class=n>word</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>:</span>
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43></a>                <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44></a>
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46></a>            <span class=c1># 生成候选列表和权重</span>
</span><span id=__span-3-47><a id=__codelineno-3-47 name=__codelineno-3-47></a>            <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span><span class=n>w</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=k>if</span> <span class=n>w</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span><span class=p>]</span>
</span><span id=__span-3-48><a id=__codelineno-3-48 name=__codelineno-3-48></a>            <span class=n>weights</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_weights</span><span class=p>()</span>
</span><span id=__span-3-49><a id=__codelineno-3-49 name=__codelineno-3-49></a>
</span><span id=__span-3-50><a id=__codelineno-3-50 name=__codelineno-3-50></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>candidates</span><span class=p>:</span>  <span class=c1># 处理只剩一个单词的情况</span>
</span><span id=__span-3-51><a id=__codelineno-3-51 name=__codelineno-3-51></a>                <span class=n>candidates</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span>
</span><span id=__span-3-52><a id=__codelineno-3-52 name=__codelineno-3-52></a>                <span class=n>weights</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>w</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>candidates</span><span class=p>]</span>
</span><span id=__span-3-53><a id=__codelineno-3-53 name=__codelineno-3-53></a>
</span><span id=__span-3-54><a id=__codelineno-3-54 name=__codelineno-3-54></a>            <span class=c1># 加权随机选择</span>
</span><span id=__span-3-55><a id=__codelineno-3-55 name=__codelineno-3-55></a>            <span class=n>chosen</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choices</span><span class=p>(</span><span class=n>candidates</span><span class=p>,</span> <span class=n>weights</span><span class=o>=</span><span class=n>weights</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-3-56><a id=__codelineno-3-56 name=__codelineno-3-56></a>            <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>chosen</span>
</span><span id=__span-3-57><a id=__codelineno-3-57 name=__codelineno-3-57></a>
</span><span id=__span-3-58><a id=__codelineno-3-58 name=__codelineno-3-58></a>            <span class=c1># 用户交互</span>
</span><span id=__span-3-59><a id=__codelineno-3-59 name=__codelineno-3-59></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"</span><span class=se>\n</span><span class=s2>当前单词：</span><span class=si>{</span><span class=n>chosen</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-3-60><a id=__codelineno-3-60 name=__codelineno-3-60></a>            <span class=n>action</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>"记得按y，忘记按n，退出按q："</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-3-61><a id=__codelineno-3-61 name=__codelineno-3-61></a>
</span><span id=__span-3-62><a id=__codelineno-3-62 name=__codelineno-3-62></a>            <span class=k>if</span> <span class=n>action</span> <span class=o>==</span> <span class=s1>'q'</span><span class=p>:</span>
</span><span id=__span-3-63><a id=__codelineno-3-63 name=__codelineno-3-63></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_save_history</span><span class=p>()</span>
</span><span id=__span-3-64><a id=__codelineno-3-64 name=__codelineno-3-64></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>"已保存学习记录"</span><span class=p>)</span>
</span><span id=__span-3-65><a id=__codelineno-3-65 name=__codelineno-3-65></a>                <span class=k>break</span>
</span><span id=__span-3-66><a id=__codelineno-3-66 name=__codelineno-3-66></a>            <span class=k>elif</span> <span class=n>action</span> <span class=ow>in</span> <span class=p>(</span><span class=s1>'y'</span><span class=p>,</span> <span class=s1>'n'</span><span class=p>):</span>
</span><span id=__span-3-67><a id=__codelineno-3-67 name=__codelineno-3-67></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_update_history</span><span class=p>(</span><span class=n>chosen</span><span class=p>,</span> <span class=n>action</span> <span class=o>==</span> <span class=s1>'y'</span><span class=p>)</span>
</span><span id=__span-3-68><a id=__codelineno-3-68 name=__codelineno-3-68></a>
</span><span id=__span-3-69><a id=__codelineno-3-69 name=__codelineno-3-69></a><span class=k>def</span><span class=w> </span><span class=nf>load_words_from_json</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span><span id=__span-3-70><a id=__codelineno-3-70 name=__codelineno-3-70></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>'r'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-3-71><a id=__codelineno-3-71 name=__codelineno-3-71></a>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span><span class=o>.</span><span class=n>keys</span><span class=p>()</span>
</span><span id=__span-3-72><a id=__codelineno-3-72 name=__codelineno-3-72></a>
</span><span id=__span-3-73><a id=__codelineno-3-73 name=__codelineno-3-73></a><span class=c1># 使用示例</span>
</span><span id=__span-3-74><a id=__codelineno-3-74 name=__codelineno-3-74></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>"__main__"</span><span class=p>:</span>
</span><span id=__span-3-75><a id=__codelineno-3-75 name=__codelineno-3-75></a>    <span class=c1># 你的单词列表（示例）</span>
</span><span id=__span-3-76><a id=__codelineno-3-76 name=__codelineno-3-76></a>    <span class=n>words</span> <span class=o>=</span> <span class=n>load_words_from_json</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-3-77><a id=__codelineno-3-77 name=__codelineno-3-77></a>
</span><span id=__span-3-78><a id=__codelineno-3-78 name=__codelineno-3-78></a>    <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>words</span><span class=p>)</span>
</span><span id=__span-3-79><a id=__codelineno-3-79 name=__codelineno-3-79></a>    <span class=n>test</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></code></pre></div></table></div></details> <p>这是我编写好并测试之后的单词记忆训练python文件，我现在想要编写一个简单的网页，并部署到服务器上(这样我就可以随时随地使用这个功能)，并且需要设置一个密码，防止他人使用以致我的历史数据被“污染”。你能帮我实现这个东西吗？</p> <p> </p> <p><strong>DeepSeek</strong>:</p> <details class=quote><summary>已深度思考（用时 242 秒）</summary> <blockquote><p>好的，我需要帮助用户将一个Python脚本转换为一个带有密码保护的网页应用，并部署到服务器上。首先，我需要理解用户的需求和现有的代码结构。<p>用户现有的代码是一个命令行下的单词记忆测试程序，使用JSON来存储历史记录。现在用户想要一个网页版本，并且需要设置密码来防止他人使用导致数据污染。此外，用户希望部署到服务器上，方便随时访问。<p>首先，我需要考虑如何将命令行程序转换为网页应用。常见的做法是使用Web框架，比如Flask或Django。考虑到这是一个简单的应用，Flask可能更合适，因为它轻量且易于配置。<p>接下来，密码保护的问题。用户需要登录后才能使用，这样可以防止未经授权的访问。在Flask中，可以使用Flask-Login扩展来处理用户认证。不过，如果用户只需要一个简单的密码保护，可能不需要复杂的用户系统。可以考虑在首页设置一个密码输入框，验证通过后设置会话（session）变量，后续检查该会话是否存在来决定是否允许访问。<p>然后，数据存储的问题。现有的历史数据是存储在history.json文件中。在网页应用中，可能需要将这个文件放在服务器的安全位置，或者考虑每个用户单独的历史文件。但根据用户描述，可能用户自己使用，所以可以继续使用同一个文件，但需要确保在Web环境下读写文件时的线程安全，比如使用文件锁或者确保单线程处理。<p>接下来，前端部分需要设计。网页需要显示当前单词，并提供按钮让用户选择“记得”或“忘记”，以及退出功能。可能需要使用HTML/CSS/JavaScript来构建界面，并通过AJAX与后端交互，或者使用表单提交。考虑到实时性，AJAX可能更合适，避免页面刷新。<p>关于部署，用户需要将应用部署到服务器上。可能需要使用Gunicorn或uWSGI作为WSGI服务器，配合Nginx反向代理。同时，需要考虑服务器的配置，比如静态文件处理、SSL加密等。但用户可能只需要基本的部署步骤，所以可以提供简单的Flask自带的服务器用于测试，并说明如何用生产服务器部署。<p>密码存储方面，如果只是单一密码，可以将密码哈希后存储在环境变量中，或者在配置文件中。但简单起见，可能直接在代码中设置一个密码，或者让用户通过环境变量设置。更安全的方式是使用哈希和加盐，但用户可能只需要基础的保护，所以可以先实现一个简单的密码验证，输入正确后设置会话。<p>还需要考虑跨用户的问题，如果多个用户同时访问，历史文件会被互相覆盖。但用户可能只是自己使用，所以可能不需要处理多用户的情况，保持单用户即可。<p>现在，步骤大致如下：<ol><li><p>使用Flask搭建Web应用框架。</p><li><p>添加密码保护，通过会话管理。</p><li><p>将原Python脚本的逻辑整合到Flask的路由中。</p><li><p>设计前端页面，使用AJAX处理用户操作。</p><li><p>确保文件读写在Web环境下的安全。</p><li><p>部署到服务器，配置相关服务。</p></ol><p>在整合代码时，需要将WordMemoryTest类适配到Web环境中。例如，每次用户请求新单词时，调用相应的方法，处理用户输入，并更新历史记录。由于Web是无状态的，需要使用会话来跟踪当前用户的进度，比如当前显示的单词、历史记录等。但原代码中的历史记录是存储在文件中的，可能需要每个会话有自己的历史，但用户需求是防止他人污染数据，所以应该保持单一历史文件，但通过密码保护确保只有授权用户访问。<p>或者，可能用户希望即使不同设备访问，历史记录也是同步的，所以继续使用同一个history.json文件，但通过密码防止他人修改。这时候，Web应用中的WordMemoryTest实例需要正确处理并发访问，比如使用锁机制，避免多个请求同时读写文件导致数据损坏。<p>这可能需要使用文件锁，例如在读写文件时使用flock，或者在Flask中使用线程锁，但需要注意Flask的多线程环境。<p>或者，将历史数据存储在数据库（如SQLite）中，更安全地处理并发。但用户现有的代码使用JSON文件，可能需要调整数据结构，或者继续使用文件，但每次访问时加锁。<p>综合考虑时间和复杂度，可能继续使用JSON文件，但在每次读写时使用锁，例如使用fcntl模块在Linux系统上锁定文件，或者在代码中使用try-except来处理冲突，尽管这可能不够完善，但对于个人项目可能足够。<p>接下来，具体实现：<p>创建Flask应用，路由包括登录页面和主功能页面。登录后，会话中标记已认证，之后才能访问主页面。<p>主页面需要显示当前单词，并通过按钮让用户选择记得或忘记。可能需要使用JavaScript来发送用户的选择到后端，并接收下一个单词，无需刷新页面。<p>每次用户操作后，后端调用WordMemoryTest的方法更新历史记录，并返回下一个单词。<p>在代码结构上，可能需要将WordMemoryTest实例保存在用户的会话中，但Flask的会话是基于cookie的，存储大小有限，不能存储对象。因此，可能需要每次请求时重新创建WordMemoryTest实例，并加载最新的历史数据。<p>或者，将必要的数据（如last_word）存储在用户会话中，但需要注意并发问题。<p>这可能比较复杂，因为原代码中的WordMemoryTest在run()方法中使用了一个循环，但在Web应用中，每个用户操作都是一个独立的HTTP请求，无法保持循环。因此，需要将原来的循环逻辑拆分为多个请求处理。<p>例如：<ul><li><p>用户访问主页，显示当前单词。</p><li><p>用户点击“记得”或“忘记”，发送POST请求，后端处理并更新历史，然后生成下一个单词，返回给前端显示。</p></ul><p>这样，每次用户操作都是一个独立的请求，后端需要维护状态，比如当前显示的单词。这可能需要将last_word存储在用户会话中，或者每次根据历史记录动态生成下一个单词。<p>这可能需要对原代码中的run()方法进行重构，将生成下一个单词的逻辑提取出来，作为单独的方法，比如get_next_word()，然后在每次用户操作后调用该方法。<p>因此，可能需要修改WordMemoryTest类，添加一个方法来选择下一个单词，而不是在run()循环中处理。<p>例如：<p>在WordMemoryTest中添加方法：<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_next_word</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-4-2><a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>    <span class=c1># 生成候选列表和权重</span>
</span><span id=__span-4-3><a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a>    <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span><span class=n>w</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=k>if</span> <span class=n>w</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span><span class=p>]</span>
</span><span id=__span-4-4><a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a>    <span class=n>weights</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_weights</span><span class=p>()</span>
</span><span id=__span-4-5><a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>candidates</span><span class=p>:</span>  <span class=c1># 处理只剩一个单词的情况</span>
</span><span id=__span-4-6><a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a>        <span class=n>candidates</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span>
</span><span id=__span-4-7><a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a>        <span class=n>weights</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>w</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=mi>1</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>candidates</span><span class=p>]</span>
</span><span id=__span-4-8><a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a>    <span class=n>chosen</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choices</span><span class=p>(</span><span class=n>candidates</span><span class=p>,</span> <span class=n>weights</span><span class=o>=</span><span class=n>weights</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-4-9><a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a>    <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>chosen</span>
</span><span id=__span-4-10><a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a>    <span class=k>return</span> <span class=n>chosen</span>
</span></code></pre></div></details><p>然后，在Web应用中，当用户访问时，调用get_next_word()来显示单词，用户提交操作后，处理并再次调用get_next_word()。<p>但问题在于，每次请求都是独立的，如何保持last_word的状态？因为Web应用是无状态的，每次请求可能需要重新初始化WordMemoryTest实例，这样last_word会被重置。<p>因此，可能需要将last_word存储在用户会话中，或者每次根据历史记录重新计算下一个单词，而不依赖last_word。但原代码中的逻辑是排除上一次的单词，所以需要跟踪上一次的单词。<p>这可能意味着，在用户会话中保存last_word的值，这样每次请求时，可以根据会话中的last_word来生成下一个单词。<p>因此，在Flask应用中，用户会话（session）可以存储last_word。每次用户提交操作后，更新last_word到会话中。<p>但需要注意，多个用户同时使用时，会话是独立的，因此每个用户会有自己的last_word，但这与原代码的逻辑不同，原代码是单用户的。但用户需求是防止他人使用，所以实际上只有一个用户，即自己，因此可能不需要处理多用户的情况。或者，当部署到服务器后，用户可能在不同设备上使用，但通过同一个账户登录，所以会话中的last_word可能不同步。这会导致问题，比如在手机上测试后，电脑上的会话可能显示不同的last_word，导致重复出现同一个单词。<p>这可能需要重新考虑设计，是否将last_word存储在历史文件中，而不是会话中。例如，在历史记录中添加一个字段记录last_word，这样无论从哪个设备访问，都能获取到上一次的单词。<p>但修改历史文件的结构可能需要调整现有代码，比如将history.json中的每个单词的记录之外，添加一个last_word字段。这可能会影响原来的命令行程序的数据兼容性。<p>或者，可以接受在Web应用中的last_word不跨会话同步，即每次会话开始时随机选择，但这样可能影响算法效果。原代码中的逻辑是避免连续出现同一个单词，所以需要跨请求保持last_word的状态。因此，在Web应用中，必须将会话中的last_word持久化存储，或者在历史文件中保存。<p>或者，在每次生成下一个单词时，不依赖last_word，而是通过其他方式避免重复。比如，原代码中的逻辑可能可以调整，比如允许同一个单词连续出现，但概率较低。这可能影响用户体验，但可能简化Web实现。<p>或者，将last_word存储在用户的会话中，这样在同一个浏览器会话中，可以保持last_word的状态。但这样，当用户在不同的标签页或设备上使用时，可能会有不同的last_word。这可能需要用户接受这种限制，或者调整算法，不再依赖last_word，而是其他方式计算权重。<p>这可能需要对原算法进行调整。例如，是否必须排除上一次的单词？或者是否可以降低其权重？<p>例如，原代码中的_get_weights()方法生成权重时，排除了last_word。如果无法在Web应用中可靠跟踪last_word，可能需要修改这个逻辑。例如，可以调整权重计算方式，使得上一次出现的单词的权重降低，而不是完全排除。这样，即使无法跟踪last_word，也能减少连续出现的概率。<p>但这样可能需要修改原程序的核心逻辑，用户是否接受？或者是否必须保持与原程序相同的行为？<p>用户可能希望保持与原程序相同的逻辑，因此需要找到在Web环境中可靠跟踪last_word的方法。<p>因此，可行的解决方案是将last_word存储在用户会话中。在Flask中，session对象可以存储数据，但默认情况下，Flask的session是基于cookie的，且数据是签名的，但存储内容需要能够序列化为JSON。因此，可以在用户登录后，在session中存储last_word的值，每次请求时读取和更新。<p>这样，在每次生成下一个单词时，使用session中的last_word来排除上一次的单词。<p>但需要注意，当多个请求同时发生时（比如用户快速点击按钮），可能导致并发问题，但考虑到是个人使用，这种情况可能较少，可以暂时忽略。<p>现在，整合这些思路，具体步骤：<p>安装必要的库：Flask, Flask-Login（如果需要用户登录），或者其他认证方式。<p>但用户只需要一个简单的密码，可能不需要复杂的用户系统。可以设计一个登录页面，输入密码，验证通过后设置session['authenticated'] = True，并在其他路由中检查该值。<p>密码可以存储在环境变量中，或者在配置文件中，或者硬编码（不推荐，但简单）。更好的方式是从环境变量读取，比如设置一个SECRET_PASSWORD变量。<p>但用户可能希望密码在代码中设置，或者通过某种方式配置。例如，可以在代码中设置一个密码哈希，并在登录时比较输入密码的哈希。<p>不过，为了简单起见，可能先实现一个简单的密码验证，密码明文存储在环境变量中，或者代码中（虽然不安全，但快速实现）。<p>例如，在Flask应用中：<p>设置一个密码，比如在config.py中：<div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=n>PASSWORD</span> <span class=o>=</span> <span class=s1>'mypassword'</span>
</span></code></pre></div><p>然后在登录路由中，比较用户输入的密码是否等于该密码。如果正确，设置session['authenticated'] = True。<p>然后，其他路由检查session.get('authenticated')是否为True，否则重定向到登录页面。<p>这种方法虽然不够安全，但适合个人使用，特别是如果部署在HTTPS环境下，可以防止密码在传输中被截获。<p>接下来，设计路由：<ul><li><p>/login：GET显示登录表单，POST处理密码验证。</p><li><p>/：主页面，显示当前单词和操作按钮。</p><li><p>/next_word：处理用户操作（记得/忘记），并返回下一个单词。</p><li><p>/logout：注销。</p></ul><p>前端部分，可以使用简单的HTML表单，或者使用JavaScript实现动态交互。例如，当用户点击“记得”或“忘记”时，发送AJAX请求到后端，后端处理并返回下一个单词，前端更新页面内容而无需刷新。<p>这样，用户的操作体验更接近原命令行程序。<p>现在，代码实现的大致结构：<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a><span class=kn>from</span><span class=w> </span><span class=nn>flask</span><span class=w> </span><span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>session</span><span class=p>,</span> <span class=n>redirect</span><span class=p>,</span> <span class=n>url_for</span>
</span><span id=__span-6-2><a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a><span class=kn>import</span><span class=w> </span><span class=nn>random</span>
</span><span id=__span-6-3><a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
</span><span id=__span-6-4><a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-6-5><a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a>
</span><span id=__span-6-6><a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-6-7><a href=#__codelineno-6-7 id=__codelineno-6-7 name=__codelineno-6-7></a><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=s1>'supersecretkey'</span>  <span class=c1># 需要设置为安全的密钥</span>
</span><span id=__span-6-8><a href=#__codelineno-6-8 id=__codelineno-6-8 name=__codelineno-6-8></a><span class=n>PASSWORD</span> <span class=o>=</span> <span class=s1>'mypassword'</span>  <span class=c1># 或从环境变量获取</span>
</span><span id=__span-6-9><a href=#__codelineno-6-9 id=__codelineno-6-9 name=__codelineno-6-9></a>
</span><span id=__span-6-10><a href=#__codelineno-6-10 id=__codelineno-6-10 name=__codelineno-6-10></a><span class=k>class</span><span class=w> </span><span class=nc>WordMemoryTest</span><span class=p>:</span>
</span><span id=__span-6-11><a href=#__codelineno-6-11 id=__codelineno-6-11 name=__codelineno-6-11></a>    <span class=c1># 类似原有代码，但可能需要调整，比如不需要run()循环</span>
</span><span id=__span-6-12><a href=#__codelineno-6-12 id=__codelineno-6-12 name=__codelineno-6-12></a>    <span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/login'</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>'GET'</span><span class=p>,</span> <span class=s1>'POST'</span><span class=p>])</span>
</span><span id=__span-6-13><a href=#__codelineno-6-13 id=__codelineno-6-13 name=__codelineno-6-13></a>    <span class=k>def</span><span class=w> </span><span class=nf>login</span><span class=p>():</span>
</span><span id=__span-6-14><a href=#__codelineno-6-14 id=__codelineno-6-14 name=__codelineno-6-14></a>        <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>'POST'</span><span class=p>:</span>
</span><span id=__span-6-15><a href=#__codelineno-6-15 id=__codelineno-6-15 name=__codelineno-6-15></a>            <span class=n>password</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'password'</span><span class=p>)</span>
</span><span id=__span-6-16><a href=#__codelineno-6-16 id=__codelineno-6-16 name=__codelineno-6-16></a>            <span class=k>if</span> <span class=n>password</span> <span class=o>==</span> <span class=n>PASSWORD</span><span class=p>:</span>
</span><span id=__span-6-17><a href=#__codelineno-6-17 id=__codelineno-6-17 name=__codelineno-6-17></a>                <span class=n>session</span><span class=p>[</span><span class=s1>'authenticated'</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-6-18><a href=#__codelineno-6-18 id=__codelineno-6-18 name=__codelineno-6-18></a>                <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'index'</span><span class=p>))</span>
</span><span id=__span-6-19><a href=#__codelineno-6-19 id=__codelineno-6-19 name=__codelineno-6-19></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-6-20><a href=#__codelineno-6-20 id=__codelineno-6-20 name=__codelineno-6-20></a>            <span class=k>return</span> <span class=s2>"密码错误"</span>
</span><span id=__span-6-21><a href=#__codelineno-6-21 id=__codelineno-6-21 name=__codelineno-6-21></a>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>'login.html'</span><span class=p>)</span>
</span><span id=__span-6-22><a href=#__codelineno-6-22 id=__codelineno-6-22 name=__codelineno-6-22></a>
</span><span id=__span-6-23><a href=#__codelineno-6-23 id=__codelineno-6-23 name=__codelineno-6-23></a>    <span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/logout'</span><span class=p>)</span>
</span><span id=__span-6-24><a href=#__codelineno-6-24 id=__codelineno-6-24 name=__codelineno-6-24></a>    <span class=k>def</span><span class=w> </span><span class=nf>logout</span><span class=p>():</span>
</span><span id=__span-6-25><a href=#__codelineno-6-25 id=__codelineno-6-25 name=__codelineno-6-25></a>        <span class=n>session</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-6-26><a href=#__codelineno-6-26 id=__codelineno-6-26 name=__codelineno-6-26></a>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>))</span>
</span><span id=__span-6-27><a href=#__codelineno-6-27 id=__codelineno-6-27 name=__codelineno-6-27></a>
</span><span id=__span-6-28><a href=#__codelineno-6-28 id=__codelineno-6-28 name=__codelineno-6-28></a>    <span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/'</span><span class=p>)</span>
</span><span id=__span-6-29><a href=#__codelineno-6-29 id=__codelineno-6-29 name=__codelineno-6-29></a>    <span class=k>def</span><span class=w> </span><span class=nf>index</span><span class=p>():</span>
</span><span id=__span-6-30><a href=#__codelineno-6-30 id=__codelineno-6-30 name=__codelineno-6-30></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>):</span>
</span><span id=__span-6-31><a href=#__codelineno-6-31 id=__codelineno-6-31 name=__codelineno-6-31></a>            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>))</span>
</span><span id=__span-6-32><a href=#__codelineno-6-32 id=__codelineno-6-32 name=__codelineno-6-32></a>
</span><span id=__span-6-33><a href=#__codelineno-6-33 id=__codelineno-6-33 name=__codelineno-6-33></a>        <span class=c1># 初始化或获取当前单词</span>
</span><span id=__span-6-34><a href=#__codelineno-6-34 id=__codelineno-6-34 name=__codelineno-6-34></a>        <span class=c1># 需要处理WordMemoryTest实例，可能每次请求都创建新的实例？</span>
</span><span id=__span-6-35><a href=#__codelineno-6-35 id=__codelineno-6-35 name=__codelineno-6-35></a>        <span class=c1># 或者将实例保存在全局变量中，但会有多用户的问题</span>
</span><span id=__span-6-36><a href=#__codelineno-6-36 id=__codelineno-6-36 name=__codelineno-6-36></a>        <span class=c1># 更安全的是每个用户有自己的状态，但需要会话存储</span>
</span><span id=__span-6-37><a href=#__codelineno-6-37 id=__codelineno-6-37 name=__codelineno-6-37></a>        <span class=c1># 但由于是单用户，可能可以全局使用，但需要注意并发</span>
</span><span id=__span-6-38><a href=#__codelineno-6-38 id=__codelineno-6-38 name=__codelineno-6-38></a>        <span class=c1># 这里可能需要调整逻辑，因为每个用户可能有不同的会话</span>
</span><span id=__span-6-39><a href=#__codelineno-6-39 id=__codelineno-6-39 name=__codelineno-6-39></a>        <span class=c1># 可能将WordMemoryTest的状态存储在用户的session中</span>
</span><span id=__span-6-40><a href=#__codelineno-6-40 id=__codelineno-6-40 name=__codelineno-6-40></a>        <span class=c1># 但 session 存储大小有限，不能存储整个对象</span>
</span><span id=__span-6-41><a href=#__codelineno-6-41 id=__codelineno-6-41 name=__codelineno-6-41></a>        <span class=c1># 因此，每次请求时重新创建实例，并保存必要的数据到session中</span>
</span><span id=__span-6-42><a href=#__codelineno-6-42 id=__codelineno-6-42 name=__codelineno-6-42></a>        <span class=c1># 例如，保存last_word到session，history从文件加载</span>
</span><span id=__span-6-43><a href=#__codelineno-6-43 id=__codelineno-6-43 name=__codelineno-6-43></a>        <span class=c1># 初始化WordMemoryTest</span>
</span><span id=__span-6-44><a href=#__codelineno-6-44 id=__codelineno-6-44 name=__codelineno-6-44></a>
</span><span id=__span-6-45><a href=#__codelineno-6-45 id=__codelineno-6-45 name=__codelineno-6-45></a>        <span class=n>word_list</span> <span class=o>=</span> <span class=n>load_words_from_json</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-6-46><a href=#__codelineno-6-46 id=__codelineno-6-46 name=__codelineno-6-46></a>        <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>word_list</span><span class=p>,</span> <span class=n>history_file</span><span class=o>=</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-6-47><a href=#__codelineno-6-47 id=__codelineno-6-47 name=__codelineno-6-47></a>
</span><span id=__span-6-48><a href=#__codelineno-6-48 id=__codelineno-6-48 name=__codelineno-6-48></a>        <span class=c1># 从session中获取last_word</span>
</span><span id=__span-6-49><a href=#__codelineno-6-49 id=__codelineno-6-49 name=__codelineno-6-49></a>        <span class=n>last_word</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'last_word'</span><span class=p>)</span>
</span><span id=__span-6-50><a href=#__codelineno-6-50 id=__codelineno-6-50 name=__codelineno-6-50></a>        <span class=n>test</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>last_word</span>
</span><span id=__span-6-51><a href=#__codelineno-6-51 id=__codelineno-6-51 name=__codelineno-6-51></a>
</span><span id=__span-6-52><a href=#__codelineno-6-52 id=__codelineno-6-52 name=__codelineno-6-52></a>        <span class=c1># 获取下一个单词</span>
</span><span id=__span-6-53><a href=#__codelineno-6-53 id=__codelineno-6-53 name=__codelineno-6-53></a>        <span class=n>next_word</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>get_next_word</span><span class=p>()</span>
</span><span id=__span-6-54><a href=#__codelineno-6-54 id=__codelineno-6-54 name=__codelineno-6-54></a>
</span><span id=__span-6-55><a href=#__codelineno-6-55 id=__codelineno-6-55 name=__codelineno-6-55></a>        <span class=c1># 保存last_word到session</span>
</span><span id=__span-6-56><a href=#__codelineno-6-56 id=__codelineno-6-56 name=__codelineno-6-56></a>        <span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>]</span> <span class=o>=</span> <span class=n>next_word</span>
</span><span id=__span-6-57><a href=#__codelineno-6-57 id=__codelineno-6-57 name=__codelineno-6-57></a>
</span><span id=__span-6-58><a href=#__codelineno-6-58 id=__codelineno-6-58 name=__codelineno-6-58></a>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>'index.html'</span><span class=p>,</span> <span class=n>current_word</span><span class=o>=</span><span class=n>next_word</span><span class=p>)</span>
</span><span id=__span-6-59><a href=#__codelineno-6-59 id=__codelineno-6-59 name=__codelineno-6-59></a>
</span><span id=__span-6-60><a href=#__codelineno-6-60 id=__codelineno-6-60 name=__codelineno-6-60></a>    <span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/process'</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>'POST'</span><span class=p>])</span>
</span><span id=__span-6-61><a href=#__codelineno-6-61 id=__codelineno-6-61 name=__codelineno-6-61></a>    <span class=k>def</span><span class=w> </span><span class=nf>process</span><span class=p>():</span>
</span><span id=__span-6-62><a href=#__codelineno-6-62 id=__codelineno-6-62 name=__codelineno-6-62></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>):</span>
</span><span id=__span-6-63><a href=#__codelineno-6-63 id=__codelineno-6-63 name=__codelineno-6-63></a>            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>))</span>
</span><span id=__span-6-64><a href=#__codelineno-6-64 id=__codelineno-6-64 name=__codelineno-6-64></a>        <span class=n>remembered</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'remembered'</span><span class=p>)</span> <span class=o>==</span> <span class=s1>'y'</span>
</span><span id=__span-6-65><a href=#__codelineno-6-65 id=__codelineno-6-65 name=__codelineno-6-65></a>        <span class=n>current_word</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'current_word'</span><span class=p>)</span>
</span><span id=__span-6-66><a href=#__codelineno-6-66 id=__codelineno-6-66 name=__codelineno-6-66></a>
</span><span id=__span-6-67><a href=#__codelineno-6-67 id=__codelineno-6-67 name=__codelineno-6-67></a>        <span class=c1># 更新历史记录</span>
</span><span id=__span-6-68><a href=#__codelineno-6-68 id=__codelineno-6-68 name=__codelineno-6-68></a>        <span class=n>word_list</span> <span class=o>=</span> <span class=n>load_words_from_json</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-6-69><a href=#__codelineno-6-69 id=__codelineno-6-69 name=__codelineno-6-69></a>        <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>word_list</span><span class=p>,</span> <span class=n>history_file</span><span class=o>=</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-6-70><a href=#__codelineno-6-70 id=__codelineno-6-70 name=__codelineno-6-70></a>        <span class=n>test</span><span class=o>.</span><span class=n>_update_history</span><span class=p>(</span><span class=n>current_word</span><span class=p>,</span> <span class=n>remembered</span><span class=p>)</span>
</span><span id=__span-6-71><a href=#__codelineno-6-71 id=__codelineno-6-71 name=__codelineno-6-71></a>        <span class=n>test</span><span class=o>.</span><span class=n>_save_history</span><span class=p>()</span>
</span><span id=__span-6-72><a href=#__codelineno-6-72 id=__codelineno-6-72 name=__codelineno-6-72></a>
</span><span id=__span-6-73><a href=#__codelineno-6-73 id=__codelineno-6-73 name=__codelineno-6-73></a>        <span class=c1># 获取下一个单词</span>
</span><span id=__span-6-74><a href=#__codelineno-6-74 id=__codelineno-6-74 name=__codelineno-6-74></a>        <span class=n>last_word</span> <span class=o>=</span> <span class=n>current_word</span>
</span><span id=__span-6-75><a href=#__codelineno-6-75 id=__codelineno-6-75 name=__codelineno-6-75></a>        <span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>]</span> <span class=o>=</span> <span class=n>last_word</span>
</span><span id=__span-6-76><a href=#__codelineno-6-76 id=__codelineno-6-76 name=__codelineno-6-76></a>        <span class=n>next_word</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>get_next_word</span><span class=p>()</span>
</span><span id=__span-6-77><a href=#__codelineno-6-77 id=__codelineno-6-77 name=__codelineno-6-77></a>        <span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>]</span> <span class=o>=</span> <span class=n>next_word</span>
</span><span id=__span-6-78><a href=#__codelineno-6-78 id=__codelineno-6-78 name=__codelineno-6-78></a>        <span class=k>return</span> <span class=p>{</span><span class=s1>'next_word'</span><span class=p>:</span> <span class=n>next_word</span><span class=p>}</span>
</span></code></pre></div></details><p>但这样处理可能有问题，因为每次请求都会创建新的WordMemoryTest实例，而历史数据在文件中，所以每次都会正确加载。但last_word需要从session中获取，并在处理后保存到session中。<p>或者，在index路由中，每次显示一个单词，用户提交后，处理该单词的记忆状态，并生成下一个单词。<p>但前端可能需要使用AJAX来避免页面刷新。例如，用户点击按钮后，发送POST请求到/process，处理并返回下一个单词，前端用JavaScript更新页面。<p>因此，index.html可能包含JavaScript代码，监听按钮点击，发送请求，并更新显示的单词。<p>现在，设计前端模板：<p>login.html:<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-html highlight"><pre><span></span><code><span id=__span-7-1><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>></span>
</span><span id=__span-7-2><a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-7-3><a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a>    <span class=p>&lt;</span><span class=nt>form</span> <span class=na>method</span><span class=o>=</span><span class=s>"post"</span><span class=p>></span>
</span><span id=__span-7-4><a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>"password"</span> <span class=na>name</span><span class=o>=</span><span class=s>"password"</span> <span class=na>required</span><span class=p>></span>
</span><span id=__span-7-5><a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>"submit"</span><span class=p>></span>登录<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-7-6><a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a>    <span class=p>&lt;/</span><span class=nt>form</span><span class=p>></span>
</span><span id=__span-7-7><a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-7-8><a href=#__codelineno-7-8 id=__codelineno-7-8 name=__codelineno-7-8></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>></span>
</span></code></pre></div></details><p>index.html:<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-html highlight"><pre><span></span><code><span id=__span-8-1><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>></span>
</span><span id=__span-8-2><a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-8-3><a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>"current-word"</span><span class=p>>&lt;/</span><span class=nt>div</span><span class=p>></span>
</span><span id=__span-8-4><a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"handleAction('y')"</span><span class=p>></span>记得<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-8-5><a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"handleAction('n')"</span><span class=p>></span>忘记<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-8-6><a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"logout()"</span><span class=p>></span>退出<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-8-7><a href=#__codelineno-8-7 id=__codelineno-8-7 name=__codelineno-8-7></a>
</span><span id=__span-8-8><a href=#__codelineno-8-8 id=__codelineno-8-8 name=__codelineno-8-8></a>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>></span>
</span><span id=__span-8-9><a href=#__codelineno-8-9 id=__codelineno-8-9 name=__codelineno-8-9></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=nx>currentWord</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>"{{ current_word }}"</span><span class=p>;</span>
</span><span id=__span-8-10><a href=#__codelineno-8-10 id=__codelineno-8-10 name=__codelineno-8-10></a>
</span><span id=__span-8-11><a href=#__codelineno-8-11 id=__codelineno-8-11 name=__codelineno-8-11></a><span class=w>        </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>'current-word'</span><span class=p>).</span><span class=nx>textContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`当前单词：</span><span class=si>${</span><span class=nx>currentWord</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-8-12><a href=#__codelineno-8-12 id=__codelineno-8-12 name=__codelineno-8-12></a>
</span><span id=__span-8-13><a href=#__codelineno-8-13 id=__codelineno-8-13 name=__codelineno-8-13></a><span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>handleAction</span><span class=p>(</span><span class=nx>action</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-14><a href=#__codelineno-8-14 id=__codelineno-8-14 name=__codelineno-8-14></a><span class=w>            </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>'/process'</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-15><a href=#__codelineno-8-15 id=__codelineno-8-15 name=__codelineno-8-15></a><span class=w>                </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>'POST'</span><span class=p>,</span>
</span><span id=__span-8-16><a href=#__codelineno-8-16 id=__codelineno-8-16 name=__codelineno-8-16></a><span class=w>                </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-17><a href=#__codelineno-8-17 id=__codelineno-8-17 name=__codelineno-8-17></a><span class=w>                    </span><span class=s1>'Content-Type'</span><span class=o>:</span><span class=w> </span><span class=s1>'application/json'</span><span class=p>,</span>
</span><span id=__span-8-18><a href=#__codelineno-8-18 id=__codelineno-8-18 name=__codelineno-8-18></a><span class=w>                </span><span class=p>},</span>
</span><span id=__span-8-19><a href=#__codelineno-8-19 id=__codelineno-8-19 name=__codelineno-8-19></a><span class=w>                </span><span class=nx>body</span><span class=o>:</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-8-20><a href=#__codelineno-8-20 id=__codelineno-8-20 name=__codelineno-8-20></a><span class=w>                    </span><span class=nx>current_word</span><span class=o>:</span><span class=w> </span><span class=nx>currentWord</span><span class=p>,</span>
</span><span id=__span-8-21><a href=#__codelineno-8-21 id=__codelineno-8-21 name=__codelineno-8-21></a><span class=w>                    </span><span class=nx>remembered</span><span class=o>:</span><span class=w> </span><span class=nx>action</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>'y'</span>
</span><span id=__span-8-22><a href=#__codelineno-8-22 id=__codelineno-8-22 name=__codelineno-8-22></a><span class=w>                </span><span class=p>})</span>
</span><span id=__span-8-23><a href=#__codelineno-8-23 id=__codelineno-8-23 name=__codelineno-8-23></a><span class=w>            </span><span class=p>})</span>
</span><span id=__span-8-24><a href=#__codelineno-8-24 id=__codelineno-8-24 name=__codelineno-8-24></a><span class=w>            </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span><span class=w> </span><span class=p>=></span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span><span id=__span-8-25><a href=#__codelineno-8-25 id=__codelineno-8-25 name=__codelineno-8-25></a><span class=w>            </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>=></span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-26><a href=#__codelineno-8-26 id=__codelineno-8-26 name=__codelineno-8-26></a><span class=w>                </span><span class=nx>currentWord</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>next_word</span><span class=p>;</span>
</span><span id=__span-8-27><a href=#__codelineno-8-27 id=__codelineno-8-27 name=__codelineno-8-27></a><span class=w>                </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>'current-word'</span><span class=p>).</span><span class=nx>textContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`当前单词：</span><span class=si>${</span><span class=nx>currentWord</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-8-28><a href=#__codelineno-8-28 id=__codelineno-8-28 name=__codelineno-8-28></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-8-29><a href=#__codelineno-8-29 id=__codelineno-8-29 name=__codelineno-8-29></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-30><a href=#__codelineno-8-30 id=__codelineno-8-30 name=__codelineno-8-30></a>
</span><span id=__span-8-31><a href=#__codelineno-8-31 id=__codelineno-8-31 name=__codelineno-8-31></a><span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>logout</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-32><a href=#__codelineno-8-32 id=__codelineno-8-32 name=__codelineno-8-32></a><span class=w>            </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>'/logout'</span><span class=p>)</span>
</span><span id=__span-8-33><a href=#__codelineno-8-33 id=__codelineno-8-33 name=__codelineno-8-33></a><span class=w>            </span><span class=p>.</span><span class=nx>then</span><span class=p>(()</span><span class=w> </span><span class=p>=></span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-34><a href=#__codelineno-8-34 id=__codelineno-8-34 name=__codelineno-8-34></a><span class=w>                </span><span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>'/login'</span><span class=p>;</span>
</span><span id=__span-8-35><a href=#__codelineno-8-35 id=__codelineno-8-35 name=__codelineno-8-35></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-8-36><a href=#__codelineno-8-36 id=__codelineno-8-36 name=__codelineno-8-36></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-37><a href=#__codelineno-8-37 id=__codelineno-8-37 name=__codelineno-8-37></a><span class=w>    </span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>></span>
</span><span id=__span-8-38><a href=#__codelineno-8-38 id=__codelineno-8-38 name=__codelineno-8-38></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-8-39><a href=#__codelineno-8-39 id=__codelineno-8-39 name=__codelineno-8-39></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>></span>
</span></code></pre></div></details><p>但这样，前端使用JavaScript发送POST请求到/process，后端需要处理JSON数据，并返回下一个单词。<p>因此，/process路由需要调整，接收JSON数据，并返回JSON响应。<p>修改后的/process路由：<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/process'</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>'POST'</span><span class=p>])</span>
</span><span id=__span-9-2><a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a><span class=k>def</span><span class=w> </span><span class=nf>process</span><span class=p>():</span>
</span><span id=__span-9-3><a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>):</span>
</span><span id=__span-9-4><a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a>        <span class=k>return</span> <span class=p>{</span><span class=s1>'error'</span><span class=p>:</span> <span class=s1>'未认证'</span><span class=p>},</span> <span class=mi>403</span>
</span><span id=__span-9-5><a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a>
</span><span id=__span-9-6><a href=#__codelineno-9-6 id=__codelineno-9-6 name=__codelineno-9-6></a>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>get_json</span><span class=p>()</span>
</span><span id=__span-9-7><a href=#__codelineno-9-7 id=__codelineno-9-7 name=__codelineno-9-7></a>    <span class=n>current_word</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'current_word'</span><span class=p>)</span>
</span><span id=__span-9-8><a href=#__codelineno-9-8 id=__codelineno-9-8 name=__codelineno-9-8></a>    <span class=n>remembered</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'remembered'</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span><span id=__span-9-9><a href=#__codelineno-9-9 id=__codelineno-9-9 name=__codelineno-9-9></a>
</span><span id=__span-9-10><a href=#__codelineno-9-10 id=__codelineno-9-10 name=__codelineno-9-10></a>    <span class=c1># 加载单词列表和历史</span>
</span><span id=__span-9-11><a href=#__codelineno-9-11 id=__codelineno-9-11 name=__codelineno-9-11></a>    <span class=n>word_list</span> <span class=o>=</span> <span class=n>load_words_from_json</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-9-12><a href=#__codelineno-9-12 id=__codelineno-9-12 name=__codelineno-9-12></a>    <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>word_list</span><span class=p>,</span> <span class=n>history_file</span><span class=o>=</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-9-13><a href=#__codelineno-9-13 id=__codelineno-9-13 name=__codelineno-9-13></a>    <span class=n>test</span><span class=o>.</span><span class=n>_update_history</span><span class=p>(</span><span class=n>current_word</span><span class=p>,</span> <span class=n>remembered</span><span class=p>)</span>
</span><span id=__span-9-14><a href=#__codelineno-9-14 id=__codelineno-9-14 name=__codelineno-9-14></a>    <span class=n>test</span><span class=o>.</span><span class=n>_save_history</span><span class=p>()</span>
</span><span id=__span-9-15><a href=#__codelineno-9-15 id=__codelineno-9-15 name=__codelineno-9-15></a>    
</span><span id=__span-9-16><a href=#__codelineno-9-16 id=__codelineno-9-16 name=__codelineno-9-16></a>    <span class=c1># 获取下一个单词</span>
</span><span id=__span-9-17><a href=#__codelineno-9-17 id=__codelineno-9-17 name=__codelineno-9-17></a>    <span class=n>test</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>current_word</span>
</span><span id=__span-9-18><a href=#__codelineno-9-18 id=__codelineno-9-18 name=__codelineno-9-18></a>    <span class=n>next_word</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>get_next_word</span><span class=p>()</span>
</span><span id=__span-9-19><a href=#__codelineno-9-19 id=__codelineno-9-19 name=__codelineno-9-19></a>    <span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>]</span> <span class=o>=</span> <span class=n>next_word</span>
</span><span id=__span-9-20><a href=#__codelineno-9-20 id=__codelineno-9-20 name=__codelineno-9-20></a>    <span class=k>return</span> <span class=p>{</span><span class=s1>'next_word'</span><span class=p>:</span> <span class=n>next_word</span><span class=p>}</span>
</span></code></pre></div></details><p>同时，index路由在初始加载时，显示当前单词：<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/'</span><span class=p>)</span>
</span><span id=__span-10-2><a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a><span class=k>def</span><span class=w> </span><span class=nf>index</span><span class=p>():</span>
</span><span id=__span-10-3><a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>):</span>
</span><span id=__span-10-4><a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>))</span>
</span><span id=__span-10-5><a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a>
</span><span id=__span-10-6><a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a>    <span class=n>word_list</span> <span class=o>=</span> <span class=n>load_words_from_json</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-10-7><a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a>    <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>word_list</span><span class=p>,</span> <span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-10-8><a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a>    <span class=n>last_word</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'last_word'</span><span class=p>)</span>
</span><span id=__span-10-9><a href=#__codelineno-10-9 id=__codelineno-10-9 name=__codelineno-10-9></a>    <span class=n>test</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>last_word</span>
</span><span id=__span-10-10><a href=#__codelineno-10-10 id=__codelineno-10-10 name=__codelineno-10-10></a>    <span class=n>next_word</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>get_next_word</span><span class=p>()</span>
</span><span id=__span-10-11><a href=#__codelineno-10-11 id=__codelineno-10-11 name=__codelineno-10-11></a>    <span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>]</span> <span class=o>=</span> <span class=n>next_word</span>
</span><span id=__span-10-12><a href=#__codelineno-10-12 id=__codelineno-10-12 name=__codelineno-10-12></a>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>'index.html'</span><span class=p>,</span> <span class=n>current_word</span><span class=o>=</span><span class=n>next_word</span><span class=p>)</span>
</span></code></pre></div></details><p>但这样，每次用户访问主页时，会生成一个新的单词，覆盖之前的last_word。这可能与用户操作流程不符，因为用户可能在主页加载时生成一个新单词，但尚未进行操作。<p>因此，可能需要在用户访问主页时，显示当前的last_word（如果有），否则生成新单词。或者在用户第一次访问时生成一个单词，之后每次操作更新。<p>或者，初始时没有单词，用户需要点击“开始”按钮，但这样会增加复杂度。可能更好的方式是在用户登录后，立即显示第一个单词，用户操作后更新。<p>但根据原程序的逻辑，每次循环显示一个单词，用户选择后立即显示下一个。因此，在Web应用中，初始加载时显示第一个单词，用户操作后，通过AJAX获取下一个。<p>因此，index路由可能不需要生成下一个单词，而是显示一个初始单词或等待用户开始。或者，在用户访问主页时，如果session中没有last_word，则生成一个，否则继续。<p>这可能需要调整：<p>在index路由中：<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/'</span><span class=p>)</span>
</span><span id=__span-11-2><a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a><span class=k>def</span><span class=w> </span><span class=nf>index</span><span class=p>():</span>
</span><span id=__span-11-3><a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>):</span>
</span><span id=__span-11-4><a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>))</span>
</span><span id=__span-11-5><a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a>
</span><span id=__span-11-6><a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a>    <span class=c1># 如果session中没有last_word，生成初始单词</span>
</span><span id=__span-11-7><a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a>    <span class=k>if</span> <span class=s1>'last_word'</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-11-8><a href=#__codelineno-11-8 id=__codelineno-11-8 name=__codelineno-11-8></a>        <span class=n>word_list</span> <span class=o>=</span> <span class=n>load_words_from_json</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-11-9><a href=#__codelineno-11-9 id=__codelineno-11-9 name=__codelineno-11-9></a>        <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>word_list</span><span class=p>,</span> <span class=s1>'history.json'</span><span class=p>)</span>
</span><span id=__span-11-10><a href=#__codelineno-11-10 id=__codelineno-11-10 name=__codelineno-11-10></a>        <span class=n>next_word</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>get_next_word</span><span class=p>()</span>
</span><span id=__span-11-11><a href=#__codelineno-11-11 id=__codelineno-11-11 name=__codelineno-11-11></a>        <span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>]</span> <span class=o>=</span> <span class=n>next_word</span>
</span><span id=__span-11-12><a href=#__codelineno-11-12 id=__codelineno-11-12 name=__codelineno-11-12></a>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>'index.html'</span><span class=p>,</span> <span class=n>current_word</span><span class=o>=</span><span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>])</span>
</span></code></pre></div></details><p>但这样，每次用户访问主页时，会显示session中的last_word，可能是之前操作后的结果。当用户第一次登录时，生成一个新的单词。<p>当用户点击“记得”或“忘记”时，发送当前单词到后端，后端处理，生成下一个单词，保存到session，并返回给前端更新显示。<p>这可能更合理，因为用户的操作会触发下一个单词的生成。<p>因此，修改后的index.html中的JavaScript部分：<p>在页面加载时，显示当前的单词：<div class="language-javascript highlight"><pre><span></span><code><span id=__span-12-1><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a><span class=nx>currentWord</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>"{{ current_word }}"</span><span class=p>;</span>
</span></code></pre></div><p>当用户点击按钮时，发送当前单词和操作到后端，后端处理，返回下一个单词，并更新currentWord变量。<p>这样，每次操作后，当前单词更新为下一个。<p>同时，在index路由中，如果session中有last_word，就显示它，否则生成初始单词。<p>但需要注意，当用户第一次登录时，session中没有last_word，所以需要生成一个初始单词，并存入session。<p>综上，整个流程大致如下：<ol><li><p>用户登录后，进入主页。</p><li><p>如果session中有last_word，显示它；否则生成初始单词，存入session。</p><li><p>用户点击“记得”或“忘记”，发送当前单词和操作到后端。</p><li><p>后端更新历史记录，生成下一个单词，存入session，返回下一个单词。</p><li><p>前端更新显示的单词。</p></ol><p>现在，测试这个流程是否正确：<p>例如，用户第一次登录，session中没有last_word，因此生成初始单词A，存入session，并显示A。<p>用户点击“记得”，发送A和remembered=True。后端处理，更新A的历史记录，生成下一个单词B，存入session，返回B。前端显示B。<p>这样循环下去。<p>但可能存在问题：当用户连续点击多次，导致多个请求同时处理，可能导致session中的last_word被覆盖。例如，用户点击“记得”后，前端尚未收到响应，又点击一次，可能导致竞态条件。但由于是个人使用，且操作频率不高，可以暂时忽略这个问题。<p>此外，文件锁的问题：当多个请求同时读写history.json文件时，可能导致数据损坏。因此，在保存历史记录时，需要确保文件操作的原子性。可以引入文件锁，例如使用fcntl.flock在写入时加锁，但需要注意跨平台兼容性。<p>在Python中，可以使用如下方式加锁：<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a><span class=kn>import</span><span class=w> </span><span class=nn>fcntl</span>
</span><span id=__span-13-2><a href=#__codelineno-13-2 id=__codelineno-13-2 name=__codelineno-13-2></a>
</span><span id=__span-13-3><a href=#__codelineno-13-3 id=__codelineno-13-3 name=__codelineno-13-3></a><span class=k>def</span><span class=w> </span><span class=nf>_save_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-13-4><a href=#__codelineno-13-4 id=__codelineno-13-4 name=__codelineno-13-4></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>,</span> <span class=s1>'w'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-13-5><a href=#__codelineno-13-5 id=__codelineno-13-5 name=__codelineno-13-5></a>        <span class=n>fcntl</span><span class=o>.</span><span class=n>flock</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>fcntl</span><span class=o>.</span><span class=n>LOCK_EX</span><span class=p>)</span>
</span><span id=__span-13-6><a href=#__codelineno-13-6 id=__codelineno-13-6 name=__codelineno-13-6></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span><span id=__span-13-7><a href=#__codelineno-13-7 id=__codelineno-13-7 name=__codelineno-13-7></a>        <span class=n>fcntl</span><span class=o>.</span><span class=n>flock</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>fcntl</span><span class=o>.</span><span class=n>LOCK_UN</span><span class=p>)</span>
</span></code></pre></div></details><p>但Windows系统不支持fcntl，可能需要使用其他方式。或者，使用第三方库如portalocker。<p>或者，在写入文件时，使用临时文件，然后原子替换原文件，以避免数据损坏。<p>例如：<details class=quote><p><summary>展开查看代码</summary></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a><span class=k>def</span><span class=w> </span><span class=nf>_save_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-14-2><a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a>    <span class=n>temp_file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=o>.</span><span class=n>with_suffix</span><span class=p>(</span><span class=s1>'.tmp'</span><span class=p>)</span>
</span><span id=__span-14-3><a href=#__codelineno-14-3 id=__codelineno-14-3 name=__codelineno-14-3></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>temp_file</span><span class=p>,</span> <span class=s1>'w'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-14-4><a href=#__codelineno-14-4 id=__codelineno-14-4 name=__codelineno-14-4></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span><span id=__span-14-5><a href=#__codelineno-14-5 id=__codelineno-14-5 name=__codelineno-14-5></a>    <span class=n>temp_file</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>)</span>
</span></code></pre></div></details><p>这种方法在大多数操作系统上是原子的，但可能不适用于Windows。需要根据部署环境来处理。<p>假设部署在Linux服务器上，使用原子替换是可行的。<p>因此，在_save_history方法中，修改保存逻辑，确保写入的原子性。<p>这可能需要在原WordMemoryTest类中进行调整。<p>此外，在Web应用中，每次处理用户请求时，都会加载历史记录，这可能导致性能问题，但考虑到是个人使用，数据量不大，可以接受。<p>最后，部署到服务器：<p>用户需要安装Flask、Gunicorn等库，配置Nginx作为反向代理，设置静态文件路径，配置SSL等。可以提供简单的部署步骤，例如：<ol><li><p>在服务器上安装Python和必要的依赖。</p><li><p>使用Gunicorn运行应用：gunicorn -w 4 app:app</p><li><p>配置Nginx将请求代理到Gunicorn。</p><li><p>设置环境变量或配置文件中的密码。</p></ol><p>总结需要修改的地方：<ol><li><p>将原命令行程序转换为Flask Web应用。</p><li><p>添加登录验证。</p><li><p>调整WordMemoryTest类，使其适合在无状态的Web环境中使用，通过会话保存last_word。</p><li><p>实现AJAX交互的前端。</p><li><p>处理文件读写的并发安全。</p><li><p>提供部署指南。</p></ol><p>现在，编写具体的代码示例，包括上述调整。</blockquote></details> <p>根据你的需求，我将提供一个基于Flask的Web应用解决方案。以下是详细的步骤和代码：</p> <p><h3>第一步：安装必要依赖</h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>pip<span class=w> </span>install<span class=w> </span>flask<span class=w> </span>python-dotenv<span class=w> </span>gunicorn
</span></code></pre></div> <p><h3>第二步：项目结构</h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a>/word-memory-web
</span><span id=__span-16-2><a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a>  ├── app.py
</span><span id=__span-16-3><a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a>  ├── config.py
</span><span id=__span-16-4><a href=#__codelineno-16-4 id=__codelineno-16-4 name=__codelineno-16-4></a>  ├── .env
</span><span id=__span-16-5><a href=#__codelineno-16-5 id=__codelineno-16-5 name=__codelineno-16-5></a>  ├── requirements.txt
</span><span id=__span-16-6><a href=#__codelineno-16-6 id=__codelineno-16-6 name=__codelineno-16-6></a>  ├── templates/
</span><span id=__span-16-7><a href=#__codelineno-16-7 id=__codelineno-16-7 name=__codelineno-16-7></a>  │   ├── index.html
</span><span id=__span-16-8><a href=#__codelineno-16-8 id=__codelineno-16-8 name=__codelineno-16-8></a>  │   └── login.html
</span><span id=__span-16-9><a href=#__codelineno-16-9 id=__codelineno-16-9 name=__codelineno-16-9></a>  └── history.json（自动生成）
</span></code></pre></div> <p><h3>第三步：实现代码</h3> <ol><li><p><strong>app.py</strong></p> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-17-1>  1</a></span>
<span class=normal><a href=#__codelineno-17-2>  2</a></span>
<span class=normal><a href=#__codelineno-17-3>  3</a></span>
<span class=normal><a href=#__codelineno-17-4>  4</a></span>
<span class=normal><a href=#__codelineno-17-5>  5</a></span>
<span class=normal><a href=#__codelineno-17-6>  6</a></span>
<span class=normal><a href=#__codelineno-17-7>  7</a></span>
<span class=normal><a href=#__codelineno-17-8>  8</a></span>
<span class=normal><a href=#__codelineno-17-9>  9</a></span>
<span class=normal><a href=#__codelineno-17-10> 10</a></span>
<span class=normal><a href=#__codelineno-17-11> 11</a></span>
<span class=normal><a href=#__codelineno-17-12> 12</a></span>
<span class=normal><a href=#__codelineno-17-13> 13</a></span>
<span class=normal><a href=#__codelineno-17-14> 14</a></span>
<span class=normal><a href=#__codelineno-17-15> 15</a></span>
<span class=normal><a href=#__codelineno-17-16> 16</a></span>
<span class=normal><a href=#__codelineno-17-17> 17</a></span>
<span class=normal><a href=#__codelineno-17-18> 18</a></span>
<span class=normal><a href=#__codelineno-17-19> 19</a></span>
<span class=normal><a href=#__codelineno-17-20> 20</a></span>
<span class=normal><a href=#__codelineno-17-21> 21</a></span>
<span class=normal><a href=#__codelineno-17-22> 22</a></span>
<span class=normal><a href=#__codelineno-17-23> 23</a></span>
<span class=normal><a href=#__codelineno-17-24> 24</a></span>
<span class=normal><a href=#__codelineno-17-25> 25</a></span>
<span class=normal><a href=#__codelineno-17-26> 26</a></span>
<span class=normal><a href=#__codelineno-17-27> 27</a></span>
<span class=normal><a href=#__codelineno-17-28> 28</a></span>
<span class=normal><a href=#__codelineno-17-29> 29</a></span>
<span class=normal><a href=#__codelineno-17-30> 30</a></span>
<span class=normal><a href=#__codelineno-17-31> 31</a></span>
<span class=normal><a href=#__codelineno-17-32> 32</a></span>
<span class=normal><a href=#__codelineno-17-33> 33</a></span>
<span class=normal><a href=#__codelineno-17-34> 34</a></span>
<span class=normal><a href=#__codelineno-17-35> 35</a></span>
<span class=normal><a href=#__codelineno-17-36> 36</a></span>
<span class=normal><a href=#__codelineno-17-37> 37</a></span>
<span class=normal><a href=#__codelineno-17-38> 38</a></span>
<span class=normal><a href=#__codelineno-17-39> 39</a></span>
<span class=normal><a href=#__codelineno-17-40> 40</a></span>
<span class=normal><a href=#__codelineno-17-41> 41</a></span>
<span class=normal><a href=#__codelineno-17-42> 42</a></span>
<span class=normal><a href=#__codelineno-17-43> 43</a></span>
<span class=normal><a href=#__codelineno-17-44> 44</a></span>
<span class=normal><a href=#__codelineno-17-45> 45</a></span>
<span class=normal><a href=#__codelineno-17-46> 46</a></span>
<span class=normal><a href=#__codelineno-17-47> 47</a></span>
<span class=normal><a href=#__codelineno-17-48> 48</a></span>
<span class=normal><a href=#__codelineno-17-49> 49</a></span>
<span class=normal><a href=#__codelineno-17-50> 50</a></span>
<span class=normal><a href=#__codelineno-17-51> 51</a></span>
<span class=normal><a href=#__codelineno-17-52> 52</a></span>
<span class=normal><a href=#__codelineno-17-53> 53</a></span>
<span class=normal><a href=#__codelineno-17-54> 54</a></span>
<span class=normal><a href=#__codelineno-17-55> 55</a></span>
<span class=normal><a href=#__codelineno-17-56> 56</a></span>
<span class=normal><a href=#__codelineno-17-57> 57</a></span>
<span class=normal><a href=#__codelineno-17-58> 58</a></span>
<span class=normal><a href=#__codelineno-17-59> 59</a></span>
<span class=normal><a href=#__codelineno-17-60> 60</a></span>
<span class=normal><a href=#__codelineno-17-61> 61</a></span>
<span class=normal><a href=#__codelineno-17-62> 62</a></span>
<span class=normal><a href=#__codelineno-17-63> 63</a></span>
<span class=normal><a href=#__codelineno-17-64> 64</a></span>
<span class=normal><a href=#__codelineno-17-65> 65</a></span>
<span class=normal><a href=#__codelineno-17-66> 66</a></span>
<span class=normal><a href=#__codelineno-17-67> 67</a></span>
<span class=normal><a href=#__codelineno-17-68> 68</a></span>
<span class=normal><a href=#__codelineno-17-69> 69</a></span>
<span class=normal><a href=#__codelineno-17-70> 70</a></span>
<span class=normal><a href=#__codelineno-17-71> 71</a></span>
<span class=normal><a href=#__codelineno-17-72> 72</a></span>
<span class=normal><a href=#__codelineno-17-73> 73</a></span>
<span class=normal><a href=#__codelineno-17-74> 74</a></span>
<span class=normal><a href=#__codelineno-17-75> 75</a></span>
<span class=normal><a href=#__codelineno-17-76> 76</a></span>
<span class=normal><a href=#__codelineno-17-77> 77</a></span>
<span class=normal><a href=#__codelineno-17-78> 78</a></span>
<span class=normal><a href=#__codelineno-17-79> 79</a></span>
<span class=normal><a href=#__codelineno-17-80> 80</a></span>
<span class=normal><a href=#__codelineno-17-81> 81</a></span>
<span class=normal><a href=#__codelineno-17-82> 82</a></span>
<span class=normal><a href=#__codelineno-17-83> 83</a></span>
<span class=normal><a href=#__codelineno-17-84> 84</a></span>
<span class=normal><a href=#__codelineno-17-85> 85</a></span>
<span class=normal><a href=#__codelineno-17-86> 86</a></span>
<span class=normal><a href=#__codelineno-17-87> 87</a></span>
<span class=normal><a href=#__codelineno-17-88> 88</a></span>
<span class=normal><a href=#__codelineno-17-89> 89</a></span>
<span class=normal><a href=#__codelineno-17-90> 90</a></span>
<span class=normal><a href=#__codelineno-17-91> 91</a></span>
<span class=normal><a href=#__codelineno-17-92> 92</a></span>
<span class=normal><a href=#__codelineno-17-93> 93</a></span>
<span class=normal><a href=#__codelineno-17-94> 94</a></span>
<span class=normal><a href=#__codelineno-17-95> 95</a></span>
<span class=normal><a href=#__codelineno-17-96> 96</a></span>
<span class=normal><a href=#__codelineno-17-97> 97</a></span>
<span class=normal><a href=#__codelineno-17-98> 98</a></span>
<span class=normal><a href=#__codelineno-17-99> 99</a></span>
<span class=normal><a href=#__codelineno-17-100>100</a></span>
<span class=normal><a href=#__codelineno-17-101>101</a></span>
<span class=normal><a href=#__codelineno-17-102>102</a></span>
<span class=normal><a href=#__codelineno-17-103>103</a></span>
<span class=normal><a href=#__codelineno-17-104>104</a></span>
<span class=normal><a href=#__codelineno-17-105>105</a></span>
<span class=normal><a href=#__codelineno-17-106>106</a></span></pre></div><td class=code><div><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1></a><span class=kn>from</span><span class=w> </span><span class=nn>flask</span><span class=w> </span><span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>session</span><span class=p>,</span> <span class=n>redirect</span><span class=p>,</span> <span class=n>url_for</span><span class=p>,</span> <span class=n>jsonify</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3></a><span class=kn>import</span><span class=w> </span><span class=nn>random</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6></a><span class=kn>from</span><span class=w> </span><span class=nn>dotenv</span><span class=w> </span><span class=kn>import</span> <span class=n>load_dotenv</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7></a>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8></a><span class=n>load_dotenv</span><span class=p>()</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9></a>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10></a><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11></a><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>'SECRET_KEY'</span><span class=p>,</span> <span class=s1>'dev-secret'</span><span class=p>)</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12></a><span class=n>PASSWORD</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>'APP_PASSWORD'</span><span class=p>,</span> <span class=s1>'default-password'</span><span class=p>)</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13></a>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14></a><span class=k>class</span><span class=w> </span><span class=nc>WordMemoryTest</span><span class=p>:</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>word_list</span><span class=p>,</span> <span class=n>history_file</span><span class=o>=</span><span class=s1>'history.json'</span><span class=p>):</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16></a>        <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=o>=</span> <span class=n>word_list</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>history_file</span><span class=p>)</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_load_history</span><span class=p>()</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20></a>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21></a>    <span class=k>def</span><span class=w> </span><span class=nf>_load_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>,</span> <span class=s1>'r'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24></a>                <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span> <span class=ow>or</span> <span class=p>{}</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25></a>        <span class=k>return</span> <span class=p>{}</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26></a>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>_save_history</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28></a>        <span class=n>temp_file</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=o>.</span><span class=n>with_suffix</span><span class=p>(</span><span class=s1>'.tmp'</span><span class=p>)</span>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>temp_file</span><span class=p>,</span> <span class=s1>'w'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31></a>        <span class=n>temp_file</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>history_file</span><span class=p>)</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32></a>
</span><span id=__span-17-33><a id=__codelineno-17-33 name=__codelineno-17-33></a>    <span class=k>def</span><span class=w> </span><span class=nf>_update_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>word</span><span class=p>,</span> <span class=n>remembered</span><span class=p>):</span>
</span><span id=__span-17-34><a id=__codelineno-17-34 name=__codelineno-17-34></a>        <span class=k>if</span> <span class=n>word</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>:</span>
</span><span id=__span-17-35><a id=__codelineno-17-35 name=__codelineno-17-35></a>            <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>
</span><span id=__span-17-36><a id=__codelineno-17-36 name=__codelineno-17-36></a>        <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-17-37><a id=__codelineno-17-37 name=__codelineno-17-37></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>remembered</span><span class=p>:</span>
</span><span id=__span-17-38><a id=__codelineno-17-38 name=__codelineno-17-38></a>            <span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=p>[</span><span class=n>word</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-17-39><a id=__codelineno-17-39 name=__codelineno-17-39></a>
</span><span id=__span-17-40><a id=__codelineno-17-40 name=__codelineno-17-40></a>    <span class=k>def</span><span class=w> </span><span class=nf>_get_weights</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-41><a id=__codelineno-17-41 name=__codelineno-17-41></a>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span><span class=n>w</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=k>if</span> <span class=n>w</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span><span class=p>]</span>
</span><span id=__span-17-42><a id=__codelineno-17-42 name=__codelineno-17-42></a>        <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>history</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>])[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>candidates</span><span class=p>]</span>
</span><span id=__span-17-43><a id=__codelineno-17-43 name=__codelineno-17-43></a>
</span><span id=__span-17-44><a id=__codelineno-17-44 name=__codelineno-17-44></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_next_word</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-45><a id=__codelineno-17-45 name=__codelineno-17-45></a>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span><span class=n>w</span> <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span> <span class=k>if</span> <span class=n>w</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span><span class=p>]</span>
</span><span id=__span-17-46><a id=__codelineno-17-46 name=__codelineno-17-46></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>candidates</span><span class=p>:</span>
</span><span id=__span-17-47><a id=__codelineno-17-47 name=__codelineno-17-47></a>            <span class=n>candidates</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>word_list</span>
</span><span id=__span-17-48><a id=__codelineno-17-48 name=__codelineno-17-48></a>        <span class=n>weights</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_weights</span><span class=p>()</span>
</span><span id=__span-17-49><a id=__codelineno-17-49 name=__codelineno-17-49></a>        <span class=n>chosen</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choices</span><span class=p>(</span><span class=n>candidates</span><span class=p>,</span> <span class=n>weights</span><span class=o>=</span><span class=n>weights</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-17-50><a id=__codelineno-17-50 name=__codelineno-17-50></a>        <span class=bp>self</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>chosen</span>
</span><span id=__span-17-51><a id=__codelineno-17-51 name=__codelineno-17-51></a>        <span class=k>return</span> <span class=n>chosen</span>
</span><span id=__span-17-52><a id=__codelineno-17-52 name=__codelineno-17-52></a>
</span><span id=__span-17-53><a id=__codelineno-17-53 name=__codelineno-17-53></a><span class=k>def</span><span class=w> </span><span class=nf>load_words_from_json</span><span class=p>():</span>
</span><span id=__span-17-54><a id=__codelineno-17-54 name=__codelineno-17-54></a>    <span class=k>if</span> <span class=n>Path</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-17-55><a id=__codelineno-17-55 name=__codelineno-17-55></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>'history.json'</span><span class=p>,</span> <span class=s1>'r'</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-17-56><a id=__codelineno-17-56 name=__codelineno-17-56></a>            <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span><span id=__span-17-57><a id=__codelineno-17-57 name=__codelineno-17-57></a>    <span class=k>return</span> <span class=p>[]</span>
</span><span id=__span-17-58><a id=__codelineno-17-58 name=__codelineno-17-58></a>
</span><span id=__span-17-59><a id=__codelineno-17-59 name=__codelineno-17-59></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/login'</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>'GET'</span><span class=p>,</span> <span class=s1>'POST'</span><span class=p>])</span>
</span><span id=__span-17-60><a id=__codelineno-17-60 name=__codelineno-17-60></a><span class=k>def</span><span class=w> </span><span class=nf>login</span><span class=p>():</span>
</span><span id=__span-17-61><a id=__codelineno-17-61 name=__codelineno-17-61></a>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>'POST'</span><span class=p>:</span>
</span><span id=__span-17-62><a id=__codelineno-17-62 name=__codelineno-17-62></a>        <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'password'</span><span class=p>)</span> <span class=o>==</span> <span class=n>PASSWORD</span><span class=p>:</span>
</span><span id=__span-17-63><a id=__codelineno-17-63 name=__codelineno-17-63></a>            <span class=n>session</span><span class=p>[</span><span class=s1>'authenticated'</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-17-64><a id=__codelineno-17-64 name=__codelineno-17-64></a>            <span class=n>session</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>'last_word'</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-17-65><a id=__codelineno-17-65 name=__codelineno-17-65></a>            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'index'</span><span class=p>))</span>
</span><span id=__span-17-66><a id=__codelineno-17-66 name=__codelineno-17-66></a>        <span class=k>return</span> <span class=s2>"密码错误"</span><span class=p>,</span> <span class=mi>401</span>
</span><span id=__span-17-67><a id=__codelineno-17-67 name=__codelineno-17-67></a>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>'login.html'</span><span class=p>)</span>
</span><span id=__span-17-68><a id=__codelineno-17-68 name=__codelineno-17-68></a>
</span><span id=__span-17-69><a id=__codelineno-17-69 name=__codelineno-17-69></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/logout'</span><span class=p>)</span>
</span><span id=__span-17-70><a id=__codelineno-17-70 name=__codelineno-17-70></a><span class=k>def</span><span class=w> </span><span class=nf>logout</span><span class=p>():</span>
</span><span id=__span-17-71><a id=__codelineno-17-71 name=__codelineno-17-71></a>    <span class=n>session</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-17-72><a id=__codelineno-17-72 name=__codelineno-17-72></a>    <span class=n>session</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>'last_word'</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-17-73><a id=__codelineno-17-73 name=__codelineno-17-73></a>    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>))</span>
</span><span id=__span-17-74><a id=__codelineno-17-74 name=__codelineno-17-74></a>
</span><span id=__span-17-75><a id=__codelineno-17-75 name=__codelineno-17-75></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/'</span><span class=p>)</span>
</span><span id=__span-17-76><a id=__codelineno-17-76 name=__codelineno-17-76></a><span class=k>def</span><span class=w> </span><span class=nf>index</span><span class=p>():</span>
</span><span id=__span-17-77><a id=__codelineno-17-77 name=__codelineno-17-77></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>):</span>
</span><span id=__span-17-78><a id=__codelineno-17-78 name=__codelineno-17-78></a>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>))</span>
</span><span id=__span-17-79><a id=__codelineno-17-79 name=__codelineno-17-79></a>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>'index.html'</span><span class=p>)</span>
</span><span id=__span-17-80><a id=__codelineno-17-80 name=__codelineno-17-80></a>
</span><span id=__span-17-81><a id=__codelineno-17-81 name=__codelineno-17-81></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/next'</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>'POST'</span><span class=p>])</span>
</span><span id=__span-17-82><a id=__codelineno-17-82 name=__codelineno-17-82></a><span class=k>def</span><span class=w> </span><span class=nf>next_word</span><span class=p>():</span>
</span><span id=__span-17-83><a id=__codelineno-17-83 name=__codelineno-17-83></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>):</span>
</span><span id=__span-17-84><a id=__codelineno-17-84 name=__codelineno-17-84></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>'error'</span><span class=p>:</span> <span class=s1>'Unauthorized'</span><span class=p>}),</span> <span class=mi>401</span>
</span><span id=__span-17-85><a id=__codelineno-17-85 name=__codelineno-17-85></a>
</span><span id=__span-17-86><a id=__codelineno-17-86 name=__codelineno-17-86></a>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>get_json</span><span class=p>()</span>
</span><span id=__span-17-87><a id=__codelineno-17-87 name=__codelineno-17-87></a>    <span class=n>current_word</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'current_word'</span><span class=p>)</span>
</span><span id=__span-17-88><a id=__codelineno-17-88 name=__codelineno-17-88></a>    <span class=n>remembered</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'remembered'</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span><span id=__span-17-89><a id=__codelineno-17-89 name=__codelineno-17-89></a>
</span><span id=__span-17-90><a id=__codelineno-17-90 name=__codelineno-17-90></a>    <span class=n>word_list</span> <span class=o>=</span> <span class=n>load_words_from_json</span><span class=p>()</span>
</span><span id=__span-17-91><a id=__codelineno-17-91 name=__codelineno-17-91></a>    <span class=n>test</span> <span class=o>=</span> <span class=n>WordMemoryTest</span><span class=p>(</span><span class=n>word_list</span><span class=p>)</span>
</span><span id=__span-17-92><a id=__codelineno-17-92 name=__codelineno-17-92></a>
</span><span id=__span-17-93><a id=__codelineno-17-93 name=__codelineno-17-93></a>    <span class=c1># 更新历史记录</span>
</span><span id=__span-17-94><a id=__codelineno-17-94 name=__codelineno-17-94></a>    <span class=k>if</span> <span class=n>current_word</span><span class=p>:</span>
</span><span id=__span-17-95><a id=__codelineno-17-95 name=__codelineno-17-95></a>        <span class=n>test</span><span class=o>.</span><span class=n>last_word</span> <span class=o>=</span> <span class=n>current_word</span>
</span><span id=__span-17-96><a id=__codelineno-17-96 name=__codelineno-17-96></a>        <span class=n>test</span><span class=o>.</span><span class=n>_update_history</span><span class=p>(</span><span class=n>current_word</span><span class=p>,</span> <span class=n>remembered</span><span class=p>)</span>
</span><span id=__span-17-97><a id=__codelineno-17-97 name=__codelineno-17-97></a>        <span class=n>test</span><span class=o>.</span><span class=n>_save_history</span><span class=p>()</span>
</span><span id=__span-17-98><a id=__codelineno-17-98 name=__codelineno-17-98></a>
</span><span id=__span-17-99><a id=__codelineno-17-99 name=__codelineno-17-99></a>    <span class=c1># 获取新单词</span>
</span><span id=__span-17-100><a id=__codelineno-17-100 name=__codelineno-17-100></a>    <span class=n>new_word</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>get_next_word</span><span class=p>()</span>
</span><span id=__span-17-101><a id=__codelineno-17-101 name=__codelineno-17-101></a>    <span class=n>session</span><span class=p>[</span><span class=s1>'last_word'</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_word</span>
</span><span id=__span-17-102><a id=__codelineno-17-102 name=__codelineno-17-102></a>
</span><span id=__span-17-103><a id=__codelineno-17-103 name=__codelineno-17-103></a>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>'word'</span><span class=p>:</span> <span class=n>new_word</span><span class=p>})</span>
</span><span id=__span-17-104><a id=__codelineno-17-104 name=__codelineno-17-104></a>
</span><span id=__span-17-105><a id=__codelineno-17-105 name=__codelineno-17-105></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>'__main__'</span><span class=p>:</span>
</span><span id=__span-17-106><a id=__codelineno-17-106 name=__codelineno-17-106></a>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div></table></div><li><p><strong>templates/login.html</strong></p> <div class="language-html highlight"><pre><span></span><code><span id=__span-18-1><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a><span class=cp>&lt;!DOCTYPE html></span>
</span><span id=__span-18-2><a href=#__codelineno-18-2 id=__codelineno-18-2 name=__codelineno-18-2></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>></span>
</span><span id=__span-18-3><a href=#__codelineno-18-3 id=__codelineno-18-3 name=__codelineno-18-3></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>></span>
</span><span id=__span-18-4><a href=#__codelineno-18-4 id=__codelineno-18-4 name=__codelineno-18-4></a>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>></span>单词记忆 - 登录<span class=p>&lt;/</span><span class=nt>title</span><span class=p>></span>
</span><span id=__span-18-5><a href=#__codelineno-18-5 id=__codelineno-18-5 name=__codelineno-18-5></a>    <span class=p>&lt;</span><span class=nt>style</span><span class=p>></span>
</span><span id=__span-18-6><a href=#__codelineno-18-6 id=__codelineno-18-6 name=__codelineno-18-6></a><span class=w>        </span><span class=nt>body</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>max-width</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>50</span><span class=kt>px</span><span class=w> </span><span class=kc>auto</span><span class=p>;</span><span class=w> </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-18-7><a href=#__codelineno-18-7 id=__codelineno-18-7 name=__codelineno-18-7></a><span class=w>        </span><span class=nt>input</span><span class=o>,</span><span class=w> </span><span class=nt>button</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>100</span><span class=kt>%</span><span class=p>;</span><span class=w> </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-18-8><a href=#__codelineno-18-8 id=__codelineno-18-8 name=__codelineno-18-8></a><span class=w>    </span><span class=p>&lt;/</span><span class=nt>style</span><span class=p>></span>
</span><span id=__span-18-9><a href=#__codelineno-18-9 id=__codelineno-18-9 name=__codelineno-18-9></a><span class=p>&lt;/</span><span class=nt>head</span><span class=p>></span>
</span><span id=__span-18-10><a href=#__codelineno-18-10 id=__codelineno-18-10 name=__codelineno-18-10></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-18-11><a href=#__codelineno-18-11 id=__codelineno-18-11 name=__codelineno-18-11></a>    <span class=p>&lt;</span><span class=nt>form</span> <span class=na>method</span><span class=o>=</span><span class=s>"post"</span><span class=p>></span>
</span><span id=__span-18-12><a href=#__codelineno-18-12 id=__codelineno-18-12 name=__codelineno-18-12></a>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>"password"</span> <span class=na>name</span><span class=o>=</span><span class=s>"password"</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>"输入密码"</span> <span class=na>required</span><span class=p>></span>
</span><span id=__span-18-13><a href=#__codelineno-18-13 id=__codelineno-18-13 name=__codelineno-18-13></a>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>"submit"</span><span class=p>></span>登录<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-18-14><a href=#__codelineno-18-14 id=__codelineno-18-14 name=__codelineno-18-14></a>    <span class=p>&lt;/</span><span class=nt>form</span><span class=p>></span>
</span><span id=__span-18-15><a href=#__codelineno-18-15 id=__codelineno-18-15 name=__codelineno-18-15></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-18-16><a href=#__codelineno-18-16 id=__codelineno-18-16 name=__codelineno-18-16></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>></span>
</span></code></pre></div><li><p><strong>templates/index.html</strong></p> <div class="language-html highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-19-1> 1</a></span>
<span class=normal><a href=#__codelineno-19-2> 2</a></span>
<span class=normal><a href=#__codelineno-19-3> 3</a></span>
<span class=normal><a href=#__codelineno-19-4> 4</a></span>
<span class=normal><a href=#__codelineno-19-5> 5</a></span>
<span class=normal><a href=#__codelineno-19-6> 6</a></span>
<span class=normal><a href=#__codelineno-19-7> 7</a></span>
<span class=normal><a href=#__codelineno-19-8> 8</a></span>
<span class=normal><a href=#__codelineno-19-9> 9</a></span>
<span class=normal><a href=#__codelineno-19-10>10</a></span>
<span class=normal><a href=#__codelineno-19-11>11</a></span>
<span class=normal><a href=#__codelineno-19-12>12</a></span>
<span class=normal><a href=#__codelineno-19-13>13</a></span>
<span class=normal><a href=#__codelineno-19-14>14</a></span>
<span class=normal><a href=#__codelineno-19-15>15</a></span>
<span class=normal><a href=#__codelineno-19-16>16</a></span>
<span class=normal><a href=#__codelineno-19-17>17</a></span>
<span class=normal><a href=#__codelineno-19-18>18</a></span>
<span class=normal><a href=#__codelineno-19-19>19</a></span>
<span class=normal><a href=#__codelineno-19-20>20</a></span>
<span class=normal><a href=#__codelineno-19-21>21</a></span>
<span class=normal><a href=#__codelineno-19-22>22</a></span>
<span class=normal><a href=#__codelineno-19-23>23</a></span>
<span class=normal><a href=#__codelineno-19-24>24</a></span>
<span class=normal><a href=#__codelineno-19-25>25</a></span>
<span class=normal><a href=#__codelineno-19-26>26</a></span>
<span class=normal><a href=#__codelineno-19-27>27</a></span>
<span class=normal><a href=#__codelineno-19-28>28</a></span>
<span class=normal><a href=#__codelineno-19-29>29</a></span>
<span class=normal><a href=#__codelineno-19-30>30</a></span>
<span class=normal><a href=#__codelineno-19-31>31</a></span>
<span class=normal><a href=#__codelineno-19-32>32</a></span>
<span class=normal><a href=#__codelineno-19-33>33</a></span>
<span class=normal><a href=#__codelineno-19-34>34</a></span>
<span class=normal><a href=#__codelineno-19-35>35</a></span>
<span class=normal><a href=#__codelineno-19-36>36</a></span>
<span class=normal><a href=#__codelineno-19-37>37</a></span>
<span class=normal><a href=#__codelineno-19-38>38</a></span>
<span class=normal><a href=#__codelineno-19-39>39</a></span>
<span class=normal><a href=#__codelineno-19-40>40</a></span>
<span class=normal><a href=#__codelineno-19-41>41</a></span>
<span class=normal><a href=#__codelineno-19-42>42</a></span>
<span class=normal><a href=#__codelineno-19-43>43</a></span>
<span class=normal><a href=#__codelineno-19-44>44</a></span>
<span class=normal><a href=#__codelineno-19-45>45</a></span>
<span class=normal><a href=#__codelineno-19-46>46</a></span>
<span class=normal><a href=#__codelineno-19-47>47</a></span>
<span class=normal><a href=#__codelineno-19-48>48</a></span>
<span class=normal><a href=#__codelineno-19-49>49</a></span></pre></div><td class=code><div><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1></a><span class=cp>&lt;!DOCTYPE html></span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>></span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>></span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4></a>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>></span>单词记忆训练<span class=p>&lt;/</span><span class=nt>title</span><span class=p>></span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5></a>    <span class=p>&lt;</span><span class=nt>style</span><span class=p>></span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6></a><span class=w>        </span><span class=nt>body</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>max-width</span><span class=p>:</span><span class=w> </span><span class=mi>600</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>50</span><span class=kt>px</span><span class=w> </span><span class=kc>auto</span><span class=p>;</span><span class=w> </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>text-align</span><span class=p>:</span><span class=w> </span><span class=kc>center</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7></a><span class=w>        </span><span class=p>#</span><span class=nn>word</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>font-size</span><span class=p>:</span><span class=w> </span><span class=mi>2</span><span class=kt>em</span><span class=p>;</span><span class=w> </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>border</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=kt>px</span><span class=w> </span><span class=kc>solid</span><span class=w> </span><span class=mh>#ccc</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8></a><span class=w>        </span><span class=nt>button</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>15</span><span class=kt>px</span><span class=w> </span><span class=mi>30</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>font-size</span><span class=p>:</span><span class=w> </span><span class=mf>1.1</span><span class=kt>em</span><span class=p>;</span><span class=w> </span><span class=k>cursor</span><span class=p>:</span><span class=w> </span><span class=kc>pointer</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9></a><span class=w>    </span><span class=p>&lt;/</span><span class=nt>style</span><span class=p>></span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10></a><span class=p>&lt;/</span><span class=nt>head</span><span class=p>></span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12></a>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>"word"</span><span class=p>></span>加载中...<span class=p>&lt;/</span><span class=nt>div</span><span class=p>></span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13></a>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"handleAction(true)"</span><span class=p>></span>记得 ✓<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14></a>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"handleAction(false)"</span><span class=p>></span>忘记 ✗<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15></a>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"location.href='/logout'"</span><span class=p>></span>退出<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16></a>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17></a>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>></span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=nx>currentWord</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19></a>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20></a><span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>updateWord</span><span class=p>(</span><span class=nx>word</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21></a><span class=w>            </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>'word'</span><span class=p>).</span><span class=nx>textContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>word</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>'加载中...'</span><span class=p>;</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23></a>
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24></a><span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>handleAction</span><span class=p>(</span><span class=nx>remembered</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25></a><span class=w>            </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>'/next'</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26></a><span class=w>                </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>'POST'</span><span class=p>,</span>
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27></a><span class=w>                </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s1>'Content-Type'</span><span class=o>:</span><span class=w> </span><span class=s1>'application/json'</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28></a><span class=w>                </span><span class=nx>body</span><span class=o>:</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29></a><span class=w>                    </span><span class=nx>current_word</span><span class=o>:</span><span class=w> </span><span class=nx>currentWord</span><span class=p>,</span>
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30></a><span class=w>                    </span><span class=nx>remembered</span><span class=o>:</span><span class=w> </span><span class=nx>remembered</span>
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31></a><span class=w>                </span><span class=p>})</span>
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32></a><span class=w>            </span><span class=p>})</span>
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33></a><span class=w>            </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span><span class=w> </span><span class=p>=></span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span><span id=__span-19-34><a id=__codelineno-19-34 name=__codelineno-19-34></a><span class=w>            </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>=></span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-35><a id=__codelineno-19-35 name=__codelineno-19-35></a><span class=w>                </span><span class=nx>currentWord</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>word</span><span class=p>;</span>
</span><span id=__span-19-36><a id=__codelineno-19-36 name=__codelineno-19-36></a><span class=w>                </span><span class=nx>updateWord</span><span class=p>(</span><span class=nx>currentWord</span><span class=p>);</span>
</span><span id=__span-19-37><a id=__codelineno-19-37 name=__codelineno-19-37></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-19-38><a id=__codelineno-19-38 name=__codelineno-19-38></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-19-39><a id=__codelineno-19-39 name=__codelineno-19-39></a>
</span><span id=__span-19-40><a id=__codelineno-19-40 name=__codelineno-19-40></a><span class=w>        </span><span class=c1>// 初始加载</span>
</span><span id=__span-19-41><a id=__codelineno-19-41 name=__codelineno-19-41></a><span class=w>        </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>'/next'</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>'POST'</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-19-42><a id=__codelineno-19-42 name=__codelineno-19-42></a><span class=w>            </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span><span class=w> </span><span class=p>=></span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span><span id=__span-19-43><a id=__codelineno-19-43 name=__codelineno-19-43></a><span class=w>            </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>=></span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-44><a id=__codelineno-19-44 name=__codelineno-19-44></a><span class=w>                </span><span class=nx>currentWord</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>word</span><span class=p>;</span>
</span><span id=__span-19-45><a id=__codelineno-19-45 name=__codelineno-19-45></a><span class=w>                </span><span class=nx>updateWord</span><span class=p>(</span><span class=nx>currentWord</span><span class=p>);</span>
</span><span id=__span-19-46><a id=__codelineno-19-46 name=__codelineno-19-46></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-19-47><a id=__codelineno-19-47 name=__codelineno-19-47></a><span class=w>    </span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>></span>
</span><span id=__span-19-48><a id=__codelineno-19-48 name=__codelineno-19-48></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>></span>
</span><span id=__span-19-49><a id=__codelineno-19-49 name=__codelineno-19-49></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>></span>
</span></code></pre></div></table></div><li><p><strong>config.py</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-20-1><a href=#__codelineno-20-1 id=__codelineno-20-1 name=__codelineno-20-1></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-20-2><a href=#__codelineno-20-2 id=__codelineno-20-2 name=__codelineno-20-2></a>
</span><span id=__span-20-3><a href=#__codelineno-20-3 id=__codelineno-20-3 name=__codelineno-20-3></a><span class=k>class</span><span class=w> </span><span class=nc>Config</span><span class=p>:</span>
</span><span id=__span-20-4><a href=#__codelineno-20-4 id=__codelineno-20-4 name=__codelineno-20-4></a>    <span class=n>SECRET_KEY</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>'SECRET_KEY'</span><span class=p>,</span> <span class=s1>'dev-secret-key'</span><span class=p>)</span>
</span><span id=__span-20-5><a href=#__codelineno-20-5 id=__codelineno-20-5 name=__codelineno-20-5></a>    <span class=n>APP_PASSWORD</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>'APP_PASSWORD'</span><span class=p>,</span> <span class=s1>'your-strong-password'</span><span class=p>)</span>
</span></code></pre></div><li><p><strong>.env</strong></p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-21-1><a href=#__codelineno-21-1 id=__codelineno-21-1 name=__codelineno-21-1></a><span class=na>SECRET_KEY</span><span class=o>=</span><span class=s>your-secret-key-here</span>
</span><span id=__span-21-2><a href=#__codelineno-21-2 id=__codelineno-21-2 name=__codelineno-21-2></a><span class=na>APP_PASSWORD</span><span class=o>=</span><span class=s>your-strong-password-here</span>
</span></code></pre></div><li><p><strong>requirements.txt</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-22-1><a href=#__codelineno-22-1 id=__codelineno-22-1 name=__codelineno-22-1></a>flask
</span><span id=__span-22-2><a href=#__codelineno-22-2 id=__codelineno-22-2 name=__codelineno-22-2></a>python-dotenv
</span><span id=__span-22-3><a href=#__codelineno-22-3 id=__codelineno-22-3 name=__codelineno-22-3></a>gunicorn
</span></code></pre></div></ol> <p><h3>第四步：部署指南</h3> <ol><li><p>服务器准备</p> <ul><li>安装Python和虚拟环境</ul> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a href=#__codelineno-23-1 id=__codelineno-23-1 name=__codelineno-23-1></a>sudo<span class=w> </span>apt<span class=w> </span>update
</span><span id=__span-23-2><a href=#__codelineno-23-2 id=__codelineno-23-2 name=__codelineno-23-2></a>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>python3-pip<span class=w> </span>python3-venv<span class=w> </span>nginx
</span></code></pre></div><li><p>上传项目文件到服务器</p><li><p>创建虚拟环境并安装依赖</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a href=#__codelineno-24-1 id=__codelineno-24-1 name=__codelineno-24-1></a>python3<span class=w> </span>-m<span class=w> </span>venv<span class=w> </span>venv
</span><span id=__span-24-2><a href=#__codelineno-24-2 id=__codelineno-24-2 name=__codelineno-24-2></a><span class=nb>source</span><span class=w> </span>venv/bin/activate
</span><span id=__span-24-3><a href=#__codelineno-24-3 id=__codelineno-24-3 name=__codelineno-24-3></a>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
</span></code></pre></div><li><p>配置Gunicorn</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a href=#__codelineno-25-1 id=__codelineno-25-1 name=__codelineno-25-1></a>gunicorn<span class=w> </span>-w<span class=w> </span><span class=m>4</span><span class=w> </span>app:app
</span></code></pre></div><li><p>配置Nginx</p> <p>创建 <code>/etc/nginx/sites-available/word-memory</code>：</p> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-26-1><a href=#__codelineno-26-1 id=__codelineno-26-1 name=__codelineno-26-1></a><span class=k>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-2><a href=#__codelineno-26-2 id=__codelineno-26-2 name=__codelineno-26-2></a><span class=w>    </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-26-3><a href=#__codelineno-26-3 id=__codelineno-26-3 name=__codelineno-26-3></a><span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>your-domain.com</span><span class=p>;</span>
</span><span id=__span-26-4><a href=#__codelineno-26-4 id=__codelineno-26-4 name=__codelineno-26-4></a>
</span><span id=__span-26-5><a href=#__codelineno-26-5 id=__codelineno-26-5 name=__codelineno-26-5></a><span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-6><a href=#__codelineno-26-6 id=__codelineno-26-6 name=__codelineno-26-6></a><span class=w>        </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://localhost:8000</span><span class=p>;</span>
</span><span id=__span-26-7><a href=#__codelineno-26-7 id=__codelineno-26-7 name=__codelineno-26-7></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-26-8><a href=#__codelineno-26-8 id=__codelineno-26-8 name=__codelineno-26-8></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-26-9><a href=#__codelineno-26-9 id=__codelineno-26-9 name=__codelineno-26-9></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span><span id=__span-26-10><a href=#__codelineno-26-10 id=__codelineno-26-10 name=__codelineno-26-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-26-11><a href=#__codelineno-26-11 id=__codelineno-26-11 name=__codelineno-26-11></a><span class=p>}</span>
</span></code></pre></div> <p>启用配置：</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a href=#__codelineno-27-1 id=__codelineno-27-1 name=__codelineno-27-1></a>sudo<span class=w> </span>ln<span class=w> </span>-s<span class=w> </span>/etc/nginx/sites-available/word-memory<span class=w> </span>/etc/nginx/sites-enabled/
</span><span id=__span-27-2><a href=#__codelineno-27-2 id=__codelineno-27-2 name=__codelineno-27-2></a>sudo<span class=w> </span>nginx<span class=w> </span>-t
</span><span id=__span-27-3><a href=#__codelineno-27-3 id=__codelineno-27-3 name=__codelineno-27-3></a>sudo<span class=w> </span>systemctl<span class=w> </span>reload<span class=w> </span>nginx
</span></code></pre></div><li><p>使用systemd服务（可选）</p> <p>创建 <code>/etc/systemd/system/word-memory.service</code>：</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-28-1><a href=#__codelineno-28-1 id=__codelineno-28-1 name=__codelineno-28-1></a><span class=k>[Unit]</span>
</span><span id=__span-28-2><a href=#__codelineno-28-2 id=__codelineno-28-2 name=__codelineno-28-2></a><span class=na>Description</span><span class=o>=</span><span class=s>Word Memory Service</span>
</span><span id=__span-28-3><a href=#__codelineno-28-3 id=__codelineno-28-3 name=__codelineno-28-3></a><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span><span id=__span-28-4><a href=#__codelineno-28-4 id=__codelineno-28-4 name=__codelineno-28-4></a>
</span><span id=__span-28-5><a href=#__codelineno-28-5 id=__codelineno-28-5 name=__codelineno-28-5></a><span class=k>[Service]</span>
</span><span id=__span-28-6><a href=#__codelineno-28-6 id=__codelineno-28-6 name=__codelineno-28-6></a><span class=na>User</span><span class=o>=</span><span class=s>your-user</span>
</span><span id=__span-28-7><a href=#__codelineno-28-7 id=__codelineno-28-7 name=__codelineno-28-7></a><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/path/to/word-memory-web</span>
</span><span id=__span-28-8><a href=#__codelineno-28-8 id=__codelineno-28-8 name=__codelineno-28-8></a><span class=na>Environment</span><span class=o>=</span><span class=s>"PATH=/path/to/venv/bin"</span>
</span><span id=__span-28-9><a href=#__codelineno-28-9 id=__codelineno-28-9 name=__codelineno-28-9></a><span class=na>ExecStart</span><span class=o>=</span><span class=s>/path/to/venv/bin/gunicorn -w 4 app:app</span>
</span><span id=__span-28-10><a href=#__codelineno-28-10 id=__codelineno-28-10 name=__codelineno-28-10></a>
</span><span id=__span-28-11><a href=#__codelineno-28-11 id=__codelineno-28-11 name=__codelineno-28-11></a><span class=k>[Install]</span>
</span><span id=__span-28-12><a href=#__codelineno-28-12 id=__codelineno-28-12 name=__codelineno-28-12></a><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></code></pre></div><li><p>启动服务</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a href=#__codelineno-29-1 id=__codelineno-29-1 name=__codelineno-29-1></a>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>word-memory
</span><span id=__span-29-2><a href=#__codelineno-29-2 id=__codelineno-29-2 name=__codelineno-29-2></a>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>word-memory
</span></code></pre></div></ol> <p><h3>第五步：使用说明</h3> <ol><li><p>访问 <code>http://your-domain.com/login</code></p><li><p>输入预设的密码</p><li><p>开始记忆训练</p><li><p>点击"记得"或"忘记"按钮进行训练</p><li><p>历史数据会自动保存到服务器的<code>history.json</code></p></ol> <p><h3>注意事项</h3> <ol><li><p>安全性增强建议：</p> <ul><li><p>使用HTTPS（可以使用Let's Encrypt免费证书）</p><li><p>定期更换密码</p><li><p>限制服务器访问IP</p><li><p>定期备份history.json文件</p></ul><li><p>功能扩展建议：</p> <ul><li><p>添加数据统计展示</p><li><p>支持多用户（需修改数据结构）</p><li><p>增加单词分类管理</p><li><p>实现自动同步备份</p></ul></ol> <p>这个解决方案实现了：</p> <ol><li><p>密码保护访问</p><li><p>响应式网页界面</p><li><p>与原始脚本兼容的数据存储</p><li><p>自动保存学习进度</p><li><p>服务器部署能力</p></ol> <p>你可以根据实际需求进一步调整样式和功能逻辑。</p></details><blockquote><p>没想到竟然这个问题让deepseek输出了那么久😂(一直持续输出了5 6分钟才结束)</blockquote><p>于是我将deepseek生成的代码按照它提供的项目结构新建成文件，并在本地运行，发现是能够运行的，并且在退出后，数据也能更新到 <code>history.json</code> 中。所以打算继续尝试将这个部署到服务器上。<details class=example open><summary>对话记录</summary> <p><strong>You</strong>:</p> <p>由于我没有别的域名可以拿来给这个web程序使用了，我想把这个网页部署在原有域名的一级目录下(例如：47.123.4.0/word-mem)，我具体应该怎么做呢？</p> <p> </p> <p><strong>DeepSeek</strong>:</p> <details class=quote><summary>已深度思考（用时 40 秒）</summary> <blockquote><p>好的，我现在需要帮助用户将他们的Flask应用部署到现有域名的一级目录下，比如47.123.4.0/word-mem。他们之前已经有一个Web应用在运行，现在想添加这个单词记忆应用到子目录中。我需要思考如何配置Nginx和Flask来支持这个设置。<p>首先，用户的原有的Nginx配置可能已经处理了主域名的请求，现在需要在同一个server块中添加一个location块来处理/word-mem路径的请求。这里的关键是配置Nginx将/word-mem的请求正确地反向代理到Gunicorn运行的Flask应用，同时处理静态文件路径的问题。<p>然后，Flask应用本身需要知道它是在一个子目录下运行的，否则生成的URL可能会错误地指向根路径而不是子目录。这通常通过设置APPLICATION_ROOT或使用ProxyFix中间件来解决。用户的应用使用url_for生成链接，所以必须确保这些链接都带有正确的前缀。<p>接下来，检查用户提供的代码，特别是app.py中的路由。原来的代码中的路由都是基于根路径的，比如@app.route('/')，当应用部署在子目录下时，这些路由实际上应该在/word-mem下访问。因此，可能需要调整Flask的配置，设置应用根路径，或者在Nginx层处理URL重写。<p>另外，静态文件的路径也需要考虑。虽然在这个应用中可能没有太多静态文件，除了可能的CSS和JS，但需要确保这些文件的路径正确。不过，根据用户提供的代码，他们可能主要使用模板，所以静态文件的问题可能不大，但需要确认。<p>接下来，用户的Nginx配置需要修改，添加一个location /word-mem/的块，将请求转发到后端的Gunicorn服务。这里需要注意的是使用proxy_pass的正确配置，以及处理路径中的斜杠，避免404错误。可能需要使用rewrite来去掉子目录前缀，或者确保Flask应用正确处理带前缀的请求。<p>然后，考虑Flask应用的WSGI配置。由于应用部署在子目录下，WSGI应用需要知道请求的根路径是/word-mem，而不是/。这可以通过设置SCRIPT_NAME环境变量来实现，或者在Gunicorn启动时传递参数。例如，使用--proxy-allow-from来处理代理头，或者使用中间件来调整WSGI环境中的SCRIPT_NAME。<p>可能还需要在Flask应用中配置APPLICATION_ROOT设置，这样url_for生成的URL会自动包含子目录前缀。不过，根据Flask的文档，APPLICATION_ROOT默认是'/'，需要设置为'/word-mem'，但这可能需要在应用工厂或配置中设置。<p>另外，用户提到的密码保护功能已经通过Flask的session和登录路由实现，这部分在子目录下应该不需要修改，只要URL生成正确，登录和注销的路由都能正确指向子目录下的路径。<p>最后，测试部署后的应用是否所有链接和AJAX请求都正确指向了子目录下的路径。例如，在index.html中的JavaScript发起的fetch请求应该是相对于子目录的，或者使用绝对路径，但如果在模板中使用url_for，应该会自动处理。<p>总结步骤应该是：<ol><li><p>修改Nginx配置，添加location /word-mem/块，配置proxy_pass到Gunicorn端口，并处理路径重写。</p><li><p>配置Flask应用，设置APPLICATION_ROOT为/word-mem，或者在启动时设置SCRIPT_NAME。</p><li><p>调整Gunicorn的启动参数，确保正确处理反向代理的头信息。</p><li><p>测试所有路由和静态资源，确保在子目录下正常工作。</p><li><p>处理可能出现的404或路径错误，检查Nginx日志和Flask日志进行调试。</p></ol><p>在实施过程中，可能会遇到问题，比如静态文件404，或者AJAX请求路径错误，需要逐步排查，确保所有URL都正确包含子目录前缀。同时，确保密码保护功能在子目录下仍然有效，session管理没有问题。</blockquote></details> <p>要将应用部署到现有域名的子目录（如 <code>http://47.123.4.0/word-mem</code>），需要进行以下关键配置：</p> <hr> <p><h3>一、Nginx 配置修改</h3> <p>修改服务器上的Nginx配置（假设原配置文件在 <code>/etc/nginx/sites-available/your-config</code>）：</p> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-30-1><a href=#__codelineno-30-1 id=__codelineno-30-1 name=__codelineno-30-1></a><span class=k>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-2><a href=#__codelineno-30-2 id=__codelineno-30-2 name=__codelineno-30-2></a><span class=w>    </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-30-3><a href=#__codelineno-30-3 id=__codelineno-30-3 name=__codelineno-30-3></a><span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=mi>47</span><span class=s>.123.4.0</span><span class=p>;</span>
</span><span id=__span-30-4><a href=#__codelineno-30-4 id=__codelineno-30-4 name=__codelineno-30-4></a>
</span><span id=__span-30-5><a href=#__codelineno-30-5 id=__codelineno-30-5 name=__codelineno-30-5></a><span class=w>    </span><span class=c1># 原有其他配置...</span>
</span><span id=__span-30-6><a href=#__codelineno-30-6 id=__codelineno-30-6 name=__codelineno-30-6></a>
</span><span id=__span-30-7><a href=#__codelineno-30-7 id=__codelineno-30-7 name=__codelineno-30-7></a><span class=w>    </span><span class=c1># 新增单词记忆应用配置</span>
</span><span id=__span-30-8><a href=#__codelineno-30-8 id=__codelineno-30-8 name=__codelineno-30-8></a><span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=s>/word-mem</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-9><a href=#__codelineno-30-9 id=__codelineno-30-9 name=__codelineno-30-9></a><span class=w>        </span><span class=c1># 处理路径前缀（关键配置）</span>
</span><span id=__span-30-10><a href=#__codelineno-30-10 id=__codelineno-30-10 name=__codelineno-30-10></a><span class=w>        </span><span class=kn>rewrite</span><span class=w> </span><span class=s>^/word-mem/?(.*)</span>$<span class=w> </span><span class=s>/</span><span class=nv>$1</span><span class=w> </span><span class=s>break</span><span class=p>;</span>
</span><span id=__span-30-11><a href=#__codelineno-30-11 id=__codelineno-30-11 name=__codelineno-30-11></a>
</span><span id=__span-30-12><a href=#__codelineno-30-12 id=__codelineno-30-12 name=__codelineno-30-12></a><span class=w>        </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://localhost:8000</span><span class=p>;</span><span class=w>  </span><span class=c1># 指向Gunicorn端口</span>
</span><span id=__span-30-13><a href=#__codelineno-30-13 id=__codelineno-30-13 name=__codelineno-30-13></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-30-14><a href=#__codelineno-30-14 id=__codelineno-30-14 name=__codelineno-30-14></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-30-15><a href=#__codelineno-30-15 id=__codelineno-30-15 name=__codelineno-30-15></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span><span id=__span-30-16><a href=#__codelineno-30-16 id=__codelineno-30-16 name=__codelineno-30-16></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Script-Name</span><span class=w> </span><span class=s>/word-mem</span><span class=p>;</span><span class=w>  </span><span class=c1># 关键头信息</span>
</span><span id=__span-30-17><a href=#__codelineno-30-17 id=__codelineno-30-17 name=__codelineno-30-17></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-30-18><a href=#__codelineno-30-18 id=__codelineno-30-18 name=__codelineno-30-18></a><span class=p>}</span>
</span></code></pre></div> <p>验证并重载配置：</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a href=#__codelineno-31-1 id=__codelineno-31-1 name=__codelineno-31-1></a>sudo<span class=w> </span>nginx<span class=w> </span>-t
</span><span id=__span-31-2><a href=#__codelineno-31-2 id=__codelineno-31-2 name=__codelineno-31-2></a>sudo<span class=w> </span>systemctl<span class=w> </span>reload<span class=w> </span>nginx
</span></code></pre></div> <hr> <p><h3>二、Flask 应用配置</h3> <p>修改 <code>app.py</code> 添加子目录支持：</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-32-1><a href=#__codelineno-32-1 id=__codelineno-32-1 name=__codelineno-32-1></a><span class=kn>from</span><span class=w> </span><span class=nn>flask</span><span class=w> </span><span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>url_for</span>
</span><span id=__span-32-2><a href=#__codelineno-32-2 id=__codelineno-32-2 name=__codelineno-32-2></a>
</span><span id=__span-32-3><a href=#__codelineno-32-3 id=__codelineno-32-3 name=__codelineno-32-3></a><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-32-4><a href=#__codelineno-32-4 id=__codelineno-32-4 name=__codelineno-32-4></a>
</span><span id=__span-32-5><a href=#__codelineno-32-5 id=__codelineno-32-5 name=__codelineno-32-5></a><span class=c1># 添加应用前缀中间件</span>
</span><span id=__span-32-6><a href=#__codelineno-32-6 id=__codelineno-32-6 name=__codelineno-32-6></a><span class=k>class</span><span class=w> </span><span class=nc>ReverseProxied</span><span class=p>:</span>
</span><span id=__span-32-7><a href=#__codelineno-32-7 id=__codelineno-32-7 name=__codelineno-32-7></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>app</span><span class=p>):</span>
</span><span id=__span-32-8><a href=#__codelineno-32-8 id=__codelineno-32-8 name=__codelineno-32-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>app</span> <span class=o>=</span> <span class=n>app</span>
</span><span id=__span-32-9><a href=#__codelineno-32-9 id=__codelineno-32-9 name=__codelineno-32-9></a>
</span><span id=__span-32-10><a href=#__codelineno-32-10 id=__codelineno-32-10 name=__codelineno-32-10></a>    <span class=k>def</span><span class=w> </span><span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>environ</span><span class=p>,</span> <span class=n>start_response</span><span class=p>):</span>
</span><span id=__span-32-11><a href=#__codelineno-32-11 id=__codelineno-32-11 name=__codelineno-32-11></a>        <span class=n>script_name</span> <span class=o>=</span> <span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'HTTP_X_SCRIPT_NAME'</span><span class=p>,</span> <span class=s1>''</span><span class=p>)</span>
</span><span id=__span-32-12><a href=#__codelineno-32-12 id=__codelineno-32-12 name=__codelineno-32-12></a>        <span class=k>if</span> <span class=n>script_name</span><span class=p>:</span>
</span><span id=__span-32-13><a href=#__codelineno-32-13 id=__codelineno-32-13 name=__codelineno-32-13></a>            <span class=n>environ</span><span class=p>[</span><span class=s1>'SCRIPT_NAME'</span><span class=p>]</span> <span class=o>=</span> <span class=n>script_name</span>
</span><span id=__span-32-14><a href=#__codelineno-32-14 id=__codelineno-32-14 name=__codelineno-32-14></a>            <span class=n>path_info</span> <span class=o>=</span> <span class=n>environ</span><span class=p>[</span><span class=s1>'PATH_INFO'</span><span class=p>]</span>
</span><span id=__span-32-15><a href=#__codelineno-32-15 id=__codelineno-32-15 name=__codelineno-32-15></a>            <span class=k>if</span> <span class=n>path_info</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>script_name</span><span class=p>):</span>
</span><span id=__span-32-16><a href=#__codelineno-32-16 id=__codelineno-32-16 name=__codelineno-32-16></a>                <span class=n>environ</span><span class=p>[</span><span class=s1>'PATH_INFO'</span><span class=p>]</span> <span class=o>=</span> <span class=n>path_info</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>script_name</span><span class=p>):]</span>
</span><span id=__span-32-17><a href=#__codelineno-32-17 id=__codelineno-32-17 name=__codelineno-32-17></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>app</span><span class=p>(</span><span class=n>environ</span><span class=p>,</span> <span class=n>start_response</span><span class=p>)</span>
</span><span id=__span-32-18><a href=#__codelineno-32-18 id=__codelineno-32-18 name=__codelineno-32-18></a>
</span><span id=__span-32-19><a href=#__codelineno-32-19 id=__codelineno-32-19 name=__codelineno-32-19></a><span class=n>app</span><span class=o>.</span><span class=n>wsgi_app</span> <span class=o>=</span> <span class=n>ReverseProxied</span><span class=p>(</span><span class=n>app</span><span class=o>.</span><span class=n>wsgi_app</span><span class=p>)</span>
</span></code></pre></div> <hr> <p><h3>三、Gunicorn 启动调整</h3> <p>使用以下命令启动服务（注意端口匹配）：</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-33-1><a href=#__codelineno-33-1 id=__codelineno-33-1 name=__codelineno-33-1></a>gunicorn<span class=w> </span>-w<span class=w> </span><span class=m>4</span><span class=w> </span>-b<span class=w> </span><span class=m>127</span>.0.0.1:8000<span class=w> </span>app:app
</span></code></pre></div> <hr> <p><h3>四、前端模板调整</h3> <p>修改 <code>templates/index.html</code> 中的JavaScript请求路径：</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-34-1><a href=#__codelineno-34-1 id=__codelineno-34-1 name=__codelineno-34-1></a><span class=c1>// 原代码</span>
</span><span id=__span-34-2><a href=#__codelineno-34-2 id=__codelineno-34-2 name=__codelineno-34-2></a><span class=nx>fetch</span><span class=p>(</span><span class=s1>'/next'</span><span class=p>,</span><span class=w> </span><span class=p>...)</span>
</span><span id=__span-34-3><a href=#__codelineno-34-3 id=__codelineno-34-3 name=__codelineno-34-3></a>
</span><span id=__span-34-4><a href=#__codelineno-34-4 id=__codelineno-34-4 name=__codelineno-34-4></a><span class=c1>// 修改为</span>
</span><span id=__span-34-5><a href=#__codelineno-34-5 id=__codelineno-34-5 name=__codelineno-34-5></a><span class=nx>fetch</span><span class=p>(</span><span class=s1>'/word-mem/next'</span><span class=p>,</span><span class=w> </span><span class=p>...)</span>
</span></code></pre></div> <p>或者使用动态路径（推荐）：</p> <div class="language-html highlight"><pre><span></span><code><span id=__span-35-1><a href=#__codelineno-35-1 id=__codelineno-35-1 name=__codelineno-35-1></a><span class=p>&lt;</span><span class=nt>script</span><span class=p>></span>
</span><span id=__span-35-2><a href=#__codelineno-35-2 id=__codelineno-35-2 name=__codelineno-35-2></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>BASE_PATH</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>'{{ url_for("index") }}'</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>'/'</span><span class=p>,</span><span class=s1>''</span><span class=p>);</span><span class=w>  </span><span class=c1>// 获取应用基础路径</span>
</span><span id=__span-35-3><a href=#__codelineno-35-3 id=__codelineno-35-3 name=__codelineno-35-3></a>
</span><span id=__span-35-4><a href=#__codelineno-35-4 id=__codelineno-35-4 name=__codelineno-35-4></a><span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleAction</span><span class=p>(</span><span class=nx>remembered</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-5><a href=#__codelineno-35-5 id=__codelineno-35-5 name=__codelineno-35-5></a><span class=w>        </span><span class=nx>fetch</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>BASE_PATH</span><span class=si>}</span><span class=sb>/next`</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 动态拼接路径</span>
</span><span id=__span-35-6><a href=#__codelineno-35-6 id=__codelineno-35-6 name=__codelineno-35-6></a><span class=w>            </span><span class=c1>// ...保持其他代码不变</span>
</span><span id=__span-35-7><a href=#__codelineno-35-7 id=__codelineno-35-7 name=__codelineno-35-7></a><span class=w>        </span><span class=p>})</span>
</span><span id=__span-35-8><a href=#__codelineno-35-8 id=__codelineno-35-8 name=__codelineno-35-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-9><a href=#__codelineno-35-9 id=__codelineno-35-9 name=__codelineno-35-9></a><span class=p>&lt;/</span><span class=nt>script</span><span class=p>></span>
</span></code></pre></div> <hr> <p><h3>五、验证部署</h3> <p>通过以下步骤测试：</p> <ol><li><p>访问 <code>http://47.123.4.0/word-mem/login</code></p><li><p>输入密码后应看到训练界面</p><li><p>点击按钮检查请求是否发送到正确路径：</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-36-1><a href=#__codelineno-36-1 id=__codelineno-36-1 name=__codelineno-36-1></a>正确请求路径示例：
</span><span id=__span-36-2><a href=#__codelineno-36-2 id=__codelineno-36-2 name=__codelineno-36-2></a>POST /word-mem/next
</span><span id=__span-36-3><a href=#__codelineno-36-3 id=__codelineno-36-3 name=__codelineno-36-3></a>GET /word-mem/logout
</span></code></pre></div></ol> <hr> <p><h3>六、常见问题排查</h3> <ol><li><p><strong>出现404错误</strong>：</p> <ul><li><p>检查Nginx的 <code>rewrite</code> 规则是否正确</p><li><p>查看Gunicorn日志：<code>journalctl -u word-memory.service</code></p><li><p>在Chrome开发者工具中检查请求路径</p></ul><li><p><strong>静态资源加载失败</strong>：</p> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-37-1><a href=#__codelineno-37-1 id=__codelineno-37-1 name=__codelineno-37-1></a><span class=k>location</span><span class=w> </span><span class=s>/word-mem/static</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-2><a href=#__codelineno-37-2 id=__codelineno-37-2 name=__codelineno-37-2></a><span class=w>    </span><span class=kn>alias</span><span class=w> </span><span class=s>/path/to/your/static/files</span><span class=p>;</span>
</span><span id=__span-37-3><a href=#__codelineno-37-3 id=__codelineno-37-3 name=__codelineno-37-3></a><span class=p>}</span>
</span></code></pre></div><li><p><strong>Session失效</strong>：</p> <ul><li><p>确保所有请求都携带正确的Cookie</p><li><p>检查Flask的 <code>SECRET_KEY</code> 配置</p></ul></ol> <hr> <p><h3>七、最终部署结构</h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-38-1><a href=#__codelineno-38-1 id=__codelineno-38-1 name=__codelineno-38-1></a>http://47.123.4.0
</span><span id=__span-38-2><a href=#__codelineno-38-2 id=__codelineno-38-2 name=__codelineno-38-2></a>├── / (原有应用)
</span><span id=__span-38-3><a href=#__codelineno-38-3 id=__codelineno-38-3 name=__codelineno-38-3></a>└── /word-mem (新增的单词记忆应用)
</span><span id=__span-38-4><a href=#__codelineno-38-4 id=__codelineno-38-4 name=__codelineno-38-4></a>    ├── /login
</span><span id=__span-38-5><a href=#__codelineno-38-5 id=__codelineno-38-5 name=__codelineno-38-5></a>    ├── /next
</span><span id=__span-38-6><a href=#__codelineno-38-6 id=__codelineno-38-6 name=__codelineno-38-6></a>    └── /logout
</span></code></pre></div> <p>通过以上配置，你的应用就可以通过子目录访问，且不会干扰原有网站的运行。如果需要HTTPS，只需在Nginx主配置中统一添加SSL证书即可。</p></details><p>在尝试和摸索中发现，由于我之前在服务器上安装的是宝塔面板，所以deepseek给出的部分步骤并不完全和我的情况相对应。<p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=auto href=../../../../images/word_mem_server_1.jpeg><img alt=word_mem_server_1 loading=lazy src=../../../../images/word_mem_server_1.jpeg></a><p>在宝塔面板中，需要在『网站』→『Python项目』中，点击『添加Python项目』。这里如果之前没有安装python(python3)需要先花几分钟安装python，安装好之后就可以添加Python项目了。<p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=auto href=../../../../images/word_mem_server_2.jpeg><img alt=word_mem_server_2 loading=lazy src=../../../../images/word_mem_server_2.jpeg></a><p>这里『启动命令』一栏需要填的是deepseek的回复中的<strong><em>Gunicorn 启动调整</em></strong>部分的命令<div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a href=#__codelineno-39-1 id=__codelineno-39-1 name=__codelineno-39-1></a>gunicorn<span class=w> </span>-w<span class=w> </span><span class=m>4</span><span class=w> </span>-b<span class=w> </span><span class=m>127</span>.0.0.1:8000<span class=w> </span>app:app
</span></code></pre></div><p>创建好项目之后，可能需要点击『终端』，在终端中<div class="language-bash highlight"><pre><span></span><code><span id=__span-40-1><a href=#__codelineno-40-1 id=__codelineno-40-1 name=__codelineno-40-1></a>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
</span></code></pre></div><blockquote><p>不知道python的依赖会不会自动安装</blockquote><p>再『启动』项目就好了。<details class=example open><summary>对话记录</summary> <p><strong>You</strong>:</p> <p>index.html中的“退出”按钮，如何动态退出到正确的地址？(现在是错误地返回到了/logout中)</p> <p> </p> <p><strong>DeepSeek</strong>:</p> <details class=quote><summary>已深度思考（用时 33 秒）</summary> <blockquote><p>好的，用户现在的问题是退出按钮的链接错误，原本的代码是直接跳转到/logout，但当应用部署在子目录下时，这个路径会变成/word-mem/logout，而原来的写法没有考虑子目录的情况，导致跳转到错误的地址。我需要帮他解决这个问题。<p>首先，我需要理解问题所在。原来的退出按钮使用的是硬编码的路径“/logout”，当应用部署在子目录下时，比如“/word-mem”，正确的退出路径应该是“/word-mem/logout”。但是目前的代码没有动态生成这个路径，所以需要修改。<p>用户使用的是Flask框架，Flask提供了url_for函数来动态生成URL，这可以自动处理子目录的问题。原来的模板中退出按钮用的是相对路径，导致错误。所以解决办法是使用Flask的url_for来生成正确的URL。<p>接下来，我需要检查用户提供的代码。在原来的index.html中，退出按钮的HTML代码是：<div class="language-html highlight"><pre><span></span><code><span id=__span-41-1><a href=#__codelineno-41-1 id=__codelineno-41-1 name=__codelineno-41-1></a><span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"location.href='/logout'"</span><span class=p>></span>退出<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span></code></pre></div><p>这会导致无论应用部署在哪个路径下，都会跳转到根目录下的/logout，而不是子目录下的正确路径。<p>解决方案是将硬编码的路径改为使用Flask的url_for函数。修改后的按钮应该是：<div class="language-html highlight"><pre><span></span><code><span id=__span-42-1><a href=#__codelineno-42-1 id=__codelineno-42-1 name=__codelineno-42-1></a><span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"location.href='{{ url_for('logout') }}'"</span><span class=p>></span>退出<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span></code></pre></div><p>这样，Flask会自动生成正确的URL，包含子目录的前缀，比如“/word-mem/logout”。<p>但是，用户可能在之前的修改中已经调整了模板，或者在JavaScript中处理了路径。需要确认用户是否在模板中正确使用了url_for。另外，用户提到现在返回到了/logout，这说明当前的退出链接没有正确包含子目录路径，必须用url_for来动态生成。<p>还需要检查Flask的路由是否正确定义了logout视图函数，确保url_for('logout')能正确指向该路由。在app.py中，logout的路由是@app.route('/logout')，所以url_for('logout')应该生成正确的路径，包括子目录。<p>此外，用户可能没有在Flask应用中配置子目录处理，导致url_for生成的路径不正确。之前用户配置了ReverseProxied中间件来处理SCRIPT_NAME，这样url_for应该能正确生成包含子目录的URL。需要确认中间件是否正常工作，确保HTTP_X_SCRIPT_NAME头被正确设置，这样Flask才能识别子目录。<p>总结步骤：<ol><li><p>修改index.html中的退出按钮，使用url_for生成正确的logout路径。</p><li><p>确保Flask应用配置了处理子目录的中间件，如ReverseProxied。</p><li><p>测试修改后的应用，确认退出按钮跳转到正确的子目录下的logout路径。</p></ol><p>可能遇到的问题：如果中间件配置不正确，url_for可能仍然生成不带子目录的路径。需要检查Nginx配置中的proxy_set_header X-Script-Name是否正确传递了子目录路径，例如设置为/word-mem。同时，确保Flask的ReverseProxied中间件正确处理了这个头信息，修改SCRIPT_NAME和PATH_INFO环境变量。<p>最后，测试退出按钮的跳转，确保点击后正确跳转到子目录下的logout，并重定向到登录页面，路径应为/word-mem/login。</blockquote></details> <p>要使退出按钮正确跳转到子目录下的地址，需要进行以下修改：</p> <p><h3>解决方案（分两步）：</h3> <hr> <p><h4>第一步：修改模板中的退出按钮链接</h4> <p>在 <code>templates/index.html</code> 中将硬编码路径改为使用Flask的 <code>url_for</code></p> <p>原代码：</p> <div class="language-html highlight"><pre><span></span><code><span id=__span-43-1><a href=#__codelineno-43-1 id=__codelineno-43-1 name=__codelineno-43-1></a><span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"location.href='/logout'"</span><span class=p>></span>退出<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span></code></pre></div> <p>修改后：</p> <div class="language-html highlight"><pre><span></span><code><span id=__span-44-1><a href=#__codelineno-44-1 id=__codelineno-44-1 name=__codelineno-44-1></a><span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=s>"location.href='{{ url_for("</span><span class=na>logout</span><span class=err>")</span> <span class=err>}}'"</span><span class=p>></span>退出<span class=p>&lt;/</span><span class=nt>button</span><span class=p>></span>
</span></code></pre></div> <hr> <p><h4>第二步：确保Flask正确处理子目录路由</h4> <p>在 <code>app.py</code> 中补充路由处理（需要与之前的ReverseProxied中间件配合）：</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-45-1><a href=#__codelineno-45-1 id=__codelineno-45-1 name=__codelineno-45-1></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>'/logout'</span><span class=p>)</span>
</span><span id=__span-45-2><a href=#__codelineno-45-2 id=__codelineno-45-2 name=__codelineno-45-2></a><span class=k>def</span><span class=w> </span><span class=nf>logout</span><span class=p>():</span>
</span><span id=__span-45-3><a href=#__codelineno-45-3 id=__codelineno-45-3 name=__codelineno-45-3></a>    <span class=n>session</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>'authenticated'</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-45-4><a href=#__codelineno-45-4 id=__codelineno-45-4 name=__codelineno-45-4></a>    <span class=n>session</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>'last_word'</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-45-5><a href=#__codelineno-45-5 id=__codelineno-45-5 name=__codelineno-45-5></a>    <span class=c1># 使用url_for确保重定向路径正确</span>
</span><span id=__span-45-6><a href=#__codelineno-45-6 id=__codelineno-45-6 name=__codelineno-45-6></a>    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>'login'</span><span class=p>,</span> <span class=n>_external</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></code></pre></div> <hr> <p><h3>完整原理说明：</h3> <ol><li><p><strong>模板渲染机制</strong>：</p> <ul><li><p><code>url_for()</code> 会根据当前应用的上下文自动生成正确的URL</p><li><p>当应用部署在 <code>/word-mem</code> 子目录时，<code>url_for('logout')</code> 会自动生成 <code>/word-mem/logout</code></p></ul><li><p><strong>Nginx与WSGI协作</strong>：</p> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-46-1><a href=#__codelineno-46-1 id=__codelineno-46-1 name=__codelineno-46-1></a><span class=k>location</span><span class=w> </span><span class=s>/word-mem</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-46-2><a href=#__codelineno-46-2 id=__codelineno-46-2 name=__codelineno-46-2></a><span class=w>    </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Script-Name</span><span class=w> </span><span class=s>/word-mem</span><span class=p>;</span><span class=w>  </span><span class=c1># 关键配置</span>
</span><span id=__span-46-3><a href=#__codelineno-46-3 id=__codelineno-46-3 name=__codelineno-46-3></a><span class=w>    </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://localhost:8000</span><span class=p>;</span>
</span><span id=__span-46-4><a href=#__codelineno-46-4 id=__codelineno-46-4 name=__codelineno-46-4></a><span class=p>}</span>
</span></code></pre></div> <ul><li><p>这个头部信息会被ReverseProxied中间件捕获</p><li><p>Flask通过 <code>url_for()</code> 自动将路径前缀添加到所有生成的URL</p></ul><li><p><strong>会话管理</strong>：</p> <ul><li><p>退出时清除所有会话数据</p><li><p>使用 <code>_external=True</code> 确保生成完整URL（应对某些代理场景）</p></ul></ol> <hr> <p><h3>验证方法：</h3> <ol><li><p>在浏览器中打开开发者工具 -> Network标签</p><li><p>点击退出按钮应看到：</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-47-1><a href=#__codelineno-47-1 id=__codelineno-47-1 name=__codelineno-47-1></a>302 Redirect 到 /word-mem/login
</span></code></pre></div><li><p>查看实际的请求路径：</p> <div class="language-http highlight"><pre><span></span><code><span id=__span-48-1><a href=#__codelineno-48-1 id=__codelineno-48-1 name=__codelineno-48-1></a><span class=nf>GET</span> <span class=nn>/word-mem/logout</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></code></pre></div></ol> <hr> <p><h3>补充：如果仍然有问题，可添加路径调试信息</h3> <p>在模板底部添加调试信息：</p> <div class="language-html highlight"><pre><span></span><code><span id=__span-49-1><a href=#__codelineno-49-1 id=__codelineno-49-1 name=__codelineno-49-1></a><span class=cm>&lt;!-- 在index.html底部添加 --></span>
</span><span id=__span-49-2><a href=#__codelineno-49-2 id=__codelineno-49-2 name=__codelineno-49-2></a><span class=p>&lt;</span><span class=nt>script</span><span class=p>></span>
</span><span id=__span-49-3><a href=#__codelineno-49-3 id=__codelineno-49-3 name=__codelineno-49-3></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>"退出路径："</span><span class=p>,</span><span class=w> </span><span class=s1>'{{ url_for("logout") }}'</span><span class=p>)</span>
</span><span id=__span-49-4><a href=#__codelineno-49-4 id=__codelineno-49-4 name=__codelineno-49-4></a><span class=p>&lt;/</span><span class=nt>script</span><span class=p>></span>
</span></code></pre></div> <p>正确输出应为：</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-50-1><a href=#__codelineno-50-1 id=__codelineno-50-1 name=__codelineno-50-1></a>退出路径： /word-mem/logout
</span></code></pre></div> <hr> <p><h3>最终效果：</h3> <table><thead><tr><th>部署位置<th>点击退出按钮后的跳转地址<tbody><tr><td>根目录<td>/logout → /login<tr><td>子目录<td>/word-mem/logout → /word-mem/login</table> <p>这个方案可以自动适应不同的部署路径，无需硬编码任何URL地址。</p></details><p>最后按照deepseek给出的方法修改，就可以正确地退出了<h2>最终实现的代码仓库</h2><ul><li><a href=https://github.com/RonaldLN/word-memory-test>github.com/RonaldLN/word-memory-test</a></ul><hr><div class=md-source-file><small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-03-28T07:54:06+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-28</span> <br> 创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-03-22T11:25:21+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-22</span> </small></div><h2 id=__comments>评论</h2><script async crossorigin data-category=Announcements data-category-id=DIC_kwDOKTCz0s4CZ2M5 data-emit-metadata=1 data-input-position=top data-lang=zh-CN data-loading=lazy data-mapping=pathname data-reactions-enabled=1 data-repo=RonaldLN/MyPamphlet-Blog data-repo-id=R_kgDOKTCz0g data-strict=0 data-theme=https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow.css src=https://giscus.app/client.js></script><script>var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "sunset-glow-dark"
        ? "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow_dark.css"
        : "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow.css"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "sunset-glow-dark"
            ? "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow_dark.css"
            : "https://cdn.jsdelivr.net/gh/RonaldLN/MyPamphlet-Blog@main/docs/stylesheets/giscus_sunset_glow.css"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })</script></article></div></div><button class="md-top md-icon" data-md-component=top hidden type=button><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部</button></main><footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=页脚><a aria-label="上一页: 询问DeepSeek如何实现服务器上根目录自动跳转到一级目录的记录" class="md-footer__link md-footer__link--prev" href=../../22/deepseek/> <div class="md-footer__button md-icon"><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg></div> <div class=md-footer__title><span class=md-footer__direction> 上一页 </span><div class=md-ellipsis>询问DeepSeek如何实现服务器上根目录自动跳转到一级目录的记录</div></div> </a><a aria-label="下一页: 实现麦克风录音并使用faster-whisper无文件读写地进行语音识别" class="md-footer__link md-footer__link--next" href=../../26/faster-whisper/> <div class=md-footer__title><span class=md-footer__direction> 下一页 </span><div class=md-ellipsis>实现麦克风录音并使用faster-whisper无文件读写地进行语音识别</div></div> <div class="md-footer__button md-icon"><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg></div> </a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight>Copyright © 2023 - 2025 Ronald Luo</div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><div class=md-progress data-md-component=progress role=progressbar></div><script id=__config type=application/json>{"base": "../../../..", "features": ["navigation.expand", "toc.follow", "navigation.top", "search.suggest", "navigation.footer", "navigation.tabs", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "content.code.copy", "search.suggest", "search.highlight", "search.share"], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script><script src=../../../../assets/javascripts/bundle.aecac24b.min.js></script><script src=../../../../js/timeago.min.js></script><script src=../../../../js/timeago_mkdocs_material.js></script><script src=../../../../javascripts/katex.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js></script><script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script>